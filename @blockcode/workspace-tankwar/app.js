var _r=Object.defineProperty;var Nr=(s,l)=>{for(var R in l)_r(s,R,{get:l[R],enumerable:!0,configurable:!0,set:(A)=>l[R]=()=>A})};var xa=((s)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(s,{get:(l,R)=>(typeof require!=="undefined"?require:l)[R]}):s)(function(s){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+s+'" is not supported')});import{Text as No} from"@blockcode/ui";import{Text as wn} from"@blockcode/ui";import{Keys as Da,useLayout as Ar,useEditor as Fr} from"@blockcode/core";import{Text as ya,MenuSection as ro,MenuItem as Ca} from"@blockcode/ui";import{ScratchBlocks as Mr} from"@blockcode/blocks-editor";import{jsx as ka,jsxs as gn,Fragment as Ur} from"preact/jsx-runtime";var xr=function({itemClassName:s,onNew:l,onSave:R,children:A}){const{createPrompt:F,setStoreLibrary:j}=Ar(),{modified:Y,saveNow:q}=Fr();return gn(Ur,{children:[gn(ro,{children:[ka(Ca,{className:s,label:ka(ya,{id:"blocks.menu.file.newProject",defaultMessage:"New"}),hotkey:[qn?Da.COMMAND:Da.CONTROL,Da.N],onClick:()=>{if(Y)F({title:ka(ya,{id:"gui.projects.notSaved",defaultMessage:"Not saved"}),label:ka(ya,{id:"gui.projects.replaceProject",defaultMessage:"Replace contents of the current project?"}),onSubmit:l});else l()}}),ka(Ca,{className:s,label:ka(ya,{id:"blocks.menu.file.openProject",defaultMessage:"Open"}),hotkey:[qn?Da.COMMAND:Da.CONTROL,Da.O],onClick:()=>j(!0)}),ka(Ca,{className:s,label:ka(ya,{id:"blocks.menu.file.saveProject",defaultMessage:"Save"}),hotkey:[qn?Da.COMMAND:Da.CONTROL,Da.S],onClick:async()=>{let S,O;const ke=Mr.getMainWorkspace();if(ke)S=await $r.svgAsDataUri(ke.getCanvas(),{}),O=Array.from(new Set(Object.values(ke.blockDB_).filter((ue)=>["nes","translate","color-sensor","servo","time","pen","brain","request","text","broadcast"].find((ce)=>ce===ue.category_)).map((ue)=>ue.category_)));q((ue)=>{const ce={thumb:S,...ue,...R?R():{},editor:{...ue.editor,extensions:O}};return ce.fileList=ce.fileList.map((ee)=>({...ee,script:void 0,content:void 0})),ce})}})]}),gn(ro,{children:[ka(Ca,{disabled:!0,className:s,label:ka(ya,{id:"blocks.menu.file.uploadProject",defaultMessage:"Load from your computer"})}),ka(Ca,{disabled:!0,className:s,label:ka(ya,{id:"blocks.menu.file.downloadProject",defaultMessage:"save to your computer"})})]}),A]})};import{useEffect as yr,useState as Jn} from"preact/hooks";import{Keys as Ja} from"@blockcode/core";import{Text as so,MenuSection as Qr,MenuItem as io} from"@blockcode/ui";import{ScratchBlocks as Xr} from"@blockcode/blocks-editor";import{jsx as tn,jsxs as lo,Fragment as Br} from"preact/jsx-runtime";var Vr=function({itemClassName:s,children:l}){const[R,A]=Jn(!0),[F,j]=Jn(!0),[Y,q]=Jn(null),S=Xr.getMainWorkspace();if(S){if(Y?.id!==S.id)q(S)}return yr(()=>{if(Y)Y.addChangeListener(()=>{A(Y.undoStack_.length===0),j(Y.redoStack_.length===0)}),A(Y.undoStack_.length===0),j(Y.redoStack_.length===0)},[Y]),lo(Br,{children:[lo(Qr,{children:[tn(io,{disabled:R,className:s,label:tn(so,{id:"blocks.menu.edit.undo",defaultMessage:"Undo"}),hotkey:[co?Ja.COMMAND:Ja.CONTROL,Ja.Z],onClick:async(O)=>{if(O instanceof MouseEvent&&Y)Y.undo(!1)}}),tn(io,{disabled:F,className:s,label:tn(so,{id:"blocks.menu.edit.redo",defaultMessage:"Redo"}),hotkey:co?[Ja.SHIFT,Ja.COMMAND,Ja.Z]:[Ja.CONTROL,Ja.Y],onClick:async(O)=>{if(O instanceof MouseEvent&&Y)Y.undo(!0)}})]}),l]})};import{useState as Yr} from"preact/hooks";import{useLocale as jr,useLayout as Wr,useEditor as Lr} from"@blockcode/core";import{Text as Tn,Spinner as Or,MenuSection as Gr,MenuItem as Sr} from"@blockcode/ui";import{Serial as Zr,sleep as fn} from"@blockcode/core";var Dr=function(s,l){const R=`data:${s};base64,${l}`;return fetch(R).then((A)=>A.arrayBuffer())},zn=function(s){return s.replaceAll("\r\n","\n")},Cn=function(s){return s.slice(2,-3)},fr="\x01",Pn="\x02",Dn="\x03",hn="\x04",vn=1024;class Hn{constructor(){this.serial=null,this._connected=!1,this._encoder=new TextEncoder,this._decoder=new TextDecoder}requestPort(s=[]){return navigator.serial.requestPort({filters:s}).then((l)=>{if(l._serial){this.serial=l._serial,this.serial.on("connect",()=>this._connected=!0),this.serial.on("disconnect",()=>this._connected=!1);return}this.serial=new Zr(l),this.serial.on("connect",()=>this._connected=!0),this.serial.on("disconnect",()=>this._connected=!1)})}connect(s={}){return new Promise((l,R)=>{if(this.serial)this.serial.open({baudRate:1500000,...s}).then(()=>l()).catch((A)=>{if(A.name==="InvalidStateError")this._connected=!0,l();R(A)});else R(new Error("No device specified"))})}get connected(){return this._connected}disconnect(){return this.serial.close()}get deviceInfo(){return this.serial.getInfo()}readUntil(s,l){return new Promise((R)=>{let A="";const F=async(j)=>{if(j){if(A+=this._decoder.decode(j),l)l(j)}if(A.indexOf(s)!==-1)this.serial.off("data",F),R(A)};this.serial.on("data",F)})}writeAndReadUntil(s,l,R){return new Promise(async(A)=>{if(l)this.readUntil(l,R).then(A);for(let F=0;F<s.length;F+=vn)await this.serial.write(s.slice(F,F+vn)),await fn(10);if(!l)A()})}async getPrompt(){return await fn(150),await this.stop(),await fn(150),await this.writeAndReadUntil(`\r${Dn}${Pn}`,"\r\n>>>")}async enterRawRepl(){return await this.writeAndReadUntil(fr,"raw REPL; CTRL-B to exit")}async exitRawRepl(){return await this.writeAndReadUntil(Pn,"\r\n>>>")}async execRaw(s,l){return await this.writeAndReadUntil(s),await this.writeAndReadUntil(hn,`${hn}>`,l)}async execFile(s,l){if(l=l||function(){},s){await this.enterRawRepl();const R=await this.execRaw(s,l);return await this.exitRawRepl(),R}return Promise.reject()}async run(s,l){return l=l||function(){},new Promise(async(R,A)=>{if(this.rejectRun)this.rejectRun(new Error("re-run")),this.rejectRun=null;this.rejectRun=A;try{await this.enterRawRepl();const F=await this.execRaw(s||"#",l);return await this.exitRawRepl(),R(F)}catch(F){A(F),this.rejectRun=null}})}async eval(s){await this.serial.write(s)}async stop(){if(this.rejectRun)this.rejectRun(new Error("pre stop")),this.rejectRun=null;await this.serial.write(Dn)}async reset(){if(this.rejectRun)this.rejectRun(new Error("pre reset")),this.rejectRun=null;await this.serial.write(Dn),await this.serial.write(hn)}async hardwareReset(){if(this.rejectRun)this.rejectRun(new Error("pre reset")),this.rejectRun=null;await this.enterRawRepl(),this.execRaw("import machine\nmachine.reset()")}async exists(s){s=s||"";let l="";l+="try:\n",l+=`  f = open('${s}', 'r')\n`,l+="  print(1)\n",l+="except OSError:\n",l+="  print(0)\n",await this.enterRawRepl();const R=await this.execRaw(l);return await this.exitRawRepl(),R[2]=="1"}async listdir(s){s=s||"";let l="";l+="import os\n",l+="try:\n",l+=`  print(os.listdir('${s}'))\n`,l+="except OSError:\n",l+="  print([])\n",await this.enterRawRepl();let R=await this.execRaw(l);return await this.exitRawRepl(),R=Cn(R),R=R.replace(/'/g,'"'),JSON.parse(R)}async mkdir(s){if(s){await this.enterRawRepl();const l=await this.execRaw(`import os\nos.mkdir('${s}')`);return await this.exitRawRepl(),l}return Promise.reject(new Error("Path to file was not specified"))}async rmdir(s){if(s){let l="";l+="import os\n",l+="try:\n",l+=`  os.rmdir("${s}")\n`,l+="except OSError:\n",l+="  print(0)\n",await this.enterRawRepl();const R=await this.execRaw(l);return await this.exitRawRepl(),R}return Promise.reject(new Error("Path to file was not specified"))}async remove(s){if(s){let l="";l+="import os\n",l+="try:\n",l+=`  os.remove("${s}")\n`,l+="except OSError:\n",l+="  print(0)\n",await this.enterRawRepl();const R=await this.execRaw(l);return this.exitRawRepl(),R}return Promise.reject(new Error("Path to file was not specified"))}async rename(s,l){if(s&&l){await this.enterRawRepl();const R=await this.execRaw(`import os\nos.rename('${s}', '${l}')`);return this.exitRawRepl(),R}return Promise.reject(new Error("Path to file was not specified"))}async cat(s){if(s){await this.enterRawRepl();let l=await this.execRaw(`with open('${s}','r') as f:\n while 1:\n  b=f.read(256)\n  if not b:break\n  print(b,end='')`);return await this.exitRawRepl(),l=Cn(l),zn(l)}return Promise.reject(new Error("Path to file was not specified"))}async checkHash(s,l){if(s){let R="";R+="import os\n",R+="import hashlib\n",R+="import binascii\n",R+="hash = hashlib.sha256()\n",R+=`with open('${s}', 'rb') as f:\n`,R+="  while True:\n",R+=`    c = f.read(${vn})\n`,R+="    if not c: break\n",R+="    hash.update(c)\n",R+="print(binascii.hexlify(hash.digest()).decode())\n",await this.enterRawRepl();let A=await this.execRaw(R);return await this.exitRawRepl(),A=A.slice(2,A.indexOf("\n")-1),l===A}return Promise.reject(new Error("Path to file was not specified"))}async put(s,l,R){if(!l){Promise.reject(new Error("Must specify content and destination path"));return}let A;if(typeof s==="string")A=this._encoder.encode(zn(s));else if(s instanceof ArrayBuffer)A=new Uint8Array(s);else if(s instanceof Uint8Array)A=s;else Promise.reject(new Error(`${s} must string, Uint8Array or ArrayBuffer`));if(R=R||function(){},await this.exists(l)){const S=await crypto.subtle.digest("SHA-256",A),O=Array.from(new Uint8Array(S)).map((ke)=>ke.toString(16).padStart(2,"0")).join("");if(await this.checkHash(l,O)){R(100);return}}const F=Array.from(A).map((S)=>S.toString(16).padStart(2,"0"));let j="";j+=await this.enterRawRepl();let Y=l.split("/");if(Y.pop(),Y.length>0){j+=await this.execRaw("import os");const S=[];Y.reduce((O,ke)=>{if(ke===""||O!==""&&O.at(-1)!=="/")O+="/";if(O+=ke,O!=="/")S.push(O);return O},"");for(let O of S)j+=await this.execRaw(`os.mkdir('${O}')`)}j+=await this.execRaw(`f=open('${l}','w')\nw=f.write`);const q=48;for(let S=0;S<F.length;S+=q){let O=`w(bytes([${F.slice(S,S+q).map((ke)=>`0x${ke}`).join(",")}]))`;j+=await this.execRaw(O),R(parseInt(S/F.length*100))}return j+=await this.execRaw("f.close()"),j+=await this.exitRawRepl(),R(100),j}}var eo=async(s,l)=>{const R=new Hn;await R.requestPort(s),await R.connect(),await R.stop(),l(R);const A=()=>setTimeout(async()=>{if(R.connected)A();else l(null)},1000);return A(),R};var ao=async(s,l)=>{await s.stop(),await s.enterRawRepl(),await s.execRaw(`from ${l} import display`),await s.execRaw("import popui.download_screen as download_screen"),await s.execRaw("download_screen.render(display)"),await s.exitRawRepl()};var no=async(s,l,R,A=!1)=>{await s.stop();const F=l.length;let j=0;const Y=(q)=>{R(((j+1/F*(q/100))*100).toFixed(1))};for(let q of l){let{id:S,content:O}=q;if(q.type){if(q.type==="text/x-python"&&!S.endsWith(".py"))S+=".py";else if(q.type.startsWith("image/")&&!O)O=await Dr(q.type,q.data)}await s.put(O||"",S,Y),j+=1/F}if(R(100),A)await s.reset();else await s.hardwareReset()};import{jsx as ja,jsxs as zr,Fragment as Cr} from"preact/jsx-runtime";var Pr=function({itemClassName:s,deviceName:l,deviceFilters:R,downloadScreen:A,onDownload:F,children:j}){const[Y,q]=Yr(!1),{maybeLocaleText:S}=jr(),{createAlert:O,removeAlert:ke}=Wr(),{key:ue,name:ce,fileList:ee,assetList:Te,device:U,setDevice:qe}=Lr(),oe=()=>q(!1),oa=()=>q(!0),re=(ra)=>{if(!re.id)re.id=`download.${Date.now()}`,oa();if(ra<100)O({id:re.id,icon:ja(Or,{level:"success"}),message:ja(Tn,{id:"blocks.alert.downloading",defaultMessage:"Downloading...{progress}%",progress:ra})});else O({id:re.id,icon:null,message:ja(Tn,{id:"blocks.alert.downloadCompleted",defaultMessage:"Download completed."})}),setTimeout(()=>{ke(re.id),oe(),delete re.id},1000)};return zr(Cr,{children:[ja(Gr,{children:ja(Sr,{disabled:Y,className:s,label:ja(Tn,{id:"blocks.menu.device.download",defaultMessage:"Download program"}),onClick:async()=>{if(re.id)return;try{const ra=U||await eo(R||Kr,qe);if(A)await ao(ra,A);let Ze=F?F(ce,ee,Te):[].concat(Te);Ze=Ze.map((Qe)=>({...Qe,id:Qe.id[0]!=="_"?`proj${ue}/${Qe.id}`:Qe.id})),no(ra,Ze,re)}catch(ra){}}})}),j]})};import{jsx as Wa} from"preact/jsx-runtime";var Zo=function({deviceName:s,deviceFilters:l,createDefaultProject:R,saveCurrentProject:A,downloadProjectToDevice:F,showDownloadScreen:j}){return[{icon:Hr,label:Wa(wn,{id:"blocks.menu.file",defaultMessage:"File"}),Menu:({itemClassName:Y,children:q})=>Wa(xr,{itemClassName:Y,onNew:R,onSave:A,children:q})},{icon:es,label:Wa(wn,{id:"blocks.menu.edit",defaultMessage:"Edit"}),Menu:({itemClassName:Y,children:q})=>Wa(Vr,{itemClassName:Y,children:q})},{icon:as,label:Wa(wn,{id:"blocks.menu.device",defaultMessage:"Device"}),Menu:({itemClassName:Y,children:q})=>Wa(Pr,{deviceName:s,itemClassName:Y,deviceFilters:l,downloadScreen:j,onDownload:F,children:q})}]};import{ScratchBlocks as ta} from"@blockcode/blocks-editor";import{ScratchBlocks as Ve} from"@blockcode/blocks-editor";import{ScratchBlocks as fo} from"@blockcode/blocks-editor";import{useEffect as os,useState as Rn} from"preact/hooks";import{useLocale as rs,useLayout as ss,useEditor as uo} from"@blockcode/core";import{classNames as is} from"@blockcode/ui";import{BlocksEditor as ls,ScratchBlocks as ia,makeToolboxXML as cs} from"@blockcode/blocks-editor";import{ScratchBlocks as mo,blockSeparator as us} from"@blockcode/blocks-editor";var ds=function(s,l,R,A){const{id:F}=s,j=R(s.name);let Y=`<category name="${Ta(j)}" id="${Ta(F)}"`;if(Y+=` colour="${Ta(s.themeColor||to)}"`,Y+=` secondaryColour="${Ta(s.inputColor||Ro)}"`,s.connectionConfig)Y+=' showStatusButton="true"';if(s.iconURI)Y+=` iconURI="${Ta(s.iconURI)}"`;return Y+=">",s.blocks.forEach((q)=>{if(q==="---"){Y+=`${us}`;return}if(q.button){Y+=`<button text="${R(q.text)}" callbackKey="${q.button}"></button>`;const ce=mo.getMainWorkspace();if(ce){const ee=ce.getFlyout();if(ee){const Te=ee.getWorkspace();if(Te)Te.registerButtonCallback(q.button,A(q.onClick))}}return}if(l&&q.useStage===!1)return;if(!l&&q.useSprite===!1)return;const S=`${F}_${q.id.toLowerCase()}`,O={message0:R(q.text),category:F,outputShape:Rs,colour:s.themeColor||to,colourSecondary:s.inputColor||Ro,colourTertiary:s.otherColor||ks};let ke=1;if(s.iconURI)O.message0=`%1 %2 ${O.message0}`,O.args0=[{type:"field_image",src:s.iconURI,width:40,height:40},{type:"field_vertical_separator"}],O.extensions=["scratch_extension"],ke+=2;if(q.hat)O.nextStatement=null;else if(q.output){if(q.output==="boolean")O.output="Boolean",O.outputShape=ms;else O.output="String",O.outputShape=ts;O.checkboxInFlyout=q.monitoring!==!1}else O.previousStatement=null,O.nextStatement=null;let ue=`<block type="${Ta(S)}">`;if(q.inputs)O.checkboxInFlyout=!1,O.args0=[].concat(O.args0||[],Object.entries(q.inputs).map(([ce,ee])=>{const Te={name:ce,type:"input_value"};if(ee.menu)Te.type="field_dropdown",Te.options=ee.menu.map(([U,qe])=>[R(U),qe]);else if(ee.type==="boolean")Te.check="Boolean";else{if(ue+=`<value name="${Ta(ce)}">`,ko[ee.type]){if(ue+=`<shadow type="${ko[ee.type]}">`,ee.default&&Eo[ee.type])ue+=`<field name="${Eo[ee.type]}">${Ta(R(ee.default))}</field>`;ue+="</shadow>"}ue+="</value>"}return O.message0=O.message0.replace(`[${ce}]`,`%${ke++}`),Te}));if(mo.Blocks[S]={init(){this.jsonInit(O)}},q.python)h[S]=q.python.bind(h);else h[S]=()=>"";ue+="</block>",Y+=ue}),Y+="</category>",Y};import{useRef as Es,useEffect as ps,useState as po} from"preact/hooks";import{classNames as bs,Text as La,Button as bo,Modal as Is,BufferedInput as _s} from"@blockcode/ui";var Do=function(s){const l=globalThis.document,R=l.createElement("style");R.appendChild(l.createTextNode(s)),l.head.append(R)};import{jsx as la,jsxs as Pa} from"preact/jsx-runtime";var Ns=function({title:s,label:l,defaultValue:R,enableLocalVariable:A,showListMessage:F,showVariableOptions:j,showCloudOption:Y,onClose:q,onSubmit:S}){const O=Es(null),[ke,ue]=po(R),[ce,ee]=po({scope:"global",isCloud:!1}),Te=()=>{S(ke,ce)},U=(qe)=>{if(qe.key==="Escape")q();if(qe.key==="Enter")S(O.current.base.value,ce)};return ps(()=>{if(O.current)O.current.base.focus(),window.addEventListener("keydown",U);return()=>{window.removeEventListener("keydown",U)}},[O]),la(Is,{title:s,className:Na.promptModal,onClose:q,children:Pa("div",{className:Na.promptContent,children:[la("div",{className:Na.label,children:l}),la(_s,{autoFocus:!0,forceFocus:!0,ref:O,className:Na.variableNameTextInput,defaultValue:ke,onSubmit:ue}),j&&la("div",{children:A?Pa("div",{className:Na.options,children:[Pa("label",{children:[la("input",{checked:ce.scope==="global",name:"variableScopeOption",type:"radio",value:"global",onChange:()=>ee({...ce,scope:"global"})}),la(La,{id:"blocks.dataPrompt.forAllTargets",defaultMessage:"For all targets"})]}),Pa("label",{children:[la("input",{checked:ce.scope==="local",name:"variableScopeOption",type:"radio",value:"local",onChange:()=>ee({...ce,scope:"local"})}),la(La,{id:"blocks.dataPrompt.forThisTarget",defaultMessage:"For this target only"})]})]}):la("div",{className:Na.infoMessage,children:F?la(La,{id:"blocks.dataPrompt.listAvailableToAllTargets",defaultMessage:"This list will be available to all targets."}):la(La,{id:"blocks.dataPrompt.availableToAllTargets",defaultMessage:"This variable will be available to all targets."})})}),Pa("div",{className:Na.buttonRow,children:[la(bo,{className:Na.button,onClick:q,children:la(La,{id:"blocks.dataPrompt.cancel",defaultMessage:"Cancel"})}),la(bo,{className:bs(Na.button,Na.okButton),onClick:Te,children:la(La,{id:"blocks.dataPrompt.ok",defaultMessage:"OK"})})]})]})})};import{useEffect as Zs,useState as Io} from"preact/hooks";import{useLocale as fs,useLayout as Ds,useEditor as hs} from"@blockcode/core";import{Library as vs} from"@blockcode/ui";import{jsx as gs} from"preact/jsx-runtime";var Js=function({deviceId:s,onSelect:l,onClose:R,onFilter:A}){const[F,j]=Io([]),[Y,q]=Io(!1),{language:S,getText:O}=fs(),{createAlert:ke,removeAlert:ue}=Ds(),{addAsset:ce}=hs(),ee=(Te)=>{const U=Te.tags||[];let qe=["blocks",["dupont","data"],["3v3","5v"]];if(A)qe=A(U);if(Array.isArray(qe))return qe.every((oe)=>{if(Array.isArray(oe))return oe.some((oa)=>U.includes(oa));return U.includes(oe)});return qe};return Zs(()=>{qs.then((Te)=>{j(Te.filter(ee).map((U)=>Object.assign({...U,featured:!0,disabled:U.disabled||U.preview,onSelect:async()=>{ke("importing",{id:U.id});let{default:qe}=await import(`@blockcode/extension-${U.id}/blocks`);if(typeof qe==="function")qe=qe(s);if(qe.id=U.id,qe.files)qe.files.forEach(async(oe)=>{const oa=`extensions/${U.id.replace(/[^a-z\d]/gi,"_")}/${oe.name}`,re=await fetch(oe.uri).then((ra)=>ra.text());ce({...oe,id:oa,content:re})});l(qe),ue(U.id),R()}},U.translations&&U.translations[S]?{name:U.translations[S].name||U.name,description:U.translations[S].description||U.description,collaborator:U.translations[S].collaborator||U.collaborator}:{}))),q(!1)})},[]),gs(vs,{filterable:!0,loading:Y,items:F,filterPlaceholder:O("gui.library.search","Search"),title:O("blocks.extensions.addExtension","Add Extension"),emptyText:O("blocks.extensions.empty","No extension!"),onClose:R})};import{jsx as Oa,jsxs as _o,Fragment as $s} from"preact/jsx-runtime";var Fs=function({toolbox:s,messages:l,enableMultiTargets:R,enableLocalVariable:A,disableGenerator:F,disableExtension:j,deviceId:Y,onChange:q,onExtensionsFilter:S,onLoadExtension:O}){const{addLocaleData:ke,getText:ue,maybeLocaleText:ce}=rs(),{splash:ee,createPrompt:Te,createAlert:U,removeAlert:qe,setSplash:oe}=ss(),{editor:oa,fileList:re,selectedFileId:ra,openFile:Ze,modifyFile:Qe,modifyAsset:ba,setModified:de}=uo(),[Ke,Ia]=Rn(),[ie,H]=Rn(!1),[ae,z]=Rn(!1),[le,C]=Rn(!1);if(ee){if(ee===!0&&le===!1)Za.clear(),C(setTimeout(()=>{C(As(Y,oa.extensions,ke,ba,O).then(()=>C(!0)))},100));if(le===!0){let K=!0;if(re.length>1){for(let fe=0;fe>-re.length;fe--)if(!re.at(fe).content){K=!1,setTimeout(()=>{const Fe=(fe+re.length)%re.length;Ze(re[Fe].id)},100);break}}if(K)setTimeout(()=>{oe(!1),de(!1)},100)}}l={EVENT_WHENPROGRAMSTART:ue("blocks.event.programStart","when program start"),CONTROL_STOP_OTHER:ue("blocks.control.stopOther","other scripts"),...l||[]},os(()=>{ia.prompt=(K,fe,Fe,Xe,$e)=>{const Ae={callback:Fe,message:K,defaultValue:fe};Ae.title=Xe?Xe:ia.Msg.VARIABLE_MODAL_TITLE,Ae.varType=typeof $e==="string"?$e:ia.SCALAR_VARIABLE_TYPE,Ae.showVariableOptions=R&&$e!==ia.BROADCAST_MESSAGE_VARIABLE_TYPE&&Ae.title!==ia.Msg.RENAME_VARIABLE_MODAL_TITLE&&Ae.title!==ia.Msg.RENAME_LIST_MODAL_TITLE,Ae.showCloudOption=$e===ia.SCALAR_VARIABLE_TYPE&&this.props.canUseCloud,H(Ae)},ia.FlyoutExtensionCategoryHeader.getExtensionState=(K)=>{if(Za.has(K)){const fe=Za.get(K);if(fe.connectionConfig?.items.every((Fe)=>localStorage.getItem(`${fe.id}.connection.${Fe.id}`)))return ia.StatusButtonState.READY}return ia.StatusButtonState.NOT_READY},ia.statusButtonCallback=(K)=>{if(!Za.has(K))return;const fe=Za.get(K),{connectionConfig:Fe}=fe;if(!Fe)return;Te({title:fe.name,label:Fe.title,inputMode:Fe.items.map((Xe)=>({name:Xe.id,placeholder:Xe.text,defaultValue:localStorage.getItem(`${fe.id}.connection.${Xe.id}`)})),content:Fe.description,onSubmit:(Xe)=>{if(Object.entries(Xe).forEach(([$e,Ae])=>{localStorage.setItem(`${fe.id}.connection.${$e}`,`${Ae}`)}),Ke)ia.refreshStatusButtons(Ke)}})}},[Ke]);let De;if(Ke)De=Ke.getAllVariables().filter((K)=>{if(K.isLocal)return!1;if(K.type===ia.BROADCAST_MESSAGE_VARIABLE_TYPE){if(K.name===ia.Msg.DEFAULT_BROADCAST_MESSAGE_NAME)return!1;const fe=K.id_.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Fe=new RegExp(`<field name="BROADCAST_OPTION" id="${fe}"[^>]+>[^<]+</field>`,"g");for(let Xe of re)if(Fe.test(Xe.xml))return!0;return!1}return!0});let L=s||cs();const je=ra===re[0].id,Pe=(K)=>K.bind(null,{context:uo(),createPrompt:Te,createAlert:U,removeAlert:qe});Za.forEach((K)=>{L+=ds(K,je,ce,Pe)});const Ee=(K,fe)=>{let Fe;if(!F)Fe=h.workspaceToCode(fe);if(Qe({xml:K,content:Fe}),q)q(K,fe)},We=(K,fe)=>{ie.callback(K,[],fe),H(!1)},sa=()=>H(!1),Le=()=>z(!0),He=()=>z(!1),Oe=(K)=>{if(!Za.has(K.id)){if(ke(K.translations),O)O({...K,blocks:K.blocks.filter(ho)});Za.set(K.id,K)}setTimeout(()=>{Ke.toolbox_.setSelectedCategoryById(K.id)},100)};return _o($s,{children:[_o("div",{className:$n.editorWrapper,children:[Oa(ls,{toolbox:L,messages:l,globalVariables:De,onWorkspaceCreated:Ia,onChange:ra!==null?Ee:null}),j?null:Oa("div",{className:is("scratchCategoryMenu",$n.extensionButton),children:Oa("button",{className:$n.addButton,title:ue("blocks.extensions.addExtension","Add Extension"),onClick:Le,children:Oa("img",{src:Ts,title:"Add Extension"})})}),ie&&Oa(Ns,{title:ie.title,label:ie.message,defaultValue:ie.defaultValue,enableLocalVariable:A,showListMessage:ie.varType===ia.LIST_VARIABLE_TYPE,showVariableOptions:ie.showVariableOptions,showCloudOption:ie.showCloudOption,onClose:sa,onSubmit:We}),ae&&Oa(Js,{deviceId:Y,onFilter:S,onSelect:Oe,onClose:He})]}),!1]})};import{jsx as vo} from"preact/jsx-runtime";var hr=Object.create,{defineProperty:oo,getPrototypeOf:vr,getOwnPropertyNames:wr}=Object,gr=Object.prototype.hasOwnProperty,qr=(s,l,R)=>{R=s!=null?hr(vr(s)):{};const A=l||!s||!s.__esModule?oo(R,"default",{value:s,enumerable:!0}):R;for(let F of wr(s))if(!gr.call(A,F))oo(A,F,{get:()=>s[F],enumerable:!0});return A},Jr=(s,l)=>()=>(l||s((l={exports:{}}).exports,l),l.exports),Tr=Jr((s)=>{(function(){var l=typeof s!="undefined"&&s||typeof define!="undefined"&&{}||this||window;if(typeof define!=="undefined")define("save-svg-as-png",[],function(){return l});l.default=l;var R="http://www.w3.org/2000/xmlns/",A="http://www.w3.org/1999/xhtml",F="http://www.w3.org/2000/svg",j='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" [<!ENTITY nbsp "&#160;">]>',Y=/url\(["']?(.+?)["']?\)/,q={woff2:"font/woff2",woff:"font/woff",otf:"application/x-font-opentype",ttf:"application/x-font-ttf",eot:"application/vnd.ms-fontobject",sfnt:"application/font-sfnt",svg:"image/svg+xml"},S=function ie(H){return H instanceof HTMLElement||H instanceof SVGElement},O=function ie(H){if(!S(H))throw new Error("an HTMLElement or SVGElement is required; got "+H)},ke=function ie(H){return new Promise(function(ae,z){if(S(H))ae(H);else z(new Error("an HTMLElement or SVGElement is required; got "+H))})},ue=function ie(H){return H&&H.lastIndexOf("http",0)===0&&H.lastIndexOf(window.location.host)===-1},ce=function ie(H){var ae=Object.keys(q).filter(function(z){return H.indexOf("."+z)>0}).map(function(z){return q[z]});if(ae)return ae[0];return console.error("Unknown font format for "+H+". Fonts may not be working correctly."),"application/octet-stream"},ee=function ie(H){var ae="",z=new Uint8Array(H);for(var le=0;le<z.byteLength;le++)ae+=String.fromCharCode(z[le]);return window.btoa(ae)},Te=function ie(H,ae,z){var le=H.viewBox&&H.viewBox.baseVal&&H.viewBox.baseVal[z]||ae.getAttribute(z)!==null&&!ae.getAttribute(z).match(/%$/)&&parseInt(ae.getAttribute(z))||H.getBoundingClientRect()[z]||parseInt(ae.style[z])||parseInt(window.getComputedStyle(H).getPropertyValue(z));return typeof le==="undefined"||le===null||isNaN(parseFloat(le))?0:le},U=function ie(H,ae,z,le){if(H.tagName==="svg")return{width:z||Te(H,ae,"width"),height:le||Te(H,ae,"height")};else if(H.getBBox){var C=H.getBBox(),De=C.x,L=C.y,je=C.width,Pe=C.height;return{width:De+je,height:L+Pe}}},qe=function ie(H){return decodeURIComponent(encodeURIComponent(H).replace(/%([0-9A-F]{2})/g,function(ae,z){var le=String.fromCharCode("0x"+z);return le==="%"?"%25":le}))},oe=function ie(H){var ae=window.atob(H.split(",")[1]),z=H.split(",")[0].split(":")[1].split(";")[0],le=new ArrayBuffer(ae.length),C=new Uint8Array(le);for(var De=0;De<ae.length;De++)C[De]=ae.charCodeAt(De);return new Blob([le],{type:z})},oa=function ie(H,ae){if(!ae)return;try{return H.querySelector(ae)||H.parentNode&&H.parentNode.querySelector(ae)}catch(z){console.warn('Invalid CSS selector "'+ae+'"',z)}},re=function ie(H,ae){var z=H.cssText.match(Y),le=z&&z[1]||"";if(!le||le.match(/^data:/)||le==="about:blank")return;var C=le.startsWith("../")?ae+"/../"+le:le.startsWith("./")?ae+"/."+le:le;return{text:H.cssText,format:ce(C),url:C}},ra=function ie(H){return Promise.all(Array.from(H.querySelectorAll("image")).map(function(ae){var z=ae.getAttributeNS("http://www.w3.org/1999/xlink","href")||ae.getAttribute("href");if(!z)return Promise.resolve(null);if(ue(z))z+=(z.indexOf("?")===-1?"?":"&")+"t="+(new Date()).valueOf();return new Promise(function(le,C){var De=document.createElement("canvas"),L=new Image;L.crossOrigin="anonymous",L.src=z,L.onerror=function(){return C(new Error("Could not load "+z))},L.onload=function(){De.width=L.width,De.height=L.height,De.getContext("2d").drawImage(L,0,0),ae.setAttributeNS("http://www.w3.org/1999/xlink","href",De.toDataURL("image/png")),le(!0)}})}))},Ze={},Qe=function ie(H){return Promise.all(H.map(function(ae){return new Promise(function(z,le){if(Ze[ae.url])return z(Ze[ae.url]);var C=new XMLHttpRequest;C.addEventListener("load",function(){var De=ee(C.response),L=ae.text.replace(Y,'url("data:'+ae.format+";base64,"+De+'")')+"\n";Ze[ae.url]=L,z(L)}),C.addEventListener("error",function(De){console.warn("Failed to load font from: "+ae.url,De),Ze[ae.url]=null,z(null)}),C.addEventListener("abort",function(De){console.warn("Aborted loading font from: "+ae.url,De),z(null)}),C.open("GET",ae.url),C.responseType="arraybuffer",C.send()})})).then(function(ae){return ae.filter(function(z){return z}).join("")})},ba=null,de=function ie(){if(ba)return ba;return ba=Array.from(document.styleSheets).map(function(H){try{return{rules:H.cssRules,href:H.href}}catch(ae){return console.warn("Stylesheet could not be loaded: "+H.href,ae),{}}})},Ke=function ie(H,ae){var z=ae||{},le=z.selectorRemap,C=z.modifyStyle,De=z.modifyCss,L=z.fonts,je=z.excludeUnusedCss,Pe=De||function(Le,He){var Oe=le?le(Le):Le,K=C?C(He):He;return Oe+"{"+K+"}\n"},Ee=[],We=typeof L==="undefined",sa=L||[];return de().forEach(function(Le){var{rules:He,href:Oe}=Le;if(!He)return;Array.from(He).forEach(function(K){if(typeof K.style!="undefined"){if(oa(H,K.selectorText))Ee.push(Pe(K.selectorText,K.style.cssText));else if(We&&K.cssText.match(/^@font-face/)){var fe=re(K,Oe);if(fe)sa.push(fe)}else if(!je)Ee.push(K.cssText)}})}),Qe(sa).then(function(Le){return Ee.join("\n")+Le})},Ia=function ie(){if(!navigator.msSaveOrOpenBlob&&!("download"in document.createElement("a")))return{popup:window.open()}};l.prepareSvg=function(ie,H,ae){O(ie);var z=H||{},le=z.left,C=le===void 0?0:le,De=z.top,L=De===void 0?0:De,je=z.width,Pe=z.height,Ee=z.scale,We=Ee===void 0?1:Ee,sa=z.responsive,Le=sa===void 0?!1:sa,He=z.excludeCss,Oe=He===void 0?!1:He;return ra(ie).then(function(){var K=ie.cloneNode(!0);K.style.backgroundColor=(H||{}).backgroundColor||ie.style.backgroundColor;var fe=U(ie,K,je,Pe),Fe=fe.width,Xe=fe.height;if(ie.tagName!=="svg")if(ie.getBBox){if(K.getAttribute("transform")!=null)K.setAttribute("transform",K.getAttribute("transform").replace(/translate\(.*?\)/,""));var $e=document.createElementNS("http://www.w3.org/2000/svg","svg");$e.appendChild(K),K=$e}else{console.error("Attempted to render non-SVG element",ie);return}if(K.setAttribute("version","1.1"),K.setAttribute("viewBox",[C,L,Fe,Xe].join(" ")),!K.getAttribute("xmlns"))K.setAttributeNS(R,"xmlns",F);if(!K.getAttribute("xmlns:xlink"))K.setAttributeNS(R,"xmlns:xlink","http://www.w3.org/1999/xlink");if(Le)K.removeAttribute("width"),K.removeAttribute("height"),K.setAttribute("preserveAspectRatio","xMinYMin meet");else K.setAttribute("width",Fe*We),K.setAttribute("height",Xe*We);if(Array.from(K.querySelectorAll("foreignObject > *")).forEach(function(Ya){Ya.setAttributeNS(R,"xmlns",Ya.tagName==="svg"?F:A)}),Oe){var Ae=document.createElement("div");Ae.appendChild(K);var Be=Ae.innerHTML;if(typeof ae==="function")ae(Be,Fe,Xe);else return{src:Be,width:Fe,height:Xe}}else return Ke(ie,H).then(function(Ya){var wa=document.createElement("style");wa.setAttribute("type","text/css"),wa.innerHTML="<![CDATA[\n"+Ya+"\n]]>";var cn=document.createElement("defs");cn.appendChild(wa),K.insertBefore(cn,K.firstChild);var Ka=document.createElement("div");Ka.appendChild(K);var un=Ka.innerHTML.replace(/NS\d+:href/gi,'xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href');if(typeof ae==="function")ae(un,Fe,Xe);else return{src:un,width:Fe,height:Xe}})})},l.svgAsDataUri=function(ie,H,ae){return O(ie),l.prepareSvg(ie,H).then(function(z){var{src:le,width:C,height:De}=z,L="data:image/svg+xml;base64,"+window.btoa(qe(j+le));if(typeof ae==="function")ae(L,C,De);return L})},l.svgAsPngUri=function(ie,H,ae){O(ie);var z=H||{},le=z.encoderType,C=le===void 0?"image/png":le,De=z.encoderOptions,L=De===void 0?0.8:De,je=z.canvg,Pe=function Ee(We){var{src:sa,width:Le,height:He}=We,Oe=document.createElement("canvas"),K=Oe.getContext("2d"),fe=window.devicePixelRatio||1;if(Oe.width=Le*fe,Oe.height=He*fe,Oe.style.width=Oe.width+"px",Oe.style.height=Oe.height+"px",K.setTransform(fe,0,0,fe,0,0),je)je(Oe,sa);else K.drawImage(sa,0,0);var Fe=void 0;try{Fe=Oe.toDataURL(C,L)}catch(Xe){if(typeof SecurityError!=="undefined"&&Xe instanceof SecurityError||Xe.name==="SecurityError"){console.error("Rendered SVG images cannot be downloaded in this browser.");return}else throw Xe}if(typeof ae==="function")ae(Fe,Oe.width,Oe.height);return Promise.resolve(Fe)};if(je)return l.prepareSvg(ie,H).then(Pe);else return l.svgAsDataUri(ie,H).then(function(Ee){return new Promise(function(We,sa){var Le=new Image;Le.onload=function(){return We(Pe({src:Le,width:Le.width,height:Le.height}))},Le.onerror=function(){sa("There was an error loading the data URI as an image on the following SVG\n"+window.atob(Ee.slice(26))+"Open the following link to see browser\'s diagnosis\n"+Ee)},Le.src=Ee})})},l.download=function(ie,H,ae){if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(oe(H),ie);else{var z=document.createElement("a");if("download"in z){z.download=ie,z.style.display="none",document.body.appendChild(z);try{var le=oe(H),C=URL.createObjectURL(le);z.href=C,z.onclick=function(){return requestAnimationFrame(function(){return URL.revokeObjectURL(C)})}}catch(De){console.error(De),console.warn("Error while getting object URL. Falling back to string URL."),z.href=H}z.click(),document.body.removeChild(z)}else if(ae&&ae.popup)ae.popup.document.title=ie,ae.popup.location.replace(H)}},l.saveSvg=function(ie,H,ae){var z=Ia();return ke(ie).then(function(le){return l.svgAsDataUri(le,ae||{})}).then(function(le){return l.download(H,le,z)})},l.saveSvgAsPng=function(ie,H,ae){var z=Ia();return ke(ie).then(function(le){return l.svgAsPngUri(le,ae||{})}).then(function(le){return l.download(H,le,z)})}})()}),$r=qr(Tr(),1),qn=/Mac/i.test(navigator.platform||navigator.userAgent),co=/Mac/i.test(navigator.platform||navigator.userAgent),Kr=[{usbVendorId:12346},{usbVendorId:11914}],Hr="./assets/icon-file-1def53419f4ad0ae.svg",es="./assets/icon-edit-2b1e47b495524ed2.svg",as="./assets/icon-device-c2fafab2eaccf043.svg";var h=new ta.Generator("Python");h.addReservedWords("False,None,True,and,as,assert,break,class,continue,def,del,elif,else,except,exec,finally,for,from,global,if,import,in,is,lambda,nonlocal,not,or,pass,print,raise,return,try,while,with,yield,NotImplemented,Ellipsis,__debug__,quit,exit,copyright,license,credits,ArithmeticError,AssertionError,AttributeError,BaseException,BlockingIOError,BrokenPipeError,BufferError,BytesWarning,ChildProcessError,ConnectionAbortedError,ConnectionError,ConnectionRefusedError,ConnectionResetError,DeprecationWarning,EOFError,Ellipsis,EnvironmentError,Exception,FileExistsError,FileNotFoundError,FloatingPointError,FutureWarning,GeneratorExit,IOError,ImportError,ImportWarning,IndentationError,IndexError,InterruptedError,IsADirectoryError,KeyError,KeyboardInterrupt,LookupError,MemoryError,ModuleNotFoundError,NameError,NotADirectoryError,NotImplemented,NotImplementedError,OSError,OverflowError,PendingDeprecationWarning,PermissionError,ProcessLookupError,RecursionError,ReferenceError,ResourceWarning,RuntimeError,RuntimeWarning,StandardError,StopAsyncIteration,StopIteration,SyntaxError,SyntaxWarning,SystemError,SystemExit,TabError,TimeoutError,TypeError,UnboundLocalError,UnicodeDecodeError,UnicodeEncodeError,UnicodeError,UnicodeTranslateError,UnicodeWarning,UserWarning,ValueError,Warning,ZeroDivisionError,_,__build_class__,__debug__,__doc__,__import__,__loader__,__name__,__package__,__spec__,abs,all,any,apply,ascii,basestring,bin,bool,buffer,bytearray,bytes,callable,chr,classmethod,cmp,coerce,compile,complex,copyright,credits,delattr,dict,dir,divmod,enumerate,eval,exec,execfile,exit,file,filter,float,format,frozenset,getattr,globals,hasattr,hash,help,hex,id,input,int,intern,isinstance,issubclass,iter,len,license,list,locals,long,map,max,memoryview,min,next,object,oct,open,ord,pow,print,property,quit,range,raw_input,reduce,reload,repr,reversed,round,set,setattr,slice,sorted,staticmethod,str,sum,super,tuple,type,unichr,unicode,vars,xrange,zip");h.ORDER_ATOMIC=0;h.ORDER_COLLECTION=1;h.ORDER_STRING_CONVERSION=1;h.ORDER_MEMBER=2.1;h.ORDER_FUNCTION_CALL=2.2;h.ORDER_EXPONENTIATION=3;h.ORDER_UNARY_SIGN=4;h.ORDER_BITWISE_NOT=4;h.ORDER_MULTIPLICATIVE=5;h.ORDER_ADDITIVE=6;h.ORDER_BITWISE_SHIFT=7;h.ORDER_BITWISE_AND=8;h.ORDER_BITWISE_XOR=9;h.ORDER_BITWISE_OR=10;h.ORDER_RELATIONAL=11;h.ORDER_LOGICAL_NOT=12;h.ORDER_LOGICAL_AND=13;h.ORDER_LOGICAL_OR=14;h.ORDER_CONDITIONAL=15;h.ORDER_LAMBDA=16;h.ORDER_NONE=99;h.ORDER_OVERRIDES=[[h.ORDER_FUNCTION_CALL,h.ORDER_MEMBER],[h.ORDER_FUNCTION_CALL,h.ORDER_FUNCTION_CALL],[h.ORDER_MEMBER,h.ORDER_MEMBER],[h.ORDER_MEMBER,h.ORDER_FUNCTION_CALL],[h.ORDER_LOGICAL_NOT,h.ORDER_LOGICAL_NOT],[h.ORDER_LOGICAL_AND,h.ORDER_LOGICAL_AND],[h.ORDER_LOGICAL_OR,h.ORDER_LOGICAL_OR]];h.init=(s)=>{if(h.PASS=h.INDENT+"pass\n",h.definitions_=Object.create(null),h.functionNames_=Object.create(null),!h.variableDB_)h.variableDB_=new ta.Names(h.RESERVED_WORDS_);else h.variableDB_.reset();h.variableDB_.setVariableMap(s.getVariableMap());const l=[],R=s.getAllVariables();for(let F=0;F<R.length;F++){if(R[F].type===ta.BROADCAST_MESSAGE_VARIABLE_TYPE)continue;let j=h.variableDB_.getName(R[F].getId(),ta.Variables.NAME_TYPE),Y="";if(R[F].type===ta.LIST_VARIABLE_TYPE)j=`${j}_${ta.LIST_VARIABLE_TYPE}`,Y="[]";l.push(`${j} = ${Y}`)}const A=ta.Variables.allDeveloperVariables(s);for(let F=0;F<A.length;F++){let j=h.variableDB_.getName(A[F],ta.Names.DEVELOPER_VARIABLE_TYPE),Y="";if(R[F].type===ta.LIST_VARIABLE_TYPE)j=`${j}_${ta.LIST_VARIABLE_TYPE}`,Y="[]";l.push(`${j} = ${Y}`)}if(l.length)h.definitions_.variables=l.join("\n");h.definitions_.import_blocks="from blocks import *"};h.finish=(s)=>{const l=[],R=[];for(let A in h.definitions_){const F=h.definitions_[A];if(F.match(/^(from\s+\S+\s+)?import\s+\S+/))l.push(F);else R.push(F)}return delete h.definitions_,delete h.functionNames_,h.variableDB_.reset(),(l.join("\n")+"\n\n"+R.join("\n\n")).replace(/\n\n+/g,"\n\n").replace(/\n*$/,"\n\n\n")+s};h.scrubNakedValue=(s)=>{return s+"\n"};h.quote_=(s)=>{s=s.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/\%/g,"\\%");let l='"';if(s.indexOf('"')!==-1)if(s.indexOf("'")===-1)l="'";else s=s.replace(/"/g,'\\"');return l+s+l};h.scrub_=(s,l)=>{let R="";if(!s.outputConnection?.targetConnection){let A=s.getCommentText();if(A=ta.utils.wrap(A,h.COMMENT_WRAP-3),A)if(s.getProcedureDef)R+='"""'+A+'\n"""\n';else R+=h.prefixLines(A+"\n","# ");for(let F=0;F<s.inputList.length;F++)if(s.inputList[F].type==ta.INPUT_VALUE){const j=s.inputList[F].connection.targetBlock();if(j){const Y=h.allNestedComments(j);if(Y)R+=h.prefixLines(Y,"# ")}}}if(s.startHat_){const A=s.nextConnection&&s.nextConnection.targetBlock();let F=h.blockToCode(A);if(F)F=h.prefixLines(F,h.INDENT),l=l.replace(`\n${h.PASS}`,`\n${F}`);return R+l}if(s.parentBlock_){const A=s.nextConnection&&s.nextConnection.targetBlock(),F=h.blockToCode(A);return R+l+F}};h.getAdjustedInt=(s,l,R,A)=>{let F=R||0;if(s.workspace.options.oneBasedIndex)F--;const j=s.workspace.options.oneBasedIndex?"1":"0",Y=F?h.ORDER_ADDITIVE:h.ORDER_NONE;let q=h.valueToCode(s,l,Y)||j;if(ta.isNumber(q)){if(q=parseInt(q,10)+F,A)q=-q}else{if(F>0)q="int("+q+" + "+F+")";else if(F<0)q="int("+q+" - "+-F+")";else q="int("+q+")";if(A)q="-"+q}return q};h.hatToCode=(s="",...l)=>{if(!h.functionNames_[s])h.functionNames_[s]=0;h.functionNames_[s]+=1;const R=`${s}_${h.functionNames_[s]}`;return h.HAT_FUNCTION_PLACEHOLDER=R,`async def ${R}(${l.join(", ")}):\n  this_func = ${R}\n${h.PASS}\n`};var ns=(s)=>{const l=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;s=s.replace(l,(A,F,j,Y)=>F+F+j+j+Y+Y);const R=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);return R?{r:parseInt(R[1],16),g:parseInt(R[2],16),b:parseInt(R[3],16)}:null};h.colour_picker=(s)=>{const{r:l,g:R,b:A}=ns(s.getFieldValue("COLOUR"));return[`(${l}, ${R}, ${A})`,h.ORDER_ATOMIC]};var Ha="  await runtime.next_frame()\n";h.control_wait=(s)=>{let l="";if(h.STATEMENT_PREFIX)l+=h.injectId(h.STATEMENT_PREFIX,s);const R=h.valueToCode(s,"DURATION",h.ORDER_NONE)||0;return l+=`await runtime.wait_for(num(${R}))\n`,l};h.control_repeat=(s)=>{let l="";if(h.STATEMENT_PREFIX)l+=h.injectId(h.STATEMENT_PREFIX,s);let R=h.statementToCode(s,"SUBSTACK")||h.PASS;if(h.STATEMENT_SUFFIX)R=h.prefixLines(h.injectId(h.STATEMENT_SUFFIX,s),h.INDENT)+R;const A=h.valueToCode(s,"TIMES",h.ORDER_NONE)||10;return l+=`for _ in range(num(${A})):\n${R}${Ha}`,l};h.control_forever=(s)=>{let l="";if(h.STATEMENT_PREFIX)l+=h.injectId(h.STATEMENT_PREFIX,s);let R=h.statementToCode(s,"SUBSTACK")||h.PASS;if(h.STATEMENT_SUFFIX)R=h.prefixLines(h.injectId(h.STATEMENT_SUFFIX,s),h.INDENT)+R;return l+=`while True:\n${R}${Ha}`,l};h.control_if=(s)=>{let l="";if(h.STATEMENT_PREFIX)l+=h.injectId(h.STATEMENT_PREFIX,s);let R=h.statementToCode(s,"SUBSTACK")||h.PASS;if(h.STATEMENT_SUFFIX)R=h.prefixLines(h.injectId(h.STATEMENT_SUFFIX,s),h.INDENT)+R;const A=h.valueToCode(s,"CONDITION",h.ORDER_NONE)||"False";if(l+=`if ${A}:\n${R}`,s.getInput("SUBSTACK2")){if(R=h.statementToCode(s,"SUBSTACK2")||h.PASS,h.STATEMENT_SUFFIX)R=h.prefixLines(h.injectId(h.STATEMENT_SUFFIX,s),h.INDENT)+R;l+=`else:\n${R}`}return l};h.control_if_else=h.control_if;h.control_wait_until=(s)=>{let l="";if(h.STATEMENT_PREFIX)l+=h.injectId(h.STATEMENT_PREFIX,s);const R=h.valueToCode(s,"CONDITION",h.ORDER_NONE)||"False";return l+=`while not ${R}:\n${Ha}`,l};h.control_repeat_until=(s)=>{let l="";if(h.STATEMENT_PREFIX)l+=h.injectId(h.STATEMENT_PREFIX,s);let R=h.statementToCode(s,"SUBSTACK")||h.PASS;if(h.STATEMENT_SUFFIX)R=h.prefixLines(h.injectId(h.STATEMENT_SUFFIX,s),h.INDENT)+R;const A=h.valueToCode(s,"CONDITION",h.ORDER_NONE)||"False";return l+=`while not ${A}:\n${R}${Ha}`,l};h.control_while=(s)=>{let l="";if(h.STATEMENT_PREFIX)l+=h.injectId(h.STATEMENT_PREFIX,s);let R=h.statementToCode(s,"SUBSTACK")||h.PASS;if(h.STATEMENT_SUFFIX)R=h.prefixLines(h.injectId(h.STATEMENT_SUFFIX,s),h.INDENT)+R;const A=h.valueToCode(s,"CONDITION",h.ORDER_NONE)||"False";return l+=`while ${A}:\n${R}${Ha}`,l};h.control_stop=(s)=>{let l="";if(h.STATEMENT_PREFIX)l+=h.injectId(h.STATEMENT_PREFIX,s);switch(s.getFieldValue("STOP_OPTION")){case"all":l+="runtime.stop()\n";break;case"this script":l+="return\n";break;case"other scripts in sprite":l+="runtime.stop_tasks(this_func)\n";break}return l};h.data_variable=(s)=>{return[h.variableDB_.getName(s.getFieldValue("VARIABLE"),Ve.Variables.NAME_TYPE),h.ORDER_ATOMIC]};h.data_setvariableto=(s)=>{let l="";if(javascriptGenerator.STATEMENT_PREFIX)l+=javascriptGenerator.injectId(javascriptGenerator.STATEMENT_PREFIX,s);const R=h.variableDB_.getName(s.getFieldValue("VARIABLE"),Ve.Variables.NAME_TYPE),A=h.valueToCode(s,"VALUE",h.ORDER_NONE)||'""';return l+=`${R} = ${A}\n`,l};h.data_changevariableby=(s)=>{let l="";if(javascriptGenerator.STATEMENT_PREFIX)l+=javascriptGenerator.injectId(javascriptGenerator.STATEMENT_PREFIX,s);const R=h.variableDB_.getName(s.getFieldValue("VARIABLE"),Ve.Variables.NAME_TYPE),A=h.valueToCode(s,"VALUE",h.ORDER_NONE)||0;return l+=`${R} = num(${R}) + num(${A})\n`,l};h.data_listcontents=(s)=>{return[h.variableDB_.getName(s.getFieldValue("LIST"),Ve.Variables.NAME_TYPE)+"_"+Ve.LIST_VARIABLE_TYPE,h.ORDER_ATOMIC]};h.data_addtolist=(s)=>{let l="";if(h.STATEMENT_PREFIX)l+=h.injectId(h.STATEMENT_PREFIX,s);const R=h.variableDB_.getName(s.getFieldValue("LIST"),Ve.Variables.NAME_TYPE)+"_"+Ve.LIST_VARIABLE_TYPE,A=h.valueToCode(s,"ITEM",h.ORDER_NONE)||'""';return l+=`${R}.append(${A})\n`,l};h.data_deleteoflist=(s)=>{let l="";if(h.STATEMENT_PREFIX)l+=h.injectId(h.STATEMENT_PREFIX,s);const R=h.variableDB_.getName(s.getFieldValue("LIST"),Ve.Variables.NAME_TYPE)+"_"+Ve.LIST_VARIABLE_TYPE,A=h.valueToCode(s,"INDEX",h.ORDER_NONE)||1;return l+=`${R}.remove(runtime.index(${A}, len(${R})))\n`,l};h.data_deletealloflist=(s)=>{let l="";if(h.STATEMENT_PREFIX)l+=h.injectId(h.STATEMENT_PREFIX,s);const R=h.variableDB_.getName(s.getFieldValue("LIST"),Ve.Variables.NAME_TYPE)+"_"+Ve.LIST_VARIABLE_TYPE;return l+=`${R} = []\n`,l};h.data_insertatlist=(s)=>{let l="";if(h.STATEMENT_PREFIX)l+=h.injectId(h.STATEMENT_PREFIX,s);const R=h.variableDB_.getName(s.getFieldValue("LIST"),Ve.Variables.NAME_TYPE)+"_"+Ve.LIST_VARIABLE_TYPE,A=h.valueToCode(s,"INDEX",h.ORDER_NONE)||1,F=h.valueToCode(s,"ITEM",h.ORDER_NONE)||'""';return l+=`${R}.insert(runtime.index(${A}, len(${R})), ${F})\n`,l};h.data_replaceitemoflist=(s)=>{let l="";if(h.STATEMENT_PREFIX)l+=h.injectId(h.STATEMENT_PREFIX,s);const R=h.variableDB_.getName(s.getFieldValue("LIST"),Ve.Variables.NAME_TYPE)+"_"+Ve.LIST_VARIABLE_TYPE,A=h.valueToCode(s,"INDEX",h.ORDER_NONE)||1,F=h.valueToCode(s,"ITEM",h.ORDER_NONE)||'""';return l+=`${R}[runtime.index(${A}, len(${R}))] = ${F}\n`,l};h.data_itemoflist=(s)=>{const l=h.variableDB_.getName(s.getFieldValue("LIST"),Ve.Variables.NAME_TYPE)+"_"+Ve.LIST_VARIABLE_TYPE,R=h.valueToCode(s,"INDEX",h.ORDER_NONE)||1;return[`${l}[runtime.index(${R}, len(${l}))]`,h.ORDER_CONDITIONAL]};h.data_itemnumoflist=(s)=>{const l=h.variableDB_.getName(s.getFieldValue("LIST"),Ve.Variables.NAME_TYPE)+"_"+Ve.LIST_VARIABLE_TYPE,R=h.valueToCode(s,"ITEM",h.ORDER_NONE)||0;return[`(${l}.index(${R}) + 1)`,h.ORDER_NONE]};h.data_lengthoflist=(s)=>{return[`len(${h.variableDB_.getName(s.getFieldValue("LIST"),Ve.Variables.NAME_TYPE)+"_"+Ve.LIST_VARIABLE_TYPE})`,h.ORDER_FUNCTION_CALL]};h.data_listcontainsitem=(s)=>{const l=h.variableDB_.getName(s.getFieldValue("LIST"),Ve.Variables.NAME_TYPE)+"_"+Ve.LIST_VARIABLE_TYPE,R=h.valueToCode(s,"ITEM",h.ORDER_NONE)||0;return[`bool(${l}.count(${R}))`,h.ORDER_FUNCTION_CALL]};h.event_whenflagclicked=()=>{return`${h.hatToCode("start")}runtime.when_start(${h.HAT_FUNCTION_PLACEHOLDER})\n`};h.event_whengreaterthan=(s)=>{const l=s.getFieldValue("WHENGREATERTHANMENU"),R=h.valueToCode(s,"VALUE",h.ORDER_NONE)||0;return`${h.hatToCode("greaterthen")}runtime.when_greaterthen("${l}", num(${R}), ${h.HAT_FUNCTION_PLACEHOLDER})\n`};h.event_whenbroadcastreceived=(s)=>{const l=h.variableDB_.getName(s.getFieldValue("BROADCAST_OPTION"),fo.Variables.NAME_TYPE);return`${h.hatToCode("broadcastreceived")}runtime.when_broadcastreceived("${l}", ${h.HAT_FUNCTION_PLACEHOLDER})\n`};h.event_broadcast_menu=(s)=>{return[h.variableDB_.getName(s.getFieldValue("BROADCAST_OPTION"),fo.Variables.NAME_TYPE),h.ORDER_ATOMIC]};h.event_broadcast=(s)=>{return`runtime.broadcast("${h.valueToCode(s,"BROADCAST_INPUT",h.ORDER_NONE)||'"message1"'}")\n`};h.event_broadcastandwait=(s)=>{return`await runtime.broadcast("${h.valueToCode(s,"BROADCAST_INPUT",h.ORDER_NONE)||'"message1"'}", waiting=True)\n`};h.addReservedWords("math,random,Number");h.math_number=(s)=>{let l=parseFloat(s.getFieldValue("NUM")),R;if(l===1/0)l='float("inf")',R=h.ORDER_FUNCTION_CALL;else if(l===-1/0)l='-float("inf")',R=h.ORDER_UNARY_SIGN;else if(Number.isNaN(l))l='float("nan")',R=h.ORDER_UNARY_SIGN;else R=l<0?h.ORDER_UNARY_SIGN:h.ORDER_ATOMIC;return[l,R]};h.math_integer=(s)=>{const l=parseInt(s.getFieldValue("NUM")),R=l<0?h.ORDER_UNARY_SIGN:h.ORDER_ATOMIC;return[l,R]};h.math_whole_number=(s)=>{return[Math.abs(parseInt(s.getFieldValue("NUM"))),h.ORDER_ATOMIC]};h.math_positive_number=(s)=>{let l=parseFloat(s.getFieldValue("NUM")),R;if(l===1/0)l='float("inf")',R=h.ORDER_FUNCTION_CALL;else if(l===-1/0)l='-float("inf")',R=h.ORDER_FUNCTION_CALL;else if(Number.isNaN(l))l='float("nan")',R=h.ORDER_FUNCTION_CALL;else l=l<0?0:l,R=h.ORDER_ATOMIC;return[l,R]};h.math_angle=(s)=>{let l=parseFloat(s.getFieldValue("NUM")),R;if(l==1/0)l='float("inf")',R=h.ORDER_FUNCTION_CALL;else if(l==-1/0)l='-float("inf")',R=h.ORDER_UNARY_SIGN;else l=l%360,l=l<0?l+360:l,R=h.ORDER_ATOMIC;return[l,R]};h.operator_add=(s)=>{const l=h.valueToCode(s,"NUM1",h.ORDER_NONE)||0,R=h.valueToCode(s,"NUM2",h.ORDER_NONE)||0;return[`(num(${l}) + num(${R}))`,h.ORDER_SUBTRACTION]};h.operator_subtract=(s)=>{const l=h.valueToCode(s,"NUM1",h.ORDER_NONE)||0,R=h.valueToCode(s,"NUM2",h.ORDER_NONE)||0;return[`(num(${l}) - num(${R}))`,h.ORDER_SUBTRACTION]};h.operator_multiply=(s)=>{const l=h.valueToCode(s,"NUM1",h.ORDER_NONE)||0,R=h.valueToCode(s,"NUM2",h.ORDER_NONE)||0;return[`(num(${l}) * num(${R}))`,h.ORDER_SUBTRACTION]};h.operator_divide=(s)=>{const l=h.valueToCode(s,"NUM1",h.ORDER_NONE)||0,R=h.valueToCode(s,"NUM2",h.ORDER_NONE)||0;return[`(num(${l}) / num(${R}))`,h.ORDER_SUBTRACTION]};h.operator_random=(s)=>{const l=h.valueToCode(s,"FROM",h.ORDER_NONE)||0,R=h.valueToCode(s,"TO",h.ORDER_NONE)||0;return[`runtime.random(${l}, ${R})`,h.ORDER_FUNCTION_CALL]};h.operator_gt=(s)=>{const l=h.valueToCode(s,"OPERAND1",h.ORDER_NONE)||0,R=h.valueToCode(s,"OPERAND2",h.ORDER_NONE)||0;return[`(num(${l}) > num(${R}))`,h.ORDER_RELATIONAL]};h.operator_lt=(s)=>{const l=h.valueToCode(s,"OPERAND1",h.ORDER_NONE)||0,R=h.valueToCode(s,"OPERAND2",h.ORDER_NONE)||0;return[`(num(${l}) < num(${R}))`,h.ORDER_RELATIONAL]};h.operator_equals=(s)=>{const l=h.valueToCode(s,"OPERAND1",h.ORDER_NONE)||0,R=h.valueToCode(s,"OPERAND2",h.ORDER_NONE)||0;return[`(num(${l}) == num(${R}) or str(${l}) == str(${R}))`,h.ORDER_RELATIONAL]};h.operator_and=(s)=>{const l=h.valueToCode(s,"OPERAND1",h.ORDER_NONE)||"False",R=h.valueToCode(s,"OPERAND2",h.ORDER_NONE)||"False";return[`(${l} and ${R})`,h.ORDER_LOGICAL_AND]};h.operator_or=(s)=>{const l=h.valueToCode(s,"OPERAND1",h.ORDER_NONE)||"False",R=h.valueToCode(s,"OPERAND2",h.ORDER_NONE)||"False";return[`(${l} or ${R})`,h.ORDER_LOGICAL_OR]};h.operator_not=(s)=>{return[`(not ${h.valueToCode(s,"OPERAND",h.ORDER_NONE)||"False"})`,h.ORDER_LOGICAL_NOT]};h.operator_join=(s)=>{const l=h.valueToCode(s,"STRING1",h.ORDER_NONE)||'""',R=h.valueToCode(s,"STRING2",h.ORDER_NONE)||'""';return[`(str(${l}) + str(${R}))`,h.ORDER_ATOMIC]};h.operator_letter_of=(s)=>{const l=h.valueToCode(s,"LETTER",h.ORDER_NONE)||0;return[`(str(${h.valueToCode(s,"STRING",h.ORDER_NONE)||'""'})[num(${l}) - 1] || "")`,h.ORDER_MEMBER]};h.operator_length=(s)=>{return[`len(str(${h.valueToCode(s,"STRING",h.ORDER_NONE)||'""'}))`,h.ORDER_FUNCTION_CALL]};h.operator_contains=(s)=>{const l=h.valueToCode(s,"STRING1",h.ORDER_NONE)||'""',R=h.valueToCode(s,"STRING2",h.ORDER_NONE)||'""';return[`(str(${l}).count(str(${R})) > 0)`,h.ORDER_FUNCTION_CALL]};h.operator_mod=(s)=>{const l=h.valueToCode(s,"NUM1",h.ORDER_NONE)||0,R=h.valueToCode(s,"NUM2",h.ORDER_NONE)||0;return[`(num(${l}) % num(${R}))`,h.ORDER_MODULUS]};h.operator_round=(s)=>{return h.definitions_.import_math="import math",[`math.round(num(${h.valueToCode(s,"NUM",h.ORDER_NONE)||0}))`,h.ORDER_FUNCTION_CALL]};h.operator_mathop=(s)=>{h.definitions_.import_math="import math";const l=h.valueToCode(s,"NUM",h.ORDER_NONE)||0,R=s.getFieldValue("OPERATOR");let A="";if(R==="ceiling")A+=`math.ceil(num(${l}))`;else if(R==="sin"||R==="cos"||R==="tan")A+=`math.${R}(math.radians(num(${l})))`;else if(R==="asin"||R==="acos"||R==="atan")A+=`math.degrees(math.${R}(num(${l})))`;else if(R==="ln")A+=`(math.log(num(${l}))`;else if(R==="log")A+=`(math.log10(num(${l}))`;else if(R==="e ^")A+=`math.exp(num(${l}))`;else if(R==="10 ^")A+=`math.pow(10, num(${l}))`;else A+=`math.${R}(num(${l}))`;return[A,h.ORDER_FUNCTION_CALL]};h.procedures_definition=(s)=>{};h.procedures_call=(s)=>{};h.procedures_prototype=(s)=>{};h.procedures_declaration=(s)=>{};h.argument_reporter_boolean=(s)=>{};h.argument_reporter_string_number=(s)=>{};h.argument_editor_boolean=(s)=>{};h.argument_editor_string_number=(s)=>{};h.sensing_timer=()=>{return["runtime.time",h.ORDER_MEMBER]};h.sensing_resettimer=()=>{return"runtime.reset_timer()\n"};h.text=(s)=>{const l=s.getFieldValue("TEXT");return[l.length===0||isNaN(l)?h.quote_(l):+l,h.ORDER_ATOMIC]};var ms=1,ts=2,Rs=3,to="#0FBD8C",Ro="#0DA57A",ks="#0B8E69",Ta=(s)=>{if(typeof s!=="string")if(Array.isArray(s))s=String(s);else return s;return s.replace(/[<>&'"]/g,(l)=>{switch(l){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}})},ko={number:"math_number",angle:"math_angle",text:"text",string:"text",color:"colour_picker",matrix:"matrix",note:"note"},Eo={number:"NUM",angle:"NUM",text:"TEXT",string:"TEXT",matrix:"MATRIX",note:"NOTE"};Do("._5SVWFW_prompt-modal{width:360px}._5SVWFW_prompt-content{background:var(--ui-white);padding:1.5rem 2.25rem}._5SVWFW_prompt-content input[type=checkbox],._5SVWFW_prompt-content input[type=radio]{margin:3px}._5SVWFW_label{margin:0 0 .75rem;font-weight:500}._5SVWFW_variable-name-text-input{border:1px solid var(--ui-black-transparent);color:var(--text-primary-transparent);border-radius:5px;width:100%;height:3rem;margin-bottom:1.5rem;padding:0 1rem;font-size:.875rem}._5SVWFW_info-message{text-align:center;margin-bottom:1.5rem;font-size:.875rem;font-weight:400}._5SVWFW_options{justify-content:space-between;margin-bottom:1.5rem;font-weight:400;display:flex}._5SVWFW_button-row{text-align:right;font-weight:bolder}._5SVWFW_button{padding:.75rem 1rem;font-size:.85rem;font-weight:600}._5SVWFW_ok-button{background:var(--motion-primary);border:var(--motion-primary);color:var(--ui-white);margin-left:var(--space)}");var Na={buttonRow:"_5SVWFW_button-row",label:"_5SVWFW_label",variableNameTextInput:"_5SVWFW_variable-name-text-input",options:"_5SVWFW_options",button:"_5SVWFW_button",promptContent:"_5SVWFW_prompt-content",promptModal:"_5SVWFW_prompt-modal",okButton:"_5SVWFW_ok-button",infoMessage:"_5SVWFW_info-message"},ws=["nes","translate","color-sensor","servo","time","pen","brain","request","text","broadcast"].map(async(s)=>{const{default:l}=await import(`@blockcode/extension-${s}`);return l.id=s,l}),qs=Promise.all(ws);Do(".cujmXa_editor-wrapper{border-radius:inherit;width:100%;height:100%;position:relative}.cujmXa_extension-button{z-index:var(--z-index-extension-button);background:var(--motion-primary);border:1px solid var(--motion-primary);box-sizing:content-box;border-bottom-left-radius:inherit;border-top:0;height:3.25rem;position:absolute;bottom:-1px;left:-1px}.cujmXa_extension-button:before{--fade-out-distance:15px;content:\"\";top:calc(calc(-1*var(--fade-out-distance)));height:var(--fade-out-distance);background:linear-gradient(#0000,#00000026);position:absolute;left:0;right:0}.cujmXa_add-button{cursor:pointer;background:0 0;border:none;outline:none;width:100%;height:100%}.cujmXa_add-button img{width:1.75rem;height:1.75rem}.cujmXa_debug-box{z-index:var(--z-index-monitor);border:1px solid var(--ui-tertiary);border-radius:var(--space)var(--space)0 0;opacity:.8;font-size:var(--standard-font-size);background:#fff;border-bottom:0;width:600px;height:300px;position:absolute;bottom:0;left:50vw;overflow:auto;transform:translate(-50%)}.cujmXa_debug-box pre{margin:calc(var(--space)/2)}");var $n={debugBox:"cujmXa_debug-box",addButton:"cujmXa_add-button",extensionButton:"cujmXa_extension-button",editorWrapper:"cujmXa_editor-wrapper"},Ts="./assets/icon-extension-5ec2ee35b87b4126.svg",Za=new Map,ho=(s)=>typeof s!=="string"&&!s.button,As=async(s,l,R,A,F)=>{if(l){for(let j of l)if(!Za.has(j)){let{default:Y}=await import(`@blockcode/extension-${j}/blocks`);if(typeof Y==="function")Y=Y(s);if(Y.id=j,Y.files)Y.files.forEach(async(q)=>{const S=`extensions/${j}/${q.name}`,O=await fetch(q.uri).then((ke)=>ke.text());A({...q,id:S,content:O})});if(R(Y.translations),F)F({...Y,blocks:Y.blocks.filter(ho)});Za.set(j,Y)}}},Ms="./assets/icon-blocks-d7e4a3a3eb74d0fb.svg",Us={"blocks.menu.file":"File","blocks.menu.file.newProject":"New","blocks.menu.file.openProject":"Open","blocks.menu.file.saveProject":"Save","blocks.menu.file.uploadProject":"Load from your computer","blocks.menu.file.downloadProject":"Save to your computer","blocks.menu.edit":"Edit","blocks.menu.edit.undo":"Undo","blocks.menu.edit.redo":"Redo","blocks.menu.device":"Device","blocks.menu.device.name":"device","blocks.menu.device.connect":"Connect to your {name}","blocks.menu.device.disconnect":"Disconnect this {name}","blocks.menu.device.download":"Download program","blocks.menu.device.turnOnAutoDownload":"Turn on Auto Download","blocks.menu.device.turnOffAutoDownload":"Turn off Auto Download","blocks.alert.downloading":"Downloading...{progress}%","blocks.alert.downloadCompleted":"Download completed.","blocks.codeTab":"Code","blocks.monitorPane.title":"Monitor","blocks.downloadToDevice":"Download","blocks.extensions.addExtension":"Add Extension","blocks.extensions.empty":"No extension!","blocks.dataPrompt.forAllTargets":"For all targets","blocks.dataPrompt.forThisTarget":"For this target only","blocks.dataPrompt.availableToAllTargets":"This variable will be available to all targets.","blocks.dataPrompt.listAvailableToAllTargets":"This list will be available to all targets.","blocks.dataPrompt.cancel":"Cancel","blocks.dataPrompt.ok":"OK","blocks.event.programStart":"when program start","blocks.control.stopOther":"other scripts"},xs={"blocks.menu.file":"\u6587\u4EF6","blocks.menu.file.newProject":"\u65B0\u4F5C\u54C1","blocks.menu.file.openProject":"\u6253\u5F00","blocks.menu.file.saveProject":"\u4FDD\u5B58","blocks.menu.file.uploadProject":"\u4ECE\u7535\u8111\u4E2D\u6253\u5F00","blocks.menu.file.downloadProject":"\u4FDD\u5B58\u5230\u7535\u8111","blocks.menu.edit":"\u7F16\u8F91","blocks.menu.edit.undo":"\u64A4\u9500","blocks.menu.edit.redo":"\u6062\u590D","blocks.menu.device":"\u8BBE\u5907","blocks.menu.device.name":"\u8BBE\u5907","blocks.menu.device.connect":"\u8FDE\u63A5{name}","blocks.menu.device.disconnect":"\u65AD\u5F00{name}\u8FDE\u63A5","blocks.menu.device.download":"\u4E0B\u8F7D\u7A0B\u5E8F","blocks.menu.device.turnOnAutoDownload":"\u6253\u5F00\u81EA\u52A8\u4E0B\u8F7D","blocks.menu.device.turnOffAutoDownload":"\u5173\u95ED\u81EA\u52A8\u4E0B\u8F7D","blocks.alert.downloading":"\u6B63\u5728\u4E0B\u8F7D\u2026{progress}%","blocks.alert.downloadCompleted":"\u4E0B\u8F7D\u5B8C\u6210\u3002","blocks.codeTab":"\u4EE3\u7801","blocks.monitorPane.title":"\u76D1\u89C6\u5668","blocks.downloadToDevice":"\u4E0B\u8F7D","blocks.extensions.addExtension":"\u6DFB\u52A0\u6269\u5C55","blocks.extensions.empty":"\u6CA1\u6709\u6269\u5C55\uFF01","blocks.dataPrompt.forAllTargets":"\u9002\u7528\u4E8E\u5168\u5C40","blocks.dataPrompt.forThisTarget":"\u4EC5\u9002\u7528\u4E8E\u5F53\u524D","blocks.dataPrompt.availableToAllTargets":"\u5168\u5C40\u90FD\u53EF\u4F7F\u7528\u8BE5\u53D8\u91CF\u3002","blocks.dataPrompt.listAvailableToAllTargets":"\u5168\u5C40\u90FD\u53EF\u4F7F\u7528\u8BE5\u5217\u8868\u3002","blocks.dataPrompt.cancel":"\u53D6\u6D88","blocks.dataPrompt.ok":"\u786E\u5B9A","blocks.event.programStart":"\u5F53\u7A0B\u5E8F\u5F00\u59CB\u8FD0\u884C","blocks.control.stopOther":"\u5176\u4ED6\u811A\u672C"},wo={en:Us,"zh-Hans":xs},kn={icon:Ms,label:vo(No,{id:"blocks.codeTab",defaultMessage:"Code"}),Content:Fs},$l={label:vo(No,{id:"blocks.monitorPane.title",defaultMessage:"Monitor"}),Content:null};import{useLocale as oi} from"@blockcode/core";import{ScratchBlocks as Pl,makeToolboxXML as Hs,blockSeparator as fa,categorySeparator as xn} from"@blockcode/blocks-editor";import{ScratchBlocks as dn} from"@blockcode/blocks-editor";dn.Blocks.event_whenflagclicked={init(){this.jsonInit({message0:dn.Msg.EVENT_WHENFLAGCLICKED,args0:[{type:"field_image",src:dn.mainWorkspace.options.pathToMedia+"green-flag.svg",width:24,height:24,alt:"flag"}],category:dn.Categories.event,extensions:["colours_event","shape_hat"]})}};import{ScratchBlocks as ca} from"@blockcode/blocks-editor";ca.Blocks.motion_attack={init(){this.jsonInit({message0:ca.Msg.MOTION_ATTACK,args0:[{type:"input_value",name:"DIRECTION"},{type:"input_value",name:"DISTANCE"}],category:ca.Categories.motion,extensions:["colours_motion","shape_statement"]})}};ca.Blocks.motion_move={init(){this.jsonInit({message0:ca.Msg.MOTION_MOVE,args0:[{type:"input_value",name:"DIRECTION"},{type:"input_value",name:"SPEED"}],category:ca.Categories.motion,extensions:["colours_motion","shape_statement"]})}};ca.Blocks.motion_setspeed={init(){this.jsonInit({message0:ca.Msg.MOTION_SETSPEED,args0:[{type:"input_value",name:"SPEED"}],category:ca.Categories.motion,extensions:["colours_motion","shape_statement"]})}};ca.Blocks.motion_stop={init(){this.jsonInit({message0:ca.Msg.MOTION_STOP,category:ca.Categories.motion,extensions:["colours_motion","shape_statement"]})}};ca.Blocks.motion_speed={init(){this.jsonInit({message0:ca.Msg.MOTION_SPEED,category:ca.Categories.motion,checkboxInFlyout:!0,extensions:["colours_motion","output_number"]})}};import{ScratchBlocks as da} from"@blockcode/blocks-editor";da.Blocks.sensing_scanwidth={init(){this.jsonInit({message0:da.Msg.SENSING_SCANWIDTH,args0:[{type:"input_value",name:"WIDTH"}],category:da.Categories.sensing,extensions:["colours_sensing","shape_statement"]})}};da.Blocks.sensing_scan={init(){this.jsonInit({message0:da.Msg.SENSING_SCAN,args0:[{type:"input_value",name:"DIRECTION"}],category:da.Categories.sensing,extensions:["colours_sensing","output_boolean"]})}};da.Blocks.sensing_scandistance={init(){this.jsonInit({message0:da.Msg.SENSING_DISTANCE,args0:[{type:"input_value",name:"DIRECTION"}],category:da.Categories.sensing,extensions:["colours_sensing","output_number"]})}};da.Blocks.sensing_health={init(){this.jsonInit({message0:da.Msg.SENSING_HEALTH,category:da.Categories.sensing,checkboxInFlyout:!0,extensions:["colours_sensing","output_number"]})}};import{useRef as js,useEffect as Ws} from"preact/hooks";import{useEditor as Ls} from"@blockcode/core";import{ScratchBlocks as ma} from"@blockcode/blocks-editor";import{ScratchBlocks as Ra} from"@blockcode/blocks-editor";import{ScratchBlocks as Ye} from"@blockcode/blocks-editor";import{ScratchBlocks as $o} from"@blockcode/blocks-editor";var Ao=function({width:s,height:l,onSetup:R,...A}){const F=js(null),{fileList:j,selectedFileId:Y,modifyFile:q}=Ls(),S=j.find((O)=>O.id===Y);if(F.script=S.script,F.xml=S.xml,F.current){const O=ma.getMainWorkspace();if(O&&O!==F.workspace)F.workspace=O,O.addChangeListener((ke)=>{if(O.isDragging())return;if(!Ss.has(ke.type))return;const ue=ma.Xml.workspaceToDom(O),ce=ma.Xml.domToText(ue).replace(/<variable type="broadcast_msg"[^>]+>[^<]+<\/variable>/gi,"");if(!F.script||F.xml!==ce){const ee=b.workspaceToCode(O);if(F.script!==ee)q({script:ee})}})}return Ws(()=>{if(F.current){if(An.default.setup(F.current),R)R(F.current)}return()=>{An.default.project.clear(),An.default.project.remove()}},[F]),Gs("canvas",{id:"blockcode-blocks-player",ref:F,style:{width:s,height:l},...A})};import{jsx as Gs} from"preact/jsx-runtime";var ys=Object.create,{defineProperty:go,getPrototypeOf:Qs,getOwnPropertyNames:Xs}=Object,Bs=Object.prototype.hasOwnProperty,Fn=(s,l,R)=>{R=s!=null?ys(Qs(s)):{};const A=l||!s||!s.__esModule?go(R,"default",{value:s,enumerable:!0}):R;for(let F of Xs(s))if(!Bs.call(A,F))go(A,F,{get:()=>s[F],enumerable:!0});return A},Vs=(s,l)=>()=>(l||s((l={exports:{}}).exports,l),l.exports),xl=((s)=>typeof xa!=="undefined"?xa:typeof Proxy!=="undefined"?new Proxy(s,{get:(l,R)=>(typeof xa!=="undefined"?xa:l)[R]}):s)(function(s){if(typeof xa!=="undefined")return xa.apply(this,arguments);throw Error('Dynamic require of "'+s+'" is not supported')}),Mn=Vs((s,l)=>{/*!
 * Paper.js v0.12.17 - The Swiss Army Knife of Vector Graphics Scripting.
 * http://paperjs.org/
 *
 * Copyright (c) 2011 - 2020, Jrg Lehni & Jonathan Puckey
 * http://juerglehni.com/ & https://puckey.studio/
 *
 * Distributed under the MIT license. See LICENSE file for details.
 *
 * All rights reserved.
 *
 * Date: Thu Nov 3 21:15:36 2022 +0100
 *
 ***
 *
 * Straps.js - Class inheritance library with support for bean-style accessors
 *
 * Copyright (c) 2006 - 2020 Jrg Lehni
 * http://juerglehni.com/
 *
 * Distributed under the MIT license.
 *
 ***
 *
 * Acorn.js
 * https://marijnhaverbeke.nl/acorn/
 *
 * Acorn is a tiny, fast JavaScript parser written in JavaScript,
 * created by Marijn Haverbeke and released under an MIT license.
 *
 */var R=function(A,F){A=A||(()=>({}));var{window:j,document:Y}=A,q=new function(){var e=/^(statics|enumerable|beans|preserve)$/,a=[],n=a.slice,o=Object.create,r=Object.getOwnPropertyDescriptor,i=Object.defineProperty,u=a.forEach||function(p,d){for(var N=0,v=this.length;N<v;N++)p.call(d,this[N],N,this)},c=function(p,d){for(var N in this)if(this.hasOwnProperty(N))p.call(d,this[N],N,this)},m=Object.assign||function(p){for(var d=1,N=arguments.length;d<N;d++){var v=arguments[d];for(var g in v)if(v.hasOwnProperty(g))p[g]=v[g]}return p},t=function(p,d,N){if(p){var v=r(p,"length");(v&&typeof v.value==="number"?u:c).call(p,d,N=N||p)}return N};function E(p,d,N,v,g){var Z={};function f(J,T){if(T=T||(T=r(d,J))&&(T.get?T:T.value),typeof T==="string"&&T[0]==="#")T=p[T.substring(1)]||T;var $=typeof T==="function",M=T,x=g||$&&!T.base?T&&T.get?J in p:p[J]:null,B;if(!g||!x){if($&&x)T.base=x;if($&&v!==!1&&(B=J.match(/^([gs]et|is)(([A-Z])(.*))$/)))Z[B[3].toLowerCase()+B[4]]=B[2];if(!M||$||!M.get||typeof M.get!=="function"||!I.isPlainObject(M))M={value:M,writable:!0};if((r(p,J)||{configurable:!0}).configurable)M.configurable=!0,M.enumerable=N!=null?N:!B;i(p,J,M)}}if(d){for(var k in d)if(d.hasOwnProperty(k)&&!e.test(k))f(k);for(var k in Z){var _=Z[k],D=p["set"+_],w=p["get"+_]||D&&p["is"+_];if(w&&(v===!0||w.length===0))f(k,{get:w,set:D})}}return p}function I(){for(var p=0,d=arguments.length;p<d;p++){var N=arguments[p];if(N)m(this,N)}return this}return E(I,{inject:function(p){if(p){var d=p.statics===!0?p:p.statics,N=p.beans,v=p.preserve;if(d!==p)E(this.prototype,p,p.enumerable,N,v);E(this,d,null,N,v)}for(var g=1,Z=arguments.length;g<Z;g++)this.inject(arguments[g]);return this},extend:function(){var p=this,d,N;for(var v=0,g,Z=arguments.length;v<Z&&!(d&&N);v++)g=arguments[v],d=d||g.initialize,N=N||g.prototype;if(d=d||function(){p.apply(this,arguments)},N=d.prototype=N||o(this.prototype),i(N,"constructor",{value:d,writable:!0,configurable:!0}),E(d,this),arguments.length)this.inject.apply(d,arguments);return d.base=p,d}}).inject({enumerable:!1,initialize:I,set:I,inject:function(){for(var p=0,d=arguments.length;p<d;p++){var N=arguments[p];if(N)E(this,N,N.enumerable,N.beans,N.preserve)}return this},extend:function(){var p=o(this);return p.inject.apply(p,arguments)},each:function(p,d){return t(this,p,d)},clone:function(){return new this.constructor(this)},statics:{set:m,each:t,create:o,define:i,describe:r,clone:function(p){return m(new p.constructor,p)},isPlainObject:function(p){var d=p!=null&&p.constructor;return d&&(d===Object||d===I||d.name==="Object")},pick:function(p,d){return p!==F?p:d},slice:function(p,d,N){return n.call(p,d,N)}}})};if(typeof l!=="undefined")l.exports=q;q.inject({enumerable:!1,toString:function(){return this._id!=null?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+q.each(this,function(e,a){if(!/^_/.test(a)){var n=typeof e;this.push(a+": "+(n==="number"?ce.instance.number(e):n==="string"?"'"+e+"'":e))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(e){return q.importJSON(e,this)},exportJSON:function(e){return q.exportJSON(this,e)},toJSON:function(){return q.serialize(this)},set:function(e,a){if(e)q.filter(this,e,a,this._prioritize);return this}},{beans:!1,statics:{exports:{},extend:function e(){var a=e.base.apply(this,arguments),n=a.prototype._class;if(n&&!q.exports[n])q.exports[n]=a;return a},equals:function(e,a){if(e===a)return!0;if(e&&e.equals)return e.equals(a);if(a&&a.equals)return a.equals(e);if(e&&a&&typeof e==="object"&&typeof a==="object"){if(Array.isArray(e)&&Array.isArray(a)){var n=e.length;if(n!==a.length)return!1;while(n--)if(!q.equals(e[n],a[n]))return!1}else{var o=Object.keys(e),n=o.length;if(n!==Object.keys(a).length)return!1;while(n--){var r=o[n];if(!(a.hasOwnProperty(r)&&q.equals(e[r],a[r])))return!1}}return!0}return!1},read:function(e,a,n,o){if(this===q){var r=this.peek(e,a);return e.__index++,r}var i=this.prototype,u=i._readIndex,c=a||u&&e.__index||0,m=e.length,t=e[c];if(o=o||m-c,t instanceof this||n&&n.readNull&&t==null&&o<=1){if(u)e.__index=c+1;return t&&n&&n.clone?t.clone():t}if(t=q.create(i),u)t.__read=!0;if(t=t.initialize.apply(t,c>0||c+o<m?q.slice(e,c,c+o):e)||t,u){e.__index=c+t.__read;var E=t.__filtered;if(E)e.__filtered=E,t.__filtered=F;t.__read=F}return t},peek:function(e,a){return e[e.__index=a||e.__index||0]},remain:function(e){return e.length-(e.__index||0)},readList:function(e,a,n,o){var r=[],i,u=a||0,c=o?u+o:e.length;for(var m=u;m<c;m++)r.push(Array.isArray(i=e[m])?this.read(i,0,n):this.read(e,m,n,1));return r},readNamed:function(e,a,n,o,r){var i=this.getNamed(e,a),u=i!==F;if(u){var c=e.__filtered;if(!c){var m=this.getSource(e);c=e.__filtered=q.create(m),c.__unfiltered=m}c[a]=F}return this.read(u?[i]:e,n,o,r)},readSupported:function(e,a){var n=this.getSource(e),o=this,r=!1;if(n)Object.keys(n).forEach(function(i){if(i in a){var u=o.readNamed(e,i);if(u!==F)a[i]=u;r=!0}});return r},getSource:function(e){var a=e.__source;if(a===F){var n=e.length===1&&e[0];a=e.__source=n&&q.isPlainObject(n)?n:null}return a},getNamed:function(e,a){var n=this.getSource(e);if(n)return a?n[a]:e.__filtered||n},hasNamed:function(e,a){return!!this.getNamed(e,a)},filter:function(e,a,n,o){var r;function i(E){if(!(n&&(E in n))&&!(r&&(E in r))){var I=a[E];if(I!==F)e[E]=I}}if(o){var u={};for(var c=0,m,t=o.length;c<t;c++)if((m=o[c])in a)i(m),u[m]=!0;r=u}return Object.keys(a.__unfiltered||a).forEach(i),e},isPlainValue:function(e,a){return q.isPlainObject(e)||Array.isArray(e)||a&&typeof e==="string"},serialize:function(e,a,n,o){a=a||{};var r=!o,i;if(r)a.formatter=new ce(a.precision),o={length:0,definitions:{},references:{},add:function(I,p){var d="#"+I._id,N=this.references[d];if(!N){this.length++;var v=p.call(I),g=I._class;if(g&&v[0]!==g)v.unshift(g);this.definitions[d]=v,N=this.references[d]=[d]}return N}};if(e&&e._serialize){i=e._serialize(a,o);var u=e._class;if(u&&!e._compactSerialize&&(r||!n)&&i[0]!==u)i.unshift(u)}else if(Array.isArray(e)){i=[];for(var c=0,m=e.length;c<m;c++)i[c]=q.serialize(e[c],a,n,o)}else if(q.isPlainObject(e)){i={};var t=Object.keys(e);for(var c=0,m=t.length;c<m;c++){var E=t[c];i[E]=q.serialize(e[E],a,n,o)}}else if(typeof e==="number")i=a.formatter.number(e,a.precision);else i=e;return r&&o.length>0?[["dictionary",o.definitions],i]:i},deserialize:function(e,a,n,o,r){var i=e,u=!n,c=u&&e&&e.length&&e[0][0]==="dictionary";if(n=n||{},Array.isArray(e)){var m=e[0],t=m==="dictionary";if(e.length==1&&/^#/.test(m))return n.dictionary[m];m=q.exports[m],i=[];for(var E=m?1:0,I=e.length;E<I;E++)i.push(q.deserialize(e[E],a,n,t,c));if(m){var p=i;if(a)i=a(m,p,u||r);else i=new m(p)}}else if(q.isPlainObject(e)){if(i={},o)n.dictionary=i;for(var d in e)i[d]=q.deserialize(e[d],a,n)}return c?i[1]:i},exportJSON:function(e,a){var n=q.serialize(e,a);return a&&a.asString==!1?n:JSON.stringify(n)},importJSON:function(e,a){return q.deserialize(typeof e==="string"?JSON.parse(e):e,function(n,o,r){var i=r&&a&&a.constructor===n,u=i?a:q.create(n.prototype);if(o.length===1&&u instanceof de&&(i||!(u instanceof Ia))){var c=o[0];if(q.isPlainObject(c)){if(c.insert=!1,i)o=o.concat([de.INSERT])}}if((i?u.set:n).apply(u,o),i)a=null;return u})},push:function(e,a){var n=a.length;if(n<4096)e.push.apply(e,a);else{var o=e.length;e.length+=n;for(var r=0;r<n;r++)e[o+r]=a[r]}return e},splice:function(e,a,n,o){var r=a&&a.length,i=n===F;if(n=i?e.length:n,n>e.length)n=e.length;for(var u=0;u<r;u++)a[u]._index=n+u;if(i)return q.push(e,a),[];else{var c=[n,o];if(a)q.push(c,a);var m=e.splice.apply(e,c);for(var u=0,t=m.length;u<t;u++)m[u]._index=F;for(var u=n+r,t=e.length;u<t;u++)e[u]._index=u;return m}},capitalize:function(e){return e.replace(/\b[a-z]/g,function(a){return a.toUpperCase()})},camelize:function(e){return e.replace(/-(.)/g,function(a,n){return n.toUpperCase()})},hyphenate:function(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var S={on:function(e,a){if(typeof e!=="string")q.each(e,function(i,u){this.on(u,i)},this);else{var n=this._eventTypes,o=n&&n[e],r=this._callbacks=this._callbacks||{};if(r=r[e]=r[e]||[],r.indexOf(a)===-1){if(r.push(a),o&&o.install&&r.length===1)o.install.call(this,e)}}return this},off:function(e,a){if(typeof e!=="string"){q.each(e,function(u,c){this.off(c,u)},this);return}var n=this._eventTypes,o=n&&n[e],r=this._callbacks&&this._callbacks[e],i;if(r){if(!a||(i=r.indexOf(a))!==-1&&r.length===1){if(o&&o.uninstall)o.uninstall.call(this,e);delete this._callbacks[e]}else if(i!==-1)r.splice(i,1)}return this},once:function(e,a){return this.on(e,function n(){a.apply(this,arguments),this.off(e,n)})},emit:function(e,a){var n=this._callbacks&&this._callbacks[e];if(!n)return!1;var o=q.slice(arguments,1),r=a&&a.target&&!a.currentTarget;if(n=n.slice(),r)a.currentTarget=this;for(var i=0,u=n.length;i<u;i++)if(n[i].apply(this,o)==!1){if(a&&a.stop)a.stop();break}if(r)delete a.currentTarget;return!0},responds:function(e){return!!(this._callbacks&&this._callbacks[e])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(e){var a=this._eventTypes,n=this._callbacks,o=e?"install":"uninstall";if(a){for(var r in n)if(n[r].length>0){var i=a[r],u=i&&i[o];if(u)u.call(this,r)}}},statics:{inject:function e(a){var n=a._events;if(n){var o={};q.each(n,function(r,i){var u=typeof r==="string",c=u?r:i,m=q.capitalize(c),t=c.substring(2).toLowerCase();o[t]=u?{}:r,c="_"+c,a["get"+m]=function(){return this[c]},a["set"+m]=function(E){var I=this[c];if(I)this.off(t,I);if(E)this.on(t,E);this[c]=E}}),a._eventTypes=o}return e.base.apply(this,arguments)}}},O=q.extend({_class:"PaperScope",initialize:function e(){ve=this,this.settings=new q({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this._id=e._id++,e._scopes[this._id]=this;var a=e.prototype;if(!this.support){var n=Se.getContext(1,1)||{};a.support={nativeDash:"setLineDash"in n||"mozDash"in n,nativeBlendModes:Zn.nativeModes},Se.release(n)}if(!this.agent){var o=A.navigator.userAgent.toLowerCase(),r=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(o)||[])[0],i=r==="darwin"?"mac":r,u=a.agent=a.browser={platform:i};if(i)u[i]=!0;if(o.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node|jsdom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,function(c,m,t,E,I){if(!u.chrome){var p=m==="opera"?E:/^(node|trident)$/.test(m)?I:t;u.version=p,u.versionNumber=parseFloat(p),m={trident:"msie",jsdom:"node"}[m]||m,u.name=m,u[m]=!0}}),u.chrome)delete u.webkit;if(u.atom)delete u.chrome}},version:"0.12.17",getView:function(){var e=this.project;return e&&e._view},getPaper:function(){return this},execute:function(e,a){},install:function(e){var a=this;q.each(["project","view","tool"],function(o){q.define(e,o,{configurable:!0,get:function(){return a[o]}})});for(var n in this)if(!/^_/.test(n)&&this[n])e[n]=this[n]},setup:function(e){return ve=this,this.project=new ba(e),this},createCanvas:function(e,a){return Se.getCanvas(e,a)},activate:function(){ve=this},clear:function(){var e=this.projects,a=this.tools;for(var n=e.length-1;n>=0;n--)e[n].remove();for(var n=a.length-1;n>=0;n--)a[n].remove()},remove:function(){this.clear(),delete O._scopes[this._id]},statics:new function(){function e(a){return a+="Attribute",function(n,o){return n[a](o)||n[a]("data-paper-"+o)}}return{_scopes:{},_id:0,get:function(a){return this._scopes[a]||null},getAttribute:e("get"),hasAttribute:e("has")}}}),ke=q.extend(S,{initialize:function(e){if(this._scope=ve,this._index=this._scope[this._list].push(this)-1,e||!this._scope[this._reference])this.activate()},activate:function(){if(!this._scope)return!1;var e=this._scope[this._reference];if(e&&e!==this)e.emit("deactivate");return this._scope[this._reference]=this,this.emit("activate",e),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){if(this._index==null)return!1;if(q.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this)this._scope[this._reference]=null;return this._scope=null,!0},getView:function(){return this._scope.getView()}}),ue={findItemBoundsCollisions:function(e,a,n){function o(u){var c=new Array(u.length);for(var m=0;m<u.length;m++){var t=u[m].getBounds();c[m]=[t.left,t.top,t.right,t.bottom]}return c}var r=o(e),i=!a||a===e?r:o(a);return this.findBoundsCollisions(r,i,n||0)},findCurveBoundsCollisions:function(e,a,n,o){function r(p){var{min:d,max:N}=Math,v=new Array(p.length);for(var g=0;g<p.length;g++){var Z=p[g];v[g]=[d(Z[0],Z[2],Z[4],Z[6]),d(Z[1],Z[3],Z[5],Z[7]),N(Z[0],Z[2],Z[4],Z[6]),N(Z[1],Z[3],Z[5],Z[7])]}return v}var i=r(e),u=!a||a===e?i:r(a);if(o){var c=this.findBoundsCollisions(i,u,n||0,!1,!0),m=this.findBoundsCollisions(i,u,n||0,!0,!0),t=[];for(var E=0,I=c.length;E<I;E++)t[E]={hor:c[E],ver:m[E]};return t}return this.findBoundsCollisions(i,u,n||0)},findBoundsCollisions:function(e,a,n,o,r){var i=!a||e===a,u=i?e:e.concat(a),c=e.length,m=u.length;function t(P,ne,Re){var me=0,be=P.length;while(me<be){var se=be+me>>>1;if(u[P[se]][ne]<Re)me=se+1;else be=se}return me-1}var E=o?1:0,I=E+2,p=o?0:1,d=p+2,N=new Array(m);for(var v=0;v<m;v++)N[v]=v;N.sort(function(P,ne){return u[P][E]-u[ne][E]});var g=[],Z=new Array(c);for(var v=0;v<m;v++){var f=N[v],k=u[f],_=i?f:f-c,D=f<c,w=i||!D,J=D?[]:null;if(g.length){var T=t(g,I,k[E]-n)+1;if(g.splice(0,T),i&&r){J=J.concat(g);for(var $=0;$<g.length;$++){var M=g[$];Z[M].push(_)}}else{var x=k[d],B=k[p];for(var $=0;$<g.length;$++){var M=g[$],Q=u[M],y=M<c,X=i||M>=c;if(r||(D&&X||w&&y)&&(x>=Q[p]-n&&B<=Q[d]+n)){if(D&&X)J.push(i?M:M-c);if(w&&y)Z[M].push(_)}}}}if(D){if(e===a)J.push(f);Z[f]=J}if(g.length){var V=k[I],W=t(g,I,V);g.splice(W+1,0,f)}else g.push(f)}for(var v=0;v<Z.length;v++){var G=Z[v];if(G)G.sort(function(ne,Re){return ne-Re})}return Z}},ce=q.extend({initialize:function(e){this.precision=q.pick(e,5),this.multiplier=Math.pow(10,this.precision)},number:function(e){return this.precision<16?Math.round(e*this.multiplier)/this.multiplier:e},pair:function(e,a,n){return this.number(e)+(n||",")+this.number(a)},point:function(e,a){return this.number(e.x)+(a||",")+this.number(e.y)},size:function(e,a){return this.number(e.width)+(a||",")+this.number(e.height)},rectangle:function(e,a){return this.point(e,a)+(a||",")+this.size(e,a)}});ce.instance=new ce;var ee=new function(){var e=[[0.5773502691896257],[0,0.7745966692414834],[0.33998104358485626,0.8611363115940526],[0,0.5384693101056831,0.906179845938664],[0.2386191860831969,0.6612093864662645,0.932469514203152],[0,0.4058451513773972,0.7415311855993945,0.9491079123427585],[0.1834346424956498,0.525532409916329,0.7966664774136267,0.9602898564975363],[0,0.3242534234038089,0.6133714327005904,0.8360311073266358,0.9681602395076261],[0.14887433898163122,0.4333953941292472,0.6794095682990244,0.8650633666889845,0.9739065285171717],[0,0.26954315595234496,0.5190961292068118,0.7301520055740494,0.8870625997680953,0.978228658146057],[0.1252334085114689,0.3678314989981802,0.5873179542866175,0.7699026741943047,0.9041172563704749,0.9815606342467192],[0,0.2304583159551348,0.44849275103644687,0.6423493394403402,0.8015780907333099,0.9175983992229779,0.9841830547185881],[0.10805494870734367,0.31911236892788974,0.5152486363581541,0.6872929048116855,0.827201315069765,0.9284348836635735,0.9862838086968123],[0,0.20119409399743451,0.3941513470775634,0.5709721726085388,0.7244177313601701,0.8482065834104272,0.937273392400706,0.9879925180204854],[0.09501250983763744,0.2816035507792589,0.45801677765722737,0.6178762444026438,0.755404408355003,0.8656312023878318,0.9445750230732326,0.9894009349916499]],a=[[1],[0.8888888888888888,0.5555555555555556],[0.6521451548625461,0.34785484513745385],[0.5688888888888889,0.47862867049936647,0.23692688505618908],[0.46791393457269104,0.3607615730481386,0.17132449237917036],[0.4179591836734694,0.3818300505051189,0.27970539148927664,0.1294849661688697],[0.362683783378362,0.31370664587788727,0.22238103445337448,0.10122853629037626],[0.3302393550012598,0.31234707704000286,0.26061069640293544,0.1806481606948574,0.08127438836157441],[0.29552422471475287,0.26926671930999635,0.21908636251598204,0.1494513491505806,0.06667134430868814],[0.2729250867779006,0.26280454451024665,0.23319376459199048,0.18629021092773426,0.1255803694649046,0.05566856711617366],[0.24914704581340277,0.2334925365383548,0.20316742672306592,0.16007832854334622,0.10693932599531843,0.04717533638651183],[0.2325515532308739,0.22628318026289723,0.2078160475368885,0.17814598076194574,0.13887351021978725,0.09212149983772845,0.04048400476531588],[0.2152638534631578,0.2051984637212956,0.18553839747793782,0.15720316715819355,0.12151857068790319,0.08015808715976021,0.03511946033175186],[0.2025782419255613,0.19843148532711158,0.1861610000155622,0.16626920581699392,0.13957067792615432,0.10715922046717194,0.07036604748810812,0.03075324199611727],[0.1894506104550685,0.18260341504492358,0.16915651939500254,0.14959598881657674,0.12462897125553388,0.09515851168249279,0.062253523938647894,0.027152459411754096]],n=Math.abs,o=Math.sqrt,r=Math.pow,i=Math.log2||function(I){return Math.log(I)*Math.LOG2E},u=0.000000000001,c=0.000000000000000112;function m(I,p,d){return I<p?p:I>d?d:I}function t(I,p,d){function N(T){var $=T*134217729,M=T-$,x=M+$,B=T-x;return[x,B]}var v=p*p-I*d,g=p*p+I*d;if(n(v)*3<g){var Z=N(I),f=N(p),k=N(d),_=p*p,D=f[0]*f[0]-_+2*f[0]*f[1]+f[1]*f[1],w=I*d,J=Z[0]*k[0]-w+Z[0]*k[1]+Z[1]*k[0]+Z[1]*k[1];v=_-w+(D-J)}return v}function E(){var I=Math.max.apply(Math,arguments);return I&&(I<0.00000001||I>1e8)?r(2,-Math.round(i(I))):0}return{EPSILON:u,MACHINE_EPSILON:c,CURVETIME_EPSILON:0.00000001,GEOMETRIC_EPSILON:0.0000001,TRIGONOMETRIC_EPSILON:0.00000001,ANGULAR_EPSILON:0.00001,KAPPA:4*(o(2)-1)/3,isZero:function(I){return I>=-u&&I<=u},isMachineZero:function(I){return I>=-c&&I<=c},clamp:m,integrate:function(I,p,d,N){var v=e[N-2],g=a[N-2],Z=(d-p)*0.5,f=Z+p,k=0,_=N+1>>1,D=N&1?g[k++]*I(f):0;while(k<_){var w=Z*v[k];D+=g[k++]*(I(f+w)+I(f-w))}return Z*D},findRoot:function(I,p,d,N,v,g,Z){for(var f=0;f<g;f++){var k=I(d),_=k/p(d),D=d-_;if(n(_)<Z){d=D;break}if(k>0)v=d,d=D<=N?(N+v)*0.5:D;else N=d,d=D>=v?(N+v)*0.5:D}return m(d,N,v)},solveQuadratic:function(I,p,d,N,v,g){var Z,f=1/0;if(n(I)<u){if(n(p)<u)return n(d)<u?-1:0;Z=-d/p}else{p*=-0.5;var k=t(I,p,d);if(k&&n(k)<c){var _=E(n(I),n(p),n(d));if(_)I*=_,p*=_,d*=_,k=t(I,p,d)}if(k>=-c){var D=k<0?0:o(k),w=p+(p<0?-D:D);if(w===0)Z=d/I,f=-Z;else Z=w/I,f=d/w}}var J=0,T=v==null,$=v-u,M=g+u;if(isFinite(Z)&&(T||Z>$&&Z<M))N[J++]=T?Z:m(Z,v,g);if(f!==Z&&isFinite(f)&&(T||f>$&&f<M))N[J++]=T?f:m(f,v,g);return J},solveCubic:function(I,p,d,N,v,g,Z){var f=E(n(I),n(p),n(d),n(N)),k,_,D,w,J;if(f)I*=f,p*=f,d*=f,N*=f;function T(W){k=W;var G=I*k;_=G+p,D=_*k+d,w=(G+_)*k+D,J=D*k+N}if(n(I)<u)I=p,_=d,D=N,k=1/0;else if(n(N)<u)_=p,D=d,k=0;else{T(-(p/I)/3);var $=J/I,M=r(n($),0.3333333333333333),x=$<0?-1:1,B=-w/I,Q=B>0?1.324717957244746*Math.max(M,o(B)):M,y=k-x*Q;if(y!==k){do T(y),y=w===0?k:k-J/w/(1+c);while(x*y>x*k);if(n(I)*k*k>n(N/k))D=-N/k,_=(D-d)/k}}var X=ee.solveQuadratic(I,_,D,v,g,Z),V=g==null;if(isFinite(k)&&(X===0||X>0&&k!==v[0]&&k!==v[1])&&(V||k>g-u&&k<Z+u))v[X++]=V?k:m(k,g,Z);return X}}},Te={_id:1,_pools:{},get:function(e){if(e){var a=this._pools[e];if(!a)a=this._pools[e]={_id:1};return a._id++}else return this._id++}},U=q.extend({_class:"Point",_readIndex:!0,initialize:function e(a,n){var o=typeof a,r=this.__read,i=0;if(o==="number"){var u=typeof n==="number";if(this._set(a,u?n:a),r)i=u?2:1}else if(o==="undefined"||a===null){if(this._set(0,0),r)i=a===null?1:0}else{var c=o==="string"?a.split(/[\s,]+/)||[]:a;if(i=1,Array.isArray(c))this._set(+c[0],+(c.length>1?c[1]:c[0]));else if("x"in c)this._set(c.x||0,c.y||0);else if("width"in c)this._set(c.width||0,c.height||0);else if("angle"in c)this._set(c.length||0,0),this.setAngle(c.angle||0);else this._set(0,0),i=0}if(r)this.__read=i;return this},set:"#initialize",_set:function(e,a){return this.x=e,this.y=a,this},equals:function(e){return this===e||e&&(this.x===e.x&&this.y===e.y||Array.isArray(e)&&this.x===e[0]&&this.y===e[1])||!1},clone:function(){return new U(this.x,this.y)},toString:function(){var e=ce.instance;return"{ x: "+e.number(this.x)+", y: "+e.number(this.y)+" }"},_serialize:function(e){var a=e.formatter;return[a.number(this.x),a.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(e){if(this.isZero()){var a=this._angle||0;this._set(Math.cos(a)*e,Math.sin(a)*e)}else{var n=e/this.getLength();if(ee.isZero(n))this.getAngle();this._set(this.x*n,this.y*n)}},getAngle:function(){return this.getAngleInRadians.apply(this,arguments)*180/Math.PI},setAngle:function(e){this.setAngleInRadians.call(this,e*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(!arguments.length)return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x);else{var e=U.read(arguments),a=this.getLength()*e.getLength();if(ee.isZero(a))return NaN;else{var n=this.dot(e)/a;return Math.acos(n<-1?-1:n>1?1:n)}}},setAngleInRadians:function(e){if(this._angle=e,!this.isZero()){var a=this.getLength();this._set(Math.cos(e)*a,Math.sin(e)*a)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var e=U.read(arguments);return Math.atan2(this.cross(e),this.dot(e))*180/Math.PI},getDistance:function(){var e=arguments,a=U.read(e),n=a.x-this.x,o=a.y-this.y,r=n*n+o*o,i=q.read(e);return i?r:Math.sqrt(r)},normalize:function(e){if(e===F)e=1;var a=this.getLength(),n=a!==0?e/a:0,o=new U(this.x*n,this.y*n);if(n>=0)o._angle=this._angle;return o},rotate:function(e,a){if(e===0)return this.clone();e=e*Math.PI/180;var n=a?this.subtract(a):this,o=Math.sin(e),r=Math.cos(e);return n=new U(n.x*r-n.y*o,n.x*o+n.y*r),a?n.add(a):n},transform:function(e){return e?e._transformPoint(this):this},add:function(){var e=U.read(arguments);return new U(this.x+e.x,this.y+e.y)},subtract:function(){var e=U.read(arguments);return new U(this.x-e.x,this.y-e.y)},multiply:function(){var e=U.read(arguments);return new U(this.x*e.x,this.y*e.y)},divide:function(){var e=U.read(arguments);return new U(this.x/e.x,this.y/e.y)},modulo:function(){var e=U.read(arguments);return new U(this.x%e.x,this.y%e.y)},negate:function(){return new U(-this.x,-this.y)},isInside:function(){return re.read(arguments).contains(this)},isClose:function(){var e=arguments,a=U.read(e),n=q.read(e);return this.getDistance(a)<=n},isCollinear:function(){var e=U.read(arguments);return U.isCollinear(this.x,this.y,e.x,e.y)},isColinear:"#isCollinear",isOrthogonal:function(){var e=U.read(arguments);return U.isOrthogonal(this.x,this.y,e.x,e.y)},isZero:function(){var e=ee.isZero;return e(this.x)&&e(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(e){return this.x*(e>1&&e<4?-1:1)>=0&&this.y*(e>2?-1:1)>=0},dot:function(){var e=U.read(arguments);return this.x*e.x+this.y*e.y},cross:function(){var e=U.read(arguments);return this.x*e.y-this.y*e.x},project:function(){var e=U.read(arguments),a=e.isZero()?0:this.dot(e)/e.dot(e);return new U(e.x*a,e.y*a)},statics:{min:function(){var e=arguments,a=U.read(e),n=U.read(e);return new U(Math.min(a.x,n.x),Math.min(a.y,n.y))},max:function(){var e=arguments,a=U.read(e),n=U.read(e);return new U(Math.max(a.x,n.x),Math.max(a.y,n.y))},random:function(){return new U(Math.random(),Math.random())},isCollinear:function(e,a,n,o){return Math.abs(e*o-a*n)<=Math.sqrt((e*e+a*a)*(n*n+o*o))*0.00000001},isOrthogonal:function(e,a,n,o){return Math.abs(e*n+a*o)<=Math.sqrt((e*e+a*a)*(n*n+o*o))*0.00000001}}},q.each(["round","ceil","floor","abs"],function(e){var a=Math[e];this[e]=function(){return new U(a(this.x),a(this.y))}},{})),qe=U.extend({initialize:function e(a,n,o,r){this._x=a,this._y=n,this._owner=o,this._setter=r},_set:function(e,a,n){if(this._x=e,this._y=a,!n)this._owner[this._setter](this);return this},getX:function(){return this._x},setX:function(e){this._x=e,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(e){this._y=e,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(e){this._owner._changeSelection(this._getSelection(),e)},_getSelection:function(){return this._setter==="setPosition"?4:0}}),oe=q.extend({_class:"Size",_readIndex:!0,initialize:function e(a,n){var o=typeof a,r=this.__read,i=0;if(o==="number"){var u=typeof n==="number";if(this._set(a,u?n:a),r)i=u?2:1}else if(o==="undefined"||a===null){if(this._set(0,0),r)i=a===null?1:0}else{var c=o==="string"?a.split(/[\s,]+/)||[]:a;if(i=1,Array.isArray(c))this._set(+c[0],+(c.length>1?c[1]:c[0]));else if("width"in c)this._set(c.width||0,c.height||0);else if("x"in c)this._set(c.x||0,c.y||0);else this._set(0,0),i=0}if(r)this.__read=i;return this},set:"#initialize",_set:function(e,a){return this.width=e,this.height=a,this},equals:function(e){return e===this||e&&(this.width===e.width&&this.height===e.height||Array.isArray(e)&&this.width===e[0]&&this.height===e[1])||!1},clone:function(){return new oe(this.width,this.height)},toString:function(){var e=ce.instance;return"{ width: "+e.number(this.width)+", height: "+e.number(this.height)+" }"},_serialize:function(e){var a=e.formatter;return[a.number(this.width),a.number(this.height)]},add:function(){var e=oe.read(arguments);return new oe(this.width+e.width,this.height+e.height)},subtract:function(){var e=oe.read(arguments);return new oe(this.width-e.width,this.height-e.height)},multiply:function(){var e=oe.read(arguments);return new oe(this.width*e.width,this.height*e.height)},divide:function(){var e=oe.read(arguments);return new oe(this.width/e.width,this.height/e.height)},modulo:function(){var e=oe.read(arguments);return new oe(this.width%e.width,this.height%e.height)},negate:function(){return new oe(-this.width,-this.height)},isZero:function(){var e=ee.isZero;return e(this.width)&&e(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(e,a){return new oe(Math.min(e.width,a.width),Math.min(e.height,a.height))},max:function(e,a){return new oe(Math.max(e.width,a.width),Math.max(e.height,a.height))},random:function(){return new oe(Math.random(),Math.random())}}},q.each(["round","ceil","floor","abs"],function(e){var a=Math[e];this[e]=function(){return new oe(a(this.width),a(this.height))}},{})),oa=oe.extend({initialize:function e(a,n,o,r){this._width=a,this._height=n,this._owner=o,this._setter=r},_set:function(e,a,n){if(this._width=e,this._height=a,!n)this._owner[this._setter](this);return this},getWidth:function(){return this._width},setWidth:function(e){this._width=e,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(e){this._height=e,this._owner[this._setter](this)}}),re=q.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function e(a,n,o,r){var i=arguments,u=typeof a,c;if(u==="number")this._set(a,n,o,r),c=4;else if(u==="undefined"||a===null)this._set(0,0,0,0),c=a===null?1:0;else if(i.length===1){if(Array.isArray(a))this._set.apply(this,a),c=1;else if(a.x!==F||a.width!==F)this._set(a.x||0,a.y||0,a.width||0,a.height||0),c=1;else if(a.from===F&&a.to===F){if(this._set(0,0,0,0),q.readSupported(i,this))c=1}}if(c===F){var m=U.readNamed(i,"from"),t=q.peek(i),E=m.x,I=m.y,p,d;if(t&&t.x!==F||q.hasNamed(i,"to")){var N=U.readNamed(i,"to");if(p=N.x-E,d=N.y-I,p<0)E=N.x,p=-p;if(d<0)I=N.y,d=-d}else{var v=oe.read(i);p=v.width,d=v.height}this._set(E,I,p,d),c=i.__index}var g=i.__filtered;if(g)this.__filtered=g;if(this.__read)this.__read=c;return this},set:"#initialize",_set:function(e,a,n,o){return this.x=e,this.y=a,this.width=n,this.height=o,this},clone:function(){return new re(this.x,this.y,this.width,this.height)},equals:function(e){var a=q.isPlainValue(e)?re.read(arguments):e;return a===this||a&&this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height||!1},toString:function(){var e=ce.instance;return"{ x: "+e.number(this.x)+", y: "+e.number(this.y)+", width: "+e.number(this.width)+", height: "+e.number(this.height)+" }"},_serialize:function(e){var a=e.formatter;return[a.number(this.x),a.number(this.y),a.number(this.width),a.number(this.height)]},getPoint:function(e){var a=e?U:qe;return new a(this.x,this.y,this,"setPoint")},setPoint:function(){var e=U.read(arguments);this.x=e.x,this.y=e.y},getSize:function(e){var a=e?oe:oa;return new a(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var e=oe.read(arguments),a=this._sx,n=this._sy,o=e.width,r=e.height;if(a)this.x+=(this.width-o)*a;if(n)this.y+=(this.height-r)*n;this.width=o,this.height=r,this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(e){if(!this._fw){var a=e-this.x;this.width-=this._sx===0.5?a*2:a}this.x=e,this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(e){if(!this._fh){var a=e-this.y;this.height-=this._sy===0.5?a*2:a}this.y=e,this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(e){if(!this._fw){var a=e-this.x;this.width=this._sx===0.5?a*2:a}this.x=e-this.width,this._sx=1,this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(e){if(!this._fh){var a=e-this.y;this.height=this._sy===0.5?a*2:a}this.y=e-this.height,this._sy=1,this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(e){if(this._fw||this._sx===0.5)this.x=e-this.width/2;else{if(this._sx)this.x+=(e-this.x)*2*this._sx;this.width=(e-this.x)*2}this._sx=0.5,this._fw=0},getCenterY:function(){return this.y+this.height/2},setCenterY:function(e){if(this._fh||this._sy===0.5)this.y=e-this.height/2;else{if(this._sy)this.y+=(e-this.y)*2*this._sy;this.height=(e-this.y)*2}this._sy=0.5,this._fh=0},getCenter:function(e){var a=e?U:qe;return new a(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var e=U.read(arguments);return this.setCenterX(e.x),this.setCenterY(e.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return this.width===0||this.height===0},contains:function(e){return e&&e.width!==F||(Array.isArray(e)?e:arguments).length===4?this._containsRectangle(re.read(arguments)):this._containsPoint(U.read(arguments))},_containsPoint:function(e){var{x:a,y:n}=e;return a>=this.x&&n>=this.y&&a<=this.x+this.width&&n<=this.y+this.height},_containsRectangle:function(e){var{x:a,y:n}=e;return a>=this.x&&n>=this.y&&a+e.width<=this.x+this.width&&n+e.height<=this.y+this.height},intersects:function(){var e=re.read(arguments),a=q.read(arguments)||0;return e.x+e.width>this.x-a&&e.y+e.height>this.y-a&&e.x<this.x+this.width+a&&e.y<this.y+this.height+a},intersect:function(){var e=re.read(arguments),a=Math.max(this.x,e.x),n=Math.max(this.y,e.y),o=Math.min(this.x+this.width,e.x+e.width),r=Math.min(this.y+this.height,e.y+e.height);return new re(a,n,o-a,r-n)},unite:function(){var e=re.read(arguments),a=Math.min(this.x,e.x),n=Math.min(this.y,e.y),o=Math.max(this.x+this.width,e.x+e.width),r=Math.max(this.y+this.height,e.y+e.height);return new re(a,n,o-a,r-n)},include:function(){var e=U.read(arguments),a=Math.min(this.x,e.x),n=Math.min(this.y,e.y),o=Math.max(this.x+this.width,e.x),r=Math.max(this.y+this.height,e.y);return new re(a,n,o-a,r-n)},expand:function(){var e=oe.read(arguments),a=e.width,n=e.height;return new re(this.x-a/2,this.y-n/2,this.width+a,this.height+n)},scale:function(e,a){return this.expand(this.width*e-this.width,this.height*(a===F?e:a)-this.height)}},q.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(e,a){var n=e.join(""),o=/^[RL]/.test(n);if(a>=4)e[1]+=o?"Y":"X";var r=e[o?0:1],i=e[o?1:0],u="get"+r,c="get"+i,m="set"+r,t="set"+i,E="get"+n,I="set"+n;this[E]=function(p){var d=p?U:qe;return new d(this[u](),this[c](),this,I)},this[I]=function(){var p=U.read(arguments);this[m](p.x),this[t](p.y)}},{beans:!0})),ra=re.extend({initialize:function e(a,n,o,r,i,u){this._set(a,n,o,r,!0),this._owner=i,this._setter=u},_set:function(e,a,n,o,r){if(this._x=e,this._y=a,this._width=n,this._height=o,!r)this._owner[this._setter](this);return this}},new function(){var e=re.prototype;return q.each(["x","y","width","height"],function(a){var n=q.capitalize(a),o="_"+a;this["get"+n]=function(){return this[o]},this["set"+n]=function(r){if(this[o]=r,!this._dontNotify)this._owner[this._setter](this)}},q.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(a){var n="set"+a;this[n]=function(){this._dontNotify=!0,e[n].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return!!(this._owner._selection&2)},setSelected:function(a){var n=this._owner;if(n._changeSelection)n._changeSelection(2,a)}}))}),Ze=q.extend({_class:"Matrix",initialize:function e(a,n){var o=arguments,r=o.length,i=!0;if(r>=6)this._set.apply(this,o);else if(r===1||r===2)if(a instanceof e)this._set(a._a,a._b,a._c,a._d,a._tx,a._ty,n);else if(Array.isArray(a))this._set.apply(this,n?a.concat([n]):a);else i=!1;else if(!r)this.reset();else i=!1;if(!i)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(e,a,n,o,r,i,u){if(this._a=e,this._b=a,this._c=n,this._d=o,this._tx=r,this._ty=i,!u)this._changed();return this},_serialize:function(e,a){return q.serialize(this.getValues(),e,!0,a)},_changed:function(){var e=this._owner;if(e)if(e._applyMatrix)e.transform(null,!0);else e._changed(25)},clone:function(){return new Ze(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(e){return e===this||e&&this._a===e._a&&this._b===e._b&&this._c===e._c&&this._d===e._d&&this._tx===e._tx&&this._ty===e._ty},toString:function(){var e=ce.instance;return"[["+[e.number(this._a),e.number(this._c),e.number(this._tx)].join(", ")+"], ["+[e.number(this._b),e.number(this._d),e.number(this._ty)].join(", ")+"]]"},reset:function(e){if(this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,!e)this._changed();return this},apply:function(e,a){var n=this._owner;if(n)return n.transform(null,q.pick(e,!0),a),this.isIdentity();return!1},translate:function(){var e=U.read(arguments),a=e.x,n=e.y;return this._tx+=a*this._a+n*this._c,this._ty+=a*this._b+n*this._d,this._changed(),this},scale:function(){var e=arguments,a=U.read(e),n=U.read(e,0,{readNull:!0});if(n)this.translate(n);if(this._a*=a.x,this._b*=a.x,this._c*=a.y,this._d*=a.y,n)this.translate(n.negate());return this._changed(),this},rotate:function(e){e*=Math.PI/180;var a=U.read(arguments,1),n=a.x,o=a.y,r=Math.cos(e),i=Math.sin(e),u=n-n*r+o*i,c=o-n*i-o*r,m=this._a,t=this._b,E=this._c,I=this._d;return this._a=r*m+i*E,this._b=r*t+i*I,this._c=-i*m+r*E,this._d=-i*t+r*I,this._tx+=u*m+c*E,this._ty+=u*t+c*I,this._changed(),this},shear:function(){var e=arguments,a=U.read(e),n=U.read(e,0,{readNull:!0});if(n)this.translate(n);var o=this._a,r=this._b;if(this._a+=a.y*this._c,this._b+=a.y*this._d,this._c+=a.x*o,this._d+=a.x*r,n)this.translate(n.negate());return this._changed(),this},skew:function(){var e=arguments,a=U.read(e),n=U.read(e,0,{readNull:!0}),o=Math.PI/180,r=new U(Math.tan(a.x*o),Math.tan(a.y*o));return this.shear(r,n)},append:function(e,a){if(e){var n=this._a,o=this._b,r=this._c,i=this._d,u=e._a,c=e._c,m=e._b,t=e._d,E=e._tx,I=e._ty;if(this._a=u*n+m*r,this._c=c*n+t*r,this._b=u*o+m*i,this._d=c*o+t*i,this._tx+=E*n+I*r,this._ty+=E*o+I*i,!a)this._changed()}return this},prepend:function(e,a){if(e){var n=this._a,o=this._b,r=this._c,i=this._d,u=this._tx,c=this._ty,m=e._a,t=e._c,E=e._b,I=e._d,p=e._tx,d=e._ty;if(this._a=m*n+t*o,this._c=m*r+t*i,this._b=E*n+I*o,this._d=E*r+I*i,this._tx=m*u+t*c+p,this._ty=E*u+I*c+d,!a)this._changed()}return this},appended:function(e){return this.clone().append(e)},prepended:function(e){return this.clone().prepend(e)},invert:function(){var e=this._a,a=this._b,n=this._c,o=this._d,r=this._tx,i=this._ty,u=e*o-a*n,c=null;if(u&&!isNaN(u)&&isFinite(r)&&isFinite(i))this._a=o/u,this._b=-a/u,this._c=-n/u,this._d=e/u,this._tx=(n*i-o*r)/u,this._ty=(a*r-e*i)/u,c=this;return c},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new Ze(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return this._a===1&&this._b===0&&this._c===0&&this._d===1&&this._tx===0&&this._ty===0},isInvertible:function(){var e=this._a*this._d-this._c*this._b;return e&&!isNaN(e)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(e,a,n){return arguments.length<3?this._transformPoint(U.read(arguments)):this._transformCoordinates(e,a,n)},_transformPoint:function(e,a,n){var{x:o,y:r}=e;if(!a)a=new U;return a._set(o*this._a+r*this._c+this._tx,o*this._b+r*this._d+this._ty,n)},_transformCoordinates:function(e,a,n){for(var o=0,r=2*n;o<r;o+=2){var i=e[o],u=e[o+1];a[o]=i*this._a+u*this._c+this._tx,a[o+1]=i*this._b+u*this._d+this._ty}return a},_transformCorners:function(e){var{x:a,y:n}=e,o=a+e.width,r=n+e.height,i=[a,n,o,n,o,r,a,r];return this._transformCoordinates(i,i,4)},_transformBounds:function(e,a,n){var o=this._transformCorners(e),r=o.slice(0,2),i=r.slice();for(var u=2;u<8;u++){var c=o[u],m=u&1;if(c<r[m])r[m]=c;else if(c>i[m])i[m]=c}if(!a)a=new re;return a._set(r[0],r[1],i[0]-r[0],i[1]-r[1],n)},inverseTransform:function(){return this._inverseTransform(U.read(arguments))},_inverseTransform:function(e,a,n){var o=this._a,r=this._b,i=this._c,u=this._d,c=this._tx,m=this._ty,t=o*u-r*i,E=null;if(t&&!isNaN(t)&&isFinite(c)&&isFinite(m)){var I=e.x-this._tx,p=e.y-this._ty;if(!a)a=new U;E=a._set((I*u-p*i)/t,(p*o-I*r)/t,n)}return E},decompose:function(){var e=this._a,a=this._b,n=this._c,o=this._d,r=e*o-a*n,i=Math.sqrt,u=Math.atan2,c=180/Math.PI,m,t,E;if(e!==0||a!==0){var I=i(e*e+a*a);m=Math.acos(e/I)*(a>0?1:-1),t=[I,r/I],E=[u(e*n+a*o,I*I),0]}else if(n!==0||o!==0){var p=i(n*n+o*o);m=Math.asin(n/p)*(o>0?1:-1),t=[r/p,p],E=[0,u(e*n+a*o,p*p)]}else m=0,E=t=[0,0];return{translation:this.getTranslation(),rotation:m*c,scaling:new U(t),skewing:new U(E[0]*c,E[1]*c)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new U(this._tx,this._ty)},getScaling:function(){return this.decompose().scaling},getRotation:function(){return this.decompose().rotation},applyToContext:function(e){if(!this.isIdentity())e.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},q.each(["a","b","c","d","tx","ty"],function(e){var a=q.capitalize(e),n="_"+e;this["get"+a]=function(){return this[n]},this["set"+a]=function(o){this[n]=o,this._changed()}},{})),Qe=q.extend({_class:"Line",initialize:function e(a,n,o,r,i){var u=!1;if(arguments.length>=4)this._px=a,this._py=n,this._vx=o,this._vy=r,u=i;else this._px=a.x,this._py=a.y,this._vx=n.x,this._vy=n.y,u=o;if(!u)this._vx-=this._px,this._vy-=this._py},getPoint:function(){return new U(this._px,this._py)},getVector:function(){return new U(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(e,a){return Qe.intersect(this._px,this._py,this._vx,this._vy,e._px,e._py,e._vx,e._vy,!0,a)},getSide:function(e,a){return Qe.getSide(this._px,this._py,this._vx,this._vy,e.x,e.y,!0,a)},getDistance:function(e){return Math.abs(this.getSignedDistance(e))},getSignedDistance:function(e){return Qe.getSignedDistance(this._px,this._py,this._vx,this._vy,e.x,e.y,!0)},isCollinear:function(e){return U.isCollinear(this._vx,this._vy,e._vx,e._vy)},isOrthogonal:function(e){return U.isOrthogonal(this._vx,this._vy,e._vx,e._vy)},statics:{intersect:function(e,a,n,o,r,i,u,c,m,t){if(!m)n-=e,o-=a,u-=r,c-=i;var E=n*c-o*u;if(!ee.isMachineZero(E)){var I=e-r,p=a-i,d=(u*p-c*I)/E,N=(n*p-o*I)/E,v=0.000000000001,g=-v,Z=1+v;if(t||g<d&&d<Z&&g<N&&N<Z){if(!t)d=d<=0?0:d>=1?1:d;return new U(e+d*n,a+d*o)}}},getSide:function(e,a,n,o,r,i,u,c){if(!u)n-=e,o-=a;var m=r-e,t=i-a,E=m*o-t*n;if(!c&&ee.isMachineZero(E)){if(E=(m*n+m*n)/(n*n+o*o),E>=0&&E<=1)E=0}return E<0?-1:E>0?1:0},getSignedDistance:function(e,a,n,o,r,i,u){if(!u)n-=e,o-=a;return n===0?o>0?r-e:e-r:o===0?n<0?i-a:a-i:((r-e)*o-(i-a)*n)/(o>n?o*Math.sqrt(1+n*n/(o*o)):n*Math.sqrt(1+o*o/(n*n)))},getDistance:function(e,a,n,o,r,i,u){return Math.abs(Qe.getSignedDistance(e,a,n,o,r,i,u))}}}),ba=ke.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function e(a){ke.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new Xe(null,null,this),this._view=Be.create(this,a||Se.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(e,a){return q.serialize(this._children,e,!0,a)},_changed:function(e,a){if(e&1){var n=this._view;if(n){if(n._needsUpdate=!0,!n._requested&&n._autoUpdate)n.requestUpdate()}}var o=this._changes;if(o&&a){var r=this._changesById,i=a._id,u=r[i];if(u)u.flags|=e;else o.push(r[i]={item:a,flags:e})}},clear:function(){var e=this._children;for(var a=e.length-1;a>=0;a--)e[a].remove()},isEmpty:function(){return!this._children.length},remove:function e(){if(!e.base.call(this))return!1;if(this._view)this._view.remove();return!0},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(e){this._currentStyle.set(e)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new Ia({project:this,insert:!0})},getSymbolDefinitions:function(){var e=[],a={};return this.getItems({class:ae,match:function(n){var o=n._definition,r=o._id;if(!a[r])a[r]=!0,e.push(o);return!1}}),e},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var e=this._selectionItems,a=[];for(var n in e){var o=e[n],r=o._selection;if(r&1&&o.isInserted())a.push(o);else if(!r)this._updateSelection(o)}return a},_updateSelection:function(e){var a=e._id,n=this._selectionItems;if(e._selection){if(n[a]!==e)this._selectionCount++,n[a]=e}else if(n[a]===e)this._selectionCount--,delete n[a]},selectAll:function(){var e=this._children;for(var a=0,n=e.length;a<n;a++)e[a].setFullySelected(!0)},deselectAll:function(){var e=this._selectionItems;for(var a in e)e[a].setFullySelected(!1)},addLayer:function(e){return this.insertLayer(F,e)},insertLayer:function(e,a){if(a instanceof Ia){a._remove(!1,!0),q.splice(this._children,[a],e,0),a._setProject(this,!0);var n=a._name;if(n)a.setName(n);if(this._changes)a._changed(5);if(!this._activeLayer)this._activeLayer=a}else a=null;return a},_insertItem:function(e,a,n){if(a=this.insertLayer(e,a)||(this._activeLayer||this._insertItem(F,new Ia(de.NO_INSERT),!0)).insertChild(e,a),n&&a.activate)a.activate();return a},getItems:function(e){return de._getItems(this,e)},getItem:function(e){return de._getItems(this,e,null,null,!0)[0]||null},importJSON:function(e){this.activate();var a=this._activeLayer;return q.importJSON(e,a&&a.isEmpty()&&a)},removeOn:function(e){var a=this._removeSets;if(a){if(e==="mouseup")a.mousedrag=null;var n=a[e];if(n){for(var o in n){var r=n[o];for(var i in a){var u=a[i];if(u&&u!=n)delete u[r._id]}r.remove()}a[e]=null}}},draw:function(e,a,n){this._updateVersion++,e.save(),a.applyToContext(e);var o=this._children,r=new q({offset:new U(0,0),pixelRatio:n,viewMatrix:a.isIdentity()?null:a,matrices:[new Ze],updateMatrix:!0});for(var i=0,u=o.length;i<u;i++)o[i].draw(e,r);if(e.restore(),this._selectionCount>0){e.save(),e.strokeWidth=1;var c=this._selectionItems,m=this._scope.settings.handleSize,t=this._updateVersion;for(var E in c)c[E]._drawSelection(e,a,m,c,t);e.restore()}}}),de=q.extend(S,{statics:{extend:function e(a){if(a._serializeFields)a._serializeFields=q.set({},this.prototype._serializeFields,a._serializeFields);return e.base.apply(this,arguments)},INSERT:{insert:!0},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new Ze,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var e=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return q.each(e,function(a){this._events[a]={install:function(n){this.getView()._countItemEvent(n,1)},uninstall:function(n){this.getView()._countItemEvent(n,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:e}})},{initialize:function e(){},_initialize:function(e,a){var n=e&&q.isPlainObject(e),o=n&&e.internal===!0,r=this._matrix=new Ze,i=n&&e.project||ve.project,u=ve.settings;if(this._id=o?null:Te.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&u.applyMatrix,a)r.translate(a);if(r._owner=this,this._style=new Xe(i._currentStyle,this,i),o||n&&e.insert==!1||!u.insertItems&&!(n&&e.insert==!0))this._setProject(i);else(n&&e.parent||i)._insertItem(F,this,!0);if(n&&e!==de.NO_INSERT&&e!==de.INSERT)this.set(e,{internal:!0,insert:!0,project:!0,parent:!0});return n},_serialize:function(e,a){var n={},o=this;function r(i){for(var u in i){var c=o[u];if(!q.equals(c,u==="leading"?i.fontSize*1.2:i[u]))n[u]=q.serialize(c,e,u!=="data",a)}}if(r(this._serializeFields),!(this instanceof Ke))r(this._style._defaults);return[this._class,n]},_changed:function(e){var a=this._symbol,n=this._parent||a,o=this._project;if(e&8)this._bounds=this._position=this._decomposed=F;if(e&16)this._globalMatrix=F;if(n&&e&72)de._clearBoundsCache(n);if(e&2)de._clearBoundsCache(this);if(o)o._changed(e,this);if(a)a._changed(e)},getId:function(){return this._id},getName:function(){return this._name},setName:function(e){if(this._name)this._removeNamed();if(e===+e+"")throw new Error("Names consisting only of numbers are not supported.");var a=this._getOwner();if(e&&a){var{_children:n,_namedChildren:o}=a;if((o[e]=o[e]||[]).push(this),!(e in n))n[e]=this}this._name=e||F,this._changed(256)},getStyle:function(){return this._style},setStyle:function(e){this.getStyle().set(e)}},q.each(["locked","visible","blendMode","opacity","guide"],function(e){var a=q.capitalize(e),n="_"+e,o={locked:256,visible:265};this["get"+a]=function(){return this[n]},this["set"+a]=function(r){if(r!=this[n])this[n]=r,this._changed(o[e]||257)}},{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(e){if(e!==this._selection){this._selection=e;var a=this._project;if(a)a._updateSelection(this),this._changed(257)}},_changeSelection:function(e,a){var n=this._selection;this.setSelection(a?n|e:n&~e)},isSelected:function(){if(this._selectChildren){var e=this._children;for(var a=0,n=e.length;a<n;a++)if(e[a].isSelected())return!0}return!!(this._selection&1)},setSelected:function(e){if(this._selectChildren){var a=this._children;for(var n=0,o=a.length;n<o;n++)a[n].setSelected(e)}this._changeSelection(1,e)},isFullySelected:function(){var e=this._children,a=!!(this._selection&1);if(e&&a){for(var n=0,o=e.length;n<o;n++)if(!e[n].isFullySelected())return!1;return!0}return a},setFullySelected:function(e){var a=this._children;if(a)for(var n=0,o=a.length;n<o;n++)a[n].setFullySelected(e);this._changeSelection(1,e)},isClipMask:function(){return this._clipMask},setClipMask:function(e){if(this._clipMask!=(e=!!e)){if(this._clipMask=e,e)this.setFillColor(null),this.setStrokeColor(null);if(this._changed(257),this._parent)this._parent._changed(2048)}},getData:function(){if(!this._data)this._data={};return this._data},setData:function(e){this._data=e},getPosition:function(e){var a=e?U:qe,n=this._position||(this._position=this._getPositionFromBounds());return new a(n.x,n.y,this,"setPosition")},setPosition:function(){this.translate(U.read(arguments).subtract(this.getPosition(!0)))},_getPositionFromBounds:function(e){return this._pivot?this._matrix._transformPoint(this._pivot):(e||this.getBounds()).getCenter(!0)},getPivot:function(){var e=this._pivot;return e?new qe(e.x,e.y,this,"setPivot"):null},setPivot:function(){this._pivot=U.read(arguments,0,{clone:!0,readNull:!0}),this._position=F}},q.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(e,a){this[a]=function(n){return this.getBounds(n,e)}},{beans:!0,getBounds:function(e,a){var n=a||e instanceof Ze,o=q.set({},n?a:e,this._boundsOptions);if(!o.stroke||this.getStrokeScaling())o.cacheItem=this;var r=this._getCachedBounds(n&&e,o).rect;return!arguments.length?new ra(r.x,r.y,r.width,r.height,this,"setBounds"):r},setBounds:function(){var e=re.read(arguments),a=this.getBounds(),n=this._matrix,o=new Ze,r=e.getCenter();if(o.translate(r),e.width!=a.width||e.height!=a.height){if(!n.isInvertible())n.set(n._backup||new Ze().translate(n.getTranslation())),a=this.getBounds();o.scale(a.width!==0?e.width/a.width:0,a.height!==0?e.height/a.height:0)}r=a.getCenter(),o.translate(-r.x,-r.y),this.transform(o)},_getBounds:function(e,a){var n=this._children;if(!n||!n.length)return new re;return de._updateBoundsCache(this,a.cacheItem),de._getBounds(n,e,a)},_getBoundsCacheKey:function(e,a){return[e.stroke?1:0,e.handle?1:0,a?1:0].join("")},_getCachedBounds:function(e,a,n){e=e&&e._orNullIfIdentity();var o=a.internal&&!n,r=a.cacheItem,i=o?null:this._matrix._orNullIfIdentity(),u=r&&(!e||e.equals(i))&&this._getBoundsCacheKey(a,o),c=this._bounds;if(de._updateBoundsCache(this._parent||this._symbol,r),u&&c&&u in c){var m=c[u];return{rect:m.rect.clone(),nonscaling:m.nonscaling}}var t=this._getBounds(e||i,a),E=t.rect||t,I=this._style,p=t.nonscaling||I.hasStroke()&&!I.getStrokeScaling();if(u){if(!c)this._bounds=c={};var m=c[u]={rect:E.clone(),nonscaling:p,internal:o}}return{rect:E,nonscaling:p}},_getStrokeMatrix:function(e,a){var n=this.getStrokeScaling()?null:a&&a.internal?this:this._parent||this._symbol&&this._symbol._item,o=n?n.getViewMatrix().invert():e;return o&&o._shiftless()},statics:{_updateBoundsCache:function(e,a){if(e&&a){var n=a._id,o=e._boundsCache=e._boundsCache||{ids:{},list:[]};if(!o.ids[n])o.list.push(a),o.ids[n]=a}},_clearBoundsCache:function(e){var a=e._boundsCache;if(a){e._bounds=e._position=e._boundsCache=F;for(var n=0,o=a.list,r=o.length;n<r;n++){var i=o[n];if(i!==e){if(i._bounds=i._position=F,i._boundsCache)de._clearBoundsCache(i)}}}},_getBounds:function(e,a,n){var o=1/0,r=-o,i=o,u=r,c=!1;n=n||{};for(var m=0,t=e.length;m<t;m++){var E=e[m];if(E._visible&&!E.isEmpty(!0)){var I=E._getCachedBounds(a&&a.appended(E._matrix),n,!0),p=I.rect;if(o=Math.min(p.x,o),i=Math.min(p.y,i),r=Math.max(p.x+p.width,r),u=Math.max(p.y+p.height,u),I.nonscaling)c=!0}}return{rect:isFinite(o)?new re(o,i,r-o,u-i):new re,nonscaling:c}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var e=this._decompose();return e?e.rotation:0},setRotation:function(e){var a=this.getRotation();if(a!=null&&e!=null){var n=this._decomposed;if(this.rotate(e-a),n)n.rotation=e,this._decomposed=n}},getScaling:function(){var e=this._decompose(),a=e&&e.scaling;return new qe(a?a.x:1,a?a.y:1,this,"setScaling")},setScaling:function(){var e=this.getScaling(),a=U.read(arguments,0,{clone:!0,readNull:!0});if(e&&a&&!e.equals(a)){var n=this.getRotation(),o=this._decomposed,r=new Ze,i=ee.isZero;if(i(e.x)||i(e.y)){if(r.translate(o.translation),n)r.rotate(n);r.scale(a.x,a.y),this._matrix.set(r)}else{var u=this.getPosition(!0);if(r.translate(u),n)r.rotate(n);if(r.scale(a.x/e.x,a.y/e.y),n)r.rotate(-n);r.translate(u.negate()),this.transform(r)}if(o)o.scaling=a,this._decomposed=o}},getMatrix:function(){return this._matrix},setMatrix:function(){var e=this._matrix;e.set.apply(e,arguments)},getGlobalMatrix:function(e){var a=this._globalMatrix;if(a){var n=this._parent,o=[];while(n){if(!n._globalMatrix){a=null;for(var r=0,i=o.length;r<i;r++)o[r]._globalMatrix=null;break}o.push(n),n=n._parent}}if(!a){a=this._globalMatrix=this._matrix.clone();var n=this._parent;if(n)a.prepend(n.getGlobalMatrix(!0))}return e?a:a.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(e){if(this._applyMatrix=this._canApplyMatrix&&!!e)this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(e,a){if(this._project!==e){if(this._project)this._installEvents(!1);this._project=e;var n=this._children;for(var o=0,r=n&&n.length;o<r;o++)n[o]._setProject(e);a=!0}if(a)this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function e(a){e.base.call(this,a);var n=this._children;for(var o=0,r=n&&n.length;o<r;o++)n[o]._installEvents(a)},getLayer:function(){var e=this;while(e=e._parent)if(e instanceof Ia)return e;return null},getParent:function(){return this._parent},setParent:function(e){return e.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(e){this.removeChildren(),this.addChildren(e)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var e=this._getOwner();return e&&e._children[this._index+1]||null},getPreviousSibling:function(){var e=this._getOwner();return e&&e._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(e){return e===this||e&&this._class===e._class&&this._style.equals(e._style)&&this._matrix.equals(e._matrix)&&this._locked===e._locked&&this._visible===e._visible&&this._blendMode===e._blendMode&&this._opacity===e._opacity&&this._clipMask===e._clipMask&&this._guide===e._guide&&this._equals(e)||!1},_equals:function(e){return q.equals(this._children,e._children)},clone:function(e){var a=new this.constructor(de.NO_INSERT),n=this._children,o=q.pick(e?e.insert:F,e===F||e===!0),r=q.pick(e?e.deep:F,!0);if(n)a.copyAttributes(this);if(!n||r)a.copyContent(this);if(!n)a.copyAttributes(this);if(o)a.insertAbove(this);var i=this._name,u=this._parent;if(i&&u){var n=u._children,c=i,m=1;while(n[i])i=c+" "+m++;if(i!==c)a.setName(i)}return a},copyContent:function(e){var a=e._children;for(var n=0,o=a&&a.length;n<o;n++)this.addChild(a[n].clone(!1),!0)},copyAttributes:function(e,a){this.setStyle(e._style);var n=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"];for(var o=0,r=n.length;o<r;o++){var i=n[o];if(e.hasOwnProperty(i))this[i]=e[i]}if(!a)this._matrix.set(e._matrix,!0);this.setApplyMatrix(e._applyMatrix),this.setPivot(e._pivot),this.setSelection(e._selection);var{_data:u,_name:c}=e;if(this._data=u?q.clone(u):null,c)this.setName(c)},rasterize:function(e,a){var n,o,r;if(q.isPlainObject(e))n=e.resolution,o=e.insert,r=e.raster;else n=e,o=a;if(!r)r=new H(de.NO_INSERT);var i=this.getStrokeBounds(),u=(n||this.getView().getResolution())/72,c=i.getTopLeft().floor(),m=i.getBottomRight().ceil(),t=new oe(m.subtract(c)),E=t.multiply(u);if(r.setSize(E,!0),!E.isZero()){var I=r.getContext(!0),p=new Ze().scale(u).translate(c.negate());I.save(),p.applyToContext(I),this.draw(I,new q({matrices:[p]})),I.restore()}if(r._matrix.set(new Ze().translate(c.add(t.divide(2))).scale(1/u)),o===F||o)r.insertAbove(this);return r},contains:function(){var e=this._matrix;return e.isInvertible()&&!!this._contains(e._inverseTransform(U.read(arguments)))},_contains:function(e){var a=this._children;if(a){for(var n=a.length-1;n>=0;n--)if(a[n].contains(e))return!0;return!1}return e.isInside(this.getInternalBounds())},isInside:function(){return re.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new Ee.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(e,a){if(!(e instanceof de))return!1;return this._asPathItem().getIntersections(e._asPathItem(),null,a,!0).length>0}},new function(){function e(){var o=arguments;return this._hitTest(U.read(o),le.getOptions(o))}function a(){var o=arguments,r=U.read(o),i=le.getOptions(o),u=[];return this._hitTest(r,new q({all:u},i)),u}function n(o,r,i,u){var c=this._children;if(c)for(var m=c.length-1;m>=0;m--){var t=c[m],E=t!==u&&t._hitTest(o,r,i);if(E&&!r.all)return E}return null}return ba.inject({hitTest:e,hitTestAll:a,_hitTest:n}),{hitTest:e,hitTestAll:a,_hitTestChildren:n}},{_hitTest:function(e,a,n){if(this._locked||!this._visible||this._guide&&!a.guides||this.isEmpty())return null;var o=this._matrix,r=n?n.appended(o):this.getGlobalMatrix().prepend(this.getView()._matrix),i=Math.max(a.tolerance,0.000000000001),u=a._tolerancePadding=new oe(Ee._getStrokePadding(i,o._shiftless().invert()));if(e=o._inverseTransform(e),!e||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(u.multiply(2))._containsPoint(e))return null;var c=!(a.guides&&!this._guide||a.selected&&!this.isSelected()||a.type&&a.type!==q.hyphenate(this._class)||a.class&&!(this instanceof a.class)),m=a.match,t=this,E,I;function p(k){if(k&&m&&!m(k))k=null;if(k&&a.all)a.all.push(k);return k}function d(k,_){var D=_?E["get"+_]():t.getPosition();if(e.subtract(D).divide(u).length<=1)return new le(k,t,{name:_?q.hyphenate(_):k,point:D})}var{position:N,center:v,bounds:g}=a;if(c&&this._parent&&(N||v||g)){if(v||g)E=this.getInternalBounds();if(I=N&&d("position")||v&&d("center","Center"),!I&&g){var Z=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"];for(var f=0;f<8&&!I;f++)I=d("bounds",Z[f])}I=p(I)}if(!I)I=this._hitTestChildren(e,a,r)||c&&p(this._hitTestSelf(e,a,r,this.getStrokeScaling()?null:r._shiftless().invert()))||null;if(I&&I.point)I.point=o.transform(I.point);return I},_hitTestSelf:function(e,a){if(a.fill&&this.hasFill()&&this._contains(e))return new le("fill",this)},matches:function(e,a){function n(u,c){for(var m in u)if(u.hasOwnProperty(m)){var t=u[m],E=c[m];if(q.isPlainObject(t)&&q.isPlainObject(E)){if(!n(t,E))return!1}else if(!q.equals(t,E))return!1}return!0}var o=typeof e;if(o==="object"){for(var r in e)if(e.hasOwnProperty(r)&&!this.matches(r,e[r]))return!1;return!0}else if(o==="function")return e(this);else if(e==="match")return a(this);else{var i=/^(empty|editable)$/.test(e)?this["is"+q.capitalize(e)]():e==="type"?q.hyphenate(this._class):this[e];if(e==="class"){if(typeof a==="function")return this instanceof a;i=this._class}if(typeof a==="function")return!!a(i);else if(a){if(a.test)return a.test(i);else if(q.isPlainObject(a))return n(a,i)}return q.equals(i,a)}},getItems:function(e){return de._getItems(this,e,this._matrix)},getItem:function(e){return de._getItems(this,e,this._matrix,null,!0)[0]||null},statics:{_getItems:function e(a,n,o,r,i){if(!r){var u=typeof n==="object"&&n,c=u&&u.overlapping,m=u&&u.inside,t=c||m,p=t&&re.read([t]);if(r={items:[],recursive:u&&u.recursive!==!1,inside:!!m,overlapping:!!c,rect:p,path:c&&new Ee.Rectangle({rectangle:p,insert:!1})},u)n=q.filter({},n,{recursive:!0,inside:!0,overlapping:!0})}var E=a._children,I=r.items,p=r.rect;o=p&&(o||new Ze);for(var d=0,N=E&&E.length;d<N;d++){var v=E[d],g=o&&o.appended(v._matrix),Z=!0;if(p){var t=v.getBounds(g);if(!p.intersects(t))continue;if(!(p.contains(t)||r.overlapping&&(t.contains(p)||r.path.intersects(v,g))))Z=!1}if(Z&&v.matches(n)){if(I.push(v),i)break}if(r.recursive!==!1)e(v,n,g,r,i);if(i&&I.length>0)break}return I}}},{importJSON:function(e){var a=q.importJSON(e,this);return a!==this?this.addChild(a):a},addChild:function(e){return this.insertChild(F,e)},insertChild:function(e,a){var n=a?this.insertChildren(e,[a]):null;return n&&n[0]},addChildren:function(e){return this.insertChildren(this._children.length,e)},insertChildren:function(e,a){var n=this._children;if(n&&a&&a.length>0){a=q.slice(a);var o={};for(var r=a.length-1;r>=0;r--){var i=a[r],u=i&&i._id;if(!i||o[u])a.splice(r,1);else i._remove(!1,!0),o[u]=!0}q.splice(n,a,e,0);var c=this._project,m=c._changes;for(var r=0,t=a.length;r<t;r++){var i=a[r],E=i._name;if(i._parent=this,i._setProject(c,!0),E)i.setName(E);if(m)i._changed(5)}this._changed(11)}else a=null;return a},_insertItem:"#insertChild",_insertAt:function(e,a){var n=e&&e._getOwner(),o=e!==this&&n?this:null;if(o)o._remove(!1,!0),n._insertItem(e._index+a,o);return o},insertAbove:function(e){return this._insertAt(e,1)},insertBelow:function(e){return this._insertAt(e,0)},sendToBack:function(){var e=this._getOwner();return e?e._insertItem(0,this):null},bringToFront:function(){var e=this._getOwner();return e?e._insertItem(F,this):null},appendTop:"#addChild",appendBottom:function(e){return this.insertChild(0,e)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(e){return e._insertItem(F,this)},copyTo:function(e){return this.clone(!1).addTo(e)},reduce:function(e){var a=this._children;if(a&&a.length===1){var n=a[0].reduce(e);if(this._parent)n.insertAbove(this),this.remove();else n.remove();return n}return this},_removeNamed:function(){var e=this._getOwner();if(e){var{_children:a,_namedChildren:n}=e,o=this._name,r=n[o],i=r?r.indexOf(this):-1;if(i!==-1){if(a[o]==this)delete a[o];if(r.splice(i,1),r.length)a[o]=r[0];else delete n[o]}}},_remove:function(e,a){var n=this._getOwner(),o=this._project,r=this._index;if(this._style)this._style._dispose();if(n){if(this._name)this._removeNamed();if(r!=null){if(o._activeLayer===this)o._activeLayer=this.getNextSibling()||this.getPreviousSibling();q.splice(n._children,null,r,1)}if(this._installEvents(!1),e&&o._changes)this._changed(5);if(a)n._changed(11,this);return this._parent=null,!0}return!1},remove:function(){return this._remove(!0,!0)},replaceWith:function(e){var a=e&&e.insertBelow(this);if(a)this.remove();return a},removeChildren:function(e,a){if(!this._children)return null;e=e||0,a=q.pick(a,this._children.length);var n=q.splice(this._children,null,e,a-e);for(var o=n.length-1;o>=0;o--)n[o]._remove(!0,!1);if(n.length>0)this._changed(11);return n},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var e=0,a=this._children.length;e<a;e++)this._children[e]._index=e;this._changed(11)}},isEmpty:function(e){var a=this._children,n=a?a.length:0;if(e){for(var o=0;o<n;o++)if(!a[o].isEmpty(e))return!1;return!0}return!n},isEditable:function(){var e=this;while(e){if(!e._visible||e._locked)return!1;e=e._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(e){function a(u){var c=[];do c.unshift(u);while(u=u._parent);return c}var n=a(this),o=a(e);for(var r=0,i=Math.min(n.length,o.length);r<i;r++)if(n[r]!=o[r])return n[r]._index<o[r]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return this._parent?this._parent.isInserted():!1},isAbove:function(e){return this._getOrder(e)===-1},isBelow:function(e){return this._getOrder(e)===1},isParent:function(e){return this._parent===e},isChild:function(e){return e&&e._parent===this},isDescendant:function(e){var a=this;while(a=a._parent)if(a===e)return!0;return!1},isAncestor:function(e){return e?e.isDescendant(this):!1},isSibling:function(e){return this._parent===e._parent},isGroupedWith:function(e){var a=this._parent;while(a){if(a._parent&&/^(Group|Layer|CompoundPath)$/.test(a._class)&&e.isDescendant(a))return!0;a=a._parent}return!1}},q.each(["rotate","scale","shear","skew"],function(e){var a=e==="rotate";this[e]=function(){var n=arguments,o=(a?q:U).read(n),r=U.read(n,0,{readNull:!0});return this.transform(new Ze()[e](o,r||this.getPosition(!0)))}},{translate:function(){var e=new Ze;return this.transform(e.translate.apply(e,arguments))},transform:function(e,a,n){var o=this._matrix,r=e&&!e.isIdentity(),i=n&&this._canApplyMatrix||this._applyMatrix&&(r||!o.isIdentity()||a&&this._children);if(!r&&!i)return this;if(r){if(!e.isInvertible()&&o.isInvertible())o._backup=o.getValues();o.prepend(e,!0);var u=this._style,c=u.getFillColor(!0),m=u.getStrokeColor(!0);if(c)c.transform(e);if(m)m.transform(e)}if(i&&(i=this._transformContent(o,a,n))){var t=this._pivot;if(t)o._transformPoint(t,t,!0);if(o.reset(!0),n&&this._canApplyMatrix)this._applyMatrix=!0}var E=this._bounds,I=this._position;if(r||i)this._changed(25);var p=r&&E&&e.decompose();if(p&&p.skewing.isZero()&&p.rotation%90===0){for(var d in E){var N=E[d];if(N.nonscaling)delete E[d];else if(i||!N.internal){var v=N.rect;e._transformBounds(v,v)}}this._bounds=E;var g=E[this._getBoundsCacheKey(this._boundsOptions||{})];if(g)this._position=this._getPositionFromBounds(g.rect)}else if(r&&I&&this._pivot)this._position=e._transformPoint(I,I);return this},_transformContent:function(e,a,n){var o=this._children;if(o){for(var r=0,i=o.length;r<i;r++)o[r].transform(e,a,n);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(U.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(U.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(U.read(arguments))},localToParent:function(){return this._matrix._transformPoint(U.read(arguments))},fitBounds:function(e,a){e=re.read(arguments);var n=this.getBounds(),o=n.height/n.width,r=e.height/e.width,i=(a?o>r:o<r)?e.width/n.width:e.height/n.height,u=new re(new U,new oe(n.width*i,n.height*i));u.setCenter(e.getCenter()),this.setBounds(u)}}),{_setStyles:function(e,a,n){var o=this._style,r=this._matrix;if(o.hasFill())e.fillStyle=o.getFillColor().toCanvasStyle(e,r);if(o.hasStroke()){e.strokeStyle=o.getStrokeColor().toCanvasStyle(e,r),e.lineWidth=o.getStrokeWidth();var i=o.getStrokeJoin(),u=o.getStrokeCap(),c=o.getMiterLimit();if(i)e.lineJoin=i;if(u)e.lineCap=u;if(c)e.miterLimit=c;if(ve.support.nativeDash){var m=o.getDashArray(),t=o.getDashOffset();if(m&&m.length)if("setLineDash"in e)e.setLineDash(m),e.lineDashOffset=t;else e.mozDash=m,e.mozDashOffset=t}}if(o.hasShadow()){var E=a.pixelRatio||1,I=n._shiftless().prepend(new Ze().scale(E,E)),p=I.transform(new U(o.getShadowBlur(),0)),d=I.transform(this.getShadowOffset());e.shadowColor=o.getShadowColor().toCanvasStyle(e),e.shadowBlur=p.getLength(),e.shadowOffsetX=d.x,e.shadowOffsetY=d.y}},draw:function(e,a,n){var o=this._updateVersion=this._project._updateVersion;if(!this._visible||this._opacity===0)return;var{matrices:r,viewMatrix:i}=a,u=this._matrix,c=r[r.length-1].appended(u);if(!c.isInvertible())return;if(i=i?i.appended(c):c,r.push(c),a.updateMatrix)this._globalMatrix=c;var m=this._blendMode,t=ee.clamp(this._opacity,0,1),E=m==="normal",I=Zn.nativeModes[m],p=E&&t===1||a.dontStart||a.clip||(I||E&&t<1)&&this._canComposite(),d=a.pixelRatio||1,N,v,g;if(!p){var Z=this.getStrokeBounds(i);if(!Z.width||!Z.height){r.pop();return}if(g=a.offset,v=a.offset=Z.getTopLeft().floor(),N=e,e=Se.getContext(Z.getSize().ceil().add(1).multiply(d)),d!==1)e.scale(d,d)}e.save();var f=n?n.appended(u):this._canScaleStroke&&!this.getStrokeScaling(!0)&&i,k=!p&&a.clipItem,_=!f||k;if(p){if(e.globalAlpha=t,I)e.globalCompositeOperation=m}else if(_)e.translate(-v.x,-v.y);if(_)(p?u:i).applyToContext(e);if(k)a.clipItem.draw(e,a.extend({clip:!0}));if(f){e.setTransform(d,0,0,d,0,0);var D=a.offset;if(D)e.translate(-D.x,-D.y)}if(this._draw(e,a,i,f),e.restore(),r.pop(),a.clip&&!a.dontFinish)e.clip(this.getFillRule());if(!p)Zn.process(m,e,N,t,v.subtract(g).multiply(d)),Se.release(e),a.offset=g},_isUpdated:function(e){var a=this._parent;if(a instanceof We)return a._isUpdated(e);var n=this._updateVersion===e;if(!n&&a&&a._visible&&a._isUpdated(e))this._updateVersion=e,n=!0;return n},_drawSelection:function(e,a,n,o,r){var i=this._selection,u=i&1,c=i&2||u&&this._selectBounds,m=i&4;if(!this._drawSelected)u=!1;if((u||c||m)&&this._isUpdated(r)){var t,E=this.getSelectedColor(!0)||(t=this.getLayer())&&t.getSelectedColor(!0),I=a.appended(this.getGlobalMatrix(!0)),p=n/2;if(e.strokeStyle=e.fillStyle=E?E.toCanvasStyle(e):"#009dec",u)this._drawSelected(e,I,o);if(m){var d=this.getPosition(!0),N=this._parent,v=N?N.localToGlobal(d):d,g=v.x,Z=v.y;e.beginPath(),e.arc(g,Z,p,0,Math.PI*2,!0),e.stroke();var f=[[0,-1],[1,0],[0,1],[-1,0]],k=p,_=n+1;for(var D=0;D<4;D++){var w=f[D],J=w[0],T=w[1];e.moveTo(g+J*k,Z+T*k),e.lineTo(g+J*_,Z+T*_),e.stroke()}}if(c){var $=I._transformCorners(this.getInternalBounds());e.beginPath();for(var D=0;D<8;D++)e[!D?"moveTo":"lineTo"]($[D],$[++D]);e.closePath(),e.stroke();for(var D=0;D<8;D++)e.fillRect($[D]-p,$[++D]-p,n,n)}}},_canComposite:function(){return!1}},q.each(["down","drag","up","move"],function(e){this["removeOn"+q.capitalize(e)]=function(){var a={};return a[e]=!0,this.removeOn(a)}},{removeOn:function(e){for(var a in e)if(e[a]){var n="mouse"+a,o=this._project,r=o._removeSets=o._removeSets||{};r[n]=r[n]||{},r[n][this._id]=this}return this}}),{tween:function(e,a,n){if(!n){if(n=a,a=e,e=null,!n)n=a,a=null}var o=n&&n.easing,r=n&&n.start,i=n!=null&&(typeof n==="number"?n:n.duration),u=new pr(this,e,a,i,o,r);function c(m){if(u._handleFrame(m.time*1000),!u.running)this.off("frame",c)}if(i)this.on("frame",c);return u},tweenTo:function(e,a){return this.tween(null,e,a)},tweenFrom:function(e,a){return this.tween(e,null,a)}}),Ke=de.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function e(a){if(this._children=[],this._namedChildren={},!this._initialize(a))this.addChildren(Array.isArray(a)?a:arguments)},_changed:function e(a){if(e.base.call(this,a),a&2050)this._clipItem=F},_getClipItem:function(){var e=this._clipItem;if(e===F){e=null;var a=this._children;for(var n=0,o=a.length;n<o;n++)if(a[n]._clipMask){e=a[n];break}this._clipItem=e}return e},isClipped:function(){return!!this._getClipItem()},setClipped:function(e){var a=this.getFirstChild();if(a)a.setClipMask(e)},_getBounds:function e(a,n){var o=this._getClipItem();return o?o._getCachedBounds(o._matrix.prepended(a),q.set({},n,{stroke:!1})):e.base.call(this,a,n)},_hitTestChildren:function e(a,n,o){var r=this._getClipItem();return(!r||r.contains(a))&&e.base.call(this,a,n,o,r)},_draw:function(e,a){var n=a.clip,o=!n&&this._getClipItem();if(a=a.extend({clipItem:o,clip:!1}),n)e.beginPath(),a.dontStart=a.dontFinish=!0;else if(o)o.draw(e,a.extend({clip:!0}));var r=this._children;for(var i=0,u=r.length;i<u;i++){var c=r[i];if(c!==o)c.draw(e,a)}}}),Ia=Ke.extend({_class:"Layer",initialize:function e(){Ke.apply(this,arguments)},_getOwner:function(){return this._parent||this._index!=null&&this._project},isInserted:function e(){return this._parent?e.base.call(this):this._index!=null},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),ie=de.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function e(a,n){this._initialize(a,n)},_equals:function(e){return this._type===e._type&&this._size.equals(e._size)&&q.equals(this._radius,e._radius)},copyContent:function(e){this.setType(e._type),this.setSize(e._size),this.setRadius(e._radius)},getType:function(){return this._type},setType:function(e){this._type=e},getShape:"#getType",setShape:"#setType",getSize:function(){var e=this._size;return new oa(e.width,e.height,this,"setSize")},setSize:function(){var e=oe.read(arguments);if(!this._size)this._size=e.clone();else if(!this._size.equals(e)){var a=this._type,n=e.width,o=e.height;if(a==="rectangle")this._radius.set(oe.min(this._radius,e.divide(2).abs()));else if(a==="circle")n=o=(n+o)/2,this._radius=n/2;else if(a==="ellipse")this._radius._set(n/2,o/2);this._size._set(n,o),this._changed(9)}},getRadius:function(){var e=this._radius;return this._type==="circle"?e:new oa(e.width,e.height,this,"setRadius")},setRadius:function(e){var a=this._type;if(a==="circle"){if(e===this._radius)return;var n=e*2;this._radius=e,this._size._set(n,n)}else if(e=oe.read(arguments),!this._radius)this._radius=e.clone();else{if(this._radius.equals(e))return;if(this._radius.set(e),a==="rectangle"){var n=oe.max(this._size,e.multiply(2));this._size.set(n)}else if(a==="ellipse")this._size._set(e.width*2,e.height*2)}this._changed(9)},isEmpty:function(){return!1},toPath:function(e){var a=new Ee[q.capitalize(this._type)]({center:new U,size:this._size,radius:this._radius,insert:!1});if(a.copyAttributes(this),ve.settings.applyMatrix)a.setApplyMatrix(!0);if(e===F||e)a.insertAbove(this);return a},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(e,a,n,o){var r=this._style,i=r.hasFill(),u=r.hasStroke(),c=a.dontFinish||a.clip,m=!o;if(i||u||c){var t=this._type,E=this._radius,I=t==="circle";if(!a.dontStart)e.beginPath();if(m&&I)e.arc(0,0,E,0,Math.PI*2,!0);else{var p=I?E:E.width,d=I?E:E.height,N=this._size,v=N.width,g=N.height;if(m&&t==="rectangle"&&p===0&&d===0)e.rect(-v/2,-g/2,v,g);else{var Z=v/2,f=g/2,k=0.44771525016920644,_=p*k,D=d*k,w=[-Z,-f+d,-Z,-f+D,-Z+_,-f,-Z+p,-f,Z-p,-f,Z-_,-f,Z,-f+D,Z,-f+d,Z,f-d,Z,f-D,Z-_,f,Z-p,f,-Z+p,f,-Z+_,f,-Z,f-D,-Z,f-d];if(o)o.transform(w,w,32);if(e.moveTo(w[0],w[1]),e.bezierCurveTo(w[2],w[3],w[4],w[5],w[6],w[7]),Z!==p)e.lineTo(w[8],w[9]);if(e.bezierCurveTo(w[10],w[11],w[12],w[13],w[14],w[15]),f!==d)e.lineTo(w[16],w[17]);if(e.bezierCurveTo(w[18],w[19],w[20],w[21],w[22],w[23]),Z!==p)e.lineTo(w[24],w[25]);e.bezierCurveTo(w[26],w[27],w[28],w[29],w[30],w[31])}}e.closePath()}if(!c&&(i||u)){if(this._setStyles(e,a,n),i)e.fill(r.getFillRule()),e.shadowColor="rgba(0,0,0,0)";if(u)e.stroke()}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(e,a){var n=new re(this._size).setCenter(0,0),o=this._style,r=a.stroke&&o.hasStroke()&&o.getStrokeWidth();if(e)n=e._transformBounds(n);return r?n.expand(Ee._getStrokePadding(r,this._getStrokeMatrix(e,a))):n}},new function(){function e(n,o,r){var i=n._radius;if(!i.isZero()){var u=n._size.divide(2);for(var c=1;c<=4;c++){var m=new U(c>1&&c<4?-1:1,c>2?-1:1),t=m.multiply(u),E=t.subtract(m.multiply(i)),I=new re(r?t.add(m.multiply(r)):t,E);if(I.contains(o))return{point:E,quadrant:c}}}}function a(n,o,r,i){var u=n.divide(o);return(!i||u.isInQuadrant(i))&&u.subtract(u.normalize()).multiply(o).divide(r).length<=1}return{_contains:function n(o){if(this._type==="rectangle"){var r=e(this,o);return r?o.subtract(r.point).divide(this._radius).getLength()<=1:n.base.call(this,o)}else return o.divide(this.size).getLength()<=0.5},_hitTestSelf:function n(o,r,i,u){var c=!1,m=this._style,t=r.stroke&&m.hasStroke(),E=r.fill&&m.hasFill();if(t||E){var I=this._type,p=this._radius,d=t?m.getStrokeWidth()/2:0,N=r._tolerancePadding.add(Ee._getStrokePadding(d,!m.getStrokeScaling()&&u));if(I==="rectangle"){var v=N.multiply(2),g=e(this,o,v);if(g)c=a(o.subtract(g.point),p,N,g.quadrant);else{var Z=new re(this._size).setCenter(0,0),f=Z.expand(v),k=Z.expand(v.negate());c=f._containsPoint(o)&&!k._containsPoint(o)}}else c=a(o,p,N)}return c?new le(t?"stroke":"fill",this):n.base.apply(this,arguments)}}},{statics:new function(){function e(a,n,o,r,i){var u=q.create(ie.prototype);return u._type=a,u._size=o,u._radius=r,u._initialize(q.getNamed(i),n),u}return{Circle:function(){var a=arguments,n=U.readNamed(a,"center"),o=q.readNamed(a,"radius");return e("circle",n,new oe(o*2),o,a)},Rectangle:function(){var a=arguments,n=re.readNamed(a,"rectangle"),o=oe.min(oe.readNamed(a,"radius"),n.getSize(!0).divide(2));return e("rectangle",n.getCenter(!0),n.getSize(!0),o,a)},Ellipse:function(){var a=arguments,n=ie._readEllipse(a),o=n.radius;return e("ellipse",n.center,o.multiply(2),o,a)},_readEllipse:function(a){var n,o;if(q.hasNamed(a,"radius"))n=U.readNamed(a,"center"),o=oe.readNamed(a,"radius");else{var r=re.readNamed(a,"rectangle");n=r.getCenter(!0),o=r.getSize(!0).divide(2)}return{center:n,radius:o}}}}}),H=de.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],_smoothing:"low",beans:!0,initialize:function e(a,n){if(!this._initialize(a,n!==F&&U.read(arguments))){var o,r=typeof a,i=r==="string"?Y.getElementById(a):r==="object"?a:null;if(i&&i!==de.NO_INSERT){if(i.getContext||i.naturalHeight!=null)o=i;else if(i){var u=oe.read(arguments);if(!u.isZero())o=Se.getCanvas(u)}}if(o)this.setImage(o);else this.setSource(a)}if(!this._size)this._size=new oe,this._loaded=!1},_equals:function(e){return this.getSource()===e.getSource()},copyContent:function(e){var{_image:a,_canvas:n}=e;if(a)this._setImage(a);else if(n){var o=Se.getCanvas(e._size);o.getContext("2d").drawImage(n,0,0),this._setImage(o)}this._crossOrigin=e._crossOrigin},getSize:function(){var e=this._size;return new oa(e?e.width:0,e?e.height:0,this,"setSize")},setSize:function(e,a){var n=oe.read(arguments);if(!n.equals(this._size))if(n.width>0&&n.height>0){var o=!a&&this.getElement();if(this._setImage(Se.getCanvas(n)),o)this.getContext(!0).drawImage(o,0,0,n.width,n.height)}else{if(this._canvas)Se.release(this._canvas);this._size=n.clone()}else if(a)this.clear()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(e){this.setSize(e,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(e){this.setSize(this.getWidth(),e)},getLoaded:function(){return this._loaded},isEmpty:function(){var e=this._size;return!e||e.width===0&&e.height===0},getResolution:function(){var e=this._matrix,a=new U(0,0).transform(e),n=new U(1,0).transform(e).subtract(a),o=new U(0,1).transform(e).subtract(a);return new oe(72/n.getLength(),72/o.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(e){var a=this;function n(o){var r=a.getView(),i=o&&o.type||"load";if(r&&a.responds(i))ve=r._scope,a.emit(i,new wa(o))}if(this._setImage(e),this._loaded)setTimeout(n,0);else if(e)Ae.add(e,{load:function(o){a._setImage(e),n(o)},error:n})},_setImage:function(e){if(this._canvas)Se.release(this._canvas);if(e&&e.getContext)this._image=null,this._canvas=e,this._loaded=!0;else this._image=e,this._canvas=null,this._loaded=!!(e&&e.src&&e.complete);this._size=new oe(e?e.naturalWidth||e.width:0,e?e.naturalHeight||e.height:0),this._context=null,this._changed(1033)},getCanvas:function(){if(!this._canvas){var e=Se.getContext(this._size);try{if(this._image)e.drawImage(this._image,0,0);this._canvas=e.canvas}catch(a){Se.release(e)}}return this._canvas},setCanvas:"#setImage",getContext:function(e){if(!this._context)this._context=this.getCanvas().getContext("2d");if(e)this._image=null,this._changed(1025);return this._context},setContext:function(e){this._context=e},getSource:function(){var e=this._image;return e&&e.src||this.toDataURL()},setSource:function(e){var a=new A.Image,n=this._crossOrigin;if(n)a.crossOrigin=n;if(e)a.src=e;this.setImage(a)},getCrossOrigin:function(){var e=this._image;return e&&e.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(e){this._crossOrigin=e;var a=this._image;if(a)a.crossOrigin=e},getSmoothing:function(){return this._smoothing},setSmoothing:function(e){this._smoothing=typeof e==="string"?e:e?"low":"off",this._changed(257)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var e=re.read(arguments),a=Se.getContext(e.getSize());return a.drawImage(this.getCanvas(),e.x,e.y,e.width,e.height,0,0,e.width,e.height),a.canvas},getSubRaster:function(){var e=re.read(arguments),a=new H(de.NO_INSERT);return a._setImage(this.getSubCanvas(e)),a.translate(e.getCenter().subtract(this.getSize().divide(2))),a._matrix.prepend(this._matrix),a.insertAbove(this),a},toDataURL:function(){var e=this._image,a=e&&e.src;if(/^data:/.test(a))return a;var n=this.getCanvas();return n?n.toDataURL.apply(n,arguments):null},drawImage:function(e){var a=U.read(arguments,1);this.getContext(!0).drawImage(e,a.x,a.y)},getAverageColor:function(e){var a,n;if(!e)a=this.getBounds();else if(e instanceof Pe)n=e,a=e.getBounds();else if(typeof e==="object"){if("width"in e)a=new re(e);else if("x"in e)a=new re(e.x-0.5,e.y-0.5,1,1)}if(!a)return null;var o=32,r=Math.min(a.width,o),i=Math.min(a.height,o),u=H._sampleContext;if(!u)u=H._sampleContext=Se.getContext(new oe(o));else u.clearRect(0,0,o+1,o+1);u.save();var c=new Ze().scale(r/a.width,i/a.height).translate(-a.x,-a.y);if(c.applyToContext(u),n)n.draw(u,new q({clip:!0,matrices:[c]}));this._matrix.applyToContext(u);var m=this.getElement(),t=this._size;if(m)u.drawImage(m,-t.width/2,-t.height/2);u.restore();var E=u.getImageData(0.5,0.5,Math.ceil(r),Math.ceil(i)).data,I=[0,0,0],p=0;for(var d=0,N=E.length;d<N;d+=4){var v=E[d+3];p+=v,v/=255,I[0]+=E[d]*v,I[1]+=E[d+1]*v,I[2]+=E[d+2]*v}for(var d=0;d<3;d++)I[d]/=p;return p?K.read(I):null},getPixel:function(){var e=U.read(arguments),a=this.getContext().getImageData(e.x,e.y,1,1).data;return new K("rgb",[a[0]/255,a[1]/255,a[2]/255],a[3]/255)},setPixel:function(){var e=arguments,a=U.read(e),n=K.read(e),o=n._convert("rgb"),r=n._alpha,i=this.getContext(!0),u=i.createImageData(1,1),c=u.data;c[0]=o[0]*255,c[1]=o[1]*255,c[2]=o[2]*255,c[3]=r!=null?r*255:255,i.putImageData(u,a.x,a.y)},clear:function(){var e=this._size;this.getContext(!0).clearRect(0,0,e.width+1,e.height+1)},createImageData:function(){var e=oe.read(arguments);return this.getContext().createImageData(e.width,e.height)},getImageData:function(){var e=re.read(arguments);if(e.isEmpty())e=new re(this._size);return this.getContext().getImageData(e.x,e.y,e.width,e.height)},putImageData:function(e){var a=U.read(arguments,1);this.getContext(!0).putImageData(e,a.x,a.y)},setImageData:function(e){this.setSize(e),this.getContext(!0).putImageData(e,0,0)},_getBounds:function(e,a){var n=new re(this._size).setCenter(0,0);return e?e._transformBounds(n):n},_hitTestSelf:function(e){if(this._contains(e)){var a=this;return new le("pixel",a,{offset:e.add(a._size.divide(2)).round(),color:{get:function(){return a.getPixel(this.offset)}}})}},_draw:function(e,a,n){var o=this.getElement();if(o&&o.width>0&&o.height>0){e.globalAlpha=ee.clamp(this._opacity,0,1),this._setStyles(e,a,n);var r=this._smoothing,i=r==="off";$e.setPrefixed(e,i?"imageSmoothingEnabled":"imageSmoothingQuality",i?!1:r),e.drawImage(o,-this._size.width/2,-this._size.height/2)}},_canComposite:function(){return!0}}),ae=de.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function e(a,n){if(!this._initialize(a,n!==F&&U.read(arguments,1)))this.setDefinition(a instanceof z?a:new z(a))},_equals:function(e){return this._definition===e._definition},copyContent:function(e){this.setDefinition(e._definition)},getDefinition:function(){return this._definition},setDefinition:function(e){this._definition=e,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(e,a){var n=this._definition._item;return n._getCachedBounds(n._matrix.prepended(e),a)},_hitTestSelf:function(e,a,n){var o=a.extend({all:!1}),r=this._definition._item._hitTest(e,o,n);if(r)r.item=this;return r},_draw:function(e,a){this._definition._item.draw(e,a)}}),z=q.extend({_class:"SymbolDefinition",initialize:function e(a,n){if(this._id=Te.get(),this.project=ve.project,a)this.setItem(a,n)},_serialize:function(e,a){return a.add(this,function(){return q.serialize([this._class,this._item],e,!1,a)})},_changed:function(e){if(e&8)de._clearBoundsCache(this);if(e&1)this.project._changed(e)},getItem:function(){return this._item},setItem:function(e,a){if(e._symbol)e=e.clone();if(this._item)this._item._symbol=null;if(this._item=e,e.remove(),e.setSelected(!1),!a)e.setPosition(new U);e._symbol=this,this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(e){return new ae(this,e)},clone:function(){return new z(this._item.clone(!1))},equals:function(e){return e===this||e&&this._item.equals(e._item)||!1}}),le=q.extend({_class:"HitResult",initialize:function e(a,n,o){if(this.type=a,this.item=n,o)this.inject(o)},statics:{getOptions:function(e){var a=e&&q.read(e);return new q({type:null,tolerance:ve.settings.hitTolerance,fill:!a,stroke:!a,segments:!a,handles:!1,ends:!1,position:!1,center:!1,bounds:!1,guides:!1,selected:!1},a)}}}),C=q.extend({_class:"Segment",beans:!0,_selection:0,initialize:function e(a,n,o,r,i,u){var c=arguments.length,m,t,E,I;if(c>0)if(a==null||typeof a==="object")if(c===1&&a&&"point"in a)m=a.point,t=a.handleIn,E=a.handleOut,I=a.selection;else m=a,t=n,E=o,I=r;else m=[a,n],t=o!==F?[o,r]:null,E=i!==F?[i,u]:null;if(new De(m,this,"_point"),new De(t,this,"_handleIn"),new De(E,this,"_handleOut"),I)this.setSelection(I)},_serialize:function(e,a){var n=this._point,o=this._selection,r=o||this.hasHandles()?[n,this._handleIn,this._handleOut]:n;if(o)r.push(o);return q.serialize(r,e,!0,a)},_changed:function(e){var a=this._path;if(!a)return;var n=a._curves,o=this._index,r;if(n){if((!e||e===this._point||e===this._handleIn)&&(r=o>0?n[o-1]:a._closed?n[n.length-1]:null))r._changed();if((!e||e===this._point||e===this._handleOut)&&(r=n[o]))r._changed()}a._changed(41)},getPoint:function(){return this._point},setPoint:function(){this._point.set(U.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(U.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(U.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var e=this._handleIn,a=this._handleOut;return!e.isZero()&&!a.isZero()&&e.isCollinear(a)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(e){var a=this._selection,n=this._path;if(this._selection=e=e||0,n&&e!==a)n._updateSelection(this,a,e),n._changed(257)},_changeSelection:function(e,a){var n=this._selection;this.setSelection(a?n|e:n&~e)},isSelected:function(){return!!(this._selection&7)},setSelected:function(e){this._changeSelection(7,e)},getIndex:function(){return this._index!==F?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var e=this._path,a=this._index;if(e){if(a>0&&!e._closed&&a===e._segments.length-1)a--;return e.getCurves()[a]||null}return null},getLocation:function(){var e=this.getCurve();return e?new je(e,this===e._segment1?0:1):null},getNext:function(){var e=this._path&&this._path._segments;return e&&(e[this._index+1]||this._path._closed&&e[0])||null},smooth:function(e,a,n){var o=e||{},r=o.type,i=o.factor,u=this.getPrevious(),c=this.getNext(),m=(u||this)._point,t=this._point,E=(c||this)._point,I=m.getDistance(t),p=t.getDistance(E);if(!r||r==="catmull-rom"){var d=i===F?0.5:i,N=Math.pow(I,d),v=N*N,g=Math.pow(p,d),Z=g*g;if(!a&&u){var f=2*Z+3*g*N+v,k=3*g*(g+N);this.setHandleIn(k!==0?new U((Z*m._x+f*t._x-v*E._x)/k-t._x,(Z*m._y+f*t._y-v*E._y)/k-t._y):new U)}if(!n&&c){var f=2*v+3*N*g+Z,k=3*N*(N+g);this.setHandleOut(k!==0?new U((v*E._x+f*t._x-Z*m._x)/k-t._x,(v*E._y+f*t._y-Z*m._y)/k-t._y):new U)}}else if(r==="geometric"){if(u&&c){var _=m.subtract(E),D=i===F?0.4:i,w=D*I/(I+p);if(!a)this.setHandleIn(_.multiply(w));if(!n)this.setHandleOut(_.multiply(w-D))}}else throw new Error("Smoothing method \'"+r+"\' not supported.")},getPrevious:function(){var e=this._path&&this._path._segments;return e&&(e[this._index-1]||this._path._closed&&e[e.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var e=this._path;return e&&this._index===e._segments.length-1||!1},reverse:function(){var e=this._handleIn,a=this._handleOut,n=e.clone();e.set(a),a.set(n)},reversed:function(){return new C(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?!!this._path.removeSegment(this._index):!1},clone:function(){return new C(this._point,this._handleIn,this._handleOut)},equals:function(e){return e===this||e&&this._class===e._class&&this._point.equals(e._point)&&this._handleIn.equals(e._handleIn)&&this._handleOut.equals(e._handleOut)||!1},toString:function(){var e=["point: "+this._point];if(!this._handleIn.isZero())e.push("handleIn: "+this._handleIn);if(!this._handleOut.isZero())e.push("handleOut: "+this._handleOut);return"{ "+e.join(", ")+" }"},transform:function(e){this._transformCoordinates(e,new Array(6),!0),this._changed()},interpolate:function(e,a,n){var o=1-n,r=n,i=e._point,u=a._point,c=e._handleIn,m=a._handleIn,t=a._handleOut,E=e._handleOut;this._point._set(o*i._x+r*u._x,o*i._y+r*u._y,!0),this._handleIn._set(o*c._x+r*m._x,o*c._y+r*m._y,!0),this._handleOut._set(o*E._x+r*t._x,o*E._y+r*t._y,!0),this._changed()},_transformCoordinates:function(e,a,n){var o=this._point,r=!n||!this._handleIn.isZero()?this._handleIn:null,i=!n||!this._handleOut.isZero()?this._handleOut:null,u=o._x,c=o._y,m=2;if(a[0]=u,a[1]=c,r)a[m++]=r._x+u,a[m++]=r._y+c;if(i)a[m++]=i._x+u,a[m++]=i._y+c;if(e)if(e._transformCoordinates(a,a,m/2),u=a[0],c=a[1],n){if(o._x=u,o._y=c,m=2,r)r._x=a[m++]-u,r._y=a[m++]-c;if(i)i._x=a[m++]-u,i._y=a[m++]-c}else{if(!r)a[m++]=u,a[m++]=c;if(!i)a[m++]=u,a[m++]=c}return a}}),De=U.extend({initialize:function e(a,n,o){var r,i,u;if(!a)r=i=0;else if((r=a[0])!==F)i=a[1];else{var c=a;if((r=c.x)===F)c=U.read(arguments),r=c.x;i=c.y,u=c.selected}if(this._x=r,this._y=i,this._owner=n,n[o]=this,u)this.setSelected(!0)},_set:function(e,a){return this._x=e,this._y=a,this._owner._changed(this),this},getX:function(){return this._x},setX:function(e){this._x=e,this._owner._changed(this)},getY:function(){return this._y},setY:function(e){this._y=e,this._owner._changed(this)},isZero:function(){var e=ee.isZero;return e(this._x)&&e(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(e){this._owner._changeSelection(this._getSelection(),e)},_getSelection:function(){var e=this._owner;return this===e._point?1:this===e._handleIn?2:this===e._handleOut?4:0}}),L=q.extend({_class:"Curve",beans:!0,initialize:function e(a,n,o,r,i,u,c,m){var t=arguments.length,E,I,p,d,N,v;if(t===3)this._path=a,E=n,I=o;else if(!t)E=new C,I=new C;else if(t===1){if("segment1"in a)E=new C(a.segment1),I=new C(a.segment2);else if("point1"in a)p=a.point1,N=a.handle1,v=a.handle2,d=a.point2;else if(Array.isArray(a))p=[a[0],a[1]],d=[a[6],a[7]],N=[a[2]-a[0],a[3]-a[1]],v=[a[4]-a[6],a[5]-a[7]]}else if(t===2)E=new C(a),I=new C(n);else if(t===4)p=a,N=n,v=o,d=r;else if(t===8)p=[a,n],d=[c,m],N=[o-a,r-n],v=[i-c,u-m];this._segment1=E||new C(p,null,N),this._segment2=I||new C(d,v,null)},_serialize:function(e,a){return q.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],e,!0,a)},_changed:function(){this._length=this._bounds=F},clone:function(){return new L(this._segment1,this._segment2)},toString:function(){var e=["point1: "+this._segment1._point];if(!this._segment1._handleOut.isZero())e.push("handle1: "+this._segment1._handleOut);if(!this._segment2._handleIn.isZero())e.push("handle2: "+this._segment2._handleIn);return e.push("point2: "+this._segment2._point),"{ "+e.join(", ")+" }"},classify:function(){return L.classify(this.getValues())},remove:function(){var e=!1;if(this._path){var a=this._segment2,n=a._handleOut;if(e=a.remove(),e)this._segment1._handleOut.set(n)}return e},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(U.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(U.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(U.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(U.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var e=this._path&&this._path._curves;return e&&(e[this._segment1._index+1]||this._path._closed&&e[0])||null},getPrevious:function(){var e=this._path&&this._path._curves;return e&&(e[this._segment1._index-1]||this._path._closed&&e[e.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var e=this._path;return e&&this._segment1._index===e._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle1().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(e){this.getPoint1().setSelected(e),this.getHandle1().setSelected(e),this.getHandle2().setSelected(e),this.getPoint2().setSelected(e)},getValues:function(e){return L.getValues(this._segment1,this._segment2,e)},getPoints:function(){var e=this.getValues(),a=[];for(var n=0;n<8;n+=2)a.push(new U(e[n],e[n+1]));return a}},{getLength:function(){if(this._length==null)this._length=L.getLength(this.getValues(),0,1);return this._length},getArea:function(){return L.getArea(this.getValues())},getLine:function(){return new Qe(this._segment1._point,this._segment2._point)},getPart:function(e,a){return new L(L.getPart(this.getValues(),e,a))},getPartLength:function(e,a){return L.getLength(this.getValues(),e,a)},divideAt:function(e){return this.divideAtTime(e&&e.curve===this?e.time:this.getTimeAt(e))},divideAtTime:function(e,a){var n=0.00000001,o=1-n,r=null;if(e>=n&&e<=o){var i=L.subdivide(this.getValues(),e),u=i[0],c=i[1],m=a||this.hasHandles(),t=this._segment1,E=this._segment2,I=this._path;if(m)t._handleOut._set(u[2]-u[0],u[3]-u[1]),E._handleIn._set(c[4]-c[6],c[5]-c[7]);var p=u[6],d=u[7],N=new C(new U(p,d),m&&new U(u[4]-p,u[5]-d),m&&new U(c[2]-p,c[3]-d));if(I)I.insert(t._index+1,N),r=this.getNext();else this._segment2=N,this._changed(),r=new L(N,E)}return r},splitAt:function(e){var a=this._path;return a?a.splitAt(e):null},splitAtTime:function(e){return this.splitAt(this.getLocationAtTime(e))},divide:function(e,a){return this.divideAtTime(e===F?0.5:a?e:this.getTimeAt(e))},split:function(e,a){return this.splitAtTime(e===F?0.5:a?e:this.getTimeAt(e))},reversed:function(){return new L(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(e,a,n,o){var{_point:r,_handleOut:i}=e,u=a._handleIn,c=a._point,m=r.x,t=r.y,E=c.x,I=c.y,p=o?[m,t,m,t,E,I,E,I]:[m,t,m+i._x,t+i._y,E+u._x,I+u._y,E,I];if(n)n._transformCoordinates(p,p,4);return p},subdivide:function(e,a){var n=e[0],o=e[1],r=e[2],i=e[3],u=e[4],c=e[5],m=e[6],t=e[7];if(a===F)a=0.5;var E=1-a,I=E*n+a*r,p=E*o+a*i,d=E*r+a*u,N=E*i+a*c,v=E*u+a*m,g=E*c+a*t,Z=E*I+a*d,f=E*p+a*N,k=E*d+a*v,_=E*N+a*g,D=E*Z+a*k,w=E*f+a*_;return[[n,o,I,p,Z,f,D,w],[D,w,k,_,v,g,m,t]]},getMonoCurves:function(e,a){var n=[],o=a?0:1,r=e[o+0],i=e[o+2],u=e[o+4],c=e[o+6];if(r>=i===i>=u&&i>=u===u>=c||L.isStraight(e))n.push(e);else{var m=3*(i-u)-r+c,t=2*(r+u)-4*i,E=i-r,I=0.00000001,p=1-I,d=[],N=ee.solveQuadratic(m,t,E,d,I,p);if(!N)n.push(e);else{d.sort();var v=d[0],g=L.subdivide(e,v);if(n.push(g[0]),N>1)v=(d[1]-v)/(1-v),g=L.subdivide(g[1],v),n.push(g[0]);n.push(g[1])}}return n},solveCubic:function(e,a,n,o,r,i){var u=e[a],c=e[a+2],m=e[a+4],t=e[a+6],E=0;if(!(u<n&&t<n&&c<n&&m<n||u>n&&t>n&&c>n&&m>n)){var I=3*(c-u),p=3*(m-c)-I,d=t-u-I-p;E=ee.solveCubic(d,p,I,u-n,o,r,i)}return E},getTimeOf:function(e,a){var n=new U(e[0],e[1]),o=new U(e[6],e[7]),r=0.000000000001,i=0.0000001,u=a.isClose(n,r)?0:a.isClose(o,r)?1:null;if(u===null){var c=[a.x,a.y],m=[];for(var t=0;t<2;t++){var E=L.solveCubic(e,t,c[t],m,0,1);for(var I=0;I<E;I++){var p=m[I];if(a.isClose(L.getPoint(e,p),i))return p}}}return a.isClose(n,i)?0:a.isClose(o,i)?1:null},getNearestTime:function(e,a){if(L.isStraight(e)){var n=e[0],o=e[1],r=e[6],i=e[7],u=r-n,c=i-o,m=u*u+c*c;if(m===0)return 0;var t=((a.x-n)*u+(a.y-o)*c)/m;return t<0.000000000001?0:t>0.999999999999?1:L.getTimeOf(e,new U(n+t*u,o+t*c))}var E=100,I=1/0,p=0;function d(g){if(g>=0&&g<=1){var Z=a.getDistance(L.getPoint(e,g),!0);if(Z<I)return I=Z,p=g,!0}}for(var N=0;N<=E;N++)d(N/E);var v=1/(E*2);while(v>0.00000001)if(!d(p-v)&&!d(p+v))v/=2;return p},getPart:function(e,a,n){var o=a>n;if(o){var r=a;a=n,n=r}if(a>0)e=L.subdivide(e,a)[1];if(n<1)e=L.subdivide(e,(n-a)/(1-a))[0];return o?[e[6],e[7],e[4],e[5],e[2],e[3],e[0],e[1]]:e},isFlatEnough:function(e,a){var n=e[0],o=e[1],r=e[2],i=e[3],u=e[4],c=e[5],m=e[6],t=e[7],E=3*r-2*n-m,I=3*i-2*o-t,p=3*u-2*m-n,d=3*c-2*t-o;return Math.max(E*E,p*p)+Math.max(I*I,d*d)<=16*a*a},getArea:function(e){var a=e[0],n=e[1],o=e[2],r=e[3],i=e[4],u=e[5],c=e[6],m=e[7];return 3*((m-n)*(o+i)-(c-a)*(r+u)+r*(a-i)-o*(n-u)+m*(i+a/3)-c*(u+n/3))/20},getBounds:function(e){var a=e.slice(0,2),n=a.slice(),o=[0,0];for(var r=0;r<2;r++)L._addBounds(e[r],e[r+2],e[r+4],e[r+6],r,0,a,n,o);return new re(a[0],a[1],n[0]-a[0],n[1]-a[1])},_addBounds:function(e,a,n,o,r,i,u,c,m){function t(D,w){var J=D-w,T=D+w;if(J<u[r])u[r]=J;if(T>c[r])c[r]=T}i/=2;var E=u[r]+i,I=c[r]-i;if(e<E||a<E||n<E||o<E||e>I||a>I||n>I||o>I)if(a<e!=a<o&&n<e!=n<o)t(e,0),t(o,0);else{var p=3*(a-n)-e+o,d=2*(e+n)-4*a,N=a-e,v=ee.solveQuadratic(p,d,N,m),g=0.00000001,Z=1-g;t(o,0);for(var f=0;f<v;f++){var k=m[f],_=1-k;if(g<=k&&k<=Z)t(_*_*_*e+3*_*_*k*a+3*_*k*k*n+k*k*k*o,i)}}}}},q.each(["getBounds","getStrokeBounds","getHandleBounds"],function(e){this[e]=function(){if(!this._bounds)this._bounds={};var a=this._bounds[e];if(!a)a=this._bounds[e]=Ee[e]([this._segment1,this._segment2],!1,this._path);return a.clone()}},{}),q.each({isStraight:function(e,a,n,o){if(a.isZero()&&n.isZero())return!0;else{var r=o.subtract(e);if(r.isZero())return!1;else if(r.isCollinear(a)&&r.isCollinear(n)){var i=new Qe(e,o),u=0.0000001;if(i.getDistance(e.add(a))<u&&i.getDistance(o.add(n))<u){var c=r.dot(r),m=r.dot(a)/c,t=r.dot(n)/c;return m>=0&&m<=1&&t<=0&&t>=-1}}}return!1},isLinear:function(e,a,n,o){var r=o.subtract(e).divide(3);return a.equals(r)&&n.negate().equals(r)}},function(e,a){this[a]=function(n){var o=this._segment1,r=this._segment2;return e(o._point,o._handleOut,r._handleIn,r._point,n)},this.statics[a]=function(n,o){var r=n[0],i=n[1],u=n[6],c=n[7];return e(new U(r,i),new U(n[2]-r,n[3]-i),new U(n[4]-u,n[5]-c),new U(u,c),o)}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(e){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(e||0)},isCollinear:function(e){return e&&this.isStraight()&&e.isStraight()&&this.getLine().isCollinear(e.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(0.5).y)<0.00000001},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(0.5).x)<0.00000001}}),{beans:!1,getLocationAt:function(e,a){return this.getLocationAtTime(a?e:this.getTimeAt(e))},getLocationAtTime:function(e){return e!=null&&e>=0&&e<=1?new je(this,e):null},getTimeAt:function(e,a){return L.getTimeAt(this.getValues(),e,a)},getParameterAt:"#getTimeAt",getTimesWithTangent:function(){var e=U.read(arguments);return e.isZero()?[]:L.getTimesWithTangent(this.getValues(),e)},getOffsetAtTime:function(e){return this.getPartLength(0,e)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(U.read(arguments)))},getOffsetOf:function(){var e=this.getLocationOf.apply(this,arguments);return e?e.getOffset():null},getTimeOf:function(){return L.getTimeOf(this.getValues(),U.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var e=U.read(arguments),a=this.getValues(),n=L.getNearestTime(a,e),o=L.getPoint(a,n);return new je(this,n,o,null,e.getDistance(o))},getNearestPoint:function(){var e=this.getNearestLocation.apply(this,arguments);return e?e.getPoint():e}},new function(){var e=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return q.each(e,function(a){this[a+"At"]=function(n,o){var r=this.getValues();return L[a](r,o?n:L.getTimeAt(r,n))},this[a+"AtTime"]=function(n){return L[a](this.getValues(),n)}},{statics:{_evaluateMethods:e}})},new function(){function e(o){var r=o[0],i=o[1],u=o[2],c=o[3],m=o[4],t=o[5],E=o[6],I=o[7],p=9*(u-m)+3*(E-r),d=6*(r+m)-12*u,N=3*(u-r),v=9*(c-t)+3*(I-i),g=6*(i+t)-12*c,Z=3*(c-i);return function(f){var k=(p*f+d)*f+N,_=(v*f+g)*f+Z;return Math.sqrt(k*k+_*_)}}function a(o,r){return Math.max(2,Math.min(16,Math.ceil(Math.abs(r-o)*32)))}function n(o,r,i,u){if(r==null||r<0||r>1)return null;var c=o[0],m=o[1],t=o[2],E=o[3],I=o[4],p=o[5],d=o[6],N=o[7],v=ee.isZero;if(v(t-c)&&v(E-m))t=c,E=m;if(v(I-d)&&v(p-N))I=d,p=N;var g=3*(t-c),Z=3*(I-t)-g,f=d-c-g-Z,k=3*(E-m),_=3*(p-E)-k,D=N-m-k-_,w,J;if(i===0)w=r===0?c:r===1?d:((f*r+Z)*r+g)*r+c,J=r===0?m:r===1?N:((D*r+_)*r+k)*r+m;else{var T=0.00000001,$=1-T;if(r<T)w=g,J=k;else if(r>$)w=3*(d-I),J=3*(N-p);else w=(3*f*r+2*Z)*r+g,J=(3*D*r+2*_)*r+k;if(u){if(w===0&&J===0&&(r<T||r>$))w=I-t,J=p-E;var M=Math.sqrt(w*w+J*J);if(M)w/=M,J/=M}if(i===3){var I=6*f*r+2*Z,p=6*D*r+2*_,x=Math.pow(w*w+J*J,1.5);w=x!==0?(w*p-J*I)/x:0,J=0}}return i===2?new U(J,-w):new U(w,J)}return{statics:{classify:function(o){var r=o[0],i=o[1],u=o[2],c=o[3],m=o[4],t=o[5],E=o[6],I=o[7],p=r*(I-t)+i*(m-E)+E*t-I*m,d=u*(i-I)+c*(E-r)+r*I-i*E,N=m*(c-i)+t*(r-u)+u*i-c*r,v=3*N,g=v-d,Z=g-d+p,f=Math.sqrt(Z*Z+g*g+v*v),k=f!==0?1/f:0,_=ee.isZero,D="serpentine";Z*=k,g*=k,v*=k;function w(M,x,B){var Q=x!==F,y=Q&&x>0&&x<1,X=Q&&B>0&&B<1;if(Q&&(!(y||X)||M==="loop"&&!(y&&X)))M="arch",y=X=!1;return{type:M,roots:y||X?y&&X?x<B?[x,B]:[B,x]:[y?x:B]:null}}if(_(Z))return _(g)?w(_(v)?"line":"quadratic"):w(D,v/(3*g));var J=3*g*g-4*Z*v;if(_(J))return w("cusp",g/(2*Z));var T=J>0?Math.sqrt(J/3):Math.sqrt(-J),$=2*Z;return w(J>0?D:"loop",(g+T)/$,(g-T)/$)},getLength:function(o,r,i,u){if(r===F)r=0;if(i===F)i=1;if(L.isStraight(o)){var c=o;if(i<1)c=L.subdivide(c,i)[0],r/=i;if(r>0)c=L.subdivide(c,r)[1];var m=c[6]-c[0],t=c[7]-c[1];return Math.sqrt(m*m+t*t)}return ee.integrate(u||e(o),r,i,a(r,i))},getTimeAt:function(o,r,i){if(i===F)i=r<0?1:0;if(r===0)return i;var u=Math.abs,c=0.000000000001,m=r>0,t=m?i:0,E=m?1:i,I=e(o),p=L.getLength(o,t,E,I),d=u(r)-p;if(u(d)<c)return m?E:t;else if(d>c)return null;var N=r/p,v=0;function g(Z){return v+=ee.integrate(I,i,Z,a(i,Z)),i=Z,v-r}return ee.findRoot(g,I,i+N,t,E,32,0.000000000001)},getPoint:function(o,r){return n(o,r,0,!1)},getTangent:function(o,r){return n(o,r,1,!0)},getWeightedTangent:function(o,r){return n(o,r,1,!1)},getNormal:function(o,r){return n(o,r,2,!0)},getWeightedNormal:function(o,r){return n(o,r,2,!1)},getCurvature:function(o,r){return n(o,r,3,!1).x},getPeaks:function(o){var r=o[0],i=o[1],u=o[2],c=o[3],m=o[4],t=o[5],E=o[6],I=o[7],p=-r+3*u-3*m+E,d=3*r-6*u+3*m,N=-3*r+3*u,v=-i+3*c-3*t+I,g=3*i-6*c+3*t,Z=-3*i+3*c,f=0.00000001,k=1-f,_=[];return ee.solveCubic(9*(p*p+v*v),9*(p*d+g*v),2*(d*d+g*g)+3*(N*p+Z*v),N*d+g*Z,_,f,k),_.sort()}}}},new function(){function e(d,N,v,g,Z,f,k){var _=!k&&v.getPrevious()===Z,D=!k&&v!==Z&&v.getNext()===Z,w=0.00000001,J=1-w;if(g!==null&&g>=(_?w:0)&&g<=(D?J:1)){if(f!==null&&f>=(D?w:0)&&f<=(_?J:1)){var T=new je(v,g,null,k),$=new je(Z,f,null,k);if(T._intersection=$,$._intersection=T,!N||N(T))je.insert(d,T,!0)}}}function a(d,N,v,g,Z,f,k,_,D,w,J,T,$){if(++D>=4096||++_>=40)return D;var M=0.000000001,x=N[0],B=N[1],Q=N[6],y=N[7],X=Qe.getSignedDistance,V=X(x,B,Q,y,N[2],N[3]),W=X(x,B,Q,y,N[4],N[5]),G=V*W>0?0.75:0.4444444444444444,P=G*Math.min(0,V,W),ne=G*Math.max(0,V,W),Re=X(x,B,Q,y,d[0],d[1]),me=X(x,B,Q,y,d[2],d[3]),be=X(x,B,Q,y,d[4],d[5]),se=X(x,B,Q,y,d[6],d[7]),_e=n(Re,me,be,se),te=_e[0],Je=_e[1],Ne,we;if(V===0&&W===0&&Re===0&&me===0&&be===0&&se===0||(Ne=o(te,Je,P,ne))==null||(we=o(te.reverse(),Je.reverse(),P,ne))==null)return D;var ge=w+(J-w)*Ne,he=w+(J-w)*we;if(Math.max($-T,he-ge)<M){var ea=(ge+he)/2,aa=(T+$)/2;e(Z,f,k?g:v,k?aa:ea,k?v:g,k?ea:aa)}else{d=L.getPart(d,Ne,we);var ua=$-T;if(we-Ne>0.8)if(he-ge>ua){var ze=L.subdivide(d,0.5),ea=(ge+he)/2;D=a(N,ze[0],g,v,Z,f,!k,_,D,T,$,ge,ea),D=a(N,ze[1],g,v,Z,f,!k,_,D,T,$,ea,he)}else{var ze=L.subdivide(N,0.5),aa=(T+$)/2;D=a(ze[0],d,g,v,Z,f,!k,_,D,T,aa,ge,he),D=a(ze[1],d,g,v,Z,f,!k,_,D,aa,$,ge,he)}else if(ua===0||ua>=M)D=a(N,d,g,v,Z,f,!k,_,D,T,$,ge,he);else D=a(d,N,v,g,Z,f,k,_,D,ge,he,T,$)}return D}function n(d,N,v,g){var Z=[0,d],f=[0.3333333333333333,N],k=[0.6666666666666666,v],_=[1,g],D=N-(2*d+g)/3,w=v-(d+2*g)/3,J;if(D*w<0)J=[[Z,f,_],[Z,k,_]];else{var T=D/w;J=[T>=2?[Z,f,_]:T<=0.5?[Z,k,_]:[Z,f,k,_],[Z,_]]}return(D||w)<0?J.reverse():J}function o(d,N,v,g){if(d[0][1]<v)return r(d,!0,v);else if(N[0][1]>g)return r(N,!1,g);else return d[0][0]}function r(d,N,v){var g=d[0][0],Z=d[0][1];for(var f=1,k=d.length;f<k;f++){var _=d[f][0],D=d[f][1];if(N?D>=v:D<=v)return D===v?_:g+(v-Z)*(_-g)/(D-Z);g=_,Z=D}return null}function i(d,N,v,g,Z){var f=ee.isZero;if(f(g)&&f(Z)){var k=L.getTimeOf(d,new U(N,v));return k===null?[]:[k]}var _=Math.atan2(-Z,g),D=Math.sin(_),w=Math.cos(_),J=[],T=[];for(var $=0;$<8;$+=2){var M=d[$]-N,x=d[$+1]-v;J.push(M*w-x*D,M*D+x*w)}return L.solveCubic(J,1,0,T,0,1),T}function u(d,N,v,g,Z,f,k){var _=N[0],D=N[1],w=N[6],J=N[7],T=i(d,_,D,w-_,J-D);for(var $=0,M=T.length;$<M;$++){var x=T[$],B=L.getPoint(d,x),Q=L.getTimeOf(N,B);if(Q!==null)e(Z,f,k?g:v,k?Q:x,k?v:g,k?x:Q)}}function c(d,N,v,g,Z,f){var k=Qe.intersect(d[0],d[1],d[6],d[7],N[0],N[1],N[6],N[7]);if(k)e(Z,f,v,L.getTimeOf(d,k),g,L.getTimeOf(N,k))}function m(d,N,v,g,Z,f){var k=0.000000000001,_=Math.min,D=Math.max;if(D(d[0],d[2],d[4],d[6])+k>_(N[0],N[2],N[4],N[6])&&_(d[0],d[2],d[4],d[6])-k<D(N[0],N[2],N[4],N[6])&&D(d[1],d[3],d[5],d[7])+k>_(N[1],N[3],N[5],N[7])&&_(d[1],d[3],d[5],d[7])-k<D(N[1],N[3],N[5],N[7])){var w=I(d,N);if(w)for(var J=0;J<2;J++){var T=w[J];e(Z,f,v,T[0],g,T[1],!0)}else{var $=L.isStraight(d),M=L.isStraight(N),x=$&&M,B=$&&!M,Q=Z.length;if((x?c:$||M?u:a)(B?N:d,B?d:N,B?g:v,B?v:g,Z,f,B,0,0,0,1,0,1),!x||Z.length===Q)for(var J=0;J<4;J++){var y=J>>1,X=J&1,V=y*6,W=X*6,G=new U(d[V],d[V+1]),P=new U(N[W],N[W+1]);if(G.isClose(P,k))e(Z,f,v,y,g,X)}}}return Z}function t(d,N,v,g){var Z=L.classify(d);if(Z.type==="loop"){var f=Z.roots;e(v,g,N,f[0],N,f[1])}return v}function E(d,N,v,g,Z,f){var k=0.0000001,_=!N;if(_)N=d;var D=d.length,w=N.length,J=new Array(D),T=_?J:new Array(w),$=[];for(var M=0;M<D;M++)J[M]=d[M].getValues(g);if(!_)for(var M=0;M<w;M++)T[M]=N[M].getValues(Z);var x=ue.findCurveBoundsCollisions(J,T,k);for(var B=0;B<D;B++){var Q=d[B],y=J[B];if(_)t(y,Q,$,v);var X=x[B];if(X)for(var V=0;V<X.length;V++){if(f&&$.length)return $;var W=X[V];if(!_||W>B){var G=N[W],P=T[W];m(y,P,Q,G,$,v)}}}return $}function I(d,N){function v(se){var _e=se[6]-se[0],te=se[7]-se[1];return _e*_e+te*te}var g=Math.abs,Z=Qe.getDistance,f=0.00000001,k=0.0000001,_=L.isStraight(d),D=L.isStraight(N),w=_&&D,J=v(d)<v(N),T=J?N:d,$=J?d:N,M=T[0],x=T[1],B=T[6]-M,Q=T[7]-x;if(Z(M,x,B,Q,$[0],$[1],!0)<k&&Z(M,x,B,Q,$[6],$[7],!0)<k){if(!w&&Z(M,x,B,Q,T[2],T[3],!0)<k&&Z(M,x,B,Q,T[4],T[5],!0)<k&&Z(M,x,B,Q,$[2],$[3],!0)<k&&Z(M,x,B,Q,$[4],$[5],!0)<k)_=D=w=!0}else if(w)return null;if(_^D)return null;var y=[d,N],X=[];for(var V=0;V<4&&X.length<2;V++){var W=V&1,G=W^1,P=V>>1,ne=L.getTimeOf(y[W],new U(y[G][P?6:0],y[G][P?7:1]));if(ne!=null){var Re=W?[P,ne]:[ne,P];if(!X.length||g(Re[0]-X[0][0])>f&&g(Re[1]-X[0][1])>f)X.push(Re)}if(V>2&&!X.length)break}if(X.length!==2)X=null;else if(!w){var me=L.getPart(d,X[0][0],X[1][0]),be=L.getPart(N,X[0][1],X[1][1]);if(g(be[2]-me[2])>k||g(be[3]-me[3])>k||g(be[4]-me[4])>k||g(be[5]-me[5])>k)X=null}return X}function p(d,N){var v=d[0],g=d[1],Z=d[2],f=d[3],k=d[4],_=d[5],D=d[6],w=d[7],J=N.normalize(),T=J.x,$=J.y,M=3*D-9*k+9*Z-3*v,x=3*w-9*_+9*f-3*g,B=6*k-12*Z+6*v,Q=6*_-12*f+6*g,y=3*Z-3*v,X=3*f-3*g,V=2*M*$-2*x*T,W=[];if(Math.abs(V)<ee.CURVETIME_EPSILON){var G=M*X-x*y,V=M*Q-x*B;if(V!=0){var P=-G/V;if(P>=0&&P<=1)W.push(P)}}else{var ne=(B*B-4*M*y)*$*$+(-2*B*Q+4*x*y+4*M*X)*T*$+(Q*Q-4*x*X)*T*T,Re=B*$-Q*T;if(ne>=0&&V!=0){var me=Math.sqrt(ne),be=-(Re+me)/V,se=(-Re+me)/V;if(be>=0&&be<=1)W.push(be);if(se>=0&&se<=1)W.push(se)}}return W}return{getIntersections:function(d){var N=this.getValues(),v=d&&d!==this&&d.getValues();return v?m(N,v,this,d,[]):t(N,this,[])},statics:{getOverlaps:I,getIntersections:E,getCurveLineIntersections:i,getTimesWithTangent:p}}}),je=q.extend({_class:"CurveLocation",initialize:function e(a,n,o,r,i){if(n>=0.99999999){var u=a.getNext();if(u)n=0,a=u}this._setCurve(a),this._time=n,this._point=o||a.getPointAtTime(n),this._overlap=r,this._distance=i,this._intersection=this._next=this._previous=null},_setPath:function(e){this._path=e,this._version=e?e._version:0},_setCurve:function(e){this._setPath(e._path),this._curve=e,this._segment=null,this._segment1=e._segment1,this._segment2=e._segment2},_setSegment:function(e){var a=e.getCurve();if(a)this._setCurve(a);else this._setPath(e._path),this._segment1=e,this._segment2=null;this._segment=e,this._time=e===this._segment1?0:1,this._point=e._point.clone()},getSegment:function(){var e=this._segment;if(!e){var a=this.getCurve(),n=this.getTime();if(n===0)e=a._segment1;else if(n===1)e=a._segment2;else if(n!=null)e=a.getPartLength(0,n)<a.getPartLength(n,1)?a._segment1:a._segment2;this._segment=e}return e},getCurve:function(){var e=this._path,a=this;if(e&&e._version!==this._version)this._time=this._offset=this._curveOffset=this._curve=null;function n(o){var r=o&&o.getCurve();if(r&&(a._time=r.getTimeOf(a._point))!=null)return a._setCurve(r),r}return this._curve||n(this._segment)||n(this._segment1)||n(this._segment2.getPrevious())},getPath:function(){var e=this.getCurve();return e&&e._path},getIndex:function(){var e=this.getCurve();return e&&e.getIndex()},getTime:function(){var e=this.getCurve(),a=this._time;return e&&a==null?this._time=e.getTimeOf(this._point):a},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var e=this._offset;if(e==null){e=0;var a=this.getPath(),n=this.getIndex();if(a&&n!=null){var o=a.getCurves();for(var r=0;r<n;r++)e+=o[r].getLength()}this._offset=e+=this.getCurveOffset()}return e},getCurveOffset:function(){var e=this._curveOffset;if(e==null){var a=this.getCurve(),n=this.getTime();this._curveOffset=e=n!=null&&a&&a.getPartLength(0,n)}return e},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var e=this.getCurve(),a=e&&e.divideAtTime(this.getTime());if(a)this._setSegment(a._segment1);return a},split:function(){var e=this.getCurve(),a=e._path,n=e&&e.splitAtTime(this.getTime());if(n)this._setSegment(a.getLastSegment());return n},equals:function(e,a){var n=this===e;if(!n&&e instanceof je){var o=this.getCurve(),r=e.getCurve(),i=o._path,u=r._path;if(i===u){var c=Math.abs,m=0.0000001,t=c(this.getOffset()-e.getOffset()),E=!a&&this._intersection,I=!a&&e._intersection;n=(t<m||i&&c(i.getLength()-t)<m)&&(!E&&!I||E&&I&&E.equals(I,!0))}}return n},toString:function(){var e=[],a=this.getPoint(),n=ce.instance;if(a)e.push("point: "+a);var o=this.getIndex();if(o!=null)e.push("index: "+o);var r=this.getTime();if(r!=null)e.push("time: "+n.number(r));if(this._distance!=null)e.push("distance: "+n.number(this._distance));return"{ "+e.join(", ")+" }"},isTouching:function(){var e=this._intersection;if(e&&this.getTangent().isCollinear(e.getTangent())){var a=this.getCurve(),n=e.getCurve();return!(a.isStraight()&&n.isStraight()&&a.getLine().intersect(n.getLine()))}return!1},isCrossing:function(){var e=this._intersection;if(!e)return!1;var a=this.getTime(),n=e.getTime(),o=0.00000001,r=1-o,i=a>=o&&a<=r,u=n>=o&&n<=r;if(i&&u)return!this.isTouching();var c=this.getCurve(),m=c&&a<o?c.getPrevious():c,t=e.getCurve(),E=t&&n<o?t.getPrevious():t;if(a>r)c=c.getNext();if(n>r)t=t.getNext();if(!m||!c||!E||!t)return!1;var I=[];function p(T,$){var M=T.getValues(),x=L.classify(M).roots||L.getPeaks(M),B=x.length,Q=L.getLength(M,$&&B?x[B-1]:0,!$&&B?x[0]:1);I.push(B?Q:Q/32)}function d(T,$,M){return $<M?T>$&&T<M:T>$||T<M}if(!i)p(m,!0),p(c,!1);if(!u)p(E,!0),p(t,!1);var N=this.getPoint(),v=Math.min.apply(Math,I),g=i?c.getTangentAtTime(a):c.getPointAt(v).subtract(N),Z=i?g.negate():m.getPointAt(-v).subtract(N),f=u?t.getTangentAtTime(n):t.getPointAt(v).subtract(N),k=u?f.negate():E.getPointAt(-v).subtract(N),_=Z.getAngle(),D=g.getAngle(),w=k.getAngle(),J=f.getAngle();return!!(i?d(_,w,J)^d(D,w,J)&&d(_,J,w)^d(D,J,w):d(w,_,D)^d(J,_,D)&&d(w,D,_)^d(J,D,_))},hasOverlap:function(){return!!this._overlap}},q.each(L._evaluateMethods,function(e){var a=e+"At";this[e]=function(){var n=this.getCurve(),o=this.getTime();return o!=null&&n&&n[a](o,!0)}},{preserve:!0}),new function(){function e(a,n,o){var r=a.length,i=0,u=r-1;function c(N,v){for(var g=N+v;g>=-1&&g<=r;g+=v){var Z=a[(g%r+r)%r];if(!n.getPoint().isClose(Z.getPoint(),0.0000001))break;if(n.equals(Z))return Z}return null}while(i<=u){var m=i+u>>>1,t=a[m],E;if(o&&(E=n.equals(t)?t:c(m,-1)||c(m,1))){if(n._overlap)E._overlap=E._intersection._overlap=!0;return E}var I=n.getPath(),p=t.getPath(),d=I!==p?I._id-p._id:n.getIndex()+n.getTime()-(t.getIndex()+t.getTime());if(d<0)u=m-1;else i=m+1}return a.splice(i,0,n),n}return{statics:{insert:e,expand:function(a){var n=a.slice();for(var o=a.length-1;o>=0;o--)e(n,a[o]._intersection,!1);return n}}}}),Pe=de.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function e(){},statics:{create:function(e){var a,n,o;if(q.isPlainObject(e))n=e.segments,a=e.pathData;else if(Array.isArray(e))n=e;else if(typeof e==="string")a=e;if(n){var r=n[0];o=r&&Array.isArray(r[0])}else if(a)o=(a.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(a);var i=o?We:Ee;return new i(e)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(e){if(this.isClockwise()!=(e=!!e))this.reverse()},setPathData:function(e){var a=e&&e.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/ig),n,o=!1,r,i,u=new U,c=new U;function m(k,_){var D=+n[k];if(o)D+=u[_];return D}function t(k){return new U(m(k,"x"),m(k+1,"y"))}this.clear();for(var E=0,I=a&&a.length;E<I;E++){var p=a[E],d=p[0],N=d.toLowerCase();n=p.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g);var v=n&&n.length;if(o=d===N,r==="z"&&!/[mz]/.test(N))this.moveTo(u);switch(N){case"m":case"l":var g=N==="m";for(var Z=0;Z<v;Z+=2)if(this[g?"moveTo":"lineTo"](u=t(Z)),g)c=u,g=!1;i=u;break;case"h":case"v":var f=N==="h"?"x":"y";u=u.clone();for(var Z=0;Z<v;Z++)u[f]=m(Z,f),this.lineTo(u);i=u;break;case"c":for(var Z=0;Z<v;Z+=6)this.cubicCurveTo(t(Z),i=t(Z+2),u=t(Z+4));break;case"s":for(var Z=0;Z<v;Z+=4)this.cubicCurveTo(/[cs]/.test(r)?u.multiply(2).subtract(i):u,i=t(Z),u=t(Z+2)),r=N;break;case"q":for(var Z=0;Z<v;Z+=4)this.quadraticCurveTo(i=t(Z),u=t(Z+2));break;case"t":for(var Z=0;Z<v;Z+=2)this.quadraticCurveTo(i=/[qt]/.test(r)?u.multiply(2).subtract(i):u,u=t(Z)),r=N;break;case"a":for(var Z=0;Z<v;Z+=7)this.arcTo(u=t(Z+5),new oe(+n[Z],+n[Z+1]),+n[Z+2],+n[Z+4],+n[Z+3]);break;case"z":this.closePath(0.000000000001),u=c;break}r=N}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(e){var a=e.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(e):{};return a.onPath||!!(this.getFillRule()==="evenodd"?a.windingL&1||a.windingR&1:a.winding)},getIntersections:function(e,a,n,o){var r=this===e||!e,i=this._matrix._orNullIfIdentity(),u=r?i:(n||e._matrix)._orNullIfIdentity();return r||this.getBounds(i).intersects(e.getBounds(u),0.000000000001)?L.getIntersections(this.getCurves(),!r&&e.getCurves(),a,i,u,o):[]},getCrossings:function(e){return this.getIntersections(e,function(a){return a.isCrossing()})},getNearestLocation:function(){var e=U.read(arguments),a=this.getCurves(),n=1/0,o=null;for(var r=0,i=a.length;r<i;r++){var u=a[r].getNearestLocation(e);if(u._distance<n)n=u._distance,o=u}return o},getNearestPoint:function(){var e=this.getNearestLocation.apply(this,arguments);return e?e.getPoint():e},interpolate:function(e,a,n){var o=!this._children,r=o?"_segments":"_children",i=e[r],u=a[r],c=this[r];if(!i||!u||i.length!==u.length)throw new Error("Invalid operands in interpolate() call: "+e+", "+a);var m=c.length,t=u.length;if(m<t){var E=o?C:Ee;for(var I=m;I<t;I++)this.add(new E)}else if(m>t)this[o?"removeSegments":"removeChildren"](t,m);for(var I=0;I<t;I++)c[I].interpolate(i[I],u[I],n);if(o)this.setClosed(e._closed),this._changed(9)},compare:function(e){var a=!1;if(e){var n=this._children||[this],o=e._children?e._children.slice():[e],r=n.length,i=o.length,u=[],c=0;a=!0;var m=ue.findItemBoundsCollisions(n,o,ee.GEOMETRIC_EPSILON);for(var t=r-1;t>=0&&a;t--){var E=n[t];a=!1;var I=m[t];if(I){for(var p=I.length-1;p>=0&&!a;p--)if(E.compare(o[I[p]])){if(!u[I[p]])u[I[p]]=!0,c++;a=!0}}}a=a&&c===i}return a}}),Ee=Pe.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function e(a){this._closed=!1,this._segments=[],this._version=0;var n=arguments,o=Array.isArray(a)?typeof a[0]==="object"?a:n:a&&(a.size===F&&(a.x!==F||a.point!==F))?n:null;if(o&&o.length>0)this.setSegments(o);else if(this._curves=F,this._segmentSelection=0,!o&&typeof a==="string")this.setPathData(a),a=null;this._initialize(!o&&a)},_equals:function(e){return this._closed===e._closed&&q.equals(this._segments,e._segments)},copyContent:function(e){this.setSegments(e._segments),this._closed=e._closed},_changed:function e(a){if(e.base.call(this,a),a&8){if(this._length=this._area=F,a&32)this._version++;else if(this._curves)for(var n=0,o=this._curves.length;n<o;n++)this._curves[n]._changed()}else if(a&64)this._bounds=F},getStyle:function(){var e=this._parent;return(e instanceof We?e:this)._style},getSegments:function(){return this._segments},setSegments:function(e){var a=this.isFullySelected(),n=e&&e.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=F,n){var o=e[n-1];if(typeof o==="boolean")this.setClosed(o),n--;this._add(C.readList(e,0,{},n))}if(a)this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var e=this._curves,a=this._segments;if(!e){var n=this._countCurves();e=this._curves=new Array(n);for(var o=0;o<n;o++)e[o]=new L(this,a[o],a[o+1]||a[0])}return e},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var e=this.getCurves();return e[e.length-1]},isClosed:function(){return this._closed},setClosed:function(e){if(this._closed!=(e=!!e)){if(this._closed=e,this._curves){var a=this._curves.length=this._countCurves();if(e)this._curves[a-1]=new L(this,this._segments[a-1],this._segments[0])}this._changed(41)}}},{beans:!0,getPathData:function(e,a){var n=this._segments,o=n.length,r=new ce(a),i=new Array(6),u=!0,c,m,t,E,I,p,d,N,v=[];function g(f,k){if(f._transformCoordinates(e,i),c=i[0],m=i[1],u)v.push("M"+r.pair(c,m)),u=!1;else if(I=i[2],p=i[3],I===c&&p===m&&d===t&&N===E){if(!k){var _=c-t,D=m-E;v.push(_===0?"v"+r.number(D):D===0?"h"+r.number(_):"l"+r.pair(_,D))}}else v.push("c"+r.pair(d-t,N-E)+" "+r.pair(I-t,p-E)+" "+r.pair(c-t,m-E));t=c,E=m,d=i[4],N=i[5]}if(!o)return"";for(var Z=0;Z<o;Z++)g(n[Z]);if(this._closed&&o>0)g(n[0],!0),v.push("z");return v.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(e){var a=this._segments,n=new Array(6);for(var o=0,r=a.length;o<r;o++)a[o]._transformCoordinates(e,n,!0);return!0},_add:function(e,u){var n=this._segments,o=this._curves,r=e.length,i=u==null,u=i?n.length:u;for(var c=0;c<r;c++){var m=e[c];if(m._path)m=e[c]=m.clone();if(m._path=this,m._index=u+c,m._selection)this._updateSelection(m,0,m._selection)}if(i)q.push(n,e);else{n.splice.apply(n,[u,0].concat(e));for(var c=u+r,t=n.length;c<t;c++)n[c]._index=c}if(o){var E=this._countCurves(),I=u>0&&u+r-1===E?u-1:u,p=I,d=Math.min(I+r,E);if(e._curves)o.splice.apply(o,[I,0].concat(e._curves)),p+=e._curves.length;for(var c=p;c<d;c++)o.splice(c,0,new L(this,null,null));this._adjustCurves(I,d)}return this._changed(41),e},_adjustCurves:function(e,a){var n=this._segments,o=this._curves,r;for(var i=e;i<a;i++)r=o[i],r._path=this,r._segment1=n[i],r._segment2=n[i+1]||n[0],r._changed();if(r=o[this._closed&&!e?n.length-1:e-1])r._segment2=n[e]||n[0],r._changed();if(r=o[a])r._segment1=n[a],r._changed()},_countCurves:function(){var e=this._segments.length;return!this._closed&&e>0?e-1:e},add:function(e){var a=arguments;return a.length>1&&typeof e!=="number"?this._add(C.readList(a)):this._add([C.read(a)])[0]},insert:function(e,a){var n=arguments;return n.length>2&&typeof a!=="number"?this._add(C.readList(n,1),e):this._add([C.read(n,1)],e)[0]},addSegment:function(){return this._add([C.read(arguments)])[0]},insertSegment:function(e){return this._add([C.read(arguments,1)],e)[0]},addSegments:function(e){return this._add(C.readList(e))},insertSegments:function(e,a){return this._add(C.readList(a),e)},removeSegment:function(e){return this.removeSegments(e,e+1)[0]||null},removeSegments:function(e,a,n){e=e||0,a=q.pick(a,this._segments.length);var o=this._segments,r=this._curves,i=o.length,u=o.splice(e,a-e),c=u.length;if(!c)return u;for(var m=0;m<c;m++){var t=u[m];if(t._selection)this._updateSelection(t,t._selection,0);t._index=t._path=null}for(var m=e,E=o.length;m<E;m++)o[m]._index=m;if(r){var I=e>0&&a===i+(this._closed?1:0)?e-1:e,r=r.splice(I,c);for(var m=r.length-1;m>=0;m--)r[m]._path=null;if(n)u._curves=r.slice(1);this._adjustCurves(I,I)}return this._changed(41),u},clear:"#removeSegments",hasHandles:function(){var e=this._segments;for(var a=0,n=e.length;a<n;a++)if(e[a].hasHandles())return!0;return!1},clearHandles:function(){var e=this._segments;for(var a=0,n=e.length;a<n;a++)e[a].clearHandles()},getLength:function(){if(this._length==null){var e=this.getCurves(),a=0;for(var n=0,o=e.length;n<o;n++)a+=e[n].getLength();this._length=a}return this._length},getArea:function(){var e=this._area;if(e==null){var a=this._segments,n=this._closed;e=0;for(var o=0,r=a.length;o<r;o++){var i=o+1===r;e+=L.getArea(L.getValues(a[o],a[i?0:o+1],null,i&&!n))}this._area=e}return e},isFullySelected:function(){var e=this._segments.length;return this.isSelected()&&e>0&&this._segmentSelection===e*7},setFullySelected:function(e){if(e)this._selectSegments(!0);this.setSelected(e)},setSelection:function e(a){if(!(a&1))this._selectSegments(!1);e.base.call(this,a)},_selectSegments:function(e){var a=this._segments,n=a.length,o=e?7:0;this._segmentSelection=o*n;for(var r=0;r<n;r++)a[r]._selection=o},_updateSelection:function(e,a,n){e._selection=n;var o=this._segmentSelection+=n-a;if(o>0)this.setSelected(!0)},divideAt:function(e){var a=this.getLocationAt(e),n;return a&&(n=a.getCurve().divideAt(a.getCurveOffset()))?n._segment1:null},splitAt:function(e){var a=this.getLocationAt(e),n=a&&a.index,o=a&&a.time,r=0.00000001,i=1-r;if(o>i)n++,o=0;var u=this.getCurves();if(n>=0&&n<u.length){if(o>=r)u[n++].divideAtTime(o);var c=this.removeSegments(n,this._segments.length,!0),m;if(this._closed)this.setClosed(!1),m=this;else m=new Ee(de.NO_INSERT),m.insertAbove(this),m.copyAttributes(this);return m._add(c,0),this.addSegment(c[0]),m}return null},split:function(e,a){var n,o=a===F?e:(n=this.getCurves()[e])&&n.getLocationAtTime(a);return o!=null?this.splitAt(o):null},join:function(e,a){var n=a||0;if(e&&e!==this){var o=e._segments,r=this.getLastSegment(),i=e.getLastSegment();if(!i)return this;if(r&&r._point.isClose(i._point,n))e.reverse();var u=e.getFirstSegment();if(r&&r._point.isClose(u._point,n))r.setHandleOut(u._handleOut),this._add(o.slice(1));else{var c=this.getFirstSegment();if(c&&c._point.isClose(u._point,n))e.reverse();if(i=e.getLastSegment(),c&&c._point.isClose(i._point,n))c.setHandleIn(i._handleIn),this._add(o.slice(0,o.length-1),0);else this._add(o.slice())}if(e._closed)this._add([o[0]]);e.remove()}var m=this.getFirstSegment(),t=this.getLastSegment();if(m!==t&&m._point.isClose(t._point,n))m.setHandleIn(t._handleIn),t.remove(),this.setClosed(!0);return this},reduce:function(e){var a=this.getCurves(),n=e&&e.simplify,o=n?0.0000001:0;for(var r=a.length-1;r>=0;r--){var i=a[r];if(!i.hasHandles()&&(!i.hasLength(o)||n&&i.isCollinear(i.getNext())))i.remove()}return this},reverse:function(){this._segments.reverse();for(var e=0,a=this._segments.length;e<a;e++){var n=this._segments[e],o=n._handleIn;n._handleIn=n._handleOut,n._handleOut=o,n._index=e}this._curves=null,this._changed(9)},flatten:function(e){var a=new sa(this,e||0.25,256,!0),n=a.parts,o=n.length,r=[];for(var i=0;i<o;i++)r.push(new C(n[i].curve.slice(0,2)));if(!this._closed&&o>0)r.push(new C(n[o-1].curve.slice(6)));this.setSegments(r)},simplify:function(e){var a=new Le(this).fit(e||2.5);if(a)this.setSegments(a);return!!a},smooth:function(e){var a=this,n=e||{},o=n.type||"asymmetric",r=this._segments,i=r.length,u=this._closed;function c(te,Je){var Ne=te&&te.index;if(Ne!=null){var we=te.path;if(we&&we!==a)throw new Error(te._class+" "+Ne+" of "+we+" is not part of "+a);if(Je&&te instanceof L)Ne++}else Ne=typeof te==="number"?te:Je;return Math.min(Ne<0&&u?Ne%i:Ne<0?Ne+i:Ne,i-1)}var m=u&&n.from===F&&n.to===F,t=c(n.from,0),E=c(n.to,i-1);if(t>E)if(u)t-=i;else{var I=t;t=E,E=I}if(/^(?:asymmetric|continuous)$/.test(o)){var p=o==="asymmetric",d=Math.min,N=E-t+1,v=N-1,g=m?d(N,4):1,Z=g,f=g,k=[];if(!u)Z=d(1,t),f=d(1,i-E-1);if(v+=Z+f,v<=1)return;for(var _=0,D=t-Z;_<=v;_++,D++)k[_]=r[(D<0?D+i:D)%i]._point;var w=k[0]._x+2*k[1]._x,J=k[0]._y+2*k[1]._y,T=2,$=v-1,M=[w],x=[J],B=[T],Q=[],y=[];for(var _=1;_<v;_++){var X=_<$,V=X?1:p?1:2,W=X?4:p?2:7,G=X?4:p?3:8,P=X?2:p?0:1,ne=V/T;T=B[_]=W-ne,w=M[_]=G*k[_]._x+P*k[_+1]._x-ne*w,J=x[_]=G*k[_]._y+P*k[_+1]._y-ne*J}Q[$]=M[$]/B[$],y[$]=x[$]/B[$];for(var _=v-2;_>=0;_--)Q[_]=(M[_]-Q[_+1])/B[_],y[_]=(x[_]-y[_+1])/B[_];Q[v]=(3*k[v]._x-Q[$])/2,y[v]=(3*k[v]._y-y[$])/2;for(var _=Z,Re=v-f,D=t;_<=Re;_++,D++){var me=r[D<0?D+i:D],be=me._point,se=Q[_]-be._x,_e=y[_]-be._y;if(m||_<Re)me.setHandleOut(se,_e);if(m||_>Z)me.setHandleIn(-se,-_e)}}else for(var _=t;_<=E;_++)r[_<0?_+i:_].smooth(n,!m&&_===t,!m&&_===E)},toShape:function(e){if(!this._closed)return null;var a=this._segments,n,o,r,i;function u(p,d){var N=a[p],v=N.getNext(),g=a[d],Z=g.getNext();return N._handleOut.isZero()&&v._handleIn.isZero()&&g._handleOut.isZero()&&Z._handleIn.isZero()&&v._point.subtract(N._point).isCollinear(Z._point.subtract(g._point))}function c(p){var d=a[p],N=d.getPrevious(),v=d.getNext();return N._handleOut.isZero()&&d._handleIn.isZero()&&d._handleOut.isZero()&&v._handleIn.isZero()&&d._point.subtract(N._point).isOrthogonal(v._point.subtract(d._point))}function m(p){var d=a[p],N=d.getNext(),v=d._handleOut,g=N._handleIn,Z=0.5522847498307936;if(v.isOrthogonal(g)){var f=d._point,k=N._point,_=new Qe(f,v,!0).intersect(new Qe(k,g,!0),!0);return _&&ee.isZero(v.getLength()/_.subtract(f).getLength()-Z)&&ee.isZero(g.getLength()/_.subtract(k).getLength()-Z)}return!1}function t(p,d){return a[p]._point.getDistance(a[d]._point)}if(!this.hasHandles()&&a.length===4&&u(0,2)&&u(1,3)&&c(1))n=ie.Rectangle,o=new oe(t(0,3),t(0,1)),i=a[1]._point.add(a[2]._point).divide(2);else if(a.length===8&&m(0)&&m(2)&&m(4)&&m(6)&&u(1,5)&&u(3,7))n=ie.Rectangle,o=new oe(t(1,6),t(0,3)),r=o.subtract(new oe(t(0,7),t(1,2))).divide(2),i=a[3]._point.add(a[4]._point).divide(2);else if(a.length===4&&m(0)&&m(1)&&m(2)&&m(3)){if(ee.isZero(t(0,2)-t(1,3)))n=ie.Circle,r=t(0,2)/2;else n=ie.Ellipse,r=new oe(t(2,0)/2,t(3,1)/2);i=a[1]._point}if(n){var E=this.getPosition(!0),I=new n({center:E,size:o,radius:r,insert:!1});if(I.copyAttributes(this,!0),I._matrix.prepend(this._matrix),I.rotate(i.subtract(E).getAngle()+90),e===F||e)I.insertAbove(this);return I}return null},toPath:"#clone",compare:function e(a){if(!a||a instanceof We)return e.base.call(this,a);var n=this.getCurves(),o=a.getCurves(),r=n.length,i=o.length;if(!r||!i)return r==i;var u=n[0].getValues(),c=[],m=0,t,E=0,I;for(var p=0;p<i;p++){var g=o[p].getValues();c.push(g);var d=L.getOverlaps(u,g);if(d){t=!p&&d[0][0]>0?i-1:p,I=d[0][1];break}}var N=Math.abs,v=0.00000001,g=c[t],Z;while(u&&g){var d=L.getOverlaps(u,g);if(d){var f=d[0][0];if(N(f-E)<v){if(E=d[1][0],E===1)u=++m<r?n[m].getValues():null,E=0;var k=d[0][1];if(N(k-I)<v){if(!Z)Z=[t,k];if(I=d[1][1],I===1){if(++t>=i)t=0;g=c[t]||o[t].getValues(),I=0}if(!u)return Z[0]===t&&Z[1]===I;continue}}}break}return!1},_hitTestSelf:function(e,a,n,o){var r=this,i=this.getStyle(),u=this._segments,c=u.length,m=this._closed,t=a._tolerancePadding,E=t,I,p,d,N,v,g,Z=a.stroke&&i.hasStroke(),f=a.fill&&i.hasFill(),k=a.curves,_=Z?i.getStrokeWidth()/2:f&&a.tolerance>0||k?0:null;if(_!==null)if(_>0)I=i.getStrokeJoin(),p=i.getStrokeCap(),d=i.getMiterLimit(),E=E.add(Ee._getStrokePadding(_,o));else I=p="round";function D(Q,y){return e.subtract(Q).divide(y).length<=1}function w(Q,y,X){if(!a.selected||y.isSelected()){var V=Q._point;if(y!==V)y=y.add(V);if(D(y,E))return new le(X,r,{segment:Q,point:y})}}function J(Q,y){return(y||a.segments)&&w(Q,Q._point,"segment")||!y&&a.handles&&(w(Q,Q._handleIn,"handle-in")||w(Q,Q._handleOut,"handle-out"))}function T(Q){N.add(Q)}function $(Q){var y=m||Q._index>0&&Q._index<c-1;if((y?I:p)==="round")return D(Q._point,E);else{if(N=new Ee({internal:!0,closed:!0}),y){if(!Q.isSmooth())Ee._addBevelJoin(Q,I,_,d,null,o,T,!0)}else if(p==="square")Ee._addSquareCap(Q,p,_,null,o,T,!0);if(!N.isEmpty()){var X;return N.contains(e)||(X=N.getNearestLocation(e))&&D(X.getPoint(),t)}}}if(a.ends&&!a.segments&&!m){if(g=J(u[0],!0)||J(u[c-1],!0))return g}else if(a.segments||a.handles){for(var M=0;M<c;M++)if(g=J(u[M]))return g}if(_!==null){if(v=this.getNearestLocation(e),v){var x=v.getTime();if(x===0||x===1&&c>1){if(!$(v.getSegment()))v=null}else if(!D(v.getPoint(),E))v=null}if(!v&&I==="miter"&&c>1)for(var M=0;M<c;M++){var B=u[M];if(e.getDistance(B._point)<=d*_&&$(B)){v=B.getLocation();break}}}return!v&&f&&this._contains(e)||v&&!Z&&!k?new le("fill",this):v?new le(Z?"stroke":"curve",this,{location:v,point:v.getPoint()}):null}},q.each(L._evaluateMethods,function(e){this[e+"At"]=function(a){var n=this.getLocationAt(a);return n&&n[e]()}},{beans:!1,getLocationOf:function(){var e=U.read(arguments),a=this.getCurves();for(var n=0,o=a.length;n<o;n++){var r=a[n].getLocationOf(e);if(r)return r}return null},getOffsetOf:function(){var e=this.getLocationOf.apply(this,arguments);return e?e.getOffset():null},getLocationAt:function(e){if(typeof e==="number"){var a=this.getCurves(),n=0;for(var o=0,r=a.length;o<r;o++){var i=n,u=a[o];if(n+=u.getLength(),n>e)return u.getLocationAt(e-i)}if(a.length>0&&e<=this.getLength())return new je(a[a.length-1],1)}else if(e&&e.getPath&&e.getPath()===this)return e;return null},getOffsetsWithTangent:function(){var e=U.read(arguments);if(e.isZero())return[];var a=[],n=0,o=this.getCurves();for(var r=0,i=o.length;r<i;r++){var u=o[r],c=u.getTimesWithTangent(e);for(var m=0,t=c.length;m<t;m++){var E=n+u.getOffsetAtTime(c[m]);if(a.indexOf(E)<0)a.push(E)}n+=u.length}return a}}),new function(){function e(n,o,r,i){if(i<=0)return;var u=i/2,c=i-2,m=u-1,t=new Array(6),E,I;function p(f){var k=t[f],_=t[f+1];if(E!=k||I!=_)n.beginPath(),n.moveTo(E,I),n.lineTo(k,_),n.stroke(),n.beginPath(),n.arc(k,_,u,0,Math.PI*2,!0),n.fill()}for(var d=0,N=o.length;d<N;d++){var v=o[d],g=v._selection;if(v._transformCoordinates(r,t),E=t[0],I=t[1],g&2)p(2);if(g&4)p(4);if(n.fillRect(E-u,I-u,i,i),c>0&&!(g&1)){var Z=n.fillStyle;n.fillStyle="#ffffff",n.fillRect(E-m,I-m,c,c),n.fillStyle=Z}}}function a(n,o,r){var i=o._segments,u=i.length,c=new Array(6),m=!0,t,E,I,p,d,N,v,g;function Z(k){if(r)k._transformCoordinates(r,c),t=c[0],E=c[1];else{var _=k._point;t=_._x,E=_._y}if(m)n.moveTo(t,E),m=!1;else{if(r)d=c[2],N=c[3];else{var D=k._handleIn;d=t+D._x,N=E+D._y}if(d===t&&N===E&&v===I&&g===p)n.lineTo(t,E);else n.bezierCurveTo(v,g,d,N,t,E)}if(I=t,p=E,r)v=c[4],g=c[5];else{var D=k._handleOut;v=I+D._x,g=p+D._y}}for(var f=0;f<u;f++)Z(i[f]);if(o._closed&&u>0)Z(i[0])}return{_draw:function(n,o,r,i){var u=o.dontStart,c=o.dontFinish||o.clip,m=this.getStyle(),t=m.hasFill(),E=m.hasStroke(),I=m.getDashArray(),p=!ve.support.nativeDash&&E&&I&&I.length;if(!u)n.beginPath();if(t||E&&!p||c){if(a(n,this,i),this._closed)n.closePath()}function d(k){return I[(k%p+p)%p]}if(!c&&(t||E)){if(this._setStyles(n,o,r),t)n.fill(m.getFillRule()),n.shadowColor="rgba(0,0,0,0)";if(E){if(p){if(!u)n.beginPath();var N=new sa(this,0.25,32,!1,i),v=N.length,g=-m.getDashOffset(),Z,f=0;while(g>0)g-=d(f--)+d(f--);while(g<v){if(Z=g+d(f++),g>0||Z>0)N.drawPart(n,Math.max(g,0),Math.max(Z,0));g=Z+d(f++)}}n.stroke()}}},_drawSelected:function(n,o){n.beginPath(),a(n,this,o),n.stroke(),e(n,this._segments,o,ve.settings.handleSize)}}},new function(){function e(a){var n=a._segments;if(!n.length)throw new Error("Use a moveTo() command first");return n[n.length-1]}return{moveTo:function(){var a=this._segments;if(a.length===1)this.removeSegment(0);if(!a.length)this._add([new C(U.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new C(U.read(arguments))])},cubicCurveTo:function(){var a=arguments,n=U.read(a),o=U.read(a),r=U.read(a),i=e(this);i.setHandleOut(n.subtract(i._point)),this._add([new C(r,o.subtract(r))])},quadraticCurveTo:function(){var a=arguments,n=U.read(a),o=U.read(a),r=e(this)._point;this.cubicCurveTo(n.add(r.subtract(n).multiply(0.3333333333333333)),n.add(o.subtract(n).multiply(0.3333333333333333)),o)},curveTo:function(){var a=arguments,n=U.read(a),o=U.read(a),r=q.pick(q.read(a),0.5),i=1-r,u=e(this)._point,c=n.subtract(u.multiply(i*i)).subtract(o.multiply(r*r)).divide(2*r*i);if(c.isNaN())throw new Error("Cannot put a curve through points with parameter = "+r);this.quadraticCurveTo(c,o)},arcTo:function(){var a=arguments,n=Math.abs,o=Math.sqrt,r=e(this),i=r._point,u=U.read(a),N,c=q.peek(a),m=q.pick(c,!0),t,E,I,p;if(typeof m==="boolean")var d=i.add(u).divide(2),N=d.add(d.subtract(i).rotate(m?-90:90));else if(q.remain(a)<=2)N=u,u=U.read(a);else if(!i.equals(u)){var v=oe.read(a),g=ee.isZero;if(g(v.width)||g(v.height))return this.lineTo(u);var Z=q.read(a),m=!!q.read(a),f=!!q.read(a),d=i.add(u).divide(2),k=i.subtract(d).rotate(-Z),_=k.x,D=k.y,w=n(v.width),J=n(v.height),T=w*w,$=J*J,M=_*_,x=D*D,B=o(M/T+x/$);if(B>1)w*=B,J*=B,T=w*w,$=J*J;if(B=(T*$-T*x-$*M)/(T*x+$*M),n(B)<0.000000000001)B=0;if(B<0)throw new Error("Cannot create an arc with the given arguments");if(t=new U(w*D/J,-J*_/w).multiply((f===m?-1:1)*o(B)).rotate(Z).add(d),p=new Ze().translate(t).rotate(Z).scale(w,J),I=p._inverseTransform(i),E=I.getDirectedAngle(p._inverseTransform(u)),!m&&E>0)E-=360;else if(m&&E<0)E+=360}if(N){var Q=new Qe(i.add(N).divide(2),N.subtract(i).rotate(90),!0),y=new Qe(N.add(u).divide(2),u.subtract(N).rotate(90),!0),X=new Qe(i,u),V=X.getSide(N);if(t=Q.intersect(y,!0),!t){if(!V)return this.lineTo(u);throw new Error("Cannot create an arc with the given arguments")}I=i.subtract(t),E=I.getDirectedAngle(u.subtract(t));var W=X.getSide(t,!0);if(W===0)E=V*n(E);else if(V===W)E+=E<0?360:-360}if(E){var G=0.00001,P=n(E),ne=P>=360?4:Math.ceil((P-G)/90),Re=E/ne,me=Re*Math.PI/360,be=1.3333333333333333*Math.sin(me)/(1+Math.cos(me)),se=[];for(var _e=0;_e<=ne;_e++){var k=u,te=null;if(_e<ne)if(te=I.rotate(90).multiply(be),p)k=p._transformPoint(I),te=p._transformPoint(I.add(te)).subtract(k);else k=t.add(I);if(!_e)r.setHandleOut(te);else{var Je=I.rotate(-90).multiply(be);if(p)Je=p._transformPoint(I.add(Je)).subtract(k);se.push(new C(k,Je,te))}I=I.rotate(Re)}this._add(se)}},lineBy:function(){var a=U.read(arguments),n=e(this)._point;this.lineTo(n.add(a))},curveBy:function(){var a=arguments,n=U.read(a),o=U.read(a),r=q.read(a),i=e(this)._point;this.curveTo(i.add(n),i.add(o),r)},cubicCurveBy:function(){var a=arguments,n=U.read(a),o=U.read(a),r=U.read(a),i=e(this)._point;this.cubicCurveTo(i.add(n),i.add(o),i.add(r))},quadraticCurveBy:function(){var a=arguments,n=U.read(a),o=U.read(a),r=e(this)._point;this.quadraticCurveTo(r.add(n),r.add(o))},arcBy:function(){var a=arguments,n=e(this)._point,o=n.add(U.read(a)),r=q.pick(q.peek(a),!0);if(typeof r==="boolean")this.arcTo(o,r);else this.arcTo(o,n.add(U.read(a)))},closePath:function(a){this.setClosed(!0),this.join(this,a)}}},{_getBounds:function(e,a){var n=a.handle?"getHandleBounds":a.stroke?"getStrokeBounds":"getBounds";return Ee[n](this._segments,this._closed,this,e,a)},statics:{getBounds:function(e,a,n,o,r,i){var u=e[0];if(!u)return new re;var c=new Array(6),m=u._transformCoordinates(o,new Array(6)),t=m.slice(0,2),E=t.slice(),I=new Array(2);function p(v){v._transformCoordinates(o,c);for(var g=0;g<2;g++)L._addBounds(m[g],m[g+4],c[g+2],c[g],g,i?i[g]:0,t,E,I);var Z=m;m=c,c=Z}for(var d=1,N=e.length;d<N;d++)p(e[d]);if(a)p(u);return new re(t[0],t[1],E[0]-t[0],E[1]-t[1])},getStrokeBounds:function(e,a,n,o,r){var i=n.getStyle(),u=i.hasStroke(),c=i.getStrokeWidth(),m=u&&n._getStrokeMatrix(o,r),t=u&&Ee._getStrokePadding(c,m),E=Ee.getBounds(e,a,n,o,r,t);if(!u)return E;var I=c/2,p=i.getStrokeJoin(),d=i.getStrokeCap(),N=i.getMiterLimit(),v=new re(new oe(t));function g(w){E=E.include(w)}function Z(w){E=E.unite(v.setCenter(w._point.transform(o)))}function f(w,J){if(J==="round"||w.isSmooth())Z(w);else Ee._addBevelJoin(w,J,I,N,o,m,g)}function k(w,J){if(J==="round")Z(w);else Ee._addSquareCap(w,J,I,o,m,g)}var _=e.length-(a?0:1);if(_>0){for(var D=1;D<_;D++)f(e[D],p);if(a)f(e[0],p);else k(e[0],d),k(e[e.length-1],d)}return E},_getStrokePadding:function(e,a){if(!a)return[e,e];var n=new U(e,0).transform(a),o=new U(0,e).transform(a),r=n.getAngleInRadians(),i=n.getLength(),u=o.getLength(),c=Math.sin(r),m=Math.cos(r),t=Math.tan(r),E=Math.atan2(u*t,i),I=Math.atan2(u,t*i);return[Math.abs(i*Math.cos(E)*m+u*Math.sin(E)*c),Math.abs(u*Math.sin(I)*m+i*Math.cos(I)*c)]},_addBevelJoin:function(e,a,n,o,r,i,u,c){var m=e.getCurve(),t=m.getPrevious(),E=m.getPoint1().transform(r),I=t.getNormalAtTime(1).multiply(n).transform(i),p=m.getNormalAtTime(0).multiply(n).transform(i),d=I.getDirectedAngle(p);if(d<0||d>=180)I=I.negate(),p=p.negate();if(c)u(E);if(u(E.add(I)),a==="miter"){var N=new Qe(E.add(I),new U(-I.y,I.x),!0).intersect(new Qe(E.add(p),new U(-p.y,p.x),!0),!0);if(N&&E.getDistance(N)<=o*n)u(N)}u(E.add(p))},_addSquareCap:function(e,a,n,o,r,i,u){var c=e._point.transform(o),m=e.getLocation(),t=m.getNormal().multiply(m.getTime()===0?n:-n).transform(r);if(a==="square"){if(u)i(c.subtract(t)),i(c.add(t));c=c.add(t.rotate(-90))}i(c.add(t)),i(c.subtract(t))},getHandleBounds:function(e,a,n,o,r){var i=n.getStyle(),u=r.stroke&&i.hasStroke(),c,m;if(u){var t=n._getStrokeMatrix(o,r),E=i.getStrokeWidth()/2,I=E;if(i.getStrokeJoin()==="miter")I=E*i.getMiterLimit();if(i.getStrokeCap()==="square")I=Math.max(I,E*Math.SQRT2);c=Ee._getStrokePadding(E,t),m=Ee._getStrokePadding(I,t)}var p=new Array(6),d=1/0,N=-d,v=d,g=N;for(var Z=0,f=e.length;Z<f;Z++){var k=e[Z];k._transformCoordinates(o,p);for(var _=0;_<6;_+=2){var D=!_?m:c,w=D?D[0]:0,J=D?D[1]:0,T=p[_],$=p[_+1],M=T-w,x=T+w,B=$-J,Q=$+J;if(M<d)d=M;if(x>N)N=x;if(B<v)v=B;if(Q>g)g=Q}}return new re(d,v,N-d,g-v)}}});Ee.inject({statics:new function(){var e=0.5522847498307936,a=[new C([-1,0],[0,e],[0,-e]),new C([0,-1],[-e,0],[e,0]),new C([1,0],[0,-e],[0,e]),new C([0,1],[e,0],[-e,0])];function n(r,i,u){var c=q.getNamed(u),m=new Ee(c&&(c.insert==!0?de.INSERT:c.insert==!1?de.NO_INSERT:null));return m._add(r),m._closed=i,m.set(c,de.INSERT)}function o(r,i,u){var c=new Array(4);for(var m=0;m<4;m++){var t=a[m];c[m]=new C(t._point.multiply(i).add(r),t._handleIn.multiply(i),t._handleOut.multiply(i))}return n(c,!0,u)}return{Line:function(){var r=arguments;return n([new C(U.readNamed(r,"from")),new C(U.readNamed(r,"to"))],!1,r)},Circle:function(){var r=arguments,i=U.readNamed(r,"center"),u=q.readNamed(r,"radius");return o(i,new oe(u),r)},Rectangle:function(){var r=arguments,i=re.readNamed(r,"rectangle"),u=oe.readNamed(r,"radius",0,{readNull:!0}),c=i.getBottomLeft(!0),m=i.getTopLeft(!0),t=i.getTopRight(!0),E=i.getBottomRight(!0),I;if(!u||u.isZero())I=[new C(c),new C(m),new C(t),new C(E)];else{u=oe.min(u,i.getSize(!0).divide(2));var{width:p,height:d}=u,N=p*e,v=d*e;I=[new C(c.add(p,0),null,[-N,0]),new C(c.subtract(0,d),[0,v]),new C(m.add(0,d),null,[0,-v]),new C(m.add(p,0),[-N,0],null),new C(t.subtract(p,0),null,[N,0]),new C(t.add(0,d),[0,-v],null),new C(E.subtract(0,d),null,[0,v]),new C(E.subtract(p,0),[N,0])]}return n(I,!0,r)},RoundRectangle:"#Rectangle",Ellipse:function(){var r=arguments,i=ie._readEllipse(r);return o(i.center,i.radius,r)},Oval:"#Ellipse",Arc:function(){var r=arguments,i=U.readNamed(r,"from"),u=U.readNamed(r,"through"),c=U.readNamed(r,"to"),m=q.getNamed(r),t=new Ee(m&&m.insert==!1&&de.NO_INSERT);return t.moveTo(i),t.arcTo(u,c),t.set(m)},RegularPolygon:function(){var r=arguments,i=U.readNamed(r,"center"),u=q.readNamed(r,"sides"),c=q.readNamed(r,"radius"),m=360/u,t=u%3===0,E=new U(0,t?-c:c),I=t?-1:0.5,p=new Array(u);for(var d=0;d<u;d++)p[d]=new C(i.add(E.rotate((d+I)*m)));return n(p,!0,r)},Star:function(){var r=arguments,i=U.readNamed(r,"center"),u=q.readNamed(r,"points")*2,c=q.readNamed(r,"radius1"),m=q.readNamed(r,"radius2"),t=360/u,E=new U(0,-1),I=new Array(u);for(var p=0;p<u;p++)I[p]=new C(i.add(E.rotate(t*p).multiply(p%2?m:c)));return n(I,!0,r)}}}});var We=Pe.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function e(a){if(this._children=[],this._namedChildren={},!this._initialize(a))if(typeof a==="string")this.setPathData(a);else this.addChildren(Array.isArray(a)?a:arguments)},insertChildren:function e(a,n){var o=n,r=o[0];if(r&&typeof r[0]==="number")o=[o];for(var i=n.length-1;i>=0;i--){var u=o[i];if(o===n&&!(u instanceof Ee))o=q.slice(o);if(Array.isArray(u))o[i]=new Ee({segments:u,insert:!1});else if(u instanceof We)o.splice.apply(o,[i,1].concat(u.removeChildren())),u.remove()}return e.base.call(this,a,o)},reduce:function e(a){var n=this._children;for(var o=n.length-1;o>=0;o--){var r=n[o].reduce(a);if(r.isEmpty())r.remove()}if(!n.length){var r=new Ee(de.NO_INSERT);return r.copyAttributes(this),r.insertAbove(this),this.remove(),r}return e.base.call(this)},isClosed:function(){var e=this._children;for(var a=0,n=e.length;a<n;a++)if(!e[a]._closed)return!1;return!0},setClosed:function(e){var a=this._children;for(var n=0,o=a.length;n<o;n++)a[n].setClosed(e)},getFirstSegment:function(){var e=this.getFirstChild();return e&&e.getFirstSegment()},getLastSegment:function(){var e=this.getLastChild();return e&&e.getLastSegment()},getCurves:function(){var e=this._children,a=[];for(var n=0,o=e.length;n<o;n++)q.push(a,e[n].getCurves());return a},getFirstCurve:function(){var e=this.getFirstChild();return e&&e.getFirstCurve()},getLastCurve:function(){var e=this.getLastChild();return e&&e.getLastCurve()},getArea:function(){var e=this._children,a=0;for(var n=0,o=e.length;n<o;n++)a+=e[n].getArea();return a},getLength:function(){var e=this._children,a=0;for(var n=0,o=e.length;n<o;n++)a+=e[n].getLength();return a},getPathData:function(e,a){var n=this._children,o=[];for(var r=0,i=n.length;r<i;r++){var u=n[r],c=u._matrix;o.push(u.getPathData(e&&!c.isIdentity()?e.appended(c):e,a))}return o.join("")},_hitTestChildren:function e(a,n,o){return e.base.call(this,a,n.class===Ee||n.type==="path"?n:q.set({},n,{fill:!1}),o)},_draw:function(e,a,n,o){var r=this._children;if(!r.length)return;a=a.extend({dontStart:!0,dontFinish:!0}),e.beginPath();for(var i=0,u=r.length;i<u;i++)r[i].draw(e,a,o);if(!a.clip){this._setStyles(e,a,n);var c=this._style;if(c.hasFill())e.fill(c.getFillRule()),e.shadowColor="rgba(0,0,0,0)";if(c.hasStroke())e.stroke()}},_drawSelected:function(e,a,n){var o=this._children;for(var r=0,i=o.length;r<i;r++){var u=o[r],c=u._matrix;if(!n[u._id])u._drawSelected(e,c.isIdentity()?a:a.appended(c))}}},new function(){function e(a,n){var o=a._children;if(n&&!o.length)throw new Error("Use a moveTo() command first");return o[o.length-1]}return q.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(a){this[a]=function(){var n=e(this,!0);n[a].apply(n,arguments)}},{moveTo:function(){var a=e(this),n=a&&a.isEmpty()?a:new Ee(de.NO_INSERT);if(n!==a)this.addChild(n);n.moveTo.apply(n,arguments)},moveBy:function(){var a=e(this,!0),n=a&&a.getLastSegment(),o=U.read(arguments);this.moveTo(n?o.add(n._point):o)},closePath:function(a){e(this,!0).closePath(a)}})},q.each(["reverse","flatten","simplify","smooth"],function(e){this[e]=function(a){var n=this._children,o;for(var r=0,i=n.length;r<i;r++)o=n[r][e](a)||o;return o}},{}));Pe.inject(new function(){var{min:e,max:a,abs:n}=Math,o={unite:{"1":!0,"2":!0},intersect:{"2":!0},subtract:{"1":!0},exclude:{"1":!0,"-1":!0}};function r(Z){return Z._children||[Z]}function i(Z,f){var k=Z.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);if(f){var _=r(k);for(var D=0,w=_.length;D<w;D++){var Z=_[D];if(!Z._closed&&!Z.isEmpty())Z.closePath(0.000000000001),Z.getFirstSegment().setHandleIn(0,0),Z.getLastSegment().setHandleOut(0,0)}k=k.resolveCrossings().reorient(k.getFillRule()==="nonzero",!0)}return k}function u(Z,f,k,_,D){var w=new We(de.NO_INSERT);if(w.addChildren(Z,!0),w=w.reduce({simplify:f}),!(D&&D.insert==!1))w.insertAbove(_&&k.isSibling(_)&&k.getIndex()<_.getIndex()?_:k);return w.copyAttributes(k,!0),w}function c(Z){return Z.hasOverlap()||Z.isCrossing()}function m(Z,f,k,_){if(_&&(_.trace==!1||_.stroke)&&/^(subtract|intersect)$/.test(k))return t(Z,f,k);var D=i(Z,!0),w=f&&Z!==f&&i(f,!0),J=o[k];if(J[k]=!0,w&&(J.subtract||J.exclude)^(w.isClockwise()^D.isClockwise()))w.reverse();var T=d(je.expand(D.getIntersections(w,c))),$=r(D),M=w&&r(w),x=[],B=[],Q;function y(te){for(var Je=0,Ne=te.length;Je<Ne;Je++){var we=te[Je];q.push(x,we._segments),q.push(B,we.getCurves()),we._overlapsOnly=!0}}function X(te){var Je=[];for(var Ne=0,we=te&&te.length;Ne<we;Ne++)Je.push(B[te[Ne]]);return Je}if(T.length){if(y($),M)y(M);var V=new Array(B.length);for(var W=0,G=B.length;W<G;W++)V[W]=B[W].getValues();var P=ue.findCurveBoundsCollisions(V,V,0,!0),ne={};for(var W=0;W<B.length;W++){var Re=B[W],me=Re._path._id,be=ne[me]=ne[me]||{};be[Re.getIndex()]={hor:X(P[W].hor),ver:X(P[W].ver)}}for(var W=0,G=T.length;W<G;W++)v(T[W]._segment,D,w,ne,J);for(var W=0,G=x.length;W<G;W++){var se=x[W],_e=se._intersection;if(!se._winding)v(se,D,w,ne,J);if(!(_e&&_e._overlap))se._path._overlapsOnly=!1}Q=g(x,J)}else Q=p(M?$.concat(M):$.slice(),function(te){return!!J[te]});return u(Q,!0,Z,f,_)}function t(Z,f,k){var _=i(Z),D=i(f),w=_.getIntersections(D,c),J=k==="subtract",T=k==="divide",$={},M=[];function x(y){if(!$[y._id]&&(T||D.contains(y.getPointAt(y.getLength()/2))^J))return M.unshift(y),$[y._id]=!0}for(var B=w.length-1;B>=0;B--){var Q=w[B].split();if(Q){if(x(Q))Q.getFirstSegment().setHandleIn(0,0);_.getLastSegment().setHandleOut(0,0)}}return x(_),u(M,!1,Z,f)}function E(Z,f){var k=Z;while(k){if(k===f)return;k=k._previous}while(Z._next&&Z._next!==f)Z=Z._next;if(!Z._next){while(f._previous)f=f._previous;Z._next=f,f._previous=Z}}function I(Z){for(var f=Z.length-1;f>=0;f--)Z[f].clearHandles()}function p(Z,f,k){var _=Z&&Z.length;if(_){var D=q.each(Z,function(P,ne){this[P._id]={container:null,winding:P.isClockwise()?1:-1,index:ne}},{}),w=Z.slice().sort(function(P,ne){return n(ne.getArea())-n(P.getArea())}),J=w[0],T=ue.findItemBoundsCollisions(w,null,ee.GEOMETRIC_EPSILON);if(k==null)k=J.isClockwise();for(var $=0;$<_;$++){var M=w[$],x=D[M._id],B=0,Q=T[$];if(Q){var y=null;for(var X=Q.length-1;X>=0;X--)if(Q[X]<$){y=y||M.getInteriorPoint();var V=w[Q[X]];if(V.contains(y)){var W=D[V._id];B=W.winding,x.winding+=B,x.container=W.exclude?W.container:V;break}}}if(f(x.winding)===f(B))x.exclude=!0,Z[x.index]=null;else{var G=x.container;M.setClockwise(G?!G.isClockwise():k)}}}return Z}function d(Z,f,k){var _=f&&[],D=0.00000001,w=1-D,J=!1,T=k||[],$=k&&{},M,x,B;function Q(Je){return Je._path._id+"."+Je._segment1._index}for(var y=(k&&k.length)-1;y>=0;y--){var X=k[y];if(X._path)$[Q(X)]=!0}for(var y=Z.length-1;y>=0;y--){var V=Z[y],W=V._time,G=W,P=f&&!f(V),X=V._curve,ne;if(X){if(X!==x)J=!X.hasHandles()||$&&$[Q(X)],M=[],B=null,x=X;else if(B>=D)W/=B}if(P){if(M)M.push(V);continue}else if(f)_.unshift(V);if(B=G,W<D)ne=X._segment1;else if(W>w)ne=X._segment2;else{var Re=X.divideAtTime(W,!0);if(J)T.push(X,Re);ne=Re._segment1;for(var me=M.length-1;me>=0;me--){var be=M[me];be._time=(be._time-W)/(1-W)}}V._setSegment(ne);var se=ne._intersection,_e=V._intersection;if(se){E(se,_e);var te=se;while(te)E(te._intersection,se),te=te._next}else ne._intersection=_e}if(!k)I(T);return _||Z}function N(Z,f,k,_,D){var w=Array.isArray(f)?f:f[k?"hor":"ver"],J=k?1:0,T=J^1,$=[Z.x,Z.y],M=$[J],x=$[T],B=0.000000001,Q=0.000001,y=M-B,X=M+B,V=0,W=0,G=0,P=0,ne=!1,Re=!1,me=1,be=[],se,_e;function te(ye){var Ce=ye[T+0],Ea=ye[T+6];if(x<e(Ce,Ea)||x>a(Ce,Ea))return;var na=ye[J+0],ga=ye[J+2],za=ye[J+4],qa=ye[J+6];if(Ce===Ea){if(na<X&&qa>y||qa<X&&na>y)ne=!0;return}var Ma=x===Ce?0:x===Ea?1:y>a(na,ga,za,qa)||X<e(na,ga,za,qa)?1:L.solveCubic(ye,T,x,be,0,1)>0?be[0]:1,pa=Ma===0?na:Ma===1?qa:L.getPoint(ye,Ma)[k?"y":"x"],_a=Ce>Ea?1:-1,mn=se[T]>se[T+6]?1:-1,Ua=se[J+6];if(x!==Ce){if(pa<y)G+=_a;else if(pa>X)P+=_a;else ne=!0;if(pa>M-Q&&pa<M+Q)me/=2}else{if(_a!==mn){if(na<y)G+=_a;else if(na>X)P+=_a}else if(na!=Ua){if(Ua<X&&pa>X)P+=_a,ne=!0;else if(Ua>y&&pa<y)G+=_a,ne=!0}me/=4}return se=ye,!D&&pa>y&&pa<X&&L.getTangent(ye,Ma)[k?"x":"y"]===0&&N(Z,f,!k,_,!0)}function Je(ye){var Ce=ye[T+0],Ea=ye[T+2],na=ye[T+4],ga=ye[T+6];if(x<=a(Ce,Ea,na,ga)&&x>=e(Ce,Ea,na,ga)){var za=ye[J+0],qa=ye[J+2],Ma=ye[J+4],pa=ye[J+6],_a=y>a(za,qa,Ma,pa)||X<e(za,qa,Ma,pa)?[ye]:L.getMonoCurves(ye,k),mn;for(var Ua=0,Ir=_a.length;Ua<Ir;Ua++)if(mn=te(_a[Ua]))return mn}}for(var Ne=0,we=w.length;Ne<we;Ne++){var ge=w[Ne],he=ge._path,ea=ge.getValues(),aa;if(!Ne||w[Ne-1]._path!==he){if(se=null,!he._closed){if(_e=L.getValues(he.getLastCurve().getSegment2(),ge.getSegment1(),null,!_),_e[T]!==_e[T+6])se=_e}if(!se){se=ea;var ua=he.getLastCurve();while(ua&&ua!==ge){var ze=ua.getValues();if(ze[T]!==ze[T+6]){se=ze;break}ua=ua.getPrevious()}}}if(aa=Je(ea))return aa;if(Ne+1===we||w[Ne+1]._path!==he){if(_e&&(aa=Je(_e)))return aa;if(ne&&!G&&!P)G=P=he.isClockwise(_)^k?1:-1;if(V+=G,W+=P,G=P=0,ne)Re=!0,ne=!1;_e=null}}return V=n(V),W=n(W),{winding:a(V,W),windingL:V,windingR:W,quality:me,onPath:Re}}function v(Z,f,k,_,D){var w=[],J=Z,T=0,B;do{var $=Z.getCurve();if($){var M=$.getLength();w.push({segment:Z,curve:$,length:M}),T+=M}Z=Z.getNext()}while(Z&&!Z._intersection&&Z!==J);var x=[0.5,0.25,0.75],B={winding:0,quality:-1},Q=0.001,y=1-Q;for(var X=0;X<x.length&&B.quality<0.5;X++){var M=T*x[X];for(var V=0,W=w.length;V<W;V++){var G=w[V],P=G.length;if(M<=P){var $=G.curve,ne=$._path,Re=ne._parent,me=Re instanceof We?Re:ne,be=ee.clamp($.getTimeAt(M),Q,y),se=$.getPointAtTime(be),_e=n($.getTangentAtTime(be).y)<Math.SQRT1_2,te=null;if(D.subtract&&k){var Je=me===f?k:f,Ne=Je._getWinding(se,_e,!0);if(me===f&&Ne.winding||me===k&&!Ne.winding)if(Ne.quality<1)continue;else te={winding:0,quality:1}}if(te=te||N(se,_[ne._id][$.getIndex()],_e,!0),te.quality>B.quality)B=te;break}M-=P}}for(var V=w.length-1;V>=0;V--)w[V].segment._winding=B}function g(Z,f){var k=[],_;function D(we){var ge;return!!(we&&!we._visited&&(!f||f[(ge=we._winding||{}).winding]&&!(f.unite&&ge.winding===2&&ge.windingL&&ge.windingR)))}function w(we){if(we){for(var ge=0,he=_.length;ge<he;ge++)if(we===_[ge])return!0}return!1}function J(we){var ge=we._segments;for(var he=0,ea=ge.length;he<ea;he++)ge[he]._visited=!0}function T(we,ge){var he=we._intersection,ea=he,aa=[];if(ge)_=[we];function ua(ze,ye){while(ze&&ze!==ye){var Ce=ze._segment,Ea=Ce&&Ce._path;if(Ea){var na=Ce.getNext()||Ea.getFirstSegment(),ga=na._intersection;if(Ce!==we&&(w(Ce)||w(na)||na&&(D(Ce)&&(D(na)||ga&&D(ga._segment)))))aa.push(Ce);if(ge)_.push(Ce)}ze=ze._next}}if(he){ua(he);while(he&&he._previous)he=he._previous;ua(he,ea)}return aa}Z.sort(function(we,ge){var he=we._intersection,ea=ge._intersection,aa=!!(he&&he._overlap),ua=!!(ea&&ea._overlap),ze=we._path,ye=ge._path;return aa^ua?aa?1:-1:!he^!ea?he?1:-1:ze!==ye?ze._id-ye._id:we._index-ge._index});for(var $=0,M=Z.length;$<M;$++){var x=Z[$],B=D(x),Q=null,y=!1,X=!0,V=[],W,G,P;if(B&&x._path._overlapsOnly){var ne=x._path,Re=x._intersection._segment._path;if(ne.compare(Re)){if(ne.getArea())k.push(ne.clone(!1));J(ne),J(Re),B=!1}}while(B){var me=!Q,be=T(x,me),se=be.shift(),y=!me&&(w(x)||w(se)),_e=!y&&se;if(me)Q=new Ee(de.NO_INSERT),W=null;if(y){if(x.isFirst()||x.isLast())X=x._path._closed;x._visited=!0;break}if(_e&&W)V.push(W),W=null;if(!W){if(_e)be.push(x);W={start:Q._segments.length,crossings:be,visited:G=[],handleIn:P}}if(_e)x=se;if(!D(x)){Q.removeSegments(W.start);for(var te=0,Je=G.length;te<Je;te++)G[te]._visited=!1;G.length=0;do if(x=W&&W.crossings.shift(),!x||!x._path){if(x=null,W=V.pop(),W)G=W.visited,P=W.handleIn}while(W&&!D(x));if(!x)break}var Ne=x.getNext();Q.add(new C(x._point,P,Ne&&x._handleOut)),x._visited=!0,G.push(x),x=Ne||x._path.getFirstSegment(),P=Ne&&Ne._handleIn}if(y){if(X)Q.getFirstSegment().setHandleIn(P),Q.setClosed(X);if(Q.getArea()!==0)k.push(Q)}}return k}return{_getWinding:function(Z,f,k){return N(Z,this.getCurves(),f,k)},unite:function(Z,f){return m(this,Z,"unite",f)},intersect:function(Z,f){return m(this,Z,"intersect",f)},subtract:function(Z,f){return m(this,Z,"subtract",f)},exclude:function(Z,f){return m(this,Z,"exclude",f)},divide:function(Z,f){return f&&(f.trace==!1||f.stroke)?t(this,Z,"divide"):u([this.subtract(Z,f),this.intersect(Z,f)],!0,this,Z,f)},resolveCrossings:function(){var Z=this._children,f=Z||[this];function k(W,G){var P=W&&W._intersection;return P&&P._overlap&&P._path===G}var _=!1,D=!1,w=this.getIntersections(null,function(W){return W.hasOverlap()&&(_=!0)||W.isCrossing()&&(D=!0)}),J=_&&D&&[];if(w=je.expand(w),_){var T=d(w,function(W){return W.hasOverlap()},J);for(var $=T.length-1;$>=0;$--){var M=T[$],x=M._path,B=M._segment,Q=B.getPrevious(),y=B.getNext();if(k(Q,x)&&k(y,x)){if(B.remove(),Q._handleOut._set(0,0),y._handleIn._set(0,0),Q!==B&&!Q.getCurve().hasLength())y._handleIn.set(Q._handleIn),Q.remove()}}}if(D){if(d(w,_&&function(W){var G=W.getCurve(),P=W.getSegment(),ne=W._intersection,Re=ne._curve,me=ne._segment;if(G&&Re&&G._path&&Re._path)return!0;if(P)P._intersection=null;if(me)me._intersection=null},J),J)I(J);f=g(q.each(f,function(W){q.push(this,W._segments)},[]))}var X=f.length,V;if(X>1&&Z){if(f!==Z)this.setChildren(f);V=this}else if(X===1&&!Z){if(f[0]!==this)this.setSegments(f[0].removeSegments());V=this}if(!V)V=new We(de.NO_INSERT),V.addChildren(f),V=V.reduce(),V.copyAttributes(this),this.replaceWith(V);return V},reorient:function(Z,f){var k=this._children;if(k&&k.length)this.setChildren(p(this.removeChildren(),function(_){return!!(Z?_:_&1)},f));else if(f!==F)this.setClockwise(f);return this},getInteriorPoint:function(){var Z=this.getBounds(),f=Z.getCenter(!0);if(!this.contains(f)){var k=this.getCurves(),_=f.y,D=[],w=[];for(var J=0,T=k.length;J<T;J++){var $=k[J].getValues(),M=$[1],x=$[3],B=$[5],Q=$[7];if(_>=e(M,x,B,Q)&&_<=a(M,x,B,Q)){var y=L.getMonoCurves($);for(var X=0,V=y.length;X<V;X++){var W=y[X],G=W[1],P=W[7];if(G!==P&&(_>=G&&_<=P||_>=P&&_<=G)){var ne=_===G?W[0]:_===P?W[6]:L.solveCubic(W,1,_,w,0,1)===1?L.getPoint(W,w[0]).x:(W[0]+W[6])/2;D.push(ne)}}}}if(D.length>1)D.sort(function(Re,me){return Re-me}),f.x=(D[0]+D[1])/2}return f}}});var sa=q.extend({_class:"PathFlattener",initialize:function(e,a,n,o,r){var i=[],u=[],c=0,m=1/(n||32),t=e._segments,E=t[0],I;function p(g,Z){var f=L.getValues(g,Z,r);i.push(f),d(f,g._index,0,1)}function d(g,Z,f,k){if(k-f>m&&!(o&&L.isStraight(g))&&!L.isFlatEnough(g,a||0.25)){var _=L.subdivide(g,0.5),D=(f+k)/2;d(_[0],Z,f,D),d(_[1],Z,D,k)}else{var w=g[6]-g[0],J=g[7]-g[1],T=Math.sqrt(w*w+J*J);if(T>0)c+=T,u.push({offset:c,curve:g,index:Z,time:k})}}for(var N=1,v=t.length;N<v;N++)I=t[N],p(E,I),E=I;if(e._closed)p(I||E,t[0]);this.curves=i,this.parts=u,this.length=c,this.index=0},_get:function(e){var a=this.parts,n=a.length,o,r,i=this.index;for(;;)if(r=i,!i||a[--i].offset<e)break;for(;r<n;r++){var u=a[r];if(u.offset>=e){this.index=r;var c=a[r-1],m=c&&c.index===u.index?c.time:0,t=c?c.offset:0;return{index:u.index,time:m+(u.time-m)*(e-t)/(u.offset-t)}}}return{index:a[n-1].index,time:1}},drawPart:function(e,a,n){var o=this._get(a),r=this._get(n);for(var i=o.index,u=r.index;i<=u;i++){var c=L.getPart(this.curves[i],i===o.index?o.time:0,i===r.index?r.time:1);if(i===o.index)e.moveTo(c[0],c[1]);e.bezierCurveTo.apply(e,c.slice(2))}}},q.each(L._evaluateMethods,function(e){this[e+"At"]=function(a){var n=this._get(a);return L[e](this.curves[n.index],n.time)}},{})),Le=q.extend({initialize:function(e){var a=this.points=[],n=e._segments,o=e._closed;for(var r=0,i,u=n.length;r<u;r++){var c=n[r].point;if(!i||!i.equals(c))a.push(i=c.clone())}if(o)a.unshift(a[a.length-1]),a.push(a[1]);this.closed=o},fit:function(e){var a=this.points,n=a.length,o=null;if(n>0){if(o=[new C(a[0])],n>1){if(this.fitCubic(o,e,0,n-1,a[1].subtract(a[0]),a[n-2].subtract(a[n-1])),this.closed)o.shift(),o.pop()}}return o},fitCubic:function(e,a,n,o,r,i){var u=this.points;if(o-n===1){var c=u[n],m=u[o],t=c.getDistance(m)/3;this.addCurve(e,[c,c.add(r.normalize(t)),m.add(i.normalize(t)),m]);return}var E=this.chordLengthParameterize(n,o),I=Math.max(a,a*a),p,d=!0;for(var N=0;N<=4;N++){var v=this.generateBezier(n,o,E,r,i),g=this.findMaxError(n,o,v,E);if(g.error<a&&d){this.addCurve(e,v);return}if(p=g.index,g.error>=I)break;d=this.reparameterize(n,o,E,v),I=g.error}var Z=u[p-1].subtract(u[p+1]);this.fitCubic(e,a,n,p,r,Z),this.fitCubic(e,a,p,o,Z.negate(),i)},addCurve:function(e,a){var n=e[e.length-1];n.setHandleOut(a[1].subtract(a[0])),e.push(new C(a[3],a[2].subtract(a[3])))},generateBezier:function(e,a,n,o,r){var i=0.000000000001,u=Math.abs,c=this.points,m=c[e],t=c[a],E=[[0,0],[0,0]],I=[0,0];for(var p=0,d=a-e+1;p<d;p++){var N=n[p],v=1-N,g=3*N*v,Z=v*v*v,f=g*v,k=g*N,_=N*N*N,D=o.normalize(f),w=r.normalize(k),J=c[e+p].subtract(m.multiply(Z+f)).subtract(t.multiply(k+_));E[0][0]+=D.dot(D),E[0][1]+=D.dot(w),E[1][0]=E[0][1],E[1][1]+=w.dot(w),I[0]+=D.dot(J),I[1]+=w.dot(J)}var T=E[0][0]*E[1][1]-E[1][0]*E[0][1],$,M;if(u(T)>i){var x=E[0][0]*I[1]-E[1][0]*I[0],B=I[0]*E[1][1]-I[1]*E[0][1];$=B/T,M=x/T}else{var Q=E[0][0]+E[0][1],y=E[1][0]+E[1][1];$=M=u(Q)>i?I[0]/Q:u(y)>i?I[1]/y:0}var X=t.getDistance(m),V=i*X,W,G;if($<V||M<V)$=M=X/3;else{var P=t.subtract(m);if(W=o.normalize($),G=r.normalize(M),W.dot(P)-G.dot(P)>X*X)$=M=X/3,W=G=null}return[m,m.add(W||o.normalize($)),t.add(G||r.normalize(M)),t]},reparameterize:function(e,a,n,o){for(var r=e;r<=a;r++)n[r-e]=this.findRoot(o,this.points[r],n[r-e]);for(var r=1,i=n.length;r<i;r++)if(n[r]<=n[r-1])return!1;return!0},findRoot:function(e,a,n){var o=[],r=[];for(var i=0;i<=2;i++)o[i]=e[i+1].subtract(e[i]).multiply(3);for(var i=0;i<=1;i++)r[i]=o[i+1].subtract(o[i]).multiply(2);var u=this.evaluate(3,e,n),c=this.evaluate(2,o,n),m=this.evaluate(1,r,n),t=u.subtract(a),E=c.dot(c)+t.dot(m);return ee.isMachineZero(E)?n:n-t.dot(c)/E},evaluate:function(e,a,n){var o=a.slice();for(var r=1;r<=e;r++)for(var i=0;i<=e-r;i++)o[i]=o[i].multiply(1-n).add(o[i+1].multiply(n));return o[0]},chordLengthParameterize:function(e,a){var n=[0];for(var o=e+1;o<=a;o++)n[o-e]=n[o-e-1]+this.points[o].getDistance(this.points[o-1]);for(var o=1,r=a-e;o<=r;o++)n[o]/=n[r];return n},findMaxError:function(e,a,n,o){var r=Math.floor((a-e+1)/2),i=0;for(var u=e+1;u<a;u++){var c=this.evaluate(3,n,o[u-e]),m=c.subtract(this.points[u]),t=m.x*m.x+m.y*m.y;if(t>=i)i=t,r=u}return{error:i,index:r}}}),He=de.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function e(a){this._content="",this._lines=[];var n=a&&q.isPlainObject(a)&&a.x===F&&a.y===F;this._initialize(n&&a,!n&&U.read(arguments))},_equals:function(e){return this._content===e._content},copyContent:function(e){this.setContent(e._content)},getContent:function(){return this._content},setContent:function(e){this._content=""+e,this._lines=this._content.split(/\r\n|\n|\r/mg),this._changed(521)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),Oe=He.extend({_class:"PointText",initialize:function e(){He.apply(this,arguments)},getPoint:function(){var e=this._matrix.getTranslation();return new qe(e.x,e.y,this,"setPoint")},setPoint:function(){var e=U.read(arguments);this.translate(e.subtract(this._matrix.getTranslation()))},_draw:function(e,a,n){if(!this._content)return;this._setStyles(e,a,n);var o=this._lines,r=this._style,i=r.hasFill(),u=r.hasStroke(),c=r.getLeading(),m=e.shadowColor;e.font=r.getFontStyle(),e.textAlign=r.getJustification();for(var t=0,E=o.length;t<E;t++){e.shadowColor=m;var I=o[t];if(i)e.fillText(I,0,0),e.shadowColor="rgba(0,0,0,0)";if(u)e.strokeText(I,0,0);e.translate(0,c)}},_getBounds:function(e,a){var n=this._style,o=this._lines,r=o.length,i=n.getJustification(),u=n.getLeading(),c=this.getView().getTextWidth(n.getFontStyle(),o),m=0;if(i!=="left")m-=c/(i==="center"?2:1);var t=new re(m,r?-0.75*u:0,c,r*u);return e?e._transformBounds(t,t):t}}),K=q.extend(new function(){var e={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},a={},n={transparent:[0,0,0,0]},o;function r(c){var m=c.match(/^#([\da-f]{2})([\da-f]{2})([\da-f]{2})([\da-f]{2})?$/i)||c.match(/^#([\da-f])([\da-f])([\da-f])([\da-f])?$/i),t="rgb",E;if(m){var I=m[4]?4:3;E=new Array(I);for(var p=0;p<I;p++){var d=m[p+1];E[p]=parseInt(d.length==1?d+d:d,16)/255}}else if(m=c.match(/^(rgb|hsl)a?\((.*)\)$/)){t=m[1],E=m[2].trim().split(/[,\s]+/g);var N=t==="hsl";for(var p=0,v=Math.min(E.length,4);p<v;p++){var g=E[p],d=parseFloat(g);if(N){if(p===0){var Z=g.match(/([a-z]*)$/)[1];d*={turn:360,rad:180/Math.PI,grad:0.9}[Z]||1}else if(p<3)d/=100}else if(p<3)d/=/%$/.test(g)?100:255;E[p]=d}}else{var f=n[c];if(!f)if(j){if(!o)o=Se.getContext(1,1,{willReadFrequently:!0}),o.globalCompositeOperation="copy";o.fillStyle="rgba(0,0,0,0)",o.fillStyle=c,o.fillRect(0,0,1,1);var k=o.getImageData(0,0,1,1).data;f=n[c]=[k[0]/255,k[1]/255,k[2]/255]}else f=[0,0,0];E=f.slice()}return[t,E]}var i=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],u={"rgb-hsb":function(c,m,t){var E=Math.max(c,m,t),I=Math.min(c,m,t),p=E-I,d=p===0?0:(E==c?(m-t)/p+(m<t?6:0):E==m?(t-c)/p+2:(c-m)/p+4)*60;return[d,E===0?0:p/E,E]},"hsb-rgb":function(c,m,t){c=(c/60%6+6)%6;var I=Math.floor(c),E=c-I,I=i[I],p=[t,t*(1-m),t*(1-m*E),t*(1-m*(1-E))];return[p[I[0]],p[I[1]],p[I[2]]]},"rgb-hsl":function(c,m,t){var E=Math.max(c,m,t),I=Math.min(c,m,t),p=E-I,d=p===0,N=d?0:(E==c?(m-t)/p+(m<t?6:0):E==m?(t-c)/p+2:(c-m)/p+4)*60,v=(E+I)/2,g=d?0:v<0.5?p/(E+I):p/(2-E-I);return[N,g,v]},"hsl-rgb":function(c,m,t){if(c=(c/360%1+1)%1,m===0)return[t,t,t];var E=[c+0.3333333333333333,c,c-0.3333333333333333],I=t<0.5?t*(1+m):t+m-t*m,p=2*t-I,d=[];for(var N=0;N<3;N++){var v=E[N];if(v<0)v+=1;if(v>1)v-=1;d[N]=6*v<1?p+(I-p)*6*v:2*v<1?I:3*v<2?p+(I-p)*(0.6666666666666666-v)*6:p}return d},"rgb-gray":function(c,m,t){return[c*0.2989+m*0.587+t*0.114]},"gray-rgb":function(c){return[c,c,c]},"gray-hsb":function(c){return[0,0,c]},"gray-hsl":function(c){return[0,0,c]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return q.each(e,function(c,m){a[m]=[],q.each(c,function(t,E){var I=q.capitalize(t),p=/^(hue|saturation)$/.test(t),d=a[m][E]=m==="gradient"?t==="gradient"?function(N){var v=this._components[0];if(N=fe.read(Array.isArray(N)?N:arguments,0,{readNull:!0}),v!==N){if(v)v._removeOwner(this);if(N)N._addOwner(this)}return N}:function(){return U.read(arguments,0,{readNull:t==="highlight",clone:!0})}:function(N){return N==null||isNaN(N)?0:+N};this["get"+I]=function(){return this._type===m||p&&/^hs[bl]$/.test(this._type)?this._components[E]:this._convert(m)[E]},this["set"+I]=function(N){if(this._type!==m&&!(p&&/^hs[bl]$/.test(this._type)))this._components=this._convert(m),this._properties=e[m],this._type=m;this._components[E]=d.call(this,N),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function c(m){var t=arguments,E=this.__read,I=0,p,d,N,v;if(Array.isArray(m))t=m,m=t[0];var g=m!=null&&typeof m;if(g==="string"&&m in e)if(p=m,m=t[1],Array.isArray(m))d=m,N=t[2];else{if(E)I=1;t=q.slice(t,1),g=typeof m}if(!d){if(v=g==="number"?t:g==="object"&&m.length!=null?m:null,v){if(!p)p=v.length>=3?"rgb":"gray";var Z=e[p].length;if(N=v[Z],E)I+=v===arguments?Z+(N!=null?1:0):1;if(v.length>Z)v=q.slice(v,0,Z)}else if(g==="string"){var f=r(m);if(p=f[0],d=f[1],d.length===4)N=d[3],d.length--}else if(g==="object")if(m.constructor===c){if(p=m._type,d=m._components.slice(),N=m._alpha,p==="gradient")for(var k=1,_=d.length;k<_;k++){var D=d[k];if(D)d[k]=D.clone()}}else if(m.constructor===fe)p="gradient",v=t;else{p="hue"in m?"lightness"in m?"hsl":"hsb":("gradient"in m)||("stops"in m)||("radial"in m)?"gradient":("gray"in m)?"gray":"rgb";var w=e[p],J=a[p];this._components=d=[];for(var k=0,_=w.length;k<_;k++){var T=m[w[k]];if(T==null&&!k&&p==="gradient"&&"stops"in m)T={stops:m.stops,radial:m.radial};if(T=J[k].call(this,T),T!=null)d[k]=T}N=m.alpha}if(E&&p)I=1}if(this._type=p||"rgb",!d){this._components=d=[];var J=a[this._type];for(var k=0,_=J.length;k<_;k++){var T=J[k].call(this,v&&v[k]);if(T!=null)d[k]=T}}if(this._components=d,this._properties=e[this._type],this._alpha=N,E)this.__read=I;return this},set:"#initialize",_serialize:function(c,m){var t=this.getComponents();return q.serialize(/^(gray|rgb)$/.test(this._type)?t:[this._type].concat(t),c,!0,m)},_changed:function(){if(this._canvasStyle=null,this._owner)if(this._setter)this._owner[this._setter](this);else this._owner._changed(129)},_convert:function(c){var m;return this._type===c?this._components.slice():(m=u[this._type+"-"+c])?m.apply(this,this._components):u["rgb-"+c].apply(this,u[this._type+"-rgb"].apply(this,this._components))},convert:function(c){return new K(c,this._convert(c),this._alpha)},getType:function(){return this._type},setType:function(c){this._components=this._convert(c),this._properties=e[c],this._type=c},getComponents:function(){var c=this._components.slice();if(this._alpha!=null)c.push(this._alpha);return c},getAlpha:function(){return this._alpha!=null?this._alpha:1},setAlpha:function(c){this._alpha=c==null?null:Math.min(Math.max(c,0),1),this._changed()},hasAlpha:function(){return this._alpha!=null},equals:function(c){var m=q.isPlainValue(c,!0)?K.read(arguments):c;return m===this||m&&this._class===m._class&&this._type===m._type&&this.getAlpha()===m.getAlpha()&&q.equals(this._components,m._components)||!1},toString:function(){var c=this._properties,m=[],t=this._type==="gradient",E=ce.instance;for(var I=0,p=c.length;I<p;I++){var d=this._components[I];if(d!=null)m.push(c[I]+": "+(t?d:E.number(d)))}if(this._alpha!=null)m.push("alpha: "+E.number(this._alpha));return"{ "+m.join(", ")+" }"},toCSS:function(c){var m=this._convert("rgb"),t=c||this._alpha==null?1:this._alpha;function E(I){return Math.round((I<0?0:I>1?1:I)*255)}if(m=[E(m[0]),E(m[1]),E(m[2])],t<1)m.push(t<0?0:t);return c?"#"+(16777216+(m[0]<<16)+(m[1]<<8)+m[2]).toString(16).slice(1):(m.length==4?"rgba(":"rgb(")+m.join(",")+")"},toCanvasStyle:function(c,m){if(this._canvasStyle)return this._canvasStyle;if(this._type!=="gradient")return this._canvasStyle=this.toCSS();var t=this._components,E=t[0],I=E._stops,p=t[1],d=t[2],N=t[3],v=m&&m.inverted(),g;if(v){if(p=v._transformPoint(p),d=v._transformPoint(d),N)N=v._transformPoint(N)}if(E._radial){var Z=d.getDistance(p);if(N){var f=N.subtract(p);if(f.getLength()>Z)N=p.add(f.normalize(Z-0.1))}var k=N||p;g=c.createRadialGradient(k.x,k.y,0,p.x,p.y,Z)}else g=c.createLinearGradient(p.x,p.y,d.x,d.y);for(var _=0,D=I.length;_<D;_++){var w=I[_],J=w._offset;g.addColorStop(J==null?_/(D-1):J,w._color.toCanvasStyle())}return this._canvasStyle=g},transform:function(c){if(this._type==="gradient"){var m=this._components;for(var t=1,E=m.length;t<E;t++){var I=m[t];c._transformPoint(I,I,!0)}this._changed()}},statics:{_types:e,random:function(){var c=Math.random;return new K(c(),c(),c())},_setOwner:function(c,m,t){if(c){if(c._owner&&m&&c._owner!==m)c=c.clone();if(!c._owner^!m)c._owner=m||null,c._setter=t||null}return c}}})},new function(){var e={add:function(a,n){return a+n},subtract:function(a,n){return a-n},multiply:function(a,n){return a*n},divide:function(a,n){return a/n}};return q.each(e,function(a,n){this[n]=function(o){o=K.read(arguments);var r=this._type,i=this._components,u=o._convert(r);for(var c=0,m=i.length;c<m;c++)u[c]=a(i[c],u[c]);return new K(r,u,this._alpha!=null?a(this._alpha,o.getAlpha()):null)}},{})}),fe=q.extend({_class:"Gradient",initialize:function e(a,n){if(this._id=Te.get(),a&&q.isPlainObject(a))this.set(a),a=n=null;if(this._stops==null)this.setStops(a||["white","black"]);if(this._radial==null)this.setRadial(typeof n==="string"&&n==="radial"||n||!1)},_serialize:function(e,a){return a.add(this,function(){return q.serialize([this._stops,this._radial],e,!0,a)})},_changed:function(){for(var e=0,a=this._owners&&this._owners.length;e<a;e++)this._owners[e]._changed()},_addOwner:function(e){if(!this._owners)this._owners=[];this._owners.push(e)},_removeOwner:function(e){var a=this._owners?this._owners.indexOf(e):-1;if(a!=-1){if(this._owners.splice(a,1),!this._owners.length)this._owners=F}},clone:function(){var e=[];for(var a=0,n=this._stops.length;a<n;a++)e[a]=this._stops[a].clone();return new fe(e,this._radial)},getStops:function(){return this._stops},setStops:function(e){if(e.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var a=this._stops;if(a)for(var n=0,o=a.length;n<o;n++)a[n]._owner=F;a=this._stops=Fe.readList(e,0,{clone:!0});for(var n=0,o=a.length;n<o;n++)a[n]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(e){this._radial=e,this._changed()},equals:function(e){if(e===this)return!0;if(e&&this._class===e._class){var a=this._stops,n=e._stops,o=a.length;if(o===n.length){for(var r=0;r<o;r++)if(!a[r].equals(n[r]))return!1;return!0}}return!1}}),Fe=q.extend({_class:"GradientStop",initialize:function e(a,n){var o=a,r=n;if(typeof a==="object"&&n===F){if(Array.isArray(a)&&typeof a[0]!=="number")o=a[0],r=a[1];else if("color"in a||"offset"in a||"rampPoint"in a)o=a.color,r=a.offset||a.rampPoint||0}this.setColor(o),this.setOffset(r)},clone:function(){return new Fe(this._color.clone(),this._offset)},_serialize:function(e,a){var n=this._color,o=this._offset;return q.serialize(o==null?[n]:[n,o],e,!0,a)},_changed:function(){if(this._owner)this._owner._changed(129)},getOffset:function(){return this._offset},setOffset:function(e){this._offset=e,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){K._setOwner(this._color,null),this._color=K._setOwner(K.read(arguments,0),this,"setColor"),this._changed()},equals:function(e){return e===this||e&&this._class===e._class&&this._color.equals(e._color)&&this._offset==e._offset||!1}}),Xe=q.extend(new function(){var e={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new U,selectedColor:null},a=q.set({},e,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),n=q.set({},a,{fillColor:new K}),o={strokeWidth:193,strokeCap:193,strokeJoin:193,strokeScaling:201,miterLimit:193,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},r={beans:!0},i={_class:"Style",beans:!0,initialize:function u(c,m,t){if(this._values={},this._owner=m,this._project=m&&m._project||t||ve.project,this._defaults=!m||m instanceof Ke?a:m instanceof He?n:e,c)this.set(c)}};return q.each(a,function(u,c){var m=/Color$/.test(c),t=c==="shadowOffset",E=q.capitalize(c),I=o[c],p="set"+E,d="get"+E;i[p]=function(N){var v=this._owner,g=v&&v._children,Z=g&&g.length>0&&!(v instanceof We);if(Z)for(var f=0,k=g.length;f<k;f++)g[f]._style[p](N);if((c==="selectedColor"||!Z)&&c in this._defaults){var _=this._values[c];if(_!==N){if(m){if(_)K._setOwner(_,null),_._canvasStyle=null;if(N&&N.constructor===K)N=K._setOwner(N,v,Z&&p)}if(this._values[c]=N,v)v._changed(I||129)}}},i[d]=function(N){var v=this._owner,g=v&&v._children,Z=g&&g.length>0&&!(v instanceof We),f;if(Z&&!N)for(var k=0,_=g.length;k<_;k++){var D=g[k]._style[d]();if(!k)f=D;else if(!q.equals(f,D))return F}else if(c in this._defaults){var f=this._values[c];if(f===F){if(f=this._defaults[c],f&&f.clone)f=f.clone()}else{var w=m?K:t?U:null;if(w&&!(f&&f.constructor===w))this._values[c]=f=w.read([f],0,{readNull:!0,clone:!0})}}if(f&&m)f=K._setOwner(f,v,Z&&p);return f},r[d]=function(N){return this._style[d](N)},r[p]=function(N){this._style[p](N)}}),q.each({Font:"FontFamily",WindingRule:"FillRule"},function(u,c){var m="get"+c,t="set"+c;i[m]=r[m]="#get"+u,i[t]=r[t]="#set"+u}),de.inject(r),i},{set:function(e){var a=e instanceof Xe,n=a?e._values:e;if(n){for(var o in n)if(o in this._defaults){var r=n[o];this[o]=r&&a&&r.clone?r.clone():r}}},equals:function(e){function a(n,o,r){var i=n._values,u=o._values,c=o._defaults;for(var m in i){var t=i[m],E=u[m];if(!(r&&(m in u))&&!q.equals(t,E===F?c[m]:E))return!1}return!0}return e===this||e&&this._class===e._class&&a(this,e)&&a(e,this,!0)||!1},_dispose:function(){var e=this.getFillColor();if(e)e._canvasStyle=null;if(e=this.getStrokeColor(),e)e._canvasStyle=null;if(e=this.getShadowColor(),e)e._canvasStyle=null},hasFill:function(){var e=this.getFillColor();return!!e&&e.alpha>0},hasStroke:function(){var e=this.getStrokeColor();return!!e&&e.alpha>0&&this.getStrokeWidth()>0},hasShadow:function(){var e=this.getShadowColor();return!!e&&e.alpha>0&&(this.getShadowBlur()>0||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var e=this.getFontSize();return this.getFontWeight()+" "+e+(/[a-z]/i.test(e+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function e(){var a=e.base.call(this),n=this.getFontSize();if(/pt|em|%|px/.test(n))n=this.getView().getPixelSize(n);return a!=null?a:n*1.2}}),$e=new function(){function e(a,n,o,r){var i=["","webkit","moz","Moz","ms","o"],u=n[0].toUpperCase()+n.substring(1);for(var c=0;c<6;c++){var m=i[c],t=m?m+u:n;if(t in a){if(o)a[t]=r;else return a[t];break}}}return{getStyles:function(a){var n=a&&a.nodeType!==9?a.ownerDocument:a,o=n&&n.defaultView;return o&&o.getComputedStyle(a,"")},getBounds:function(a,n){var o=a.ownerDocument,r=o.body,i=o.documentElement,u;try{u=a.getBoundingClientRect()}catch(E){u={left:0,top:0,width:0,height:0}}var c=u.left-(i.clientLeft||r.clientLeft||0),m=u.top-(i.clientTop||r.clientTop||0);if(!n){var t=o.defaultView;c+=t.pageXOffset||i.scrollLeft||r.scrollLeft,m+=t.pageYOffset||i.scrollTop||r.scrollTop}return new re(c,m,u.width,u.height)},getViewportBounds:function(a){var n=a.ownerDocument,o=n.defaultView,r=n.documentElement;return new re(0,0,o.innerWidth||r.clientWidth,o.innerHeight||r.clientHeight)},getOffset:function(a,n){return $e.getBounds(a,n).getPoint()},getSize:function(a){return $e.getBounds(a,!0).getSize()},isInvisible:function(a){return $e.getSize(a).equals(new oe(0,0))},isInView:function(a){return!$e.isInvisible(a)&&$e.getViewportBounds(a).intersects($e.getBounds(a,!0))},isInserted:function(a){return Y.body.contains(a)},getPrefixed:function(a,n){return a&&e(a,n)},setPrefixed:function(a,n,o){if(typeof n==="object")for(var r in n)e(a,r,!0,n[r]);else e(a,n,!0,o)}}},Ae={add:function(e,a){if(e)for(var n in a){var o=a[n],r=n.split(/[\s,]+/g);for(var i=0,u=r.length;i<u;i++){var c=r[i],m=e===Y&&(c==="touchstart"||c==="touchmove")?{passive:!1}:!1;e.addEventListener(c,o,m)}}},remove:function(e,a){if(e)for(var n in a){var o=a[n],r=n.split(/[\s,]+/g);for(var i=0,u=r.length;i<u;i++)e.removeEventListener(r[i],o,!1)}},getPoint:function(e){var a=e.targetTouches?e.targetTouches.length?e.targetTouches[0]:e.changedTouches[0]:e;return new U(a.pageX||a.clientX+Y.documentElement.scrollLeft,a.pageY||a.clientY+Y.documentElement.scrollTop)},getTarget:function(e){return e.target||e.srcElement},getRelatedTarget:function(e){return e.relatedTarget||e.toElement},getOffset:function(e,a){return Ae.getPoint(e).subtract($e.getOffset(a||Ae.getTarget(e)))}};Ae.requestAnimationFrame=new function(){var e=$e.getPrefixed(j,"requestAnimationFrame"),a=!1,n=[],o;function r(){var i=n;n=[];for(var u=0,c=i.length;u<c;u++)i[u]();if(a=e&&n.length,a)e(r)}return function(i){if(n.push(i),e){if(!a)e(r),a=!0}else if(!o)o=setInterval(r,16.666666666666668)}};var Be=q.extend(S,{_class:"View",initialize:function e(a,n){function o(I){return n[I]||parseInt(n.getAttribute(I),10)}function r(){var I=$e.getSize(n);return I.isNaN()||I.isZero()?new oe(o("width"),o("height")):I}var i;if(j&&n){if(this._id=n.getAttribute("id"),this._id==null)n.setAttribute("id",this._id="paper-view-"+e._id++);Ae.add(n,this._viewEvents);var u="none";if($e.setPrefixed(n.style,{userDrag:u,userSelect:u,touchCallout:u,contentZooming:u,tapHighlightColor:"rgba(0,0,0,0)"}),O.hasAttribute(n,"resize")){var c=this;Ae.add(j,this._windowEvents={resize:function(){c.setViewSize(r())}})}if(i=r(),O.hasAttribute(n,"stats")&&typeof Stats!=="undefined"){this._stats=new Stats;var m=this._stats.domElement,t=m.style,E=$e.getOffset(n);t.position="absolute",t.left=E.x+"px",t.top=E.y+"px",Y.body.appendChild(m)}}else i=new oe(n),n=null;if(this._project=a,this._scope=a._scope,this._element=n,!this._pixelRatio)this._pixelRatio=j&&j.devicePixelRatio||1;if(this._setElementSize(i.width,i.height),this._viewSize=i,e._views.push(this),e._viewsById[this._id]=this,(this._matrix=new Ze)._owner=this,!e._focused)e._focused=this;this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!ve.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;if(Be._focused===this)Be._focused=null;Be._views.splice(Be._views.indexOf(this),1),delete Be._viewsById[this._id];var e=this._project;if(e._view===this)e._view=null;return Ae.remove(this._element,this._viewEvents),Ae.remove(j,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:q.each(de._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(e){this[e]={}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(e){if(this._autoUpdate=e,e)this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var e=this;Ae.requestAnimationFrame(function(){if(e._requested=!1,e._animate){e.requestUpdate();var a=e._element;if((!$e.getPrefixed(Y,"hidden")||O.getAttribute(a,"keepalive")==="true")&&$e.isInView(a))e._handleFrame()}if(e._autoUpdate)e.update()}),this._requested=!0}},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){ve=this._scope;var e=Date.now()/1000,a=this._last?e-this._last:0;if(this._last=e,this.emit("frame",new q({delta:a,time:this._time+=a,count:this._count++})),this._stats)this._stats.update()},_animateItem:function(e,a){var n=this._frameItems;if(a){if(n[e._id]={item:e,time:0,count:0},++this._frameItemCount===1)this.on("frame",this._handleFrameItems)}else if(delete n[e._id],--this._frameItemCount===0)this.off("frame",this._handleFrameItems)},_handleFrameItems:function(e){for(var a in this._frameItems){var n=this._frameItems[a];n.item.emit("frame",new q(e,{time:n.time+=e.delta,count:n.count++}))}},_changed:function(){this._project._changed(4097),this._bounds=this._decomposed=F},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return this._pixelRatio*72},getViewSize:function(){var e=this._viewSize;return new oa(e.width,e.height,this,"setViewSize")},setViewSize:function(){var e=oe.read(arguments),a=e.subtract(this._viewSize);if(a.isZero())return;if(this._setElementSize(e.width,e.height),this._viewSize.set(e),this._changed(),this.emit("resize",{size:e,delta:a}),this._autoUpdate)this.update()},_setElementSize:function(e,a){var n=this._element;if(n){if(n.width!==e)n.width=e;if(n.height!==a)n.height=a}},getBounds:function(){if(!this._bounds)this._bounds=this._matrix.inverted()._transformBounds(new re(new U,this._viewSize));return this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return $e.isInView(this._element)},isInserted:function(){return $e.isInserted(this._element)},getPixelSize:function(e){var a=this._element,n;if(a){var o=a.parentNode,r=Y.createElement("div");r.style.fontSize=e,o.appendChild(r),n=parseFloat($e.getStyles(r).fontSize),o.removeChild(r)}else n=parseFloat(n);return n},getTextWidth:function(e,a){return 0}},q.each(["rotate","scale","shear","skew"],function(e){var a=e==="rotate";this[e]=function(){var n=arguments,o=(a?q:U).read(n),r=U.read(n,0,{readNull:!0});return this.transform(new Ze()[e](o,r||this.getCenter(!0)))}},{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var e=new Ze;return this.transform(e.translate.apply(e,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var e=U.read(arguments);this.translate(this.getCenter().subtract(e))},getZoom:function(){var e=this._decompose().scaling;return(e.x+e.y)/2},setZoom:function(e){this.transform(new Ze().scale(e/this.getZoom(),this.getCenter()))},getRotation:function(){return this._decompose().rotation},setRotation:function(e){var a=this.getRotation();if(a!=null&&e!=null)this.rotate(e-a)},getScaling:function(){var e=this._decompose().scaling;return new qe(e.x,e.y,this,"setScaling")},setScaling:function(){var e=this.getScaling(),a=U.read(arguments,0,{clone:!0,readNull:!0});if(e&&a)this.scale(a.x/e.x,a.y/e.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var e=this._matrix;e.set.apply(e,arguments)},transform:function(e){this._matrix.append(e)},scrollBy:function(){this.translate(U.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(U.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(U.read(arguments))},getEventPoint:function(e){return this.viewToProject(Ae.getOffset(e,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(e,a){if(Y&&typeof a==="string")a=Y.getElementById(a);var n=j?Ya:Be;return new n(e,a)}}},new function(){if(!j)return;var e,a,n=!1,o=!1;function r(Q){var y=Ae.getTarget(Q);return y.getAttribute&&Be._viewsById[y.getAttribute("id")]}function i(){var Q=Be._focused;if(!Q||!Q.isVisible()){for(var y=0,X=Be._views.length;y<X;y++)if((Q=Be._views[y]).isVisible()){Be._focused=a=Q;break}}}function u(Q,y,X){Q._handleMouseEvent("mousemove",y,X)}var c=j.navigator,m,t,E;if(c.pointerEnabled||c.msPointerEnabled)m="pointerdown MSPointerDown",t="pointermove MSPointerMove",E="pointerup pointercancel MSPointerUp MSPointerCancel";else if(m="touchstart",t="touchmove",E="touchend touchcancel",!(("ontouchstart"in j)&&c.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)))m+=" mousedown",t+=" mousemove",E+=" mouseup";var I={},p={mouseout:function(Q){var y=Be._focused,X=Ae.getRelatedTarget(Q);if(y&&(!X||X.nodeName==="HTML")){var V=Ae.getOffset(Q,y._element),W=V.x,G=Math.abs,P=G(W),ne=33554432,Re=P-ne;V.x=G(Re)<P?Re*(W<0?-1:1):W,u(y,Q,y.viewToProject(V))}},scroll:i};I[m]=function(Q){var y=Be._focused=r(Q);if(!n)n=!0,y._handleMouseEvent("mousedown",Q)},p[t]=function(Q){var y=Be._focused;if(!o){var X=r(Q);if(X){if(y!==X){if(y)u(y,Q);if(!e)e=y;y=Be._focused=a=X}}else if(a&&a===y){if(e&&!e.isInserted())e=null;y=Be._focused=e,e=null,i()}}if(y)u(y,Q)},p[m]=function(){o=!0},p[E]=function(Q){var y=Be._focused;if(y&&n)y._handleMouseEvent("mouseup",Q);o=n=!1},Ae.add(Y,p),Ae.add(j,{load:i});var d=!1,N=!1,v={doubleclick:"click",mousedrag:"mousemove"},g=!1,Z,f,k,_,D,w,J,T,$;function M(Q,y,X,V,W,G,P){var ne=!1,Re;function me(be,se){if(be.responds(se)){if(!Re)Re=new un(se,V,W,y||be,G?W.subtract(G):null);if(be.emit(se,Re)){if(d=!0,Re.prevented)N=!0;if(Re.stopped)return ne=!0}}else{var _e=v[se];if(_e)return me(be,_e)}}while(Q&&Q!==P){if(me(Q,X))break;Q=Q._parent}return ne}function x(Q,y,X,V,W,G){return Q._project.removeOn(X),N=d=!1,w&&M(w,null,X,V,W,G)||y&&y!==w&&!y.isDescendant(w)&&M(y,null,X==="mousedrag"?"mousemove":X,V,W,G,w)||M(Q,w||y||Q,X,V,W,G)}var B={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:I,_handleMouseEvent:function(Q,y,X){var V=this._itemEvents,W=V.native[Q],G=Q==="mousemove",P=this._scope.tool,ne=this;function Re(Ne){return V.virtual[Ne]||ne.responds(Ne)||P&&P.responds(Ne)}if(G&&n&&Re("mousedrag"))Q="mousedrag";if(!X)X=this.getEventPoint(y);var me=this.getBounds().contains(X),be=W&&me&&ne._project.hitTest(X,{tolerance:0,fill:!0,stroke:!0}),se=be&&be.item||null,_e=!1,te={};if(te[Q.substr(5)]=!0,W&&se!==D){if(D)M(D,null,"mouseleave",y,X);if(se)M(se,null,"mouseenter",y,X);D=se}if(g^me)M(this,null,me?"mouseenter":"mouseleave",y,X),Z=me?this:null,_e=!0;if((me||te.drag)&&!X.equals(k))x(this,se,G?Q:"mousemove",y,X,k),_e=!0;if(g=me,te.down&&me||te.up&&f){if(x(this,se,Q,y,X,f),te.down){if($=se===J&&Date.now()-T<300,_=J=se,!N&&se){var Je=se;while(Je&&!Je.responds("mousedrag"))Je=Je._parent;if(Je)w=se}f=X}else if(te.up){if(!N&&se===_)T=Date.now(),x(this,se,$?"doubleclick":"click",y,X,f),$=!1;_=w=null}g=!1,_e=!0}if(k=X,_e&&P)d=P._handleMouseEvent(Q,y,X,te)||d;if(y.cancelable!==!1&&(d&&!te.move||te.down&&Re("mouseup")))y.preventDefault()},_handleKeyEvent:function(Q,y,X,V){var W=this._scope,G=W.tool,P;function ne(Re){if(Re.responds(Q))ve=W,Re.emit(Q,P=P||new cn(Q,y,X,V))}if(this.isVisible()){if(ne(this),G&&G.responds(Q))ne(G)}},_countItemEvent:function(Q,y){var X=this._itemEvents,V=X.native,W=X.virtual;for(var G in B)V[G]=(V[G]||0)+(B[G][Q]||0)*y;W[Q]=(W[Q]||0)+y},statics:{updateFocus:i,_resetState:function(){n=o=d=g=!1,e=a=Z=f=k=_=D=w=J=T=$=null}}}}),Ya=Be.extend({_class:"CanvasView",initialize:function e(a,n){if(!(n instanceof j.HTMLCanvasElement)){var o=oe.read(arguments,1);if(o.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+q.slice(arguments,1));n=Se.getCanvas(o)}var r=this._context=n.getContext("2d");if(r.save(),this._pixelRatio=1,!/^off|false$/.test(O.getAttribute(n,"hidpi"))){var i=j.devicePixelRatio||1,u=$e.getPrefixed(r,"backingStorePixelRatio")||1;this._pixelRatio=i/u}Be.call(this,a,n),this._needsUpdate=!0},remove:function e(){return this._context.restore(),e.base.call(this)},_setElementSize:function e(a,n){var o=this._pixelRatio;if(e.base.call(this,a*o,n*o),o!==1){var r=this._element,i=this._context;if(!O.hasAttribute(r,"resize")){var u=r.style;u.width=a+"px",u.height=n+"px"}i.restore(),i.save(),i.scale(o,o)}},getContext:function(){return this._context},getPixelSize:function e(a){var n=ve.agent,o;if(n&&n.firefox)o=e.base.call(this,a);else{var r=this._context,i=r.font;r.font=a+" serif",o=parseFloat(r.font),r.font=i}return o},getTextWidth:function(e,a){var n=this._context,o=n.font,r=0;n.font=e;for(var i=0,u=a.length;i<u;i++)r=Math.max(r,n.measureText(a[i]).width);return n.font=o,r},update:function(){if(!this._needsUpdate)return!1;var e=this._project,a=this._context,n=this._viewSize;if(a.clearRect(0,0,n.width+1,n.height+1),e)e.draw(a,this._matrix,this._pixelRatio);return this._needsUpdate=!1,!0}}),wa=q.extend({_class:"Event",initialize:function e(a){this.event=a,this.type=a&&a.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return Ka.modifiers}}),cn=wa.extend({_class:"KeyEvent",initialize:function e(a,n,o,r){this.type=a,this.event=n,this.key=o,this.character=r},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),Ka=new function(){var e={"\t":"tab"," ":"space","\b":"backspace","\x7F":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},a={tab:"\t",space:" ",enter:"\r"},n={},o={},r,i,u=new q({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var t=ve&&ve.agent;return t&&t.mac?this.meta:this.control}}});function c(t){var E=t.key||t.keyIdentifier;return E=/^U\+/.test(E)?String.fromCharCode(parseInt(E.substr(2),16)):/^Arrow[A-Z]/.test(E)?E.substr(5):E==="Unidentified"||E===F?String.fromCharCode(t.keyCode):E,e[E]||(E.length>1?q.hyphenate(E):E.toLowerCase())}function m(t,E,I,p){var d=t?"keydown":"keyup",N=Be._focused,v;if(n[E]=t,t)o[E]=I;else delete o[E];if(E.length>1&&(v=q.camelize(E))in u){u[v]=t;var g=ve&&ve.agent;if(v==="meta"&&g&&g.mac)if(t)r={};else{for(var Z in r)if(Z in o)m(!1,Z,r[Z],p);r=null}}else if(t&&r)r[E]=I;if(N)N._handleKeyEvent(t?"keydown":"keyup",p,E,I)}return Ae.add(Y,{keydown:function(t){var E=c(t),I=ve&&ve.agent;if(E.length>1||I&&(I.chrome&&(t.altKey||I.mac&&t.metaKey||!I.mac&&t.ctrlKey)))m(!0,E,a[E]||(E.length>1?"":E),t);else i=E},keypress:function(t){if(i){var E=c(t),I=t.charCode,p=I>=32?String.fromCharCode(I):E.length>1?"":E;if(E!==i)E=p.toLowerCase();m(!0,E,p,t),i=null}},keyup:function(t){var E=c(t);if(E in o)m(!1,E,o[E],t)}}),Ae.add(j,{blur:function(t){for(var E in o)m(!1,E,o[E],t)}}),{modifiers:u,isDown:function(t){return!!n[t]}}},un=wa.extend({_class:"MouseEvent",initialize:function e(a,n,o,r,i){this.type=a,this.event=n,this.point=o,this.target=r,this.delta=i},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),Er=wa.extend({_class:"ToolEvent",_item:null,initialize:function e(a,n,o){this.tool=a,this.type=n,this.event=o},_choosePoint:function(e,a){return e?e:a?a.clone():null},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(e){this._point=e},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(e){this._lastPoint=e},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(e){this._downPoint=e},getMiddlePoint:function(){if(!this._middlePoint&&this.tool._lastPoint)return this.tool._point.add(this.tool._lastPoint).divide(2);return this._middlePoint},setMiddlePoint:function(e){this._middlePoint=e},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(e){this._delta=e},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(e){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=e},getItem:function(){if(!this._item){var e=this.tool._scope.project.hitTest(this.getPoint());if(e){var a=e.item,n=a._parent;while(/^(Group|CompoundPath)$/.test(n._class))a=n,n=n._parent;this._item=a}}return this._item},setItem:function(e){this._item=e},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),Oi=ke.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function e(a){ke.call(this),this._moveCount=-1,this._downCount=-1,this.set(a)},getMinDistance:function(){return this._minDistance},setMinDistance:function(e){if(this._minDistance=e,e!=null&&this._maxDistance!=null&&e>this._maxDistance)this._maxDistance=e},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(e){if(this._maxDistance=e,this._minDistance!=null&&e!=null&&e<this._minDistance)this._minDistance=e},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(e){this._minDistance=this._maxDistance=e},_handleMouseEvent:function(e,a,n,o){if(ve=this._scope,o.drag&&!this.responds(e))e="mousemove";var r=o.move||o.drag,i=this.responds(e),u=this.minDistance,c=this.maxDistance,m=!1,t=this;function E(p,d){var N=n,v=r?t._point:t._downPoint||N;if(r){if(t._moveCount>=0&&N.equals(v))return!1;if(v&&(p!=null||d!=null)){var g=N.subtract(v),Z=g.getLength();if(Z<(p||0))return!1;if(d)N=v.add(g.normalize(Math.min(Z,d)))}t._moveCount++}if(t._point=N,t._lastPoint=v||N,o.down)t._moveCount=-1,t._downPoint=N,t._downCount++;return!0}function I(){if(i)m=t.emit(e,new Er(t,e,a))||m}if(o.down)E(),I();else if(o.up)E(null,c),I();else if(i)while(E(u,c))I();return m}}),pr=q.extend(S,{_class:"Tween",statics:{easings:new q({linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<0.5?2*e*e:-1+2*(2-e)*e},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<0.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<0.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<0.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}})},initialize:function e(a,n,o,r,i,u){this.object=a;var c=typeof i,m=c==="function";this.type=m?c:c==="string"?i:"linear",this.easing=m?i:e.easings[this.type],this.duration=r,this.running=!1,this._then=null,this._startTime=null;var t=n||o;if(this._keys=t?Object.keys(t):[],this._parsedKeys=this._parseKeys(this._keys),this._from=t&&this._getState(n),this._to=t&&this._getState(o),u!==!1)this.start()},then:function(e){return this._then=e,this},start:function(){return this._startTime=null,this.running=!0,this},stop:function(){return this.running=!1,this},update:function(e){if(this.running){if(e>=1)e=1,this.running=!1;var a=this.easing(e),n=this._keys,o=function(E){return typeof E==="function"?E(a,e):E};for(var r=0,i=n&&n.length;r<i;r++){var u=n[r],c=o(this._from[u]),m=o(this._to[u]),t=c&&m&&c.__add&&m.__add?m.__subtract(c).__multiply(a).__add(c):(m-c)*a+c;this._setProperty(this._parsedKeys[u],t)}if(this.responds("update"))this.emit("update",new q({progress:e,factor:a}));if(!this.running&&this._then)this._then(this.object)}return this},_events:{onUpdate:{}},_handleFrame:function(e){var a=this._startTime,n=a?(e-a)/this.duration:0;if(!a)this._startTime=e;this.update(n)},_getState:function(e){var a=this._keys,n={};for(var o=0,r=a.length;o<r;o++){var i=a[o],u=this._parsedKeys[i],c=this._getProperty(u),m;if(e){var t=this._resolveValue(c,e[i]);this._setProperty(u,t),m=this._getProperty(u),m=m&&m.clone?m.clone():m,this._setProperty(u,c)}else m=c&&c.clone?c.clone():c;n[i]=m}return n},_resolveValue:function(e,a){if(a){if(Array.isArray(a)&&a.length===2){var n=a[0];return n&&n.match&&n.match(/^[+\-\*\/]=/)?this._calculate(e,n[0],a[1]):a}else if(typeof a==="string"){var o=a.match(/^[+\-*/]=(.*)/);if(o){var r=JSON.parse(o[1].replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2": '));return this._calculate(e,a[0],r)}}}return a},_calculate:function(e,a,n){return ve.PaperScript.calculateBinary(e,a,n)},_parseKeys:function(e){var a={};for(var n=0,o=e.length;n<o;n++){var r=e[n],i=r.replace(/\.([^.]*)/g,"/$1").replace(/\[['"]?([^'"\]]*)['"]?\]/g,"/$1");a[r]=i.split("/")}return a},_getProperty:function(e,a){var n=this.object;for(var o=0,r=e.length-(a||0);o<r&&n;o++)n=n[e[o]];return n},_setProperty:function(e,a){var n=this._getProperty(e,1);if(n)n[e[e.length-1]]=a}}),br={request:function(e){var a=new A.XMLHttpRequest;if(a.open((e.method||"get").toUpperCase(),e.url,q.pick(e.async,!0)),e.mimeType)a.overrideMimeType(e.mimeType);return a.onload=function(){var n=a.status;if(n===0||n===200){if(e.onLoad)e.onLoad.call(a,a.responseText)}else a.onerror()},a.onerror=function(){var n=a.status,o='Could not load "'+e.url+'" (Status: '+n+")";if(e.onError)e.onError(o,n);else throw new Error(o)},a.send(null)}},Se=q.exports.CanvasProvider={canvases:[],getCanvas:function(e,a,n){if(!j)return null;var o,r=!0;if(typeof e==="object")a=e.height,e=e.width;if(this.canvases.length)o=this.canvases.pop();else o=Y.createElement("canvas"),r=!1;var i=o.getContext("2d",n||{});if(!i)throw new Error("Canvas "+o+" is unable to provide a 2D context.");if(o.width===e&&o.height===a){if(r)i.clearRect(0,0,e+1,a+1)}else o.width=e,o.height=a;return i.save(),o},getContext:function(e,a,n){var o=this.getCanvas(e,a,n);return o?o.getContext("2d",n||{}):null},release:function(e){var a=e&&e.canvas?e.canvas:e;if(a&&a.getContext)a.getContext("2d").restore(),this.canvases.push(a)}},Zn=new function(){var{min:e,max:a,abs:n}=Math,o,r,i,u,c,m,t,E,I,p,d;function N(D,w,J){return 0.2989*D+0.587*w+0.114*J}function v(D,w,J,M){var $=M-N(D,w,J);I=D+$,p=w+$,d=J+$;var M=N(I,p,d),x=e(I,p,d),B=a(I,p,d);if(x<0){var Q=M-x;I=M+(I-M)*M/Q,p=M+(p-M)*M/Q,d=M+(d-M)*M/Q}if(B>255){var y=255-M,X=B-M;I=M+(I-M)*y/X,p=M+(p-M)*y/X,d=M+(d-M)*y/X}}function g(D,w,J){return a(D,w,J)-e(D,w,J)}function Z(D,w,J,T){var $=[D,w,J],M=a(D,w,J),x=e(D,w,J),B;if(x=x===D?0:x===w?1:2,M=M===D?0:M===w?1:2,B=e(x,M)===0?a(x,M)===1?2:1:0,$[M]>$[x])$[B]=($[B]-$[x])*T/($[M]-$[x]),$[M]=T;else $[B]=$[M]=0;$[x]=0,I=$[0],p=$[1],d=$[2]}var f={multiply:function(){I=c*o/255,p=m*r/255,d=t*i/255},screen:function(){I=c+o-c*o/255,p=m+r-m*r/255,d=t+i-t*i/255},overlay:function(){I=c<128?2*c*o/255:255-2*(255-c)*(255-o)/255,p=m<128?2*m*r/255:255-2*(255-m)*(255-r)/255,d=t<128?2*t*i/255:255-2*(255-t)*(255-i)/255},"soft-light":function(){var D=o*c/255;I=D+c*(255-(255-c)*(255-o)/255-D)/255,D=r*m/255,p=D+m*(255-(255-m)*(255-r)/255-D)/255,D=i*t/255,d=D+t*(255-(255-t)*(255-i)/255-D)/255},"hard-light":function(){I=o<128?2*o*c/255:255-2*(255-o)*(255-c)/255,p=r<128?2*r*m/255:255-2*(255-r)*(255-m)/255,d=i<128?2*i*t/255:255-2*(255-i)*(255-t)/255},"color-dodge":function(){I=c===0?0:o===255?255:e(255,255*c/(255-o)),p=m===0?0:r===255?255:e(255,255*m/(255-r)),d=t===0?0:i===255?255:e(255,255*t/(255-i))},"color-burn":function(){I=c===255?255:o===0?0:a(0,255-(255-c)*255/o),p=m===255?255:r===0?0:a(0,255-(255-m)*255/r),d=t===255?255:i===0?0:a(0,255-(255-t)*255/i)},darken:function(){I=c<o?c:o,p=m<r?m:r,d=t<i?t:i},lighten:function(){I=c>o?c:o,p=m>r?m:r,d=t>i?t:i},difference:function(){if(I=c-o,I<0)I=-I;if(p=m-r,p<0)p=-p;if(d=t-i,d<0)d=-d},exclusion:function(){I=c+o*(255-c-c)/255,p=m+r*(255-m-m)/255,d=t+i*(255-t-t)/255},hue:function(){Z(o,r,i,g(c,m,t)),v(I,p,d,N(c,m,t))},saturation:function(){Z(c,m,t,g(o,r,i)),v(I,p,d,N(c,m,t))},luminosity:function(){v(c,m,t,N(o,r,i))},color:function(){v(o,r,i,N(c,m,t))},add:function(){I=e(c+o,255),p=e(m+r,255),d=e(t+i,255)},subtract:function(){I=a(c-o,0),p=a(m-r,0),d=a(t-i,0)},average:function(){I=(c+o)/2,p=(m+r)/2,d=(t+i)/2},negation:function(){I=255-n(255-o-c),p=255-n(255-r-m),d=255-n(255-i-t)}},k=this.nativeModes=q.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(D){this[D]=!0},{}),_=Se.getContext(1,1,{willReadFrequently:!0});if(_)q.each(f,function(D,w){var J=w==="darken",T=!1;_.save();try{if(_.fillStyle=J?"#300":"#a00",_.fillRect(0,0,1,1),_.globalCompositeOperation=w,_.globalCompositeOperation===w)_.fillStyle=J?"#a00":"#300",_.fillRect(0,0,1,1),T=_.getImageData(0,0,1,1).data[0]!==J?170:51}catch($){}_.restore(),k[w]=T}),Se.release(_);this.process=function(D,w,J,T,$){var M=w.canvas,x=D==="normal";if(x||k[D]){if(J.save(),J.setTransform(1,0,0,1,0,0),J.globalAlpha=T,!x)J.globalCompositeOperation=D;J.drawImage(M,$.x,$.y),J.restore()}else{var B=f[D];if(!B)return;var Q=J.getImageData($.x,$.y,M.width,M.height),y=Q.data,X=w.getImageData(0,0,M.width,M.height).data;for(var V=0,W=y.length;V<W;V+=4){o=X[V],c=y[V],r=X[V+1],m=y[V+1],i=X[V+2],t=y[V+2],u=X[V+3],E=y[V+3],B();var G=u*T/255,P=1-G;y[V]=G*I+P*c,y[V+1]=G*p+P*m,y[V+2]=G*d+P*t,y[V+3]=u*T+P*E}J.putImageData(Q,$.x,$.y)}}},Ge=new function(){var e="http://www.w3.org/2000/svg",a="http://www.w3.org/2000/xmlns",n="http://www.w3.org/1999/xlink",o={href:n,xlink:a,xmlns:a+"/","xmlns:xlink":a+"/"};function r(c,m,t){return u(Y.createElementNS(e,c),m,t)}function i(c,m){var t=o[m],E=t?c.getAttributeNS(t,m):c.getAttribute(m);return E==="null"?null:E}function u(c,m,t){for(var E in m){var I=m[E],p=o[E];if(typeof I==="number"&&t)I=t.number(I);if(p)c.setAttributeNS(p,E,I);else c.setAttribute(E,I)}return c}return{svg:e,xmlns:a,xlink:n,create:r,get:i,set:u}},Kn=q.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(e,a){return!a&&(e instanceof Pe||e instanceof ie||e instanceof He)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(e,a){var n=q.capitalize(a),o=e[2];this[a]={type:e[1],property:a,attribute:e[0],toSVG:o,fromSVG:o&&q.each(o,function(r,i){this[r]=i},{}),exportFilter:e[3],get:"get"+n,set:"set"+n}},{});new function(){var e;function a(f,k,_){var D=new q,w=f.getTranslation();if(k){var J;if(f.isInvertible())f=f._shiftless(),J=f._inverseTransform(w),w=null;else J=new U;D[_?"cx":"x"]=J.x,D[_?"cy":"y"]=J.y}if(!f.isIdentity()){var T=f.decompose();if(T){var $=[],M=T.rotation,x=T.scaling,B=T.skewing;if(w&&!w.isZero())$.push("translate("+e.point(w)+")");if(M)$.push("rotate("+e.number(M)+")");if(!ee.isZero(x.x-1)||!ee.isZero(x.y-1))$.push("scale("+e.point(x)+")");if(B.x)$.push("skewX("+e.number(B.x)+")");if(B.y)$.push("skewY("+e.number(B.y)+")");D.transform=$.join(" ")}else D.transform="matrix("+f.getValues().join(",")+")"}return D}function n(f,k){var _=a(f._matrix),D=f._children,w=Ge.create("g",_,e);for(var J=0,T=D.length;J<T;J++){var $=D[J],M=g($,k);if(M)if($.isClipMask()){var x=Ge.create("clipPath");x.appendChild(M),N($,x,"clip"),Ge.set(w,{"clip-path":"url(#"+x.id+")"})}else w.appendChild(M)}return w}function o(f,k){var _=a(f._matrix,!0),D=f.getSize(),w=f.getImage();return _.x-=D.width/2,_.y-=D.height/2,_.width=D.width,_.height=D.height,_.href=k.embedImages==!1&&w&&w.src||f.toDataURL(),Ge.create("image",_,e)}function r(f,k){var _=k.matchShapes;if(_){var D=f.toShape(!1);if(D)return i(D,k)}var w=f._segments,J=w.length,T,$=a(f._matrix);if(_&&J>=2&&!f.hasHandles())if(J>2){T=f._closed?"polygon":"polyline";var M=[];for(var x=0;x<J;x++)M.push(e.point(w[x]._point));$.points=M.join(" ")}else{T="line";var B=w[0]._point,Q=w[1]._point;$.set({x1:B.x,y1:B.y,x2:Q.x,y2:Q.y})}else T="path",$.d=f.getPathData(null,k.precision);return Ge.create(T,$,e)}function i(f){var{_type:k,_radius:_}=f,D=a(f._matrix,!0,k!=="rectangle");if(k==="rectangle"){k="rect";var w=f._size,J=w.width,T=w.height;if(D.x-=J/2,D.y-=T/2,D.width=J,D.height=T,_.isZero())_=null}if(_)if(k==="circle")D.r=_;else D.rx=_.width,D.ry=_.height;return Ge.create(k,D,e)}function u(f,k){var _=a(f._matrix),D=f.getPathData(null,k.precision);if(D)_.d=D;return Ge.create("path",_,e)}function c(f,k){var _=a(f._matrix,!0),D=f._definition,w=d(D,"symbol"),J=D._item,T=J.getStrokeBounds();if(!w)w=Ge.create("symbol",{viewBox:e.rectangle(T)}),w.appendChild(g(J,k)),N(D,w,"symbol");return _.href="#"+w.id,_.x+=T.x,_.y+=T.y,_.width=T.width,_.height=T.height,_.overflow="visible",Ge.create("use",_,e)}function m(f){var k=d(f,"color");if(!k){var _=f.getGradient(),D=_._radial,w=f.getOrigin(),J=f.getDestination(),T;if(D){T={cx:w.x,cy:w.y,r:w.getDistance(J)};var $=f.getHighlight();if($)T.fx=$.x,T.fy=$.y}else T={x1:w.x,y1:w.y,x2:J.x,y2:J.y};T.gradientUnits="userSpaceOnUse",k=Ge.create((D?"radial":"linear")+"Gradient",T,e);var M=_._stops;for(var x=0,B=M.length;x<B;x++){var Q=M[x],y=Q._color,X=y.getAlpha(),V=Q._offset;if(T={offset:V==null?x/(B-1):V},y)T["stop-color"]=y.toCSS(!0);if(X<1)T["stop-opacity"]=X;k.appendChild(Ge.create("stop",T,e))}N(f,k,"color")}return"url(#"+k.id+")"}function t(f){var k=Ge.create("text",a(f._matrix,!0),e);return k.textContent=f._content,k}var E={Group:n,Layer:n,Raster:o,Path:r,Shape:i,CompoundPath:u,SymbolItem:c,PointText:t};function I(f,k,_){var D={},w=!_&&f.getParent(),J=[];if(f._name!=null)D.id=f._name;if(q.each(Kn,function(T){var{get:$,type:M}=T,x=f[$]();if(T.exportFilter?T.exportFilter(f,x):!w||!q.equals(w[$](),x)){if(M==="color"&&x!=null){var B=x.getAlpha();if(B<1)D[T.attribute+"-opacity"]=B}if(M==="style")J.push(T.attribute+": "+x);else D[T.attribute]=x==null?"none":M==="color"?x.gradient?m(x,f):x.toCSS(!0):M==="array"?x.join(","):M==="lookup"?T.toSVG[x]:x}}),J.length)D.style=J.join(";");if(D.opacity===1)delete D.opacity;if(!f._visible)D.visibility="hidden";return Ge.set(k,D,e)}var p;function d(f,k){if(!p)p={ids:{},svgs:{}};return f&&p.svgs[k+"-"+(f._id||f.__id||(f.__id=Te.get("svg")))]}function N(f,k,_){if(!p)d();var D=p.ids[_]=(p.ids[_]||0)+1;k.id=_+"-"+D,p.svgs[_+"-"+(f._id||f.__id)]=k}function v(f,k){var _=f,D=null;if(p){_=f.nodeName.toLowerCase()==="svg"&&f;for(var w in p.svgs){if(!D){if(!_)_=Ge.create("svg"),_.appendChild(f);D=_.insertBefore(Ge.create("defs"),_.firstChild)}D.appendChild(p.svgs[w])}p=null}return k.asString?new A.XMLSerializer().serializeToString(_):_}function g(f,k,_){var D=E[f._class],w=D&&D(f,k);if(w){var J=k.onExport;if(J)w=J(f,w,k)||w;var T=JSON.stringify(f._data);if(T&&T!=="{}"&&T!=="null")w.setAttribute("data-paper-data",T)}return w&&I(f,w,_)}function Z(f){if(!f)f={};return e=new ce(f.precision),f}de.inject({exportSVG:function(f){return f=Z(f),v(g(this,f,!0),f)}}),ba.inject({exportSVG:function(f){f=Z(f);var k=this._children,_=this.getView(),D=q.pick(f.bounds,"view"),w=f.matrix||D==="view"&&_._matrix,J=w&&Ze.read([w]),T=D==="view"?new re([0,0],_.getViewSize()):D==="content"?de._getBounds(k,J,{stroke:!0}).rect:re.read([D],0,{readNull:!0}),$={version:"1.1",xmlns:Ge.svg,"xmlns:xlink":Ge.xlink};if(T){if($.width=T.width,$.height=T.height,T.x||T.x===0||T.y||T.y===0)$.viewBox=e.rectangle(T)}var M=Ge.create("svg",$,e),x=M;if(J&&!J.isIdentity())x=M.appendChild(Ge.create("g",a(J),e));for(var B=0,Q=k.length;B<Q;B++)x.appendChild(g(k[B],f,!0));return v(M,f)}})},new function(){var e={},a;function n(k,_,D,w,J,T){var $=Ge.get(k,_)||T,M=$==null?w?null:D?"":0:D?$:parseFloat($);return/%\s*$/.test($)?M/100*(J?1:a[/x|^width/.test(_)?"width":"height"]):M}function o(k,_,D,w,J,T,$){return _=n(k,_||"x",!1,w,J,T),D=n(k,D||"y",!1,w,J,$),w&&(_==null||D==null)?null:new U(_,D)}function r(k,_,D,w,J){return _=n(k,_||"width",!1,w,J),D=n(k,D||"height",!1,w,J),w&&(_==null||D==null)?null:new oe(_,D)}function i(k,_,D){return k==="none"?null:_==="number"?parseFloat(k):_==="array"?k?k.split(/[\s,]+/g).map(parseFloat):[]:_==="color"?g(k)||k:_==="lookup"?D[k]:k}function u(k,_,D,w){var J=k.childNodes,T=_==="clippath",$=_==="defs",M=new Ke,x=M._project,B=x._currentStyle,Q=[];if(!T&&!$)M=v(M,k,w),x._currentStyle=M._style.clone();if(w){var y=k.querySelectorAll("defs");for(var X=0,V=y.length;X<V;X++)Z(y[X],D,!1)}for(var X=0,V=J.length;X<V;X++){var W=J[X],G;if(W.nodeType===1&&!/^defs$/i.test(W.nodeName)&&(G=Z(W,D,!1))&&!(G instanceof z))Q.push(G)}if(M.addChildren(Q),T)M=v(M.reduce(),k,w);if(x._currentStyle=B,T||$)M.remove(),M=null;return M}function c(k,_){var D=k.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),w=[];for(var J=0,T=D.length;J<T;J+=2)w.push(new U(parseFloat(D[J]),parseFloat(D[J+1])));var $=new Ee(w);if(_==="polygon")$.closePath();return $}function m(k){return Pe.create(k.getAttribute("d"))}function t(k,_){var D=(n(k,"href",!0)||"").substring(1),w=_==="radialgradient",J;if(D){if(J=e[D].getGradient(),J._radial^w)J=J.clone(),J._radial=w}else{var T=k.childNodes,$=[];for(var M=0,x=T.length;M<x;M++){var B=T[M];if(B.nodeType===1)$.push(v(new Fe,B))}J=new fe($,w)}var Q,y,X,V=n(k,"gradientUnits",!0)!=="userSpaceOnUse";if(w)Q=o(k,"cx","cy",!1,V,"50%","50%"),y=Q.add(n(k,"r",!1,!1,V,"50%"),0),X=o(k,"fx","fy",!0,V);else Q=o(k,"x1","y1",!1,V,"0%","0%"),y=o(k,"x2","y2",!1,V,"100%","0%");var W=v(new K(J,Q,y,X),k);return W._scaleToBounds=V,null}var E={"#document":function(k,_,D,w){var J=k.childNodes;for(var T=0,$=J.length;T<$;T++){var M=J[T];if(M.nodeType===1)return Z(M,D,w)}},g:u,svg:u,clippath:u,polygon:c,polyline:c,path:m,lineargradient:t,radialgradient:t,image:function(k){var _=new H(n(k,"href",!0));return _.on("load",function(){var D=r(k);this.setSize(D);var w=o(k).add(D.divide(2));this._matrix.append(new Ze().translate(w))}),_},symbol:function(k,_,D,w){return new z(u(k,_,D,w),!0)},defs:u,use:function(k){var _=(n(k,"href",!0)||"").substring(1),D=e[_],w=o(k);return D?D instanceof z?D.place(w):D.clone().translate(w):null},circle:function(k){return new ie.Circle(o(k,"cx","cy"),n(k,"r"))},ellipse:function(k){return new ie.Ellipse({center:o(k,"cx","cy"),radius:r(k,"rx","ry")})},rect:function(k){return new ie.Rectangle(new re(o(k),r(k)),r(k,"rx","ry"))},line:function(k){return new Ee.Line(o(k,"x1","y1"),o(k,"x2","y2"))},text:function(k){var _=new Oe(o(k).add(o(k,"dx","dy")));return _.setContent(k.textContent.trim()||""),_},switch:u};function I(k,_,D,w){if(k.transform){var J=(w.getAttribute(D)||"").split(/\)\s*/g),T=new Ze;for(var $=0,M=J.length;$<M;$++){var x=J[$];if(!x)break;var B=x.split(/\(\s*/),Q=B[0],y=B[1].split(/[\s,]+/g);for(var X=0,V=y.length;X<V;X++)y[X]=parseFloat(y[X]);switch(Q){case"matrix":T.append(new Ze(y[0],y[1],y[2],y[3],y[4],y[5]));break;case"rotate":T.rotate(y[0],y[1]||0,y[2]||0);break;case"translate":T.translate(y[0],y[1]||0);break;case"scale":T.scale(y);break;case"skewX":T.skew(y[0],0);break;case"skewY":T.skew(0,y[0]);break}}k.transform(T)}}function p(k,_,D){var w=D==="fill-opacity"?"getFillColor":"getStrokeColor",J=k[w]&&k[w]();if(J)J.setAlpha(parseFloat(_))}var d=q.set(q.each(Kn,function(k){this[k.attribute]=function(_,D){if(_[k.set]){if(_[k.set](i(D,k.type,k.fromSVG)),k.type==="color"){var w=_[k.get]();if(w){if(w._scaleToBounds){var J=_.getBounds();w.transform(new Ze().translate(J.getPoint()).scale(J.getSize()))}}}}}},{}),{id:function(k,_){if(e[_]=k,k.setName)k.setName(_)},"clip-path":function(k,_){var D=g(_);if(D)if(D=D.clone(),D.setClipMask(!0),k instanceof Ke)k.insertChild(0,D);else return new Ke(D,k)},gradientTransform:I,transform:I,"fill-opacity":p,"stroke-opacity":p,visibility:function(k,_){if(k.setVisible)k.setVisible(_==="visible")},display:function(k,_){if(k.setVisible)k.setVisible(_!==null)},"stop-color":function(k,_){if(k.setColor)k.setColor(_)},"stop-opacity":function(k,_){if(k._color)k._color.setAlpha(parseFloat(_))},offset:function(k,_){if(k.setOffset){var D=_.match(/(.*)%$/);k.setOffset(D?D[1]/100:parseFloat(_))}},viewBox:function(k,_,D,w,J){var T=new re(i(_,"array")),$=r(w,null,null,!0),M,x;if(k instanceof Ke){var B=$?$.divide(T.getSize()):1,x=new Ze().scale(B).translate(T.getPoint().negate());M=k}else if(k instanceof z){if($)T.setSize($);M=k._item}if(M){if(N(w,"overflow",J)!=="visible"){var Q=new ie.Rectangle(T);Q.setClipMask(!0),M.addChild(Q)}if(x)M.transform(x)}}});function N(k,_,D){var w=k.attributes[_],J=w&&w.value;if(!J&&k.style){var T=q.camelize(_);if(J=k.style[T],!J&&D.node[T]!==D.parent[T])J=D.node[T]}return!J?F:J==="none"?null:J}function v(k,_,D){var w=_.parentNode,J={node:$e.getStyles(_)||{},parent:!D&&!/^defs$/i.test(w.tagName)&&$e.getStyles(w)||{}};return q.each(d,function(T,$){var M=N(_,$,J);k=M!==F&&T(k,M,$,_,J)||k}),k}function g(k){var _=k&&k.match(/\((?:["'#]*)([^"')]+)/),D=_&&_[1],w=D&&e[j?D.replace(j.location.href.split("#")[0]+"#",""):D];if(w&&w._scaleToBounds)w=w.clone(),w._scaleToBounds=!0;return w}function Z(k,_,D){var w=k.nodeName.toLowerCase(),J=w!=="#document",T=Y.body,$,M,x;if(D&&J)a=ve.getView().getSize(),a=r(k,null,null,!0)||a,$=Ge.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),M=k.parentNode,x=k.nextSibling,$.appendChild(k),T.appendChild($);var B=ve.settings,Q=B.applyMatrix,y=B.insertItems;B.applyMatrix=!1,B.insertItems=!1;var X=E[w],V=X&&X(k,w,_,D)||null;if(B.insertItems=y,B.applyMatrix=Q,V){if(J&&!(V instanceof Ke))V=v(V,k,D);var W=_.onImport,G=J&&k.getAttribute("data-paper-data");if(W)V=W(k,V,_)||V;if(_.expandShapes&&V instanceof ie)V.remove(),V=V.toPath();if(G)V._data=JSON.parse(G)}if($){if(T.removeChild($),M)if(x)M.insertBefore(k,x);else M.appendChild(k)}if(D){if(e={},V&&q.pick(_.applyMatrix,Q))V.matrix.apply(!0,!0)}return V}function f(k,_,D){if(!k)return null;_=typeof _==="function"?{onLoad:_}:_||{};var w=ve,J=null;function T(B){try{var Q=typeof B==="object"?B:new A.DOMParser().parseFromString(B.trim(),"image/svg+xml");if(!Q.nodeName)throw Q=null,new Error("Unsupported SVG source: "+k);if(ve=w,J=Z(Q,_,!0),!_||_.insert!==!1)D._insertItem(F,J);var y=_.onLoad;if(y)y(J,B)}catch(X){$(X)}}function $(B,Q){var y=_.onError;if(y)y(B,Q);else throw new Error(B)}if(typeof k==="string"&&!/^[\s\S]*</.test(k)){var M=Y.getElementById(k);if(M)T(M);else br.request({url:k,async:!0,onLoad:T,onError:$})}else if(typeof File!=="undefined"&&k instanceof File){var x=new FileReader;return x.onload=function(){T(x.result)},x.onerror=function(){$(x.error)},x.readAsText(k)}else T(k);return J}de.inject({importSVG:function(k,_){return f(k,_,this)}}),ba.inject({importSVG:function(k,_){return this.activate(),f(k,_,this)}})};var ve=new(O.inject(q.exports,{Base:q,Numerical:ee,Key:Ka,DomEvent:Ae,DomElement:$e,document:Y,window:j,Symbol:z,PlacedSymbol:ae}));if(ve.agent.node)(()=>({}))(ve);if(typeof define==="function"&&define.amd)define("paper",ve);else if(typeof l==="object"&&l)l.exports=ve;return ve}.call(s,typeof self==="object"?self:null)}),Ys=Fn(Mn(),1),An=Fn(Mn(),1),b=new Ra.Generator("JavaScript");b.addReservedWords("break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,in,instanceof,new,return,super,switch,this,throw,try,typeof,var,void,while,with,yield,enum,implements,interface,let,package,private,protected,public,static,await,null,true,false,arguments,"+Object.getOwnPropertyNames(globalThis).join(","));b.ORDER_ATOMIC=0;b.ORDER_NEW=1.1;b.ORDER_MEMBER=1.2;b.ORDER_FUNCTION_CALL=2;b.ORDER_INCREMENT=3;b.ORDER_DECREMENT=3;b.ORDER_BITWISE_NOT=4.1;b.ORDER_UNARY_PLUS=4.2;b.ORDER_UNARY_NEGATION=4.3;b.ORDER_LOGICAL_NOT=4.4;b.ORDER_TYPEOF=4.5;b.ORDER_VOID=4.6;b.ORDER_DELETE=4.7;b.ORDER_DIVISION=5.1;b.ORDER_MULTIPLICATION=5.2;b.ORDER_MODULUS=5.3;b.ORDER_SUBTRACTION=6.1;b.ORDER_ADDITION=6.2;b.ORDER_BITWISE_SHIFT=7;b.ORDER_RELATIONAL=8;b.ORDER_IN=8;b.ORDER_INSTANCEOF=8;b.ORDER_EQUALITY=9;b.ORDER_BITWISE_AND=10;b.ORDER_BITWISE_XOR=11;b.ORDER_BITWISE_OR=12;b.ORDER_LOGICAL_AND=13;b.ORDER_LOGICAL_OR=14;b.ORDER_CONDITIONAL=15;b.ORDER_ASSIGNMENT=16;b.ORDER_COMMA=17;b.ORDER_NONE=99;b.ORDER_OVERRIDES=[[b.ORDER_FUNCTION_CALL,b.ORDER_MEMBER],[b.ORDER_FUNCTION_CALL,b.ORDER_FUNCTION_CALL],[b.ORDER_MEMBER,b.ORDER_MEMBER],[b.ORDER_MEMBER,b.ORDER_FUNCTION_CALL],[b.ORDER_LOGICAL_NOT,b.ORDER_LOGICAL_NOT],[b.ORDER_MULTIPLICATION,b.ORDER_MULTIPLICATION],[b.ORDER_ADDITION,b.ORDER_ADDITION],[b.ORDER_LOGICAL_AND,b.ORDER_LOGICAL_AND],[b.ORDER_LOGICAL_OR,b.ORDER_LOGICAL_OR]];b.init=function(s){if(b.definitions_=Object.create(null),b.functionNames_=Object.create(null),!b.variableDB_)b.variableDB_=new Ra.Names(b.RESERVED_WORDS_);else b.variableDB_.reset();b.variableDB_.setVariableMap(s.getVariableMap());var l=[],R=s.getAllVariables();for(var A=0;A<R.length;A++){if(R[A].type===Ra.BROADCAST_MESSAGE_VARIABLE_TYPE)continue;const j=b.variableDB_.getName(R[A].getId(),Ra.Variables.NAME_TYPE);if(R[A].type===Ra.LIST_VARIABLE_TYPE)l.push(`let ${j}${Ra.LIST_VARIABLE_TYPE} = [];`);else l.push(`let ${j} = 0;`)}var F=Ra.Variables.allDeveloperVariables(s);for(var A=0;A<F.length;A++){const Y=b.variableDB_.getName(F[A],Ra.Names.DEVELOPER_VARIABLE_TYPE);if(R[A].type===Ra.LIST_VARIABLE_TYPE)l.push(`let ${Y}${Ra.LIST_VARIABLE_TYPE} = [];`);else l.push(`let ${Y} = 0;`)}if(l.length)b.definitions_.variables=l.join("\n")};b.finish=function(s){var l=[];for(var R in b.definitions_)l.push(b.definitions_[R]);return delete b.definitions_,delete b.functionNames_,b.variableDB_.reset(),l.join("\n\n")+"\n\n\n"+s};b.scrubNakedValue=function(s){return s+";\n"};b.quote_=function(s){return s=s.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/'/g,"\\'"),"'"+s+"'"};b.HAT_CODE="/* HatCode */";b.scrub_=function(s,l){var R="";if(!s.outputConnection?.targetConnection){var A=s.getCommentText();if(A=Ra.utils.wrap(A,b.COMMENT_WRAP-3),A)if(s.getProcedureDef)R+="/**\n"+b.prefixLines(A+"\n"," * ")+" */\n";else R+=b.prefixLines(A+"\n","// ");for(var F=0;F<s.inputList.length;F++)if(s.inputList[F].type==Ra.INPUT_VALUE){var j=s.inputList[F].connection.targetBlock();if(j){var A=b.allNestedComments(j);if(A)R+=b.prefixLines(A,"// ")}}}if(s.startHat_){const Y=s.nextConnection&&s.nextConnection.targetBlock();let q=b.blockToCode(Y);if(q)q=b.prefixLines(q,b.INDENT),l=l.replace(b.HAT_CODE,q);return R+l}if(s.parentBlock_){const Y=s.nextConnection&&s.nextConnection.targetBlock(),q=b.blockToCode(Y);return R+l+q}return""};b.getAdjusted=function(s,l,R,A,F){var j=R||0,Y=F||b.ORDER_NONE;if(s.workspace.options.oneBasedIndex)j--;var q=s.workspace.options.oneBasedIndex?"1":"0";if(j>0)var S=b.valueToCode(s,l,b.ORDER_ADDITION)||q;else if(j<0)var S=b.valueToCode(s,l,b.ORDER_SUBTRACTION)||q;else if(A)var S=b.valueToCode(s,l,b.ORDER_UNARY_NEGATION)||q;else var S=b.valueToCode(s,l,Y)||q;if(Ra.isNumber(S)){if(S=parseFloat(S)+j,A)S=-S}else{if(j>0){S=S+" + "+j;var O=b.ORDER_ADDITION}else if(j<0){S=S+" - "+-j;var O=b.ORDER_SUBTRACTION}if(A){if(j)S="-("+S+")";else S="-"+S;var O=b.ORDER_UNARY_NEGATION}if(O=Math.floor(O),Y=Math.floor(Y),O&&Y>=O)S="("+S+")"}return S};b.colour_picker=(s)=>{return[b.quote_(s.getFieldValue("COLOUR")),b.ORDER_ATOMIC]};var Qa="if (abort || !runtime.running) break;\n",en=`  await runtime.nextFrame();\n  ${Qa}`;b.control_wait=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);const R=b.valueToCode(s,"DURATION",b.ORDER_NONE)||0;return l+=`await runtime.sleep(runtime.number(${R}));\n${Qa}`,l};b.control_repeat=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);let R=b.statementToCode(s,"SUBSTACK")||"";if(b.STATEMENT_SUFFIX)R=b.prefixLines(b.injectId(b.STATEMENT_SUFFIX,s),b.INDENT)+R;const A=b.valueToCode(s,"TIMES",b.ORDER_NONE)||0;return l+=`for (let _ = 0; _ < runtime.number(${A}); _++) {\n${R}${en}}\n${Qa}`,l};b.control_forever=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);let R=b.statementToCode(s,"SUBSTACK")||"";if(b.STATEMENT_SUFFIX)R=b.prefixLines(b.injectId(b.STATEMENT_SUFFIX,s),b.INDENT)+R;return l+=`while (true) {\n${R}${en}}\n${Qa}`,l};b.control_if=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);let R=b.statementToCode(s,"SUBSTACK")||"";if(b.STATEMENT_SUFFIX)R=b.prefixLines(b.injectId(b.STATEMENT_SUFFIX,s),b.INDENT)+R;const A=b.valueToCode(s,"CONDITION",b.ORDER_NONE)||"false";if(l+=`if (${A}) {\n${R}}\n`,s.getInput("SUBSTACK2")){if(R=b.statementToCode(s,"SUBSTACK2")||"",b.STATEMENT_SUFFIX)R=b.prefixLines(b.injectId(b.STATEMENT_SUFFIX,s),b.INDENT)+R;l+=`else {\n${R}}\n`}return l};b.control_if_else=b.control_if;b.control_wait_until=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);const R=b.valueToCode(s,"CONDITION",b.ORDER_NONE)||"false";return l+=`while (!(${R})) {\n${en}}\n${Qa}`,l};b.control_repeat_until=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);let R=b.statementToCode(s,"SUBSTACK")||"";if(b.STATEMENT_SUFFIX)R=b.prefixLines(b.injectId(b.STATEMENT_SUFFIX,s),b.INDENT)+R;const A=b.valueToCode(s,"CONDITION",b.ORDER_NONE)||"false";return l+=`while (!(${A})) {\n${R}${en}}\n${Qa}`,l};b.control_while=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);let R=b.statementToCode(s,"SUBSTACK")||"";if(b.STATEMENT_SUFFIX)R=b.prefixLines(b.injectId(b.STATEMENT_SUFFIX,s),b.INDENT)+R;const A=b.valueToCode(s,"CONDITION",b.ORDER_NONE)||"false";return l+=`while (${A}) {\n${R}${en}}\n${Qa}`,l};b.control_stop=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);switch(s.getFieldValue("STOP_OPTION")){case"all":l+="runtime.stop();\n";break;case"this script":l+="return done();\n";break;case"other scripts in sprite":l+="abort = true;\n";break}return l};b.data_variable=(s)=>{return[b.variableDB_.getName(s.getFieldValue("VARIABLE"),Ye.Variables.NAME_TYPE),b.ORDER_CONDITIONAL]};b.data_setvariableto=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);const R=b.variableDB_.getName(s.getFieldValue("VARIABLE"),Ye.Variables.NAME_TYPE),A=b.valueToCode(s,"VALUE",b.ORDER_NONE)||'""';return l+=`${R} = ${A};\n`,l};b.data_changevariableby=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);const R=b.variableDB_.getName(s.getFieldValue("VARIABLE"),Ye.Variables.NAME_TYPE),A=b.valueToCode(s,"VALUE",b.ORDER_NONE)||0;return l+=`${R} = runtime.number(${R}) + runtime.number(${A});\n`,l};b.data_listcontents=(s)=>{return[b.variableDB_.getName(s.getFieldValue("LIST"),Ye.Variables.NAME_TYPE)+Ye.LIST_VARIABLE_TYPE,b.ORDER_ATOMIC]};b.data_addtolist=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);const R=b.variableDB_.getName(s.getFieldValue("LIST"),Ye.Variables.NAME_TYPE)+Ye.LIST_VARIABLE_TYPE,A=b.valueToCode(s,"ITEM",b.ORDER_NONE)||'""';return l+=`${R}.push(${A});\n`,l};b.data_deleteoflist=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);const R=b.variableDB_.getName(s.getFieldValue("LIST"),Ye.Variables.NAME_TYPE)+Ye.LIST_VARIABLE_TYPE,A=b.valueToCode(s,"INDEX",b.ORDER_NONE)||1;return l+=`${R}.splice(runtime.index(${A}, ${R}.length), 1);\n`,l};b.data_deletealloflist=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);const R=b.variableDB_.getName(s.getFieldValue("LIST"),Ye.Variables.NAME_TYPE)+Ye.LIST_VARIABLE_TYPE;return l+=`${R}.length = 0;\n`,l};b.data_insertatlist=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);const R=b.variableDB_.getName(s.getFieldValue("LIST"),Ye.Variables.NAME_TYPE)+Ye.LIST_VARIABLE_TYPE,A=b.valueToCode(s,"INDEX",b.ORDER_NONE)||1,F=b.valueToCode(s,"ITEM",b.ORDER_NONE)||'""';return l+=`${R}.splice(runtime.index(${A}, ${R}.length), 0, ${F});\n`,l};b.data_replaceitemoflist=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);const R=b.variableDB_.getName(s.getFieldValue("LIST"),Ye.Variables.NAME_TYPE)+Ye.LIST_VARIABLE_TYPE,A=b.valueToCode(s,"INDEX",b.ORDER_NONE)||1,F=b.valueToCode(s,"ITEM",b.ORDER_NONE)||'""';return l+=`${R}.splice(runtime.index(${A}, ${R}.length), 1, ${F});\n`,l};b.data_itemoflist=(s)=>{const l=b.variableDB_.getName(s.getFieldValue("LIST"),Ye.Variables.NAME_TYPE)+Ye.LIST_VARIABLE_TYPE,R=b.valueToCode(s,"INDEX",b.ORDER_NONE)||1;return[`(${l}[runtime.index(${R}, ${l}.length)] || '""')`,b.ORDER_CONDITIONAL]};b.data_itemnumoflist=(s)=>{const l=b.variableDB_.getName(s.getFieldValue("LIST"),Ye.Variables.NAME_TYPE)+Ye.LIST_VARIABLE_TYPE,R=b.valueToCode(s,"ITEM",b.ORDER_NONE)||'""';return[`(${l}.indexOf(${R}) + 1)`,b.ORDER_NONE]};b.data_lengthoflist=(s)=>{return[`${b.variableDB_.getName(s.getFieldValue("LIST"),Ye.Variables.NAME_TYPE)+Ye.LIST_VARIABLE_TYPE}.length`,b.ORDER_MEMBER]};b.data_listcontainsitem=(s)=>{const l=b.variableDB_.getName(s.getFieldValue("LIST"),Ye.Variables.NAME_TYPE)+Ye.LIST_VARIABLE_TYPE,R=b.valueToCode(s,"ITEM",b.ORDER_NONE)||'""';return[`${l}.includes(${R})`,b.ORDER_FUNCTION_CALL]};var Os="if (abort || !runtime.running) break;\n",Un=`async (done) => {\ndo {\n${b.HAT_CODE}} while (false);\ndone();\n}`;b.event_whenflagclicked=()=>{return`runtime.when('start', ${Un});\n`};b.event_whengreaterthan=(s)=>{const l=s.getFieldValue("WHENGREATERTHANMENU"),R=b.valueToCode(s,"VALUE",b.ORDER_NONE)||10;return`runtime.whenGreaterThen('${l}', runtime.number(${R}), ${Un});\n`};b.event_whenbroadcastreceived=(s)=>{return`runtime.when('message:${b.variableDB_.getName(s.getFieldValue("BROADCAST_OPTION"),$o.Variables.NAME_TYPE)}', ${Un});\n`};b.event_broadcast_menu=(s)=>{return[b.variableDB_.getName(s.getFieldValue("BROADCAST_OPTION"),$o.Variables.NAME_TYPE),b.ORDER_ATOMIC]};b.event_broadcast=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);const R=b.valueToCode(s,"BROADCAST_INPUT",b.ORDER_NONE)||"message1";return l+=`runtime.fire('message:${R}')\n`,l};b.event_broadcastandwait=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);const R=b.valueToCode(s,"BROADCAST_INPUT",b.ORDER_NONE)||"message1";return l+=`await runtime.fire('message:${R}')\n${Os}`,l};b.math_number=(s)=>{let l=parseFloat(s.getFieldValue("NUM")),R;if(l===1/0)l="Infinity",R=b.ORDER_FUNCTION_CALL;else if(l===-1/0)l="-Infinity",R=b.ORDER_UNARY_SIGN;else if(Number.isNaN(l))l="NaN",R=b.ORDER_UNARY_SIGN;else R=l<0?b.ORDER_UNARY_SIGN:b.ORDER_ATOMIC;return[l,R]};b.math_integer=(s)=>{const l=parseInt(s.getFieldValue("NUM")),R=l<0?b.ORDER_UNARY_SIGN:b.ORDER_ATOMIC;return[l,R]};b.math_whole_number=(s)=>{return[Math.abs(parseInt(s.getFieldValue("NUM"))),b.ORDER_ATOMIC]};b.math_positive_number=(s)=>{let l=parseFloat(s.getFieldValue("NUM")),R;if(l===1/0)l="Infinity",R=b.ORDER_FUNCTION_CALL;else if(l===-1/0)l="-Infinity",R=b.ORDER_FUNCTION_CALL;else if(Number.isNaN(l))l="NaN",R=b.ORDER_FUNCTION_CALL;else l=l<0?0:l,R=b.ORDER_ATOMIC;return[l,R]};b.math_angle=(s)=>{let l=parseFloat(s.getFieldValue("NUM")),R;if(l==1/0)l="Infinity",R=b.ORDER_FUNCTION_CALL;else if(l==-1/0)l="-Infinity",R=b.ORDER_UNARY_SIGN;else l=l%360,l=l<0?l+360:l,R=b.ORDER_ATOMIC;return[l,R]};b.operator_add=(s)=>{const l=b.valueToCode(s,"NUM1",b.ORDER_NONE)||0,R=b.valueToCode(s,"NUM2",b.ORDER_NONE)||0;return[`(runtime.number(${l}) + runtime.number(${R}))`,b.ORDER_SUBTRACTION]};b.operator_subtract=(s)=>{const l=b.valueToCode(s,"NUM1",b.ORDER_NONE)||0,R=b.valueToCode(s,"NUM2",b.ORDER_NONE)||0;return[`(runtime.number(${l}) - runtime.number(${R}))`,b.ORDER_ADDITION]};b.operator_multiply=(s)=>{const l=b.valueToCode(s,"NUM1",b.ORDER_NONE)||0,R=b.valueToCode(s,"NUM2",b.ORDER_NONE)||0;return[`(runtime.number(${l}) * runtime.number(${R}))`,b.ORDER_MULTIPLICATION]};b.operator_divide=(s)=>{const l=b.valueToCode(s,"NUM1",b.ORDER_NONE)||0,R=b.valueToCode(s,"NUM2",b.ORDER_NONE)||0;return[`(runtime.number(${l}) / runtime.number(${R}))`,b.ORDER_DIVISION]};b.operator_random=(s)=>{const l=b.valueToCode(s,"FROM",b.ORDER_NONE)||0,R=b.valueToCode(s,"TO",b.ORDER_NONE)||0;return[`runtime.random(${l}, ${R})`,b.ORDER_FUNCTION_CALL]};b.operator_gt=(s)=>{const l=b.valueToCode(s,"OPERAND1",b.ORDER_NONE)||0,R=b.valueToCode(s,"OPERAND2",b.ORDER_NONE)||0;return[`(runtime.number(${l}) > runtime.number(${R}))`,b.ORDER_RELATIONAL]};b.operator_lt=(s)=>{const l=b.valueToCode(s,"OPERAND1",b.ORDER_NONE)||0,R=b.valueToCode(s,"OPERAND2",b.ORDER_NONE)||0;return[`(runtime.number(${l}) < runtime.number(${R}))`,b.ORDER_RELATIONAL]};b.operator_equals=(s)=>{const l=b.valueToCode(s,"OPERAND1",b.ORDER_NONE)||0,R=b.valueToCode(s,"OPERAND2",b.ORDER_NONE)||0;return[`(${l} == ${R})`,b.ORDER_RELATIONAL]};b.operator_and=(s)=>{const l=b.valueToCode(s,"OPERAND1",b.ORDER_NONE)||0,R=b.valueToCode(s,"OPERAND2",b.ORDER_NONE)||0;return[`(${l} && ${R})`,b.ORDER_LOGICAL_AND]};b.operator_or=(s)=>{const l=b.valueToCode(s,"OPERAND1",b.ORDER_NONE)||0,R=b.valueToCode(s,"OPERAND2",b.ORDER_NONE)||0;return[`(${l} || ${R})`,b.ORDER_LOGICAL_OR]};b.operator_not=(s)=>{return[`!(${b.valueToCode(s,"OPERAND",b.ORDER_NONE)||0})`,b.ORDER_LOGICAL_NOT]};b.operator_join=(s)=>{const l=b.valueToCode(s,"STRING1",b.ORDER_NONE)||'""',R=b.valueToCode(s,"STRING2",b.ORDER_NONE)||'""';return[`(String(${l}) + String(${R}))`,b.ORDER_ATOMIC]};b.operator_letter_of=(s)=>{const l=b.valueToCode(s,"LETTER",b.ORDER_NONE)||0;return[`(String(${b.valueToCode(s,"STRING",b.ORDER_NONE)||'""'}).at(${l} - 1) || '')`,b.ORDER_ATOMIC]};b.operator_length=(s)=>{return[`String(${b.valueToCode(s,"STRING",b.ORDER_NONE)||'""'}).length`,b.ORDER_MEMBER]};b.operator_contains=(s)=>{const l=b.valueToCode(s,"STRING1",b.ORDER_NONE)||'""',R=b.valueToCode(s,"STRING2",b.ORDER_NONE)||'""';return[`String(${l}).includes(String(${R}))`,b.ORDER_FUNCTION_CALL]};b.operator_mod=(s)=>{const l=b.valueToCode(s,"NUM1",b.ORDER_NONE)||0,R=b.valueToCode(s,"NUM2",b.ORDER_NONE)||0;return[`(runtime.number(${l}) % runtime.number(${R}))`,b.ORDER_MODULUS]};b.operator_round=(s)=>{return[`Math.round(${b.valueToCode(s,"NUM",b.ORDER_NONE)||0})`,b.ORDER_FUNCTION_CALL]};b.operator_mathop=(s)=>{const l=b.valueToCode(s,"NUM",b.ORDER_NONE)||0,R=s.getFieldValue("OPERATOR");let A="";if(R==="ceiling")A+=`Math.ceil(runtime.number(${l}))`;else if(R==="sin"||R==="cos"||R==="tan")A+=`Math.${R}(Math.PI * runtime.number(${l}) / 180)`;else if(R==="asin"||R==="acos"||R==="atan")A+=`(Math.${R}(runtime.number(${l})) * 180 / Math.PI)`;else if(R==="ln")A+=`Math.log(runtime.number(${l}))`;else if(R==="log")A+=`Math.log10(runtime.number(${l}))`;else if(R==="e ^")A+=`Math.exp(runtime.number(${l}))`;else if(R==="10 ^")A+=`Math.pow(10, runtime.number(${l}))`;else A+=`Math.${R}(runtime.number(${l}))`;return[A,b.ORDER_FUNCTION_CALL]};b.procedures_definition=(s)=>{};b.procedures_call=(s)=>{};b.procedures_prototype=(s)=>{};b.procedures_declaration=(s)=>{};b.argument_reporter_boolean=(s)=>{};b.argument_reporter_string_number=(s)=>{};b.argument_editor_boolean=(s)=>{};b.argument_editor_string_number=(s)=>{};b.sensing_timer=(s)=>{return["runtime.time",b.ORDER_FUNCTION_CALL]};b.sensing_resettimer=(s)=>{return"runtime.resetTimer()\n"};b.text=(s)=>{const l=s.getFieldValue("TEXT");return[l.length===0||isNaN(l)?b.quote_(l):+l,b.ORDER_ATOMIC]};var Ss=new Set([ma.Events.BLOCK_CHANGE,ma.Events.BLOCK_CREATE,ma.Events.BLOCK_DELETE,ma.Events.BLOCK_MOVE,ma.Events.COMMENT_CHANGE,ma.Events.COMMENT_CREATE,ma.Events.COMMENT_DELETE,ma.Events.COMMENT_MOVE,ma.Events.VAR_CREATE,ma.Events.VAR_DELETE,ma.Events.VAR_RENAME]),Ks=function(s){console&&console.warn&&console.warn(s)},Ue=function(){Ue.init.call(this)},pn=function(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)},Fo=function(s){return s._maxListeners===void 0?Ue.defaultMaxListeners:s._maxListeners},Mo=function(s,l,R,A){var F,j,Y;if(pn(R),j=s._events,j===void 0?(j=s._events=Object.create(null),s._eventsCount=0):(j.newListener!==void 0&&(s.emit("newListener",l,R.listener?R.listener:R),j=s._events),Y=j[l]),Y===void 0)Y=j[l]=R,++s._eventsCount;else if(typeof Y=="function"?Y=j[l]=A?[R,Y]:[Y,R]:A?Y.unshift(R):Y.push(R),F=Fo(s),F>0&&Y.length>F&&!Y.warned){Y.warned=!0;var q=new Error("Possible EventEmitter memory leak detected. "+Y.length+" "+String(l)+" listeners added. Use emitter.setMaxListeners() to increase limit");q.name="MaxListenersExceededWarning",q.emitter=s,q.type=l,q.count=Y.length,Ks(q)}return s},zs=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)},Uo=function(s,l,R){var A={fired:!1,wrapFn:void 0,target:s,type:l,listener:R},F=zs.bind(A);return F.listener=R,A.wrapFn=F,F},xo=function(s,l,R){var A=s._events;if(A===void 0)return[];var F=A[l];return F===void 0?[]:typeof F=="function"?R?[F.listener||F]:[F]:R?Ps(F):Qo(F,F.length)},yo=function(s){var l=this._events;if(l!==void 0){var R=l[s];if(typeof R=="function")return 1;if(R!==void 0)return R.length}return 0},Qo=function(s,l){for(var R=new Array(l),A=0;A<l;++A)R[A]=s[A];return R},Cs=function(s,l){for(;l+1<s.length;l++)s[l]=s[l+1];s.pop()},Ps=function(s){for(var l=new Array(s.length),R=0;R<l.length;++R)l[R]=s[R].listener||s[R];return l},Ga=typeof Reflect=="object"?Reflect:null,qo=Ga&&typeof Ga.apply=="function"?Ga.apply:function(s,l,R){return Function.prototype.apply.call(s,l,R)},En;Ga&&typeof Ga.ownKeys=="function"?En=Ga.ownKeys:Object.getOwnPropertySymbols?En=function(s){return Object.getOwnPropertyNames(s).concat(Object.getOwnPropertySymbols(s))}:En=function(s){return Object.getOwnPropertyNames(s)};var Xo=Number.isNaN||function(s){return s!==s};Ue.EventEmitter=Ue;Ue.prototype._events=void 0;Ue.prototype._eventsCount=0;Ue.prototype._maxListeners=void 0;var Jo=10;Object.defineProperty(Ue,"defaultMaxListeners",{enumerable:!0,get:function(){return Jo},set:function(s){if(typeof s!="number"||s<0||Xo(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");Jo=s}});Ue.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Ue.prototype.setMaxListeners=function(s){if(typeof s!="number"||s<0||Xo(s))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+s+".");return this._maxListeners=s,this};Ue.prototype.getMaxListeners=function(){return Fo(this)};Ue.prototype.emit=function(s){for(var l=[],R=1;R<arguments.length;R++)l.push(arguments[R]);var A=s==="error",F=this._events;if(F!==void 0)A=A&&F.error===void 0;else if(!A)return!1;if(A){var j;if(l.length>0&&(j=l[0]),j instanceof Error)throw j;var Y=new Error("Unhandled error."+(j?" ("+j.message+")":""));throw Y.context=j,Y}var q=F[s];if(q===void 0)return!1;if(typeof q=="function")qo(q,this,l);else for(var S=q.length,O=Qo(q,S),R=0;R<S;++R)qo(O[R],this,l);return!0};Ue.prototype.addListener=function(s,l){return Mo(this,s,l,!1)};Ue.prototype.on=Ue.prototype.addListener;Ue.prototype.prependListener=function(s,l){return Mo(this,s,l,!0)};Ue.prototype.once=function(s,l){return pn(l),this.on(s,Uo(this,s,l)),this};Ue.prototype.prependOnceListener=function(s,l){return pn(l),this.prependListener(s,Uo(this,s,l)),this};Ue.prototype.removeListener=function(s,l){var R,A,F,j,Y;if(pn(l),A=this._events,A===void 0)return this;if(R=A[s],R===void 0)return this;if(R===l||R.listener===l)--this._eventsCount===0?this._events=Object.create(null):(delete A[s],A.removeListener&&this.emit("removeListener",s,R.listener||l));else if(typeof R!="function"){for(F=-1,j=R.length-1;j>=0;j--)if(R[j]===l||R[j].listener===l){Y=R[j].listener,F=j;break}if(F<0)return this;F===0?R.shift():Cs(R,F),R.length===1&&(A[s]=R[0]),A.removeListener!==void 0&&this.emit("removeListener",s,Y||l)}return this};Ue.prototype.off=Ue.prototype.removeListener;Ue.prototype.removeAllListeners=function(s){var l,R,A;if(R=this._events,R===void 0)return this;if(R.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):R[s]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete R[s]),this;if(arguments.length===0){var F=Object.keys(R),j;for(A=0;A<F.length;++A)j=F[A],j!=="removeListener"&&this.removeAllListeners(j);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(l=R[s],typeof l=="function")this.removeListener(s,l);else if(l!==void 0)for(A=l.length-1;A>=0;A--)this.removeListener(s,l[A]);return this};Ue.prototype.listeners=function(s){return xo(this,s,!0)};Ue.prototype.rawListeners=function(s){return xo(this,s,!1)};Ue.listenerCount=function(s,l){return typeof s.listenerCount=="function"?s.listenerCount(l):yo.call(s,l)};Ue.prototype.listenerCount=yo;Ue.prototype.eventNames=function(){return this._eventsCount>0?En(this._events):[]};var Wl=Ue.prototype,To=Fn(Mn(),1);class bn extends Ue{static DEFAULT_FPS=24;constructor(s,l=bn.DEFAULT_FPS){super();this._fps=l,this._frame_sec=1/l,this._running=!1,this._requestStop=s,this._timer=0,this._timers=[],this._data={},this._greaterThen={},this._eventsHappening={}}launch(s){new Function("runtime",s)(this)}get core(){return To.default}get data(){return this._data}get running(){return this._running}get time(){return(Date.now()-this._timer)/1000}resetTimer(){this._timer=Date.now()}when(s,l){this._eventsHappening[s]=this._eventsHappening[s]||[],this._eventsHappening[s].push(!1);const R=this._eventsHappening[s].length-1;this.on(`${s}_${R}`,l)}whenGreaterThen(s,l,R){const A=`${s}>${l}`;this._greaterThen[A]=!1,this.when(`greaterthen:${A}`,R)}emit(...s){return new Promise((l)=>{if(this.running)super.emit(...s,l)})}fire(s,...l){if(this.emit(s,...l),this._eventsHappening[s]=this._eventsHappening[s]||[],this._eventsHappening[s].length>0)return Promise.race(this._eventsHappening[s].map(async(R,A)=>{if(!R)this._eventsHappening[s][A]=!0,await this.emit(`${s}_${A}`,...l),this._eventsHappening[s][A]=!1}));return Promise.resolve()}_handleFrameForGreaterThen(s){const l=Object.keys(this._greaterThen);for(let R of l){const[A,F]=R.split(">");if(A==="TIMER"){const j=this.time>parseFloat(F);if(j&&!this._greaterThen[R])this.fire(`greaterthen:${R}`);this._greaterThen[R]=j}}s()}async _handleStart(){while(this.running){if(!To.default.project){this.stop();break}await this.nextFrame(),this.fire("frame")}}start(){this._running=!0,this.on("frame",this._handleFrameForGreaterThen.bind(this)),this.on("start",this._handleStart.bind(this)),this.fire("start"),this.resetTimer()}async stop(){this.emit("stop"),this._running=!1,await this.nextFrame(),this._timers.forEach(clearTimeout),this._timers.length=0,this._requestStop()}sleep(s){return new Promise((l)=>this._timers.push(setTimeout(l,s*1000)))}nextFrame(){return this.sleep(this._frame_sec)}random(s=1,l=10){const R=Math.ceil(Math.min(s,l)),A=Math.floor(Math.max(s,l));return Math.floor(Math.random()*(A-R+1))+R}number(s,l=0){return isNaN(s)?l:+s}index(s,l){let R=this.number(s)-1;return R%=l,R+=l,R%l}clamp(s,l,R){return Math.min(Math.max(s,l),R)}}var pe=Ys.default;var an="if (abort || !runtime.running) break;\n";b.motion_attack=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);const R=b.valueToCode(s,"DIRECTION",b.ORDER_NONE)||0,A=b.valueToCode(s,"DISTANCE",b.ORDER_NONE)||100;return l+=`await tank.util.attack(${R}, ${A});\n${an}`,l};b.motion_move=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);const R=b.valueToCode(s,"DIRECTION",b.ORDER_NONE)||0,A=b.valueToCode(s,"SPEED",b.ORDER_NONE)||100;return l+=`await tank.util.move(${R}, ${A});\n${an}`,l};b.motion_turnright=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);const R=b.valueToCode(s,"DEGREES",b.ORDER_NONE)||0;return l+=`await tank.util.turnRight(${R});\n${an}`,l};b.motion_turnleft=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);const R=b.valueToCode(s,"DEGREES",b.ORDER_NONE)||0;return l+=`await tank.util.turnLeft(${R});\n${an}`,l};b.motion_pointindirection=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);const R=b.valueToCode(s,"DIRECTION",b.ORDER_NONE)||0;return l+=`await tank.util.setDirection(+${R});\n${an}`,l};b.motion_setspeed=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);const R=b.valueToCode(s,"SPEED",b.ORDER_NONE)||0;return l+=`tank.util.speed = ${R};\n`,l};b.motion_stop=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);return l+="tank.util.speed = 0;\n",l};b.motion_xposition=(s)=>{return["tank.util.x",b.ORDER_ATOMIC]};b.motion_yposition=(s)=>{return["tank.util.y",b.ORDER_ATOMIC]};b.motion_speed=(s)=>{return["tank.util.currentSpeed",b.ORDER_ATOMIC]};b.motion_direction=(s)=>{return["tank.util.direction",b.ORDER_ATOMIC]};b.sensing_scanwidth=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);const R=b.valueToCode(s,"WIDTH",b.ORDER_NONE)||5;return l+=`tank.util.scanWidth = ${R};\n`,l};b.sensing_scan=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);const R=b.valueToCode(s,"DIRECTION",b.ORDER_NONE)||0;return l+=`(await tank.util.scan(${R}) !== Infinity)`,[l,b.ORDER_EQUALITY]};b.sensing_scandistance=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);const R=b.valueToCode(s,"DIRECTION",b.ORDER_NONE)||0;return l+=`(await tank.util.scan(${R}))`,[l,b.ORDER_FUNCTION_CALL]};b.sensing_health=(s)=>{let l="";if(b.STATEMENT_PREFIX)l+=b.injectId(b.STATEMENT_PREFIX,s);return l+="tank.util.health",[l,b.ORDER_FUNCTION_CALL]};var ei=()=>`
  <category name="%{BKY_CATEGORY_MOTION}" id="motion" colour="#4C97FF" secondaryColour="#3373CC">
    <block type="motion_attack">
      <value name="DIRECTION">
        <shadow type="math_angle">
          <field name="NUM">90</field>
        </shadow>
      </value>
      <value name="DISTANCE">
        <shadow type="math_number">
          <field name="NUM">200</field>
        </shadow>
      </value>
    </block>
    <block type="motion_move">
      <value name="DIRECTION">
        <shadow type="math_angle">
          <field name="NUM">90</field>
        </shadow>
      </value>
      <value name="SPEED">
        <shadow type="math_number">
          <field name="NUM">100</field>
        </shadow>
      </value>
    </block>
    ${fa}
    <block type="motion_turnright">
      <value name="DEGREES">
        <shadow type="math_number">
          <field name="NUM">15</field>
        </shadow>
      </value>
    </block>
    <block type="motion_turnleft">
      <value name="DEGREES">
        <shadow type="math_number">
          <field name="NUM">15</field>
        </shadow>
      </value>
    </block>
    <block type="motion_pointindirection">
      <value name="DIRECTION">
        <shadow type="math_angle">
          <field name="NUM">90</field>
        </shadow>
      </value>
    </block>
    ${fa}
    <block type="motion_setspeed">
      <value name="SPEED">
        <shadow type="math_number">
          <field name="NUM">50</field>
        </shadow>
      </value>
    </block>
    <block type="motion_stop"/>
    ${fa}
    <block type="motion_speed"/>
    <block type="motion_direction"/>
    ${xn}
  </category>
`,ai=()=>`
  <category name="%{BKY_CATEGORY_SENSING}" id="sensing" colour="#4CBFE6" secondaryColour="#2E8EB8">
    <block type="sensing_scanwidth">
      <value name="WIDTH">
        <shadow type="math_number">
          <field name="NUM">5</field>
        </shadow>
      </value>
    </block>
    <block type="sensing_scan">
      <value name="DIRECTION">
        <shadow type="math_angle">
          <field name="NUM">90</field>
        </shadow>
      </value>
    </block>
    <block type="sensing_scandistance">
      <value name="DIRECTION">
        <shadow type="math_angle">
          <field name="NUM">90</field>
        </shadow>
      </value>
    </block>
    ${fa}
    <block type="sensing_health"/>
    ${fa}
    <block id="timer" type="sensing_timer"/>
    <block type="sensing_resettimer"/>
    ${xn}
  </category>
`,ni=()=>`
  <category name="%{BKY_CATEGORY_OPERATORS}" id="operators" colour="#40BF4A" secondaryColour="#389438">
    <block type="operator_add">
      <value name="NUM1">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
      <value name="NUM2">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
    </block>
    <block type="operator_subtract">
      <value name="NUM1">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
      <value name="NUM2">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
    </block>
    <block type="operator_multiply">
      <value name="NUM1">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
      <value name="NUM2">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
    </block>
    <block type="operator_divide">
      <value name="NUM1">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
      <value name="NUM2">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
    </block>
    ${fa}
    <block type="operator_random">
      <value name="FROM">
        <shadow type="math_number">
          <field name="NUM">1</field>
        </shadow>
      </value>
      <value name="TO">
        <shadow type="math_number">
          <field name="NUM">10</field>
        </shadow>
      </value>
    </block>
    ${fa}
    <block type="operator_gt">
      <value name="OPERAND1">
        <shadow type="text">
          <field name="TEXT"/>
        </shadow>
      </value>
      <value name="OPERAND2">
        <shadow type="text">
          <field name="TEXT">50</field>
        </shadow>
      </value>
    </block>
    <block type="operator_lt">
      <value name="OPERAND1">
        <shadow type="text">
          <field name="TEXT"/>
        </shadow>
      </value>
      <value name="OPERAND2">
        <shadow type="text">
          <field name="TEXT">50</field>
        </shadow>
      </value>
    </block>
    <block type="operator_equals">
      <value name="OPERAND1">
        <shadow type="text">
          <field name="TEXT"/>
        </shadow>
      </value>
      <value name="OPERAND2">
        <shadow type="text">
          <field name="TEXT">50</field>
        </shadow>
      </value>
    </block>
    ${fa}
    <block type="operator_and"/>
    <block type="operator_or"/>
    <block type="operator_not"/>
    ${fa}
    <block type="operator_mod">
      <value name="NUM1">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
      <value name="NUM2">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
    </block>
    <block type="operator_round">
      <value name="NUM">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
    </block>
    ${fa}
    <block type="operator_mathop">
      <value name="NUM">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
    </block>
    ${xn}
  </category>
`;function yn(){return Hs([{id:"motion",xml:ei()},{id:"sensing",xml:ai()},{id:"operators",xml:ni()}])}import{jsx as si} from"preact/jsx-runtime";var ri=kn.Content;function Qn(){const{getText:s}=oi(),l={MOTION_ATTACK:s("tankwar.blocks.motion_attack","fire in direction %1 at %2 steps"),MOTION_MOVE:s("tankwar.blocks.motion_move","forward in direction %1 at %2 % speed"),MOTION_SETSPEED:s("tankwar.blocks.motion_setspeed","set speed to %1 %"),MOTION_STOP:s("tankwar.blocks.motion_stop","stop"),MOTION_SPEED:s("tankwar.blocks.motion_speed","speed"),SENSING_SCANWIDTH:s("tankwar.blocks.sensing_scanwidth","set scan width to %1"),SENSING_SCAN:s("tankwar.blocks.sensing_scan","scan for enemy in direction %1?"),SENSING_DISTANCE:s("tankwar.blocks.sensing_distance","measure distance of enemy in direction %1"),SENSING_HEALTH:s("tankwar.blocks.sensing_health","health")},R=yn();return si(ri,{disableGenerator:!0,disableExtension:!0,messages:l,toolbox:R})}import{useState as Nn} from"preact/hooks";import{classNames as Mi} from"@blockcode/ui";import{useState as or} from"preact/hooks";import{useEditor as qi} from"@blockcode/core";var Bo="./assets/background-81dedab007c311a5.png";function Sa(s){return new Promise((l)=>{const R=new Image;R.src=s,R.addEventListener("load",()=>l(R))})}var Vo="./assets/tank_1-5797dcf7b198a48d.png";var Yo="./assets/turret_1-26017ccc46b87689.png";var jo="./assets/tank_2-337708f7538d8787.png";var Wo="./assets/turret_2-5c4bb2c458561ace.png";var Lo="./assets/tank_3-1d999a2c9dacc246.png";var Oo="./assets/turret_3-956bfba650c81c57.png";var Go="./assets/tank_4-f93afcfd2c3d1734.png";var So="./assets/turret_4-d6c2200ed4ca50b0.png";var Ko="./assets/broken-2d9779d033bbcdb5.png";var zo="./assets/bullet-80854a0e7090b0fc.png";var Co="./assets/boom1-65b37ddc26db4cbd.png";var Po="./assets/boom2-82ff355a8e0177ba.png";var Ho="./assets/boom3-703bd7bb6580e4d9.png";var Ni=20,Zi=4,fi=40,In=500,Di=70,hi=400,nn=10,Xn=50,Bn=1000,er=(s,l)=>Math.sqrt((s.x-l.x)**2+(s.y-l.y)**2),$a=(s)=>isNaN(s)?0:+s,on=(s,l,R)=>Math.min(Math.max(s,l),R),rn=(s)=>s*Math.PI/180,Aa=(s)=>parseInt((s%360+360)%360),ar=(s,l)=>Aa(s)===Aa(l);class xe{static PLACE={LEFT:{get position(){return new pe.Point(pe.view.center.x-300,pe.view.center.y)},rotation:90},RIGHT:{get position(){return new pe.Point(pe.view.center.x+300,pe.view.center.y)},rotation:-90},LEFT_TOP:{get position(){return new pe.Point(pe.view.center.x-300,pe.view.center.y-300)},rotation:135},RIGHT_TOP:{get position(){return new pe.Point(pe.view.center.x+300,pe.view.center.y-300)},rotation:-135},LEFT_BOTTOM:{get position(){return new pe.Point(pe.view.center.x-300,pe.view.center.y+300)},rotation:45},RIGHT_BOTTOM:{get position(){return new pe.Point(pe.view.center.x+300,pe.view.center.y+300)},rotation:-45}};static STYLE={PLAYER:{tank:Vo,turret:Yo},ENEMY_A:{tank:jo,turret:Wo},ENEMY_B:{tank:Lo,turret:Oo},ENEMY_C:{tank:Go,turret:So}};constructor(s,l=xe.STYLE.PLAYER,R=xe.PLACE.LEFT){this.raster=new pe.Raster({name:s,scaling:0.2,source:l.tank,position:R.position,rotation:R.rotation,visible:l===xe.STYLE.PLAYER}),this.turretRaster=new pe.Raster({scaling:0.2,source:l.turret,position:R.position,rotation:R.rotation,visible:l===xe.STYLE.PLAYER}),this.raster.util=this,this.turretRaster.owner=this,this._hidden=!0,this._lastScanDistance=0,this._imageCache={},this._timers=[],this.reset()}sleep(s){return new Promise((l)=>this._timers.push(setTimeout(l,s)))}reset(){if(this._speed=0,this._currentSpeed=0,this._health=100,this._scanWidth=Zi,this._turretReady=null,this._scanShape)this._scanShape.remove(),this._scanShape=null;if(this._bulletRaster)this._bulletRaster.remove(),this._bulletRaster=null;if(this._boomRaster)this._boomRaster.remove(),this._boomRaster=null;if(this._collideTester)this._collideTester.remove(),this._collideTester=null;clearTimeout(this._turretReady),this._timers.forEach(clearTimeout),this._timers.length=0}bringToFront(){this.raster.bringToFront(),this.turretRaster.bringToFront()}get running(){return this._running}set running(s){if(this.reset(),this._running=s,s){const l=this.raster.scaling.x*this.raster.width-5;this._collideTester=new pe.Path.Rectangle({point:[this.raster.position.x-l/2,this.raster.position.y-5],size:[l,10],applyMatrix:!1})}}get bullseye(){if(!this._bullseye)this._bullseye=Math.min(this.raster.width,this.raster.height)*this.raster.scaling.x/4;return this._bullseye}get enemies(){if(!this._enemies)this._enemies=["red","yellow","green","player"].filter((s)=>s!==this.raster.name).map((s)=>pe.project.activeLayer.children[s]);return this._enemies}set place(s){if(this.running)return;this.raster.position=this.turretRaster.position=s.position,this.raster.rotation=this.turretRaster.rotation=s.rotation,this.hidden=!1}get hidden(){return this._hidden}set hidden(s){this._hidden=s,this.raster.visible=this.turretRaster.visible=!s}async _turn(s,l){if(!ar(s.rotation,l)){let R=Aa(l)-Aa(s.rotation);if(R>180)R-=360;if(R<-180)R+=360;await s.tween({rotation:s.rotation+R},Bn*(Math.abs(R)/360))}}async attack(s,l){if(!this.running)return;if(this._bulletRaster||this.death)return;s=Math.round($a(s)),l=$a(l)-Xn,clearTimeout(this._turretReady),this._turretReady=null,await this._turn(this.turretRaster,s);const R=Aa(s),A=rn(90-R);if(!this._imageCache.buttet)this._imageCache.buttet=await Sa(zo);if(this._bulletRaster)this._bulletRaster.remove(),this._bulletRaster=null;this._bulletRaster=new pe.Raster({image:this._imageCache.buttet,position:new pe.Point(this.raster.position.x+Xn*Math.cos(A),this.raster.position.y-Xn*Math.sin(A)),rotation:this.raster.rotation,scaling:this.raster.scaling}),l=on(l,Di,hi);const F=l/2,j=nn/l/2;let Y=nn*Math.cos(A),q=nn*Math.sin(A);while(l>0){if(await this.sleep(15),l<nn)Y=l*Math.cos(A),q=l*Math.sin(A);if(l-=nn,this._bulletRaster.position.x+=Y,this._bulletRaster.position.y-=q,this._bulletRaster.scaling.x+=l>F?j:-j,this._bulletRaster.scaling.y=this._bulletRaster.scaling.x,this._bulletRaster.scaling.x<this.raster.scaling.x)this._bulletRaster.scaling=this.raster.scaling}this._boom(this._bulletRaster.position),this._collide(this._bulletRaster,(S)=>{if(er(S.position,this._bulletRaster.position)<S.util.bullseye)S.util.hurt(10);else S.util.hurt(5)}),this._bulletRaster.remove(),this._bulletRaster=null,this._turretReady=setTimeout(()=>{this._turn(this.turretRaster,this.raster.rotation),this._turretReady=null},1000)}async _boom(s){if(!this.running)return;if(!this._imageCache.booms)this._imageCache.booms=[await Sa(Co),await Sa(Po),await Sa(Ho)];if(this._boomRaster)this._boomRaster.remove(),this._boomRaster=null;this._boomRaster=new pe.Raster({image:this._imageCache.booms[0],position:s}),await this.sleep(30),this._boomRaster.image=this._imageCache.booms[1],await this.sleep(50),this._boomRaster.image=this._imageCache.booms[2],await this.sleep(90),this._boomRaster.remove(),this._boomRaster=null}_intersectsOrContains(s,l){return s.intersects(l)||l.contains(s.position)}_collide(s,l){if(this.running&&!this.death)this.enemies.forEach((R)=>{if(R.util.death||R.util.hidden)return;if(this._intersectsOrContains(s,R))l(R)})}async move(s,l){if(!this.running)return;if(this.death)return;await this.setDirection(s),this.speed=$a(l)}drive(){if(!this.running)return;if(this.speed===0)return;if(this.hidden||this.death)return;let s=this.speed;const l=rn(90-this.direction),R=this.raster.scaling.y*this.raster.height;this._collideTester.rotation=this.raster.rotation,this._collideTester.position.x=this.raster.position.x+(R/2+5)*Math.cos(l),this._collideTester.position.y=this.raster.position.y-(R/2+5)*Math.sin(l),this.enemies.forEach((A)=>{if(A.util.hidden)return;if(this._intersectsOrContains(this.raster,A)&&this._intersectsOrContains(this._collideTester,A))s=0}),this._currentSpeed=s,s/=Ni,this.raster.position.x+=s*Math.cos(l),this.raster.position.y-=s*Math.sin(l),this.turretRaster.position=this.raster.position}get x(){return this.raster.position.x-pe.view.center.x}get y(){return pe.view.center.y-this.raster.position.y}get currentSpeed(){return on(this._currentSpeed,-100,100)}get speed(){return on(this._speed,-100,100)}set speed(s){if(!this.running)return;this._speed=on(s,-100,100)}get speedVelocity(){const s=Aa(this.speed<0?180+this.direction:this.direction),l=rn(90-s),R=Math.abs(this.speed);return new pe.Point(R*Math.cos(l),R*Math.sin(l))}get direction(){let s=this.raster.rotation%360;if(s>180)s-=360;if(s<=-180)s+=360;return s}async setDirection(s){if(!this.running)return;if(s=Math.round($a(s)),!this._turretReady)this._turn(this.turretRaster,s);await this._turn(this.raster,s)}turnRight(s){let l=this.raster.rotation;return l+=$a(s),this.setDirection(l)}turnLeft(s){return this.turnRight(-$a(s))}hurt(s){if(!this.running)return;if(this._health-=Math.abs(s),this.death)this.raster.visible=this.turretRaster.visible=!1,new pe.Raster({source:Ko,scaling:this.raster.scaling,position:this.raster.position,rotation:this.raster.rotation}).insertAbove(pe.project.activeLayer.children.background)}get health(){if(this._health<0)return 0;return this._health}get death(){return this.health<=0}get scanWidth(){return this._scanWidth}set scanWidth(s){s=$a(s),this._scanWidth=on(s,1,fi)}async scan(s){if(!this.running)return 1/0;if(this._scanShape||this.death)return 1/0;if(s=$a(s),!ar(this._lastScanDistance,s)){let ke=Aa(s)-Aa(this._lastScanDistance);if(ke>180)ke-=360;if(ke<-180)ke+=360;await this.sleep(Bn*(Math.abs(ke)/360)),this._lastScanDistance=s}const l=rn(90-(s-this.scanWidth/2)),R=In*Math.cos(l),A=In*Math.sin(l),F=new pe.Point(this.raster.position.x+R,this.raster.position.y-A),j=rn(90-(s+this.scanWidth/2)),Y=In*Math.cos(j),q=In*Math.sin(j),S=new pe.Point(this.raster.position.x+Y,this.raster.position.y-q);if(this._scanShape)this._scanShape.remove(),this._scanShape=null;this._scanShape=new pe.Path({segments:[this.raster.position,F,S],closed:!0,fillColor:{gradient:{stops:[["rgb(255 0 0 0.4)",0],["rgb(255 0 0 0)",0.7]],radial:!0},origin:this.raster.position,destination:F}}),await this.sleep(Bn*(this.scanWidth/360));let O=1/0;return this._collide(this._scanShape,(ke)=>{const ue=er(this.raster.position,ke.position);if(ue<O)O=ue}),this._scanShape.remove(),this._scanShape=null,O}}class _n extends bn{get player(){return pe.project.activeLayer.children.player}get redTank(){return pe.project.activeLayer.children.red}get yellowTank(){return pe.project.activeLayer.children.yellow}get greenTank(){return pe.project.activeLayer.children.green}start(){this.player.util.running=!0,this.redTank.util.running=!0,this.yellowTank.util.running=!0,this.greenTank.util.running=!0,super.start()}stop(){return this.player.util.running=!1,this.redTank.util.running=!1,this.yellowTank.util.running=!1,this.greenTank.util.running=!1,super.stop()}}var nr=(s="",l=[])=>`
${l.join("\n")}

((tank) => {
let abort = false;
${s||""}
})(runtime.player);

runtime.on('frame', () => {
  runtime.player.util.drive();
  runtime.redTank.util.drive();
  runtime.yellowTank.util.drive();
  runtime.greenTank.util.drive();
});

runtime.player.util.bringToFront();
runtime.start();
`;var sn={};Nr(sn,{simple:()=>vi,senior:()=>gi,medium:()=>wi});var vi=(s,l)=>`
((tank) => {
  let abort = false;

  runtime.when('start', async function (done) {
    await tank.util.turnRight(45);
    tank.util.speed = 100;
    await runtime.sleep(2.5);
    tank.util.speed = 0;
    await tank.util.turnLeft(90);
    runtime.fire('@ai_simple_${s}_${l}_message_1');
    while (true) {
      tank.util.speed = 100;
      await runtime.sleep(5.5);
      tank.util.speed = 0;
      await tank.util.turnLeft(180);
      if (abort || !runtime.running) {
        break;
      };
      await runtime.nextFrame();
    }
    done();
  });

  runtime.when('@ai_simple_${s}_${l}_message_1', async function anonymous(done) {
    while (true) {
      if ((await tank.util.scan(0) !== Infinity)) {
        await tank.util.attack(0, (await tank.util.scan(0)));
      }
      if ((await tank.util.scan(45) !== Infinity)) {
        await tank.util.attack(45, (await tank.util.scan(45)));
      }
      if ((await tank.util.scan(90) !== Infinity)) {
        await tank.util.attack(90, (await tank.util.scan(90)));
      }
      if ((await tank.util.scan(135) !== Infinity)) {
        await tank.util.attack(135, (await tank.util.scan(135)));
      }
      if ((await tank.util.scan(180) !== Infinity)) {
        await tank.util.attack(180, (await tank.util.scan(180)));
      }
      if ((await tank.util.scan(225) !== Infinity)) {
        await tank.util.attack(225, (await tank.util.scan(225)));
      }
      if ((await tank.util.scan(270) !== Infinity)) {
        await tank.util.attack(270, (await tank.util.scan(270)));
      }
      if ((await tank.util.scan(315) !== Infinity)) {
        await tank.util.attack(315, (await tank.util.scan(315)));
      }
      if (abort || !runtime.running) {
        break;
      };
      await runtime.nextFrame();
    }
    done();
  });


})(runtime.${s}Tank);
`,wi=(s,l)=>`
((tank) => {
  let abort = false;

  let _health_ = 0;
  let _angle_ = 0;

  runtime.when('start', async function anonymous() {
    _angle_ = runtime.random(1, 360);
    runtime.fire('@ai_medium_${s}_${l}_start')
  });

  runtime.when('start', async function anonymous() {
    while (true) {
      _health_ = tank.util.health;
      while (!((tank.util.health < _health_))) {
        if (abort || !runtime.running) {
          break;
        };
        await runtime.nextFrame();
      }
      abort = false;
      tank.util.move(runtime.random(1, 360), 100);
      await runtime.sleep(1);
      tank.util.speed = 0;
      runtime.fire('@ai_medium_${s}_${l}_start')
      if (abort || !runtime.running) {
        break;
      };
      await runtime.nextFrame();
    }
  });

  runtime.when('@ai_medium_${s}_${l}_start', async function anonymous(done) {
    while (true) {
      while (!((await tank.util.scan(_angle_) !== Infinity))) {
        _angle_ = (isNaN(_angle_) ? 0 : +_angle_) + +(10);

        if (abort || !runtime.running) {
          break;
        };
        await runtime.nextFrame();
      }
      while (((await tank.util.scan(_angle_) !== Infinity) && ((await tank.util.scan(_angle_)) > '400'))) {
        tank.util.move(_angle_, 100);

        if (abort || !runtime.running) {
          break;
        };
        await runtime.nextFrame();
      }
      tank.util.speed = 0;
      if (((await tank.util.scan(_angle_)) < '400') && ((await tank.util.scan(_angle_)) > '100')) {
        await tank.util.attack((_angle_ + 1), (await tank.util.scan(_angle_)));
      }
      _angle_ = (isNaN(_angle_) ? 0 : +_angle_) + +(-10);

      if (abort || !runtime.running) {
        break;
      };
      await runtime.nextFrame();
    }
    done()
  });


})(runtime.${s}Tank);
`,gi=(s,l)=>`
((tank) => {
  let abort = false;

  let _angle_ = 0;
  let _health_ = 0;


  runtime.when('start', async function anonymous() {
    if (((tank.util.y < '5') && (tank.util.y > '-5'))) {
      await tank.util.turnLeft(104);
    }
    else {
      await tank.util.turnLeft(180);
    }
    tank.util.speed = 100;
    while (!(((Math.abs(tank.util.x) > '400') && (Math.abs(tank.util.y) > '400')))) {

    if (abort || !runtime.running) {
      break;
    };
      await runtime.nextFrame();
    }
    tank.util.speed = 0;
    runtime.fire('@ai_senior_${s}_${l}_start')
  });

  runtime.when('@ai_senior_${s}_${l}_start', async function anonymous(done) {
    if ((tank.util.x < '0')) {
      if ((tank.util.y < '0')) {
        _angle_ = '45';
      }
      else {
        _angle_ = '135';
      }
    }
    else {
      if ((tank.util.y < '0')) {
        _angle_ = '-45';
      }
      else {
        _angle_ = '-135';
      }
    }
    await tank.util.setDirection(_angle_);
    runtime.fire('@ai_senior_${s}_${l}_watch_health');
    _angle_ = (isNaN(_angle_) ? 0 : +_angle_) + +(-60);
    for (let _ = 0; _ < 78; _++) {
      if (((await tank.util.scan(_angle_)) < '400') && ((await tank.util.scan(_angle_)) > '100')) {
        await tank.util.attack((_angle_ + 1), (await tank.util.scan(_angle_)));
        _angle_ = (isNaN(_angle_) ? 0 : +_angle_) + +(-10);
      }
      _angle_ = (isNaN(_angle_) ? 0 : +_angle_) + +(10);

      if (abort || !runtime.running) {
        break;
      };
      await runtime.nextFrame();
    }
    runtime.fire('@ai_senior_${s}_${l}_next_place');
    done();
  });

  runtime.when('@ai_senior_${s}_${l}_next_place', async function anonymous(done) {
    abort = false;
    if ((runtime.random(1, 3) == '1')) {
      await tank.util.turnLeft(45);
    }
    else {
      await tank.util.turnRight(45);
    }
    tank.util.speed = 100;
    await runtime.sleep(1);
    if (((tank.util.direction > '-5') && (tank.util.direction < '5'))) {
      while (!((tank.util.y > '400'))) {

      if (abort || !runtime.running) {
        break;
      };
        await runtime.nextFrame();
      }
    }
    else {
      if (((tank.util.direction > '85') && (tank.util.direction < '95'))) {
        while (!((tank.util.x > '400'))) {

        if (abort || !runtime.running) {
          break;
        };
          await runtime.nextFrame();
        }
      }
      else {
        if (((tank.util.direction > '-95') && (tank.util.direction < '-85'))) {
          while (!((tank.util.x < '-400'))) {

          if (abort || !runtime.running) {
            break;
          };
            await runtime.nextFrame();
          }
        }
        else {
          while (!((tank.util.y < '-400'))) {

          if (abort || !runtime.running) {
            break;
          };
            await runtime.nextFrame();
          }
        }
      }
    }
    tank.util.speed = 0;
    runtime.fire('@ai_senior_${s}_${l}_start')
    done()
  });

  runtime.when('@ai_senior_${s}_${l}_watch_health', async function anonymous(done) {
    _health_ = tank.util.health;
    while (!((tank.util.health < _health_))) {

    if (abort || !runtime.running) {
      break;
    };
      await runtime.nextFrame();
    }
    runtime.fire('@ai_senior_${s}_${l}_next_place')
    done()
  });


})(runtime.${s}Tank);
`;function rr({playing:s,enemies:l,enemiesAI:R,onRequestStop:A,onChangeHealth:F}){const[j,Y]=or(null),[q,S]=or(!1),{fileList:O}=qi(),ke=O[0];if(j){const ce=pe.project.activeLayer.children;if(s){if(!q){const ee=[];if(l>0)ee.push(sn[R.red]("red",Date.now().toString(36)));if(l>1)ee.push(sn[R.yellow]("yellow",Date.now().toString(36)));if(l>2)ee.push(sn[R.green]("green",Date.now().toString(36)));const Te=new _n(A);Te.launch(nr(ke.script,ee)),Te.on("frame",()=>{F({player:ce.player.util.health,red:ce.red.util.health,yellow:ce.yellow.util.health,green:ce.green.util.health})}),S(Te)}}else if(q)q.stop().then(()=>{F({player:100,red:100,yellow:100,green:100}),pe.project.activeLayer.children.forEach((ee)=>{if(ee.name==="background")return;if(ee.util instanceof xe||ee.owner instanceof xe)return;ee.remove()}),S(!1)});else{if(ce.player.util.place=xe.PLACE.LEFT_TOP,l>0)ce.red.util.place=xe.PLACE.RIGHT_BOTTOM;else ce.red.util.hidden=!0;if(l>2)ce.yellow.util.place=xe.PLACE.RIGHT_TOP,ce.green.util.place=xe.PLACE.LEFT_BOTTOM;else ce.yellow.util.hidden=!0,ce.green.util.hidden=!0;pe.project.activeLayer.children.forEach((ee)=>{if(ee.name==="background")return;if(ee.util instanceof xe||ee.owner instanceof xe)return;ee.remove()})}}return Ji(Ao,{width:"480px",height:"480px",onSetup:(ce)=>{Y(ce),pe.view.zoom=0.5,new pe.Raster({name:"background",source:Bo,position:pe.view.center}),new xe("player",xe.STYLE.PLAYER,xe.PLACE.LEFT),new xe("red",xe.STYLE.ENEMY_A,xe.PLACE.RIGHT),new xe("yellow",xe.STYLE.ENEMY_B,xe.PLACE.RIGHT_BOTTOM),new xe("green",xe.STYLE.ENEMY_C,xe.PLACE.LEFT_BOTTOM)}})}import{jsx as Ji} from"preact/jsx-runtime";import{useLocale as Ai} from"@blockcode/core";import{classNames as lr} from"@blockcode/ui";function ha(s){const l=globalThis.document,R=l.createElement("style");R.appendChild(l.createTextNode(s)),l.head.append(R)}ha("._1mbyQG_toolbar-wrapper{height:var(--tool-bar-height);padding:var(--space)0;flex-shrink:0;justify-content:space-between;align-items:center;display:flex}._1mbyQG_green-flag,._1mbyQG_stop-all{user-select:none;cursor:pointer;border:0;border-radius:.25rem;width:2rem;height:2rem;padding:.375rem}._1mbyQG_green-flag:hover,._1mbyQG_stop-all:hover{background:var(--motion-light-transparent)}._1mbyQG_green-flag._1mbyQG_actived{background:var(--motion-transparent)}._1mbyQG_stop-all{opacity:.5}._1mbyQG_stop-all._1mbyQG_actived{opacity:1}._1mbyQG_green-flag._1mbyQG_disabled,._1mbyQG_stop-all._1mbyQG_disabled{opacity:.5}._1mbyQG_toolbar-button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem!important}._1mbyQG_space{margin-left:.2rem}._1mbyQG_toolbar-buttons-group{display:flex}._1mbyQG_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}._1mbyQG_group-button{border-left:none;border-radius:0}._1mbyQG_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}");var Xa={toolbarButtonsGroup:"_1mbyQG_toolbar-buttons-group",stopAll:"_1mbyQG_stop-all",disabled:"_1mbyQG_disabled",groupButtonFirst:"_1mbyQG_group-button-first",toolbarWrapper:"_1mbyQG_toolbar-wrapper",greenFlag:"_1mbyQG_green-flag",toolbarButton:"_1mbyQG_toolbar-button",groupButton:"_1mbyQG_group-button",groupButtonLast:"_1mbyQG_group-button-last",actived:"_1mbyQG_actived",space:"_1mbyQG_space"};var sr="./assets/icon-green-flag-8eb2c7e7b0a15fba.svg";var ir="./assets/icon-stop-all-21d83d10e3dd785f.svg";import{jsx as Vn,jsxs as Fi} from"preact/jsx-runtime";function Yn({playing:s,onPlay:l,onStop:R}){const{getText:A}=Ai();return Vn("div",{className:Xa.toolbarWrapper,children:Fi("div",{className:Xa.toolbarButtonsGroup,children:[Vn("img",{className:lr(Xa.greenFlag,{[Xa.actived]:s}),src:sr,title:A("tankwar.player.greenFlag","Go"),onClick:l}),Vn("img",{className:lr(Xa.stopAll,{[Xa.actived]:s}),src:ir,title:A("tankwar.player.stopAll","Stop"),onClick:R})]})})}ha(".b0DZEW_stage-wrapper{position:relative}.b0DZEW_stage{border:1px solid var(--ui-black-transparent);border-radius:var(--space);background:var(--ui-white);width:482px;height:482px;position:relative;overflow:hidden}");var jn={stageWrapper:"b0DZEW_stage-wrapper",stage:"b0DZEW_stage"};import{jsx as Wn,jsxs as Ui} from"preact/jsx-runtime";function Ln({playing:s,enemies:l,enemiesAI:R,onChangePlaying:A,onChangeHealth:F}){const j=()=>A(!0),Y=()=>A(!1);return Ui("div",{className:jn.stageWrapper,children:[Wn(Yn,{playing:s,onPlay:j,onStop:Y}),Wn("div",{className:Mi(jn.stage),children:Wn(rr,{playing:s,enemies:l,enemiesAI:R,onRequestStop:Y,onChangeHealth:F})})]})}import{useLocale as Xi,useEditor as Bi} from"@blockcode/core";import{classNames as va,Text as ln,Button as Fa,Label as Ba,BufferedInput as Vi,ComingSoon as Yi} from"@blockcode/ui";ha('.MaJ6dq_stage-info-wrapper{margin-top:var(--space);background:var(--ui-white);color:var(--text-primary);border-radius:var(--space);border:1px solid var(--ui-black-transparent);padding:1rem}.MaJ6dq_row{justify-content:space-between;margin-top:.5rem;display:flex}.MaJ6dq_row-primary{margin-top:0}.MaJ6dq_group{flex-direction:row;align-items:center;display:inline-flex}.MaJ6dq_full-input{flex:1}.MaJ6dq_name-input{width:8rem}.MaJ6dq_button{min-width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem!important}.MaJ6dq_button-icon{margin:auto}.MaJ6dq_space{margin-left:.2rem}.MaJ6dq_toolbar-button-group{display:flex}.MaJ6dq_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}.MaJ6dq_group-button{border-left:none;border-radius:0}.MaJ6dq_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}.MaJ6dq_button-text{flex:auto}.MaJ6dq_group-button-toggled-on .MaJ6dq_button-text{color:#4c97ff}.MaJ6dq_tank-image{width:1.65rem}.MaJ6dq_health-progress{background:#f5f5f5;border-radius:10px;width:12rem;height:20px}.MaJ6dq_health-progress:before{counter-reset:progress var(--percent,0);content:counter(progress)"%\u2002";width:calc(12rem*var(--percent,0)/100);color:var(--ui-white);text-align:right;white-space:nowrap;background:#ff6680;border-radius:10px;height:20px;font-size:12px;line-height:20px;display:block;overflow:hidden}');var Ie={rowPrimary:"MaJ6dq_row-primary",groupButton:"MaJ6dq_group-button",group:"MaJ6dq_group",healthProgress:"MaJ6dq_health-progress",fullInput:"MaJ6dq_full-input",groupButtonLast:"MaJ6dq_group-button-last",space:"MaJ6dq_space",toolbarButtonGroup:"MaJ6dq_toolbar-button-group",groupButtonFirst:"MaJ6dq_group-button-first",nameInput:"MaJ6dq_name-input",buttonText:"MaJ6dq_button-text",row:"MaJ6dq_row",tankImage:"MaJ6dq_tank-image",button:"MaJ6dq_button",buttonIcon:"MaJ6dq_button-icon",stageInfoWrapper:"MaJ6dq_stage-info-wrapper",groupButtonToggledOn:"MaJ6dq_group-button-toggled-on"};var cr="./assets/tank-2-95f1944eace1f71a.png";var ur="./assets/tank-3-fc6d9534c6d7bba5.png";var mr="./assets/tank-4-79e2f163c902d864.png";import{jsx as Me,jsxs as Va} from"preact/jsx-runtime";var ji=[cr,ur,mr];function On({playing:s,enemies:l,enemiesAI:R,health:A,onChangeEnemies:F,onChangeEnemyAI:j}){const{getText:Y}=Xi(),{fileList:q,modifyFile:S}=Bi(),O=q[0],ke=(ue,ce)=>{S({[ue]:ce})};return Va("div",{className:Ie.stageInfoWrapper,children:[Va("div",{className:va(Ie.row,Ie.rowPrimary),children:[Me(Ba,{text:Y("tankwar.stageInfo.player","Player"),children:Me(Vi,{disabled:s,className:Ie.nameInput,placeholder:Y("tankwar.stageInfo.nickname","Nickname"),onSubmit:(ue)=>ke("name",ue),value:O.name})}),Me(Ba,{secondary:!0,className:Ie.health,text:Y("tankwar.stageInfo.health","Health"),children:Me("div",{className:Ie.healthProgress,style:`--percent:${A.player||0}`})})]}),Va("div",{className:Ie.row,children:[Va(Ba,{secondary:!0,text:Y("tankwar.stageInfo.enemies","Enemies"),children:[Me(Fa,{disabled:s,className:va(Ie.button,Ie.groupButtonFirst,{[Ie.groupButtonToggledOn]:l===0}),onClick:()=>F(0),children:Me("div",{className:Ie.buttonText,children:"0"})}),Me(Fa,{disabled:s,className:va(Ie.button,Ie.groupButton,{[Ie.groupButtonToggledOn]:l===1}),onClick:()=>F(1),children:Me("div",{className:Ie.buttonText,children:"1"})}),Me(Fa,{disabled:s,className:va(Ie.button,Ie.groupButtonLast,{[Ie.groupButtonToggledOn]:l===3}),onClick:()=>F(3),children:Me("div",{className:Ie.buttonText,children:"3"})})]}),l>0&&Va(Ba,{secondary:!0,children:[Me(Fa,{disabled:s,className:va(Ie.button,Ie.groupButtonFirst,{[Ie.groupButtonToggledOn]:!0}),children:Me("div",{className:Ie.buttonText,children:Me(ln,{id:"tankwar.stageInfo.mode.local",defaultMessage:"Local AI"})})}),Me(Yi,{placement:"bottom",children:Me(Fa,{disabled:s,className:va(Ie.button,Ie.groupButtonLast,{[Ie.groupButtonToggledOn]:!1}),children:Me("div",{className:Ie.buttonText,children:Me(ln,{id:"tankwar.stageInfo.mode.remote",defaultMessage:"Remote Players"})})})})]})]}),["red","yellow","green"].slice(0,l).map((ue,ce)=>Va("div",{className:Ie.row,children:[Me(Ba,{secondary:!0,children:Me("img",{className:Ie.tankImage,src:ji[ce],alt:Y(`tankwar.stageInfo.enemy.${ue}`,ue.replace(ue[0],ue[0].toUpperCase())),title:Y(`tankwar.stageInfo.enemy.${ue}`,ue.replace(ue[0],ue[0].toUpperCase()))})}),Me(Ba,{secondary:!0,children:Me("div",{className:Ie.healthProgress,style:`--percent:${A[ue]||0}`})}),Va(Ba,{secondary:!0,text:Y("tankwar.stageInfo.ai","AI"),children:[Me(Fa,{disabled:s,className:va(Ie.button,Ie.groupButtonFirst,{[Ie.groupButtonToggledOn]:R[ue]==="simple"}),onClick:()=>j(ue,"simple"),children:Me("div",{className:Ie.buttonText,children:Me(ln,{id:"tankwar.stageInfo.ai.simple",defaultMessage:"Simple"})})}),Me(Fa,{disabled:s,className:va(Ie.button,Ie.groupButton,{[Ie.groupButtonToggledOn]:R[ue]==="medium"}),onClick:()=>j(ue,"medium"),children:Me("div",{className:Ie.buttonText,children:Me(ln,{id:"tankwar.stageInfo.ai.medium",defaultMessage:"Medium"})})}),Me(Fa,{disabled:s,className:va(Ie.button,Ie.groupButtonLast,{[Ie.groupButtonToggledOn]:R[ue]==="senior"}),onClick:()=>j(ue,"senior"),children:Me("div",{className:Ie.buttonText,children:Me(ln,{id:"tankwar.stageInfo.ai.senior",defaultMessage:"Senior"})})})]})]},ce))]})}ha(".FMSzyW_sidebar-wrapper{flex-direction:column;height:100%;display:flex}.FMSzyW_stage-wrapper{display:flex}.FMSzyW_selector-wrapper{margin-top:var(--space);flex-direction:row;height:100%;display:flex}");var Gn={selectorWrapper:"FMSzyW_selector-wrapper",sidebarWrapper:"FMSzyW_sidebar-wrapper",stageWrapper:"FMSzyW_stage-wrapper"};import{jsx as tr,jsxs as Wi} from"preact/jsx-runtime";function Sn(){const[s,l]=Nn(!1),[R,A]=Nn(1),[F,j]=Nn({red:"simple",yellow:"medium",green:"senior"}),[Y,q]=Nn({player:100,red:100,yellow:100,green:100});return Wi("div",{className:Gn.sidebarWrapper,children:[tr(Ln,{className:Gn.stageWrapper,playing:s,enemies:R,enemiesAI:F,onChangePlaying:l,onChangeHealth:q}),tr(On,{playing:s,enemies:R,enemiesAI:F,health:Y,onChangeEnemies:A,onChangeEnemyAI:(S,O)=>j({...F,[S]:O})})]})}var Rr={fileList:[{id:"player",name:"player"}]};var kr={"tankwar.player.greenFlag":"Go","tankwar.player.stopAll":"Stop","tankwar.stageInfo.player":"Player","tankwar.stageInfo.nickname":"Nickname","tankwar.stageInfo.enemies":"Enemies","tankwar.stageInfo.health":"Health","tankwar.stageInfo.enemy.red":"Red","tankwar.stageInfo.enemy.yellow":"Yellow","tankwar.stageInfo.enemy.green":"Green","tankwar.stageInfo.mode.local":"Local AI","tankwar.stageInfo.mode.remote":"Remote Players","tankwar.stageInfo.ai":"AI","tankwar.stageInfo.ai.simple":"Simple","tankwar.stageInfo.ai.medium":"Medium","tankwar.stageInfo.ai.senior":"Senior","tankwar.blocks.motion_attack":"fire in direction %1 at %2 steps","tankwar.blocks.motion_move":"forward in direction %1 at %2 % speed","tankwar.blocks.motion_setspeed":"set speed to %1 %","tankwar.blocks.motion_stop":"stop","tankwar.blocks.motion_speed":"speed","tankwar.blocks.sensing_scanwidth":"set scan width to %1","tankwar.blocks.sensing_scan":"scan for enemy in direction %1?","tankwar.blocks.sensing_distance":"measure distance of enemy in direction %1","tankwar.blocks.sensing_health":"health"};var dr={"tankwar.player.greenFlag":"\u8FD0\u884C","tankwar.player.stopAll":"\u505C\u6B62","tankwar.stageInfo.player":"\u73A9\u5BB6","tankwar.stageInfo.nickname":"\u6635\u79F0","tankwar.stageInfo.enemies":"\u654C\u65B9\u6570\u91CF","tankwar.stageInfo.health":"\u751F\u547D\u503C","tankwar.stageInfo.enemy.red":"\u7EA2","tankwar.stageInfo.enemy.yellow":"\u9EC4","tankwar.stageInfo.enemy.green":"\u7EFF","tankwar.stageInfo.mode.local":"\u672C\u673A AI","tankwar.stageInfo.mode.remote":"\u8054\u7F51\u73A9\u5BB6","tankwar.stageInfo.ai":"AI \u7B56\u7565","tankwar.stageInfo.ai.simple":"\u7B80\u5355","tankwar.stageInfo.ai.medium":"\u4E2D\u7B49","tankwar.stageInfo.ai.senior":"\u9AD8\u7EA7","tankwar.blocks.motion_attack":"\u671D\u5411 %1 \u65B9\u5411\u8DDD\u79BB %2 \u6B65\u53D1\u5C04\u70AE\u5F39","tankwar.blocks.motion_move":"\u4EE5 %2 % \u901F\u5EA6\u9762\u5411 %1 \u65B9\u5411\u524D\u8FDB","tankwar.blocks.motion_setspeed":"\u5C06\u901F\u5EA6\u8BBE\u4E3A %1 %","tankwar.blocks.motion_stop":"\u505C\u6B62\u524D\u8FDB","tankwar.blocks.motion_speed":"\u901F\u5EA6","tankwar.blocks.sensing_scanwidth":"\u5C06\u96F7\u8FBE\u626B\u63CF\u5BBD\u5EA6\u8BBE\u4E3A %1","tankwar.blocks.sensing_scan":"\u96F7\u8FBE\u626B\u63CF %1 \u65B9\u5411\u6709\u654C\u4EBA\uFF1F","tankwar.blocks.sensing_distance":"\u96F7\u8FBE\u6D4B\u91CF %1 \u65B9\u5411\u654C\u4EBA\u7684\u8DDD\u79BB","tankwar.blocks.sensing_health":"\u751F\u547D\u503C"};function Li({addLocaleData:s,createLayout:l,openProject:R,project:A}){s(wo),s({en:kr,"zh-Hans":dr});const F=(Y)=>{Y=Y??Rr,R(Object.assign({selectedFileId:Y.fileList[0].id},Y))};F(A),l({mainMenu:Zo({createDefaultProject:F,saveCurrentProject:()=>{return{thumb:document.querySelector("#blockcode-blocks-player").toDataURL()}}}).slice(0,2),tabs:[{...kn,Content:Qn}],sidebars:[{expand:"right",Content:Sn}],pane:!1,tutorials:!1,canEditProjectName:!0})}export{Li as default};
