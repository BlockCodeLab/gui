var Ue=Object.create;var{getPrototypeOf:We,defineProperty:te,getOwnPropertyNames:Xe}=Object;var ke=Object.prototype.hasOwnProperty;var Ke=(t,e,o)=>{o=t!=null?Ue(We(t)):{};let i=e||!t||!t.__esModule?te(o,"default",{value:t,enumerable:!0}):o;for(let n of Xe(t))if(!ke.call(i,n))te(i,n,{get:()=>t[n],enumerable:!0});return i};var Ye=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var ee=Ye((yt)=>{(function(){var t=typeof yt!="undefined"&&yt||typeof define!="undefined"&&{}||this||window;if(typeof define!=="undefined")define("save-svg-as-png",[],function(){return t});t.default=t;var e="http://www.w3.org/2000/xmlns/",o="http://www.w3.org/1999/xhtml",i="http://www.w3.org/2000/svg",n='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" [<!ENTITY nbsp "&#160;">]>',s=/url\(["']?(.+?)["']?\)/,h={woff2:"font/woff2",woff:"font/woff",otf:"application/x-font-opentype",ttf:"application/x-font-ttf",eot:"application/vnd.ms-fontobject",sfnt:"application/font-sfnt",svg:"image/svg+xml"},l=function T(r){return r instanceof HTMLElement||r instanceof SVGElement},m=function T(r){if(!l(r))throw new Error("an HTMLElement or SVGElement is required; got "+r)},O=function T(r){return new Promise(function(u,a){if(l(r))u(r);else a(new Error("an HTMLElement or SVGElement is required; got "+r))})},C=function T(r){return r&&r.lastIndexOf("http",0)===0&&r.lastIndexOf(window.location.host)===-1},N=function T(r){var u=Object.keys(h).filter(function(a){return r.indexOf("."+a)>0}).map(function(a){return h[a]});if(u)return u[0];return console.error("Unknown font format for "+r+". Fonts may not be working correctly."),"application/octet-stream"},g=function T(r){var u="",a=new Uint8Array(r);for(var c=0;c<a.byteLength;c++)u+=String.fromCharCode(a[c]);return window.btoa(u)},_=function T(r,u,a){var c=r.viewBox&&r.viewBox.baseVal&&r.viewBox.baseVal[a]||u.getAttribute(a)!==null&&!u.getAttribute(a).match(/%$/)&&parseInt(u.getAttribute(a))||r.getBoundingClientRect()[a]||parseInt(u.style[a])||parseInt(window.getComputedStyle(r).getPropertyValue(a));return typeof c==="undefined"||c===null||isNaN(parseFloat(c))?0:c},p=function T(r,u,a,c){if(r.tagName==="svg")return{width:a||_(r,u,"width"),height:c||_(r,u,"height")};else if(r.getBBox){var w=r.getBBox(),b=w.x,D=w.y,H=w.width,Q=w.height;return{width:b+H,height:D+Q}}},E=function T(r){return decodeURIComponent(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,function(u,a){var c=String.fromCharCode("0x"+a);return c==="%"?"%25":c}))},v=function T(r){var u=window.atob(r.split(",")[1]),a=r.split(",")[0].split(":")[1].split(";")[0],c=new ArrayBuffer(u.length),w=new Uint8Array(c);for(var b=0;b<u.length;b++)w[b]=u.charCodeAt(b);return new Blob([c],{type:a})},V=function T(r,u){if(!u)return;try{return r.querySelector(u)||r.parentNode&&r.parentNode.querySelector(u)}catch(a){console.warn('Invalid CSS selector "'+u+'"',a)}},F=function T(r,u){var a=r.cssText.match(s),c=a&&a[1]||"";if(!c||c.match(/^data:/)||c==="about:blank")return;var w=c.startsWith("../")?u+"/../"+c:c.startsWith("./")?u+"/."+c:c;return{text:r.cssText,format:N(w),url:w}},U=function T(r){return Promise.all(Array.from(r.querySelectorAll("image")).map(function(u){var a=u.getAttributeNS("http://www.w3.org/1999/xlink","href")||u.getAttribute("href");if(!a)return Promise.resolve(null);if(C(a))a+=(a.indexOf("?")===-1?"?":"&")+"t="+new Date().valueOf();return new Promise(function(c,w){var b=document.createElement("canvas"),D=new Image;D.crossOrigin="anonymous",D.src=a,D.onerror=function(){return w(new Error("Could not load "+a))},D.onload=function(){b.width=D.width,b.height=D.height,b.getContext("2d").drawImage(D,0,0),u.setAttributeNS("http://www.w3.org/1999/xlink","href",b.toDataURL("image/png")),c(!0)}})}))},S={},G=function T(r){return Promise.all(r.map(function(u){return new Promise(function(a,c){if(S[u.url])return a(S[u.url]);var w=new XMLHttpRequest;w.addEventListener("load",function(){var b=g(w.response),D=u.text.replace(s,'url("data:'+u.format+";base64,"+b+'")')+`
`;S[u.url]=D,a(D)}),w.addEventListener("error",function(b){console.warn("Failed to load font from: "+u.url,b),S[u.url]=null,a(null)}),w.addEventListener("abort",function(b){console.warn("Aborted loading font from: "+u.url,b),a(null)}),w.open("GET",u.url),w.responseType="arraybuffer",w.send()})})).then(function(u){return u.filter(function(a){return a}).join("")})},ct=null,ht=function T(){if(ct)return ct;return ct=Array.from(document.styleSheets).map(function(r){try{return{rules:r.cssRules,href:r.href}}catch(u){return console.warn("Stylesheet could not be loaded: "+r.href,u),{}}})},Rt=function T(r,u){var a=u||{},c=a.selectorRemap,w=a.modifyStyle,b=a.modifyCss,D=a.fonts,H=a.excludeUnusedCss,Q=b||function($,x){var W=c?c($):$,f=w?w(x):x;return W+"{"+f+`}
`},Z=[],q=typeof D==="undefined",j=D||[];return ht().forEach(function($){var{rules:x,href:W}=$;if(!x)return;Array.from(x).forEach(function(f){if(typeof f.style!="undefined"){if(V(r,f.selectorText))Z.push(Q(f.selectorText,f.style.cssText));else if(q&&f.cssText.match(/^@font-face/)){var B=F(f,W);if(B)j.push(B)}else if(!H)Z.push(f.cssText)}})}),G(j).then(function($){return Z.join(`
`)+$})},J=function T(){if(!navigator.msSaveOrOpenBlob&&!("download"in document.createElement("a")))return{popup:window.open()}};t.prepareSvg=function(T,r,u){m(T);var a=r||{},c=a.left,w=c===void 0?0:c,b=a.top,D=b===void 0?0:b,H=a.width,Q=a.height,Z=a.scale,q=Z===void 0?1:Z,j=a.responsive,$=j===void 0?!1:j,x=a.excludeCss,W=x===void 0?!1:x;return U(T).then(function(){var f=T.cloneNode(!0);f.style.backgroundColor=(r||{}).backgroundColor||T.style.backgroundColor;var B=p(T,f,H,Q),tt=B.width,et=B.height;if(T.tagName!=="svg")if(T.getBBox){if(f.getAttribute("transform")!=null)f.setAttribute("transform",f.getAttribute("transform").replace(/translate\(.*?\)/,""));var Dt=document.createElementNS("http://www.w3.org/2000/svg","svg");Dt.appendChild(f),f=Dt}else{console.error("Attempted to render non-SVG element",T);return}if(f.setAttribute("version","1.1"),f.setAttribute("viewBox",[w,D,tt,et].join(" ")),!f.getAttribute("xmlns"))f.setAttributeNS(e,"xmlns",i);if(!f.getAttribute("xmlns:xlink"))f.setAttributeNS(e,"xmlns:xlink","http://www.w3.org/1999/xlink");if($)f.removeAttribute("width"),f.removeAttribute("height"),f.setAttribute("preserveAspectRatio","xMinYMin meet");else f.setAttribute("width",tt*q),f.setAttribute("height",et*q);if(Array.from(f.querySelectorAll("foreignObject > *")).forEach(function(A){A.setAttributeNS(e,"xmlns",A.tagName==="svg"?i:o)}),W){var Ot=document.createElement("div");Ot.appendChild(f);var R=Ot.innerHTML;if(typeof u==="function")u(R,tt,et);else return{src:R,width:tt,height:et}}else return Rt(T,r).then(function(A){var L=document.createElement("style");L.setAttribute("type","text/css"),L.innerHTML=`<![CDATA[
`+A+`
]]>`;var M=document.createElement("defs");M.appendChild(L),f.insertBefore(M,f.firstChild);var k=document.createElement("div");k.appendChild(f);var ot=k.innerHTML.replace(/NS\d+:href/gi,'xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href');if(typeof u==="function")u(ot,tt,et);else return{src:ot,width:tt,height:et}})})},t.svgAsDataUri=function(T,r,u){return m(T),t.prepareSvg(T,r).then(function(a){var{src:c,width:w,height:b}=a,D="data:image/svg+xml;base64,"+window.btoa(E(n+c));if(typeof u==="function")u(D,w,b);return D})},t.svgAsPngUri=function(T,r,u){m(T);var a=r||{},c=a.encoderType,w=c===void 0?"image/png":c,b=a.encoderOptions,D=b===void 0?0.8:b,H=a.canvg,Q=function Z(q){var{src:j,width:$,height:x}=q,W=document.createElement("canvas"),f=W.getContext("2d"),B=window.devicePixelRatio||1;if(W.width=$*B,W.height=x*B,W.style.width=W.width+"px",W.style.height=W.height+"px",f.setTransform(B,0,0,B,0,0),H)H(W,j);else f.drawImage(j,0,0);var tt=void 0;try{tt=W.toDataURL(w,D)}catch(et){if(typeof SecurityError!=="undefined"&&et instanceof SecurityError||et.name==="SecurityError"){console.error("Rendered SVG images cannot be downloaded in this browser.");return}else throw et}if(typeof u==="function")u(tt,W.width,W.height);return Promise.resolve(tt)};if(H)return t.prepareSvg(T,r).then(Q);else return t.svgAsDataUri(T,r).then(function(Z){return new Promise(function(q,j){var $=new Image;$.onload=function(){return q(Q({src:$,width:$.width,height:$.height}))},$.onerror=function(){j(`There was an error loading the data URI as an image on the following SVG
`+window.atob(Z.slice(26))+`Open the following link to see browser's diagnosis
`+Z)},$.src=Z})})},t.download=function(T,r,u){if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(v(r),T);else{var a=document.createElement("a");if("download"in a){a.download=T,a.style.display="none",document.body.appendChild(a);try{var c=v(r),w=URL.createObjectURL(c);a.href=w,a.onclick=function(){return requestAnimationFrame(function(){return URL.revokeObjectURL(w)})}}catch(b){console.error(b),console.warn("Error while getting object URL. Falling back to string URL."),a.href=r}a.click(),document.body.removeChild(a)}else if(u&&u.popup)u.popup.document.title=T,u.popup.location.replace(r)}},t.saveSvg=function(T,r,u){var a=J();return O(T).then(function(c){return t.svgAsDataUri(c,u||{})}).then(function(c){return t.download(r,c,a)})},t.saveSvgAsPng=function(T,r,u){var a=J();return O(T).then(function(c){return t.svgAsPngUri(c,u||{})}).then(function(c){return t.download(r,c,a)})}})()});import{Text as xt}from"@blockcode/ui";import{Text as Kt}from"@blockcode/ui";var ie=Ke(ee(),1);import{Keys as ut,useLayout as Ge,useEditor as Ze}from"@blockcode/core";import{Text as mt,MenuSection as oe,MenuItem as gt}from"@blockcode/ui";import{ScratchBlocks as He}from"@blockcode/blocks-editor";import{jsx as z,jsxs as Vt,Fragment as Be}from"preact/jsx-runtime";var $t=/Mac/i.test(navigator.platform||navigator.userAgent);function Ut({itemClassName:t,onNew:e,onOpen:o,onSave:i,children:n}){let{createAlert:s,createPrompt:h,setStoreLibrary:l}=Ge(),{modified:m,saveNow:O,saveToComputer:C,openFromComputer:N}=Ze(),g=(E)=>{if(i)return i(E);return E},_=async()=>{let E,v,V=He.getMainWorkspace();if(V){let F=V.getCanvas();if(F)E=await ie.svgAsDataUri(F,{})}return(F)=>{let U=new Set,S={thumb:E,editor:{},...F,...g(F)};if(S.assetList)S.assetList=S.assetList.filter((G)=>!G.id.startsWith("extensions/"));if(S.fileList)S.fileList=S.fileList.map(({content:G,script:ct,extensions:ht,...Rt})=>{return U=U.union(new Set(ht)),Rt});return S.editor.extensions=Array.from(U),S}},p=(E)=>async()=>{await E(await _()),s({message:z(mt,{id:"blocks.menu.file.saveAlert",defaultMessage:"Saved."})},2000)};return Vt(Be,{children:[Vt(oe,{children:[z(gt,{className:t,label:z(mt,{id:"blocks.menu.file.newProject",defaultMessage:"New"}),hotkey:[$t?ut.COMMAND:ut.CONTROL,ut.N],onClick:()=>{if(m)h({title:z(mt,{id:"gui.projects.notSaved",defaultMessage:"Not saved"}),label:z(mt,{id:"gui.projects.replaceProject",defaultMessage:"Replace contents of the current project?"}),onSubmit:e});else e()}}),z(gt,{className:t,label:z(mt,{id:"blocks.menu.file.openProject",defaultMessage:"Open"}),hotkey:[$t?ut.COMMAND:ut.CONTROL,ut.O],onClick:()=>l(!0)}),z(gt,{className:t,label:z(mt,{id:"blocks.menu.file.saveProject",defaultMessage:"Save"}),hotkey:[$t?ut.COMMAND:ut.CONTROL,ut.S],onClick:p(O)})]}),Vt(oe,{children:[z(gt,{className:t,label:z(mt,{id:"blocks.menu.file.uploadProject",defaultMessage:"Load from your computer"}),onClick:()=>N(o)}),z(gt,{className:t,label:z(mt,{id:"blocks.menu.file.downloadProject",defaultMessage:"save to your computer"}),onClick:window.electron?async()=>C(await _()):p(C)})]}),n]})}import{useEffect as ze,useState as Wt}from"preact/hooks";import{Keys as _t}from"@blockcode/core";import{Text as ne,MenuSection as Je,MenuItem as ae}from"@blockcode/ui";import{ScratchBlocks as Qe}from"@blockcode/blocks-editor";import{jsx as Lt,jsxs as de,Fragment as qe}from"preact/jsx-runtime";var re=/Mac/i.test(navigator.platform||navigator.userAgent);function Xt({itemClassName:t,children:e}){let[o,i]=Wt(!0),[n,s]=Wt(!0),[h,l]=Wt(null),m=Qe.getMainWorkspace();if(m){if(h?.id!==m.id)l(m)}return ze(()=>{if(h)h.addChangeListener(()=>{i(h.undoStack_.length===0),s(h.redoStack_.length===0)}),i(h.undoStack_.length===0),s(h.redoStack_.length===0)},[h]),de(qe,{children:[de(Je,{children:[Lt(ae,{disabled:o,className:t,label:Lt(ne,{id:"blocks.menu.edit.undo",defaultMessage:"Undo"}),hotkey:[re?_t.COMMAND:_t.CONTROL,_t.Z],onClick:async(O)=>{if(O instanceof MouseEvent&&h)h.undo(!1)}}),Lt(ae,{disabled:n,className:t,label:Lt(ne,{id:"blocks.menu.edit.redo",defaultMessage:"Redo"}),hotkey:re?[_t.SHIFT,_t.COMMAND,_t.Z]:[_t.CONTROL,_t.Y],onClick:async(O)=>{if(O instanceof MouseEvent&&h)h.undo(!0)}})]}),e]})}import{useLayout as je,useEditor as xe}from"@blockcode/core";import{Text as Tt,Spinner as to,MenuSection as eo,MenuItem as oo}from"@blockcode/ui";import{connectDevice as io,checkDevice as no,checkFlashFree as ao,writeFiles as ro,configDevice as uo}from"@blockcode/device-pyboard";import{jsx as at,jsxs as lo,Fragment as so}from"preact/jsx-runtime";var pt=null;function kt({itemClassName:t,deviceName:e,deviceFilters:o,onBeforeDownload:i,children:n}){let{createAlert:s,removeAlert:h,createPrompt:l}=je(),{key:m,name:O,fileList:C,assetList:N}=xe(),g=(E)=>{if(!pt)pt=`download.${Date.now()}`;if(E<100)s({id:pt,icon:at(to,{level:"success"}),message:at(Tt,{id:"blocks.alert.downloading",defaultMessage:"Downloading...{progress}%",progress:E})});else s({id:pt,icon:null,message:at(Tt,{id:"blocks.alert.downloadCompleted",defaultMessage:"Download completed."})}),setTimeout(_,2000)},_=()=>{h(pt),pt=null},p=(E)=>{if(E==="NotFoundError")return;s({message:E==="NotFoundError"?at(Tt,{id:"blocks.alert.connectionCancel",defaultMessage:"Connection cancel."}):at(Tt,{id:"blocks.alert.connectionError",defaultMessage:"Connection error."})},1000)};return lo(so,{children:[at(eo,{children:at(oo,{disabled:pt,className:t,label:at(Tt,{id:"blocks.menu.device.download",defaultMessage:"Download program"}),onClick:async()=>{if(pt)return;let E;try{E=await io(o||[])}catch(F){p(F.name)}if(!E)return;let v=no(E).catch(()=>{p(),_()}),V=i?i({key:m,name:O},C,N):[].concat(C,N);g(0);try{if(await ao(E,V))await ro(E,V,g),await uo(E,{"latest-project":m}),E.hardReset();else l({title:e||at(Tt,{id:"blocks.menu.device.name",defaultMessage:"device"}),label:at(Tt,{id:"blocks.alert.flashOutSpace",defaultMessage:"The flash is running out of space."})}),_()}catch(F){p(F.name),_()}finally{v.cancel()}}})}),n]})}var ue="./assets/icon-file-egaz1kfx.svg";var se="./assets/icon-edit-jejnm7yb.svg";var le="./assets/icon-device-3gcajtt2.svg";import{jsx as Ct}from"preact/jsx-runtime";function Yt({deviceName:t,deviceFilters:e,createProject:o,openProject:i,saveProject:n,beforeDownload:s}){return[{icon:ue,label:Ct(Kt,{id:"blocks.menu.file",defaultMessage:"File"}),Menu:({itemClassName:h,children:l})=>Ct(Ut,{itemClassName:h,onNew:o,onOpen:i,onSave:n,children:l})},{icon:se,label:Ct(Kt,{id:"blocks.menu.edit",defaultMessage:"Edit"}),Menu:({itemClassName:h,children:l})=>Ct(Xt,{itemClassName:h,children:l})},{icon:le,label:Ct(Kt,{id:"blocks.menu.device",defaultMessage:"Device"}),Menu:({itemClassName:h,children:l})=>Ct(kt,{deviceName:t,itemClassName:h,deviceFilters:e,onBeforeDownload:s,children:l})}]}var _o=(t)=>{let e="=".repeat((4-t.length%4)%4),o=(t+e).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(o),n=new Uint8Array(i.length);for(let s=0;s<i.length;++s)n[s]=i.charCodeAt(s);return n.buffer};var ce=[{id:"blocks/__init__.mpy",content:"TQYAHxQAFl9faW5pdF9fLnB5AA8OYXN5bmNpbwALHGJsb2Nrcy5ydW50aW1lABZERUZBVUxUX0ZQUwCCJQZydW4AFHdoZW5fc3RhcnQAEndoZW5fc3RvcAAgd2hlbl9ncmVhdGVydGhlbgAsd2hlbl9icm9hZGNhc3RyZWNlaXZlZAAOd3JhcHBlcgAOUnVudGltZQAOcnVudGltZQAGZnBzAAxoYW5kbGUACG5hbWUAgkUObWVzc2FnZQCDfAgYAUZIZmsgZCBkIIQHgFEbAhYCgBADKgEbBGkRDTQAFg4RDRMFKgFTMwAWBjIBFggyAhYJMgMWCjIEFgtRYwWBOKkBCAYPgAgSAhQHEg4UBrA2ATYBWVFjgQAZCAgQgAwSDhQIsDYBWVFjgQAZCAkQgBASDhQJsDYBWVFjgRwijAEKERKAFGYAAbCxIAACwrJjAYEwOwwMAwMQgBUSDhQKJQAlAbI2A1lRY3wRCwsTgBtlALAgAAHBsWMBgRgqCgwDEIAcEg4UCyUAsTYCWVFj"},{id:"blocks/runtime.mpy",content:"TQYAH3AAFHJ1bnRpbWUucHkADw5hc3luY2lvAAxyYW5kb20ACG1hdGgACHRpbWUABnN5cwAOUnVudGltZQAMbnVtYmVyAAxlcXVhbHMAFmdldF9mdW5jX2lkAAp7fS57fQCBKRZfX2dsb2JhbHNfXwAvEmlzX251bWJlcgCBFQIuAAItAIIDAxQwMTIzNDU2Nzg5ABphbnlfc3RlcF9kb25lABBzbGVlcF9tcwAIZG9uZQAKU1RBUlQACkZSQU1FABhHUkVBVEVSX1RIRU4AJEJST0FEQ0FTVF9SRUNFSVZFRAAQU0hVVERPV04ADndhaXRpbmcAIwxfdGFza3MADF9zdGVwcwAKX3RpbWUAFF9mcmFtZV9zZWMACl9kYXRhABhfZ3JlYXRlcnRoZW4ACl9waW5zAAhkYXRhAAhwaW5zABpfaXNfc3luY190YXNrABZjcmVhdGVfdGFzawAKe31Ae30AeRRzdGFydF90YXNrABZfc3RhcnRfc3RlcAASbmV4dF90aWNrABRzdG9wX3Rhc2tzAIFVgXEMY2FuY2VsAAZ7fUAAgiMId2hlbgAIZmlyZQAKYWJvcnQAFHdoZW5fZnJhbWUAFHdoZW5fc3RhcnQAEndoZW5fc3RvcAAsd2hlbl9icm9hZGNhc3RyZWNlaXZlZAAKe306e30AEmJyb2FkY2FzdAAgd2hlbl9ncmVhdGVydGhlbgAKe30+e30AJF9mcmFtZV9ncmVhdGVydGhlbgACPgAKVElNRVIAgiUWcmVzZXRfdGltZXIAFG5leHRfZnJhbWUAEmZyYW1lX3NlYwCCLQpfc3RvcAAQd2FpdF9mb3IACnNsZWVwABR0aWNrc19kaWZmABB0aWNrc19tcwAIY2VpbAAKZmxvb3IADnJhbmRpbnQAgTkGbnVtAAphZnVuYwACcwCCL4FXCnN0ZXBzAC01FkRFRkFVTFRfRlBTABBwcm9wZXJ0eQCCKYITCG5hbWUAEnN0ZXBfbmFtZQB7CHN5bmMAGmV4Y2x1ZGVfYWZ1bmMADm1lc3NhZ2UAgkUKZmxvYXQABmZwcwAIbnVtMQAIbnVtMgAGbWluAAZtYXgAGmRlZmF1bHRfdmFsdWUAgSEMbGVuZ3RoAAh2YWwxAAh2YWwyAIUUEB4BJiYmJmZkIIQbhAiJsCaAURsCFgKAURsDFgOAURsEFgSAURsFFgWAURsGFgYyABYKMgEWDzICFhZUMgMQBzQCFgcRBxMIFlIRBxMJFglRYwSBMCEIClOACBALFAywEw0QDlWwEw42AmOJeDkwD1SADCYpIisoJygiKiUnRCQrKCclJ0REElWwNAHAElawNAGA2URCUGOwFBAQETYBgdlEd7CAVRAS2URHsIFRLgJVwLCAVRAR2URCUGOwFBMQERAUNgLAsF9LDMGxEBXd00RCUGNCMlJjQnCwFBAQETYBgNlEY7CAVRAS2URHsIFRLgJVwLBfSwzBsRAV3dNEQlBjQjJSY0JCUGNRY4JQwUAQFleAJyAlKyewX0sXwRICFBeBNgFeUWhZsRQYNgBEQlJjQidCI1FjkSwYcAeIL0MkJCQkRIQJaCBoIGRkQIsThAeIDGRrZGRkZGRrQGRAhAqECWRkYGggZGRkaCBkiQdsIIgHEQ4WWBAHFlmeFloQGRYZEBoWGhAbFhsQHBYcEB0WHTIAFh8RWzIBNAEWJxFbMgI0ARYoMgMWKTIEFipTLABQEB5iMwUWLTIGFi5RKgFTMwcWMDIIFjZTLABQEB5iMwkWNzIKFjgyCxY5MgwWOjINFjsyDhY8UywAUBAeYjMPFj4yEBY/MhEWQTISFkQyExZIMhQWSRFbMhU0ARZHMhYWSjIXFkYyGBYvEVsyGTQBFgUyGhZFgYoqAlMzGxYDEVyAKgFTMxw0ARYIEVwyHTQBFlERXDIeNAEWCVFjH4J4ERQfXYA4JSUkJCUlLACwGCAsALAYIYCwGCJQsBgjLACwGCQsALAYJSwAsBgmUWNQCQgnXYBCsBMkY1AJCChdgEawEyZjgTAaCildXoBJsRIHExncRgaxEgcTGtxjhADLgIBAECpdXlOATC01ECsUDBIKsjQBsTYCxLGwEyDdREewEyCxVUJCKwCwEyCxVrATILFVFCy0srMqAzYBWVFjiBCimIDAQCgtXV4egFEoQiMnLSQqI0kjKSYpJLGwEyDd00RCUWMrAMSwFCmxNgHFsBMgsVVfSx8wA8bHyLiz8smwFC62t7m1NgTKukRHtBQsujYBWUIfskRoEla0NAGA2URGsBQvNgBjEla0NAGB2UREtIBVYxICFCoSFrQ0ATYBY1FjhBDRBBguXV9TYGGAZDAtLCaxsBMh3URHsBMhsVVCQVDFtURKtERHtRQYNgBEVBICFCqys4E1ATYBxbWwEyGxVrVjUWOGYNoBGjBdYoBrIysvQiwqKyuxQ1ywEyEUMTYAX0sQwrATIRQysjYBFDM2AFlCLlFjEDQUDBIKsTQBNgHDsxQ1EBE2AYBVxLATIRQxNgBfSxvCtLLdRFOzst3TRE2wEyEUMrI2ARQzNgBZQiNRY4EYqYCAQAg2XYB3sBQqsYE3AVlRY4E4wYiAwEAKN10egHqwFC2yEB6xgTeCAWOBGKmAgEAIOF2AfbAUMLGBNwFZUWOBSMKAgEAKOV1TgICwFDYSBxMasbKENwNZUWOBSMKAgEAKOl1TgIOwFDYSBxMZsbKENwNZUWOBSMKAgEAKO11TgIawFDYSBxMdsbKENwNZUWOCCMuAgEAMPF1jU4CJsBQ2ED0UDBIHExyxNgKys4Q3A1lRY4Ig0oiAwEAOPl1jHoCMI7AUNxA9FAwSBxMcsTYCsxAesoI3ggJjgxjYhIBAEj9dXmRTgJEpJhBAFAyxsjYCxVCwEyW1VrAUNhA9FAwSBxMbtTYCs7SENwNZUWOFYPlAFkFdgJYoJSsmKioxsBMlFDE2AMGxX0tAwrIUNRBCNgEwAsPEsxBD2URrsBMFEmW0NAHYxbVEWLATJbJVQ1GwFDcQPRQMEgcTG7I2AjYBWbWwEyWyVkK+f1FjhEiiQBZEXWaAoCYpKiYiKoGx97AYI7AUObATQTYBWbAUNxIHExk2AVmwFEU2AFlCU7AUNxIHExo2AVmwFEY2AF5RaFmwE0dDKFFjgSAhCEhdgKkSAhQqsBRJNgA2AVlRY4JImUAOSV2ArCopJrAUNxIHEx02AVmwFEY2AF5RaFmwFDg2AFlQsBgjUWNQCQhHXYCzsBMjY3giCkpdVIC2EgIUS7E2AWN4GQhGXYC5sBRKsBNHNgFjcBkIL12AvBICFBeFNgFjgVAhCAVdgMASBRRMEgUUTTYAsBMiNgIih2j3Y4EIEQhFXYDDEgUUTTYAsBgiUWOCeMuAARADXWdogMYtLRIEFE4SabGyNAI2AcMSBBRPEmqxsjQCNgHEEgMUULO0NgJjgViiAQoIZGuAzhIPsDQBREoSbBJVsDQBNAFjsWOBUCIQUQhtgNIkJCSwgfPCsrHrwrKx5cKysfhjgxgqDglub4DZLjASD7A0AURXEg+xNAFEUBIHFAiwNgESBxQIsTYB2WMSVbA0ARJVsTQB2WM="}].map((t)=>({id:t.id,content:_o(t.content)}));var he=`code_${Date.now().toString(36)}`,po=`
from blocks import *
import ${he}
start()
`,me={assetList:[{id:"main",type:"text/x-python",content:po}],fileList:[{id:he,type:"text/x-python"}]};import{ScratchBlocks as K}from"@blockcode/blocks-editor";class At extends K.Generator{ORDER_ATOMIC=0;ORDER_COLLECTION=1;ORDER_STRING_CONVERSION=1;ORDER_MEMBER=2.1;ORDER_FUNCTION_CALL=2.2;ORDER_EXPONENTIATION=3;ORDER_UNARY_SIGN=4;ORDER_BITWISE_NOT=4;ORDER_MULTIPLICATIVE=5;ORDER_ADDITIVE=6;ORDER_BITWISE_SHIFT=7;ORDER_BITWISE_AND=8;ORDER_BITWISE_XOR=9;ORDER_BITWISE_OR=10;ORDER_RELATIONAL=11;ORDER_LOGICAL_NOT=12;ORDER_LOGICAL_AND=13;ORDER_LOGICAL_OR=14;ORDER_CONDITIONAL=15;ORDER_LAMBDA=16;ORDER_NONE=99;constructor(){super("Python");this.addReservedWords("False,None,True,and,as,assert,break,class,continue,def,del,elif,else,except,exec,finally,for,from,global,if,import,in,is,lambda,nonlocal,not,or,pass,print,raise,return,try,while,with,yield,NotImplemented,Ellipsis,__debug__,quit,exit,copyright,license,credits,ArithmeticError,AssertionError,AttributeError,BaseException,BlockingIOError,BrokenPipeError,BufferError,BytesWarning,ChildProcessError,ConnectionAbortedError,ConnectionError,ConnectionRefusedError,ConnectionResetError,DeprecationWarning,EOFError,Ellipsis,EnvironmentError,Exception,FileExistsError,FileNotFoundError,FloatingPointError,FutureWarning,GeneratorExit,IOError,ImportError,ImportWarning,IndentationError,IndexError,InterruptedError,IsADirectoryError,KeyError,KeyboardInterrupt,LookupError,MemoryError,ModuleNotFoundError,NameError,NotADirectoryError,NotImplemented,NotImplementedError,OSError,OverflowError,PendingDeprecationWarning,PermissionError,ProcessLookupError,RecursionError,ReferenceError,ResourceWarning,RuntimeError,RuntimeWarning,StandardError,StopAsyncIteration,StopIteration,SyntaxError,SyntaxWarning,SystemError,SystemExit,TabError,TimeoutError,TypeError,UnboundLocalError,UnicodeDecodeError,UnicodeEncodeError,UnicodeError,UnicodeTranslateError,UnicodeWarning,UserWarning,ValueError,Warning,ZeroDivisionError,_,__build_class__,__debug__,__doc__,__import__,__loader__,__name__,__package__,__spec__,abs,all,any,apply,ascii,basestring,bin,bool,buffer,bytearray,bytes,callable,chr,classmethod,cmp,coerce,compile,complex,copyright,credits,delattr,dict,dir,divmod,enumerate,eval,exec,execfile,exit,file,filter,float,format,frozenset,getattr,globals,hasattr,hash,help,hex,id,input,int,intern,isinstance,issubclass,iter,len,license,list,locals,long,map,max,memoryview,min,next,object,oct,open,ord,pow,print,property,quit,range,raw_input,reduce,reload,repr,reversed,round,set,setattr,slice,sorted,staticmethod,str,sum,super,tuple,type,unichr,unicode,vars,xrange,zip,math,random,Number"),this.ORDER_OVERRIDES=[[this.ORDER_FUNCTION_CALL,this.ORDER_MEMBER],[this.ORDER_FUNCTION_CALL,this.ORDER_FUNCTION_CALL],[this.ORDER_MEMBER,this.ORDER_MEMBER],[this.ORDER_MEMBER,this.ORDER_FUNCTION_CALL],[this.ORDER_LOGICAL_NOT,this.ORDER_LOGICAL_NOT],[this.ORDER_LOGICAL_AND,this.ORDER_LOGICAL_AND],[this.ORDER_LOGICAL_OR,this.ORDER_LOGICAL_OR]]}init(t){for(let n in this)if(typeof this[n]==="function"&&!K.Generator.prototype[n])this[n]=this[n].bind(this);if(this.PASS=this.INDENT+`pass
`,this.definitions_=Object.create(null),this.functionNames_=Object.create(null),!this.variableDB_)this.variableDB_=new K.Names(this.RESERVED_WORDS_);else this.variableDB_.reset();this.variableDB_.setVariableMap(t.getVariableMap());let e=[],o=t.getAllVariables();for(let n=0;n<o.length;n++){if(o[n].type===K.BROADCAST_MESSAGE_VARIABLE_TYPE)continue;let s=this.variableDB_.getName(o[n].getId(),K.Variables.NAME_TYPE),h="0";if(o[n].type===K.LIST_VARIABLE_TYPE)s=`${s}_${K.LIST_VARIABLE_TYPE}`,h="[]";e.push(`${s} = ${h}`)}let i=K.Variables.allDeveloperVariables(t);for(let n=0;n<i.length;n++){let s=this.variableDB_.getName(i[n],K.Names.DEVELOPER_VARIABLE_TYPE),h="0";if(o[n].type===K.LIST_VARIABLE_TYPE)s=`${s}_${K.LIST_VARIABLE_TYPE}`,h="[]";e.push(`${s} = ${h}`)}if(e.length)this.definitions_.variables=e.join(`
`)}finish(t){let e=[],o=[];for(let n in this.definitions_){let s=this.definitions_[n];if(s.match(/^(from\s+\S+\s+)?import\s+\S+/))e.push(s);else o.push(s)}return delete this.definitions_,delete this.functionNames_,this.variableDB_.reset(),(e.join(`
`)+`

`+o.join(`

`)).replace(/\n\n+/g,`

`).replace(/\n*$/,`


`)+t}scrubNakedValue(t){return t+`
`}quote_(t){let e='"';if(t.indexOf('"')!==-1)if(t.indexOf("'")===-1)e="'";else t=t.replace(/"/g,"\\\"");return e+t+e}scrub_(t,e){let o="";if(!t.outputConnection?.targetConnection){let i=t.getCommentText();if(i=K.utils.wrap(i,this.COMMENT_WRAP-3),i)if(t.getProcedureDef)o+='"""'+i+`
"""
`;else o+=this.prefixLines(i+`
`,"# ");for(let n=0;n<t.inputList.length;n++)if(t.inputList[n].type==K.INPUT_VALUE){let s=t.inputList[n].connection.targetBlock();if(s){let h=this.allNestedComments(s);if(h)o+=this.prefixLines(h,"# ")}}}if(t.startHat_){let i=t.nextConnection&&t.nextConnection.targetBlock(),n=this.blockToCode(i);if(n)n=this.prefixLines(n,this.INDENT),e=e.replace(`
${this.PASS}`,`
${n}`);return o+e}if(t.parentBlock_){let i=t.nextConnection&&t.nextConnection.targetBlock(),n=this.blockToCode(i);return o+e+n}}getAdjustedInt(t,e,o,i){let n=o||0;if(t.workspace.options.oneBasedIndex)n--;let s=t.workspace.options.oneBasedIndex?"1":"0",h=n?this.ORDER_ADDITIVE:this.ORDER_NONE,l=this.valueToCode(t,e,h)||s;if(K.isNumber(l)){if(l=parseInt(l,10)+n,i)l=-l}else{if(n>0)l="int("+l+" + "+n+")";else if(n<0)l="int("+l+" - "+-n+")";else l="int("+l+")";if(i)l="-"+l}return l}eventToCode(t,e,...o){let i=this.variableDB_.getName(t,K.Variables.NAME_TYPE);if(!this.functionNames_[i])this.functionNames_[i]=0;this.functionNames_[i]+=1;let n=`${t}_${this.functionNames_[i]}`,s=`async def ${n}(${o.join(",")}):
`;return s+=`  this_func = f"{__name__}.${n}"
`,s+=`  flash = ${e}
`,s+=`${this.PASS}
`,s}}var d=At.prototype;var Eo=(t)=>{let e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,(i,n,s,h)=>n+n+s+s+h+h);let o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:null};d.colour_picker=function(t){let{r:e,g:o,b:i}=Eo(t.getFieldValue("COLOUR"));return[`(${e}, ${o}, ${i})`,this.ORDER_ATOMIC]};var wt=`  if not flash:
    await runtime.next_frame()
`;d.control_wait=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);let o=this.valueToCode(t,"DURATION",this.ORDER_NONE)||0;return e+=`await runtime.wait_for(num(${o}))
`,e};d.control_repeat=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);let o=this.statementToCode(t,"SUBSTACK")||this.PASS;if(this.STATEMENT_SUFFIX)o=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,t),this.INDENT)+o;let i=this.valueToCode(t,"TIMES",this.ORDER_NONE)||10;return e+=`for _ in range(num(${i})):
${o}${wt}`,e};d.control_forever=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);let o=this.statementToCode(t,"SUBSTACK")||this.PASS;if(this.STATEMENT_SUFFIX)o=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,t),this.INDENT)+o;return e+=`while True:
${o}${wt}`,e};d.control_if=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);let o=this.statementToCode(t,"SUBSTACK")||this.PASS;if(this.STATEMENT_SUFFIX)o=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,t),this.INDENT)+o;let i=this.valueToCode(t,"CONDITION",this.ORDER_NONE)||"False";if(e+=`if ${i}:
${o}`,t.getInput("SUBSTACK2")){if(o=this.statementToCode(t,"SUBSTACK2")||this.PASS,this.STATEMENT_SUFFIX)o=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,t),this.INDENT)+o;e+=`else:
${o}`}return e};d.control_if_else=d.control_if;d.control_wait_until=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);let o=this.valueToCode(t,"CONDITION",this.ORDER_NONE)||"False";return e+=`while not ${o}:
${wt}`,e};d.control_repeat_until=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);let o=this.statementToCode(t,"SUBSTACK")||this.PASS;if(this.STATEMENT_SUFFIX)o=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,t),this.INDENT)+o;let i=this.valueToCode(t,"CONDITION",this.ORDER_NONE)||"False";return e+=`while not ${i}:
${o}${wt}`,e};d.control_while=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);let o=this.statementToCode(t,"SUBSTACK")||this.PASS;if(this.STATEMENT_SUFFIX)o=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,t),this.INDENT)+o;let i=this.valueToCode(t,"CONDITION",this.ORDER_NONE)||"False";return e+=`while ${i}:
${o}${wt}`,e};d.control_stop=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);switch(t.getFieldValue("STOP_OPTION")){case"all":e+=`runtime.stop()
`;break;case"this script":e+=`return
`;break;case"other scripts in sprite":e+=`runtime.abort(this_func)
`;break}return e};import{ScratchBlocks as I}from"@blockcode/blocks-editor";d.data_variable=function(t){return[this.variableDB_.getName(t.getFieldValue("VARIABLE"),I.Variables.NAME_TYPE),this.ORDER_ATOMIC]};d.data_setvariableto=function(t){let e="";if(d.STATEMENT_PREFIX)e+=d.injectId(d.STATEMENT_PREFIX,t);let o=this.variableDB_.getName(t.getFieldValue("VARIABLE"),I.Variables.NAME_TYPE),i=this.valueToCode(t,"VALUE",this.ORDER_NONE)||'""';return e+=`${o} = ${i}
`,e};d.data_changevariableby=function(t){let e="";if(d.STATEMENT_PREFIX)e+=d.injectId(d.STATEMENT_PREFIX,t);let o=this.variableDB_.getName(t.getFieldValue("VARIABLE"),I.Variables.NAME_TYPE),i=this.valueToCode(t,"VALUE",this.ORDER_NONE)||0;return e+=`${o} = num(${o}) + num(${i})
`,e};d.data_listcontents=function(t){return[this.variableDB_.getName(t.getFieldValue("LIST"),I.Variables.NAME_TYPE)+"_"+I.LIST_VARIABLE_TYPE,this.ORDER_ATOMIC]};d.data_addtolist=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);let o=this.variableDB_.getName(t.getFieldValue("LIST"),I.Variables.NAME_TYPE)+"_"+I.LIST_VARIABLE_TYPE,i=this.valueToCode(t,"ITEM",this.ORDER_NONE)||'""';return e+=`${o}.append(${i})
`,e};d.data_deleteoflist=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);let o=this.variableDB_.getName(t.getFieldValue("LIST"),I.Variables.NAME_TYPE)+"_"+I.LIST_VARIABLE_TYPE,i=this.valueToCode(t,"INDEX",this.ORDER_NONE)||1;return e+=`runtime.list(${o}, 'remove', num(${i}))
`,e};d.data_deletealloflist=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);let o=this.variableDB_.getName(t.getFieldValue("LIST"),I.Variables.NAME_TYPE)+"_"+I.LIST_VARIABLE_TYPE;return e+=`${o} = []
`,e};d.data_insertatlist=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);let o=this.variableDB_.getName(t.getFieldValue("LIST"),I.Variables.NAME_TYPE)+"_"+I.LIST_VARIABLE_TYPE,i=this.valueToCode(t,"INDEX",this.ORDER_NONE)||1,n=this.valueToCode(t,"ITEM",this.ORDER_NONE)||'""';return e+=`runtime.list(${o}, 'insert', num(${i}), ${n})
`,e};d.data_replaceitemoflist=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);let o=this.variableDB_.getName(t.getFieldValue("LIST"),I.Variables.NAME_TYPE)+"_"+I.LIST_VARIABLE_TYPE,i=this.valueToCode(t,"INDEX",this.ORDER_NONE)||1,n=this.valueToCode(t,"ITEM",this.ORDER_NONE)||'""';return e+=`runtime.list(${o}, 'replace', num(${i}), ${n})
`,e};d.data_itemoflist=function(t){let e=this.variableDB_.getName(t.getFieldValue("LIST"),I.Variables.NAME_TYPE)+"_"+I.LIST_VARIABLE_TYPE,o=this.valueToCode(t,"INDEX",this.ORDER_NONE)||1;return[`runtime.list(${e}, 'get', num(${o}))`,this.ORDER_FUNCTION_CALL]};d.data_itemnumoflist=function(t){let e=this.variableDB_.getName(t.getFieldValue("LIST"),I.Variables.NAME_TYPE)+"_"+I.LIST_VARIABLE_TYPE,o=this.valueToCode(t,"ITEM",this.ORDER_NONE)||0;return[`(${e}.index(${o}) + 1)`,this.ORDER_NONE]};d.data_lengthoflist=function(t){return[`len(${this.variableDB_.getName(t.getFieldValue("LIST"),I.Variables.NAME_TYPE)+"_"+I.LIST_VARIABLE_TYPE})`,this.ORDER_FUNCTION_CALL]};d.data_listcontainsitem=function(t){let e=this.variableDB_.getName(t.getFieldValue("LIST"),I.Variables.NAME_TYPE)+"_"+I.LIST_VARIABLE_TYPE,o=this.valueToCode(t,"ITEM",this.ORDER_NONE)||0;return[`bool(${e}.count(${o}))`,this.ORDER_FUNCTION_CALL]};import{ScratchBlocks as _e}from"@blockcode/blocks-editor";d.event_whenflagclicked=function(){return`@when_start
${this.eventToCode("start","False")}`};d.event_whengreaterthan=function(t){let e=t.getFieldValue("WHENGREATERTHANMENU"),o=this.valueToCode(t,"VALUE",this.ORDER_NONE)||0,i=this.eventToCode("greaterthen","False");return`@when_greaterthen("${e}", num(${o}))
${i}`};d.event_whenbroadcastreceived=function(t){let e=this.variableDB_.getName(t.getFieldValue("BROADCAST_OPTION"),_e.Variables.NAME_TYPE),o=this.eventToCode("broadcastreceived","False");return`@when_broadcastreceived("${e}")
${o}`};d.event_broadcast_menu=function(t){return[this.variableDB_.getName(t.getFieldValue("BROADCAST_OPTION"),_e.Variables.NAME_TYPE),this.ORDER_ATOMIC]};d.event_broadcast=function(t){return`runtime.broadcast("${this.valueToCode(t,"BROADCAST_INPUT",this.ORDER_NONE)||"message1"}")
`};d.event_broadcastandwait=function(t){return`await runtime.broadcast("${this.valueToCode(t,"BROADCAST_INPUT",this.ORDER_NONE)||"message1"}", waiting=True)
`};d.math_number=function(t){let e=parseFloat(t.getFieldValue("NUM")),o;if(e===1/0)e='float("inf")',o=this.ORDER_FUNCTION_CALL;else if(e===-1/0)e='-float("inf")',o=this.ORDER_UNARY_SIGN;else if(Number.isNaN(e))e='float("nan")',o=this.ORDER_UNARY_SIGN;else o=e<0?this.ORDER_UNARY_SIGN:this.ORDER_ATOMIC;return[e,o]};d.math_integer=function(t){let e=parseInt(t.getFieldValue("NUM")),o=e<0?this.ORDER_UNARY_SIGN:this.ORDER_ATOMIC;return[e,o]};d.math_whole_number=function(t){return[Math.abs(parseInt(t.getFieldValue("NUM"))),this.ORDER_ATOMIC]};d.math_positive_number=function(t){let e=parseFloat(t.getFieldValue("NUM")),o;if(e===1/0)e='float("inf")',o=this.ORDER_FUNCTION_CALL;else if(e===-1/0)e='-float("inf")',o=this.ORDER_FUNCTION_CALL;else if(Number.isNaN(e))e='float("nan")',o=this.ORDER_FUNCTION_CALL;else e=e<0?0:e,o=this.ORDER_ATOMIC;return[e,o]};d.math_angle=function(t){let e=parseFloat(t.getFieldValue("NUM")),o;if(e==1/0)e='float("inf")',o=this.ORDER_FUNCTION_CALL;else if(e==-1/0)e='-float("inf")',o=this.ORDER_UNARY_SIGN;else e=e%360,e=e<0?e+360:e,o=this.ORDER_ATOMIC;return[e,o]};d.operator_add=function(t){let e=this.valueToCode(t,"NUM1",this.ORDER_NONE)||0,o=this.valueToCode(t,"NUM2",this.ORDER_NONE)||0;return[`(num(${e}) + num(${o}))`,this.ORDER_SUBTRACTION]};d.operator_subtract=function(t){let e=this.valueToCode(t,"NUM1",this.ORDER_NONE)||0,o=this.valueToCode(t,"NUM2",this.ORDER_NONE)||0;return[`(num(${e}) - num(${o}))`,this.ORDER_SUBTRACTION]};d.operator_multiply=function(t){let e=this.valueToCode(t,"NUM1",this.ORDER_NONE)||0,o=this.valueToCode(t,"NUM2",this.ORDER_NONE)||0;return[`(num(${e}) * num(${o}))`,this.ORDER_SUBTRACTION]};d.operator_divide=function(t){let e=this.valueToCode(t,"NUM1",this.ORDER_NONE)||0,o=this.valueToCode(t,"NUM2",this.ORDER_NONE)||0;return[`(num(${e}) / num(${o}))`,this.ORDER_SUBTRACTION]};d.operator_random=function(t){let e=this.valueToCode(t,"FROM",this.ORDER_NONE)||0,o=this.valueToCode(t,"TO",this.ORDER_NONE)||0;return[`runtime.random(${e}, ${o})`,this.ORDER_FUNCTION_CALL]};d.operator_gt=function(t){let e=this.valueToCode(t,"OPERAND1",this.ORDER_NONE)||0,o=this.valueToCode(t,"OPERAND2",this.ORDER_NONE)||0;return[`(num(${e}) > num(${o}))`,this.ORDER_RELATIONAL]};d.operator_lt=function(t){let e=this.valueToCode(t,"OPERAND1",this.ORDER_NONE)||0,o=this.valueToCode(t,"OPERAND2",this.ORDER_NONE)||0;return[`(num(${e}) < num(${o}))`,this.ORDER_RELATIONAL]};d.operator_equals=function(t){let e=this.valueToCode(t,"OPERAND1",this.ORDER_NONE)||0,o=this.valueToCode(t,"OPERAND2",this.ORDER_NONE)||0;return[`runtime.equals(${e}, ${o})`,this.ORDER_FUNCTION_CALL]};d.operator_and=function(t){let e=this.valueToCode(t,"OPERAND1",this.ORDER_NONE)||"False",o=this.valueToCode(t,"OPERAND2",this.ORDER_NONE)||"False";return[`(${e} and ${o})`,this.ORDER_LOGICAL_AND]};d.operator_or=function(t){let e=this.valueToCode(t,"OPERAND1",this.ORDER_NONE)||"False",o=this.valueToCode(t,"OPERAND2",this.ORDER_NONE)||"False";return[`(${e} or ${o})`,this.ORDER_LOGICAL_OR]};d.operator_not=function(t){return[`(not ${this.valueToCode(t,"OPERAND",this.ORDER_NONE)||"False"})`,this.ORDER_LOGICAL_NOT]};d.operator_join=function(t){let e=this.valueToCode(t,"STRING1",this.ORDER_NONE)||'""',o=this.valueToCode(t,"STRING2",this.ORDER_NONE)||'""';return[`(str(${e}) + str(${o}))`,this.ORDER_ATOMIC]};d.operator_letter_of=function(t){let e=this.valueToCode(t,"LETTER",this.ORDER_NONE)||1;return[`runtime.list(str(${this.valueToCode(t,"STRING",this.ORDER_NONE)||'""'}), 'get', num(${e}))`,this.ORDER_FUNCTION_CALL]};d.operator_length=function(t){return[`len(str(${this.valueToCode(t,"STRING",this.ORDER_NONE)||'""'}))`,this.ORDER_FUNCTION_CALL]};d.operator_contains=function(t){let e=this.valueToCode(t,"STRING1",this.ORDER_NONE)||'""',o=this.valueToCode(t,"STRING2",this.ORDER_NONE)||'""';return[`(str(${e}).count(str(${o})) > 0)`,this.ORDER_FUNCTION_CALL]};d.operator_mod=function(t){let e=this.valueToCode(t,"NUM1",this.ORDER_NONE)||0,o=this.valueToCode(t,"NUM2",this.ORDER_NONE)||0;return[`(num(${e}) % num(${o}))`,this.ORDER_MODULUS]};d.operator_round=function(t){return this.definitions_.import_math="import math",[`math.round(num(${this.valueToCode(t,"NUM",this.ORDER_NONE)||0}))`,this.ORDER_FUNCTION_CALL]};d.operator_mathop=function(t){this.definitions_.import_math="import math";let e=this.valueToCode(t,"NUM",this.ORDER_NONE)||0,o=t.getFieldValue("OPERATOR"),i="";if(o==="ceiling")i+=`math.ceil(num(${e}))`;else if(o==="sin"||o==="cos"||o==="tan")i+=`math.${o}(math.radians(num(${e})))`;else if(o==="asin"||o==="acos"||o==="atan")i+=`math.degrees(math.${o}(num(${e})))`;else if(o==="ln")i+=`(math.log(num(${e}))`;else if(o==="log")i+=`(math.log10(num(${e}))`;else if(o==="e ^")i+=`math.exp(num(${e}))`;else if(o==="10 ^")i+=`math.pow(10, num(${e}))`;else i+=`math.${o}(num(${e}))`;return[i,this.ORDER_FUNCTION_CALL]};import{ScratchBlocks as bt}from"@blockcode/blocks-editor";d.procedures_definition=function(t){let e=t.childBlocks_[0],o=this.variableDB_.getName(e.getProcCode(),bt.Procedures.NAME_TYPE),i=e.childBlocks_.map((s)=>this.variableDB_.getName(s.getFieldValue("VALUE"),bt.Variables.NAME_TYPE)),n=this.eventToCode("procedure",e.warp_?"True":"False",...i);return`@when_procedure("${o}")
${n}`};d.procedures_call=function(t){let e=this.variableDB_.getName(t.getProcCode(),bt.Procedures.NAME_TYPE),o=t.argumentIds_.map((n)=>this.valueToCode(t,n,this.ORDER_NONE)),i=o.length>0?`, ${o.join(", ")}`:"";return`await runtime.procedure_call("${e}"${i})
`};d.argument_reporter_boolean=function(t){return[this.variableDB_.getName(t.getFieldValue("VALUE"),bt.Variables.NAME_TYPE),this.ORDER_ATOMIC]};d.argument_reporter_string_number=function(t){return[this.variableDB_.getName(t.getFieldValue("VALUE"),bt.Variables.NAME_TYPE),this.ORDER_ATOMIC]};d.sensing_timer=function(){return["runtime.time",this.ORDER_MEMBER]};d.sensing_resettimer=function(){return`runtime.reset_timer()
`};d.sensing_debug=function(t){return`print(${this.valueToCode(t,"VALUE",this.ORDER_NONE)||'"debug"'})
`};d.text=function(t){let e=t.getFieldValue("TEXT");return[e.length===0||isNaN(e)?this.quote_(e):+e,this.ORDER_ATOMIC]};class pe extends At{init(t){super.init(t),this.definitions_.import_blocks="from blocks import *"}}var Ee=new pe;import{useEffect as Xo,useState as vt}from"preact/hooks";import{useLocale as ko,useLayout as Ko,useEditor as Le}from"@blockcode/core";import{classNames as Yo}from"@blockcode/ui";import{BlocksEditor as Go,ScratchBlocks as X,makeToolboxXML as Zo}from"@blockcode/blocks-editor";import{ScratchBlocks as Gt,blockSeparator as No}from"@blockcode/blocks-editor";var To=1,Co=2,fo=3,Zt="#0FBD8C",Ht="#0DA57A",Ne="#0B8E69",rt=(t)=>{if(typeof t!=="string")if(Array.isArray(t))t=String(t);else return t;return t.replace(/[<>&'"]/g,(e)=>{switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}})},Te={number:"math_number",angle:"math_angle",text:"text",string:"text",color:"colour_picker",matrix:"matrix",note:"note"},Ce={number:"NUM",angle:"NUM",text:"TEXT",string:"TEXT",matrix:"MATRIX",note:"NOTE"};function Bt(t,e,o,i,n){let{id:s}=e,h=i(e.name),l=`<category name="${rt(h)}" id="${rt(s)}"`;if(l+=` colour="${rt(e.themeColor||Zt)}"`,l+=` secondaryColour="${rt(e.inputColor||Ht)}"`,e.connectionConfig)l+=' showStatusButton="true"';if(e.iconURI)l+=` iconURI="${rt(e.iconURI)}"`;return l+=">",e.menus=e.menus||{},e.blocks.filter((m)=>!m.hidden).forEach((m)=>{if(m==="---"){l+=`${No}`;return}if(m.button){l+=`<button text="${i(m.text)}" callbackKey="${m.button}"></button>`;let _=Gt.getMainWorkspace();if(_){let p=_.getFlyout();if(p){let E=p.getWorkspace();if(E)E.registerButtonCallback(m.button,n(m.onClick))}}return}if(o&&m.useStage===!1)return;if(!o&&m.useSprite===!1)return;let O=`${s}_${m.id}`,C={message0:i(m.text),category:s,outputShape:fo,colour:e.themeColor||Zt,colourSecondary:e.inputColor||Ht,colourTertiary:e.otherColor||Ne},N=1;if(e.iconURI)C.message0=`%1 %2 ${C.message0}`,C.args0=[{type:"field_image",src:e.iconURI,width:40,height:40},{type:"field_vertical_separator"}],C.extensions=["scratch_extension"],N+=2;if(m.hat)C.nextStatement=null;else if(m.output){if(m.output==="boolean")C.output="Boolean",C.outputShape=To;else C.output="String",C.outputShape=Co;C.checkboxInFlyout=m.monitoring!==!1}else C.previousStatement=null,C.nextStatement=null;let g=`<block type="${rt(O)}">`;if(m.inputs)C.checkboxInFlyout=!1,C.args0=[].concat(C.args0||[],Object.entries(m.inputs).map(([_,p])=>{let E={name:_,type:"input_value"};if(p.menu){let v=p.menu,V=p.name||_,F=p.inputMode||!1,U=p.type||"string",S=p.default||"";if(typeof p.menu==="string")V=p.menu,v=e.menus[V];if(!Array.isArray(v))F=v.inputMode||F,U=v.type||U,S=v.default||S,v=v.items;if(F){if(!e.menus[V])e.menus[V]={inputMode:F,type:U,items:v};if(g+=`<value name="${rt(_)}">`,g+=`<shadow type="${s}_menu_${V}">`,S)g+=`<field name="${V}">${rt(i(S))}</field>`;g+="</shadow></value>"}else if(v)E.type="field_dropdown",E.options=v.map((G)=>{if(Array.isArray(G)){let[ct,ht]=G;return[i(ct),ht]}return G=`${G}`,[G,G]})}else if(p.type==="boolean")E.check="Boolean";else{if(g+=`<value name="${rt(_)}">`,Te[p.type]){if(g+=`<shadow type="${Te[p.type]}">`,p.default&&Ce[p.type])g+=`<field name="${Ce[p.type]}">${rt(i(p.default))}</field>`;g+="</shadow>"}g+="</value>"}return C.message0=C.message0.replace(`[${_}]`,`%${N++}`),E}));Gt.Blocks[O]={init(){this.jsonInit(C)}};for(let _ of t){let p=_.name_.toLowerCase();if(m[p])_[O]=m[p].bind(_);else _[O]=()=>""}g+="</block>",l+=g}),Object.entries(e.menus).forEach(([m,O])=>{if(!O.inputMode)return;let C=`${s}_menu_${m}`,N=O.type==="number"?"output_number":"output_string",g={message0:"%1",args0:[{type:"field_dropdown",name:m,options:O.items.map((_)=>{if(Array.isArray(_)){let[p,E]=_;return[i(p),E]}return _=`${_}`,[_,_]})}],category:s,colour:e.themeColor||Zt,colourSecondary:e.inputColor||Ht,colourTertiary:e.otherColor||Ne,extensions:[N]};Gt.Blocks[C]={init(){this.jsonInit(g)}};for(let _ of t)_[C]=(p)=>{return[p.getFieldValue(m),_.ORDER_ATOMIC]}}),l+="</category>",l}import{useRef as Ro,useEffect as Oo,useState as fe}from"preact/hooks";import{classNames as go,Text as ft,Button as Re,Modal as Ao,BufferedInput as wo}from"@blockcode/ui";function st(t){let e=globalThis.document,o=e.createElement("style");o.appendChild(e.createTextNode(t)),e.head.append(o)}st("._5SVWFW_prompt-modal{width:360px}._5SVWFW_prompt-content{background:var(--ui-white);padding:1.5rem 2.25rem}._5SVWFW_prompt-content input[type=checkbox],._5SVWFW_prompt-content input[type=radio]{margin:3px}._5SVWFW_label{margin:0 0 .75rem;font-weight:500}._5SVWFW_variable-name-text-input{border:1px solid var(--ui-black-transparent);color:var(--text-primary-transparent);border-radius:5px;width:100%;height:3rem;margin-bottom:1.5rem;padding:0 1rem;font-size:.875rem}._5SVWFW_info-message{text-align:center;margin-bottom:1.5rem;font-size:.875rem;font-weight:400}._5SVWFW_options{justify-content:space-between;margin-bottom:1.5rem;font-weight:400;display:flex}._5SVWFW_button-row{text-align:right;font-weight:bolder}._5SVWFW_button{padding:.75rem 1rem;font-size:.85rem;font-weight:600}._5SVWFW_ok-button{background:var(--motion-primary);border:var(--motion-primary);color:var(--ui-white);margin-left:var(--space)}");var nt={variableNameTextInput:"_5SVWFW_variable-name-text-input",okButton:"_5SVWFW_ok-button",promptModal:"_5SVWFW_prompt-modal",promptContent:"_5SVWFW_prompt-content",button:"_5SVWFW_button",infoMessage:"_5SVWFW_info-message",buttonRow:"_5SVWFW_button-row",label:"_5SVWFW_label",options:"_5SVWFW_options"};import{jsx as Y,jsxs as Mt}from"preact/jsx-runtime";function zt({title:t,label:e,defaultValue:o,enableLocalVariable:i,showListMessage:n,showVariableOptions:s,showCloudOption:h,onClose:l,onSubmit:m}){let O=Ro(null),[C,N]=fe(o),[g,_]=fe({scope:"global",isCloud:!1}),p=()=>{m(C,g)},E=(v)=>{if(v.key==="Escape")l();if(v.key==="Enter")m(O.current.base.value,g)};return Oo(()=>{if(O.current)O.current.base.focus(),window.addEventListener("keydown",E);return()=>{window.removeEventListener("keydown",E)}},[O]),Y(Ao,{title:t,className:nt.promptModal,onClose:l,children:Mt("div",{className:nt.promptContent,children:[Y("div",{className:nt.label,children:e}),Y(wo,{autoFocus:!0,forceFocus:!0,ref:O,className:nt.variableNameTextInput,defaultValue:C,onSubmit:N}),s&&Y("div",{children:i?Mt("div",{className:nt.options,children:[Mt("label",{children:[Y("input",{checked:g.scope==="global",name:"variableScopeOption",type:"radio",value:"global",onChange:()=>_({...g,scope:"global"})}),Y(ft,{id:"blocks.dataPrompt.forAllTargets",defaultMessage:"For all targets"})]}),Mt("label",{children:[Y("input",{checked:g.scope==="local",name:"variableScopeOption",type:"radio",value:"local",onChange:()=>_({...g,scope:"local"})}),Y(ft,{id:"blocks.dataPrompt.forThisTarget",defaultMessage:"For this target only"})]})]}):Y("div",{className:nt.infoMessage,children:n?Y(ft,{id:"blocks.dataPrompt.listAvailableToAllTargets",defaultMessage:"This list will be available to all targets."}):Y(ft,{id:"blocks.dataPrompt.availableToAllTargets",defaultMessage:"This variable will be available to all targets."})})}),Mt("div",{className:nt.buttonRow,children:[Y(Re,{className:nt.button,onClick:l,children:Y(ft,{id:"blocks.prompt.cancel",defaultMessage:"Cancel"})}),Y(Re,{className:go(nt.button,nt.okButton),onClick:p,children:Y(ft,{id:"blocks.prompt.ok",defaultMessage:"OK"})})]})]})})}import{useRef as Do,useEffect as Lo,useState as we}from"preact/hooks";import{classNames as So,Text as lt,Button as be,Modal as Io}from"@blockcode/ui";import{ScratchBlocks as St}from"@blockcode/blocks-editor";st(".ObKnhW_prompt-modal{width:700px;margin:50px auto}.ObKnhW_body{background:var(--ui-white);padding:1.5rem 2.25rem}.ObKnhW_body input[type=checkbox],.ObKnhW_body input[type=radio]{margin:3px}.ObKnhW_workspace{min-height:200px;position:relative}.ObKnhW_workspace .injectionDiv{position:absolute;inset:0}.ObKnhW_workspace .blocklySvg{background-color:var(--ui-primary)}.ObKnhW_options-row{justify-content:space-between;display:flex}.ObKnhW_option-card{border:2px solid var(--ui-black-transparent);border-radius:var(--space);padding:calc(var(--space)*2);text-align:center;cursor:pointer;background:#fff;flex-grow:1;flex-basis:100px;transition:all .2s}.ObKnhW_option-card:hover{border:2px solid var(--motion-primary);box-shadow:0px 0px 0px 4px var(--motion-transparent)}.ObKnhW_option-card+.ObKnhW_option-card{margin-left:1rem}.ObKnhW_option-icon{max-height:48px;margin-bottom:.5rem}.ObKnhW_option-title{font-weight:700}.ObKnhW_radiobox-row{justify-content:space-between;margin:1rem 6rem 1.5rem;font-weight:400;display:flex}.ObKnhW_checkbox-row{margin-top:1rem}.ObKnhW_button-row{text-align:right;margin-top:1rem;font-weight:bolder}.ObKnhW_button-row button{border:1px solid var(--ui-black-transparent);background:#fff;border-radius:.25rem;padding:.75rem 1rem;font-size:.85rem;font-weight:700}.ObKnhW_button-row button.ObKnhW_ok-button{background:var(--motion-primary);border:var(--motion-primary);color:#fff}.ObKnhW_button-row button+button{margin-left:.5rem}");var y={radioboxRow:"ObKnhW_radiobox-row",checkboxRow:"ObKnhW_checkbox-row",buttonRow:"ObKnhW_button-row",optionIcon:"ObKnhW_option-icon",body:"ObKnhW_body",promptModal:"ObKnhW_prompt-modal",optionTitle:"ObKnhW_option-title",workspace:"ObKnhW_workspace",optionsRow:"ObKnhW_options-row",okButton:"ObKnhW_ok-button",optionCard:"ObKnhW_option-card"};var Oe="./assets/icon-boolean-input-v045mxhp.svg";var ge="./assets/icon-text-input-3m98080h.svg";var Ae="./assets/icon-label-a0d2gknc.svg";import{jsx as P,jsxs as Et}from"preact/jsx-runtime";var Fo={zoom:{controls:!1,wheel:!1,startScale:0.9},comments:!1,collapse:!1,scrollbars:!0};function Jt({mutator:t,onClose:e,onSubmit:o}){let i=Do(null),[n,s]=we("command"),[h,l]=we(!1),m=()=>{},O=()=>{if(i.mutationRoot)i.mutationRoot.addLabelExternal()},C=()=>{if(i.mutationRoot)i.mutationRoot.addBooleanExternal()},N=()=>{if(i.mutationRoot)i.mutationRoot.addStringNumberExternal()},g=()=>{let p=!i.mutationRoot.getWarp();i.mutationRoot.setWarp(p),l(p)},_=()=>{o(i.mutationRoot?.mutationToDom(!0))};return Lo(()=>{if(i.current){let p=St.Blocks.defaultToolbox;St.Blocks.defaultToolbox=null,i.workspace=St.inject(i.current,Object.assign({},Fo,{media:"./assets/blocks-media/"})),St.Blocks.defaultToolbox=p,i.mutationRoot=i.workspace.newBlock("procedures_declaration"),i.mutationRoot.setMovable(!1),i.mutationRoot.setDeletable(!1),i.mutationRoot.contextMenu=!1,i.workspace.addChangeListener(()=>{i.mutationRoot.onChangeFn();let E=i.workspace.getMetrics(),{x:v,y:V}=i.mutationRoot.getRelativeToSurfaceXY(),F=E.viewHeight/2-i.mutationRoot.height/2-V,U=E.viewWidth/2-i.mutationRoot.width/2-v;if(i.mutationRoot.width>E.viewWidth)U=E.viewWidth-i.mutationRoot.width-v;i.mutationRoot.moveBy(U,F)}),i.mutationRoot.domToMutation(t),i.mutationRoot.initSvg(),i.mutationRoot.render(),l(i.mutationRoot.getWarp()),setTimeout(()=>{i.mutationRoot.focusLastEditor_()})}return()=>{if(i.workspace)i.workspace.dispose()}},[i]),Et(Io,{title:P(lt,{id:"blocks.myBlockPrompt.title",defaultMessage:"Make a Block"}),className:y.promptModal,onClose:e,children:[P("div",{ref:i,className:y.workspace}),Et("div",{className:y.body,children:[Et("div",{className:y.optionsRow,children:[Et("div",{role:"button",className:y.optionCard,onClick:N,children:[P("img",{className:y.optionIcon,src:ge}),P("div",{className:y.optionTitle,children:P(lt,{id:"blocks.myBlockPrompt.addAnInputNumberText",defaultMessage:"Add an input"})}),P("div",{className:y.optionDescription,children:P(lt,{id:"blocks.myBlockPrompt.numberTextType",defaultMessage:"number or text"})})]}),Et("div",{role:"button",className:y.optionCard,onClick:C,children:[P("img",{className:y.optionIcon,src:Oe}),P("div",{className:y.optionTitle,children:P(lt,{id:"blocks.myBlockPrompt.addAnInputBoolean",defaultMessage:"Add an input"})}),P("div",{className:y.optionDescription,children:P(lt,{id:"blocks.myBlockPrompt.booleanType",defaultMessage:"boolean"})})]}),Et("div",{role:"button",className:y.optionCard,onClick:O,children:[P("img",{className:y.optionIcon,src:Ae}),P("div",{className:y.optionTitle,children:P(lt,{id:"blocks.myBlockPrompt.addALabel",defaultMessage:"Add a label"})})]})]}),P("div",{className:y.checkboxRow,children:Et("label",{children:[P("input",{checked:h,type:"checkbox",onChange:g}),P(lt,{id:"blocks.myBlockPrompt.flash",defaultMessage:"Run without process."})]})}),Et("div",{className:y.buttonRow,children:[P(be,{className:y.button,onClick:e,children:P(lt,{id:"blocks.prompt.cancel",defaultMessage:"Cancel"})}),P(be,{className:So(y.button,y.okButton),onClick:_,children:P(lt,{id:"blocks.prompt.ok",defaultMessage:"OK"})})]})]})]})}import{useEffect as Po,useState as ve}from"preact/hooks";import{useLocale as yo}from"@blockcode/core";import{Library as $o}from"@blockcode/ui";var Me=["brain","broadcast","color-sensor","light","mqtt","nes","pen","request","servo","text","time","translate","wedo2"].map(async(t)=>{let{default:e}=await import(`@blockcode/extension-${t}`);return e.id=t,e});import{jsx as Uo}from"preact/jsx-runtime";var Vo=Promise.all(Me);function Qt({onSelect:t,onClose:e,onFilter:o}){let[i,n]=ve([]),[s,h]=ve(!1),{language:l,getText:m}=yo(),O=(C)=>{let N=C.tags||[],g=["blocks"];if(o)g=o(N);if(Array.isArray(g))return g.some((_)=>{if(Array.isArray(_))return _.every((p)=>p[0]==="!"?!N.includes(p.slice(1)):N.includes(p));return N.includes(_)});return g};return Po(()=>{Vo.then((C)=>{n(C.filter(O).map((N)=>Object.assign({...N,featured:!0,hidden:N.hidden||window.electron&&(N.preview||N.disabled),disabled:N.disabled||N.preview,onSelect:()=>{t(N.id),e()}},N.translations&&N.translations[l]?{name:N.translations[l].name||N.name,description:N.translations[l].description||N.description,collaborator:N.translations[l].collaborator||N.collaborator}:{}))),h(!1)})},[]),Uo($o,{filterable:!0,loading:s,items:i,filterPlaceholder:m("gui.library.search","Search"),title:m("blocks.extensions.addExtension","Add Extension"),emptyText:m("blocks.extensions.empty","No extension!"),onClose:e})}st('.cujmXa_editor-wrapper{border-radius:inherit;width:100%;height:100%;position:relative}.cujmXa_extension-button{z-index:var(--z-index-extension-button);background:var(--motion-primary);border:1px solid var(--motion-primary);box-sizing:content-box;border-bottom-left-radius:inherit;border-top:0;height:3.25rem;position:absolute;bottom:-1px;left:-1px}.cujmXa_extension-button:before{--fade-out-distance:15px;content:"";top:calc(calc(-1*var(--fade-out-distance)));height:var(--fade-out-distance);background:linear-gradient(#0000,#00000026);position:absolute;left:0;right:0}.cujmXa_add-button{cursor:pointer;background:0 0;border:none;outline:none;width:100%;height:100%}.cujmXa_add-button img{width:1.75rem;height:1.75rem}');var It={editorWrapper:"cujmXa_editor-wrapper",extensionButton:"cujmXa_extension-button",addButton:"cujmXa_add-button"};var De="./assets/icon-extension-61vrne2y.svg";import{jsx as Nt,jsxs as zo,Fragment as Bo}from"preact/jsx-runtime";var it=new Map,Se=(t)=>typeof t!=="string"&&!t.button,Ho=async(t,e,o,i)=>{if(t){for(let n of t)if(!it.has(n)){let{default:s}=await import(`@blockcode/extension-${n}/blocks`);if(s.id=n,s.files)for(let h of s.files){let l=`extensions/${n}/${h.name}`,m=await fetch(h.uri).then((O)=>O.text());try{o({...h,id:l,content:m})}catch(O){}}if(e(s.translations),i)i({...s,blocks:s.blocks.filter(Se)});it.set(n,s)}}};function Ft({toolbox:t,messages:e,generators:o,enableMultiTargets:i,enableLocalVariable:n,disableGenerator:s,disableExtension:h,onChange:l,onExtensionsFilter:m,onLoadExtension:O}){let{addLocaleData:C,getText:N,maybeLocaleText:g}=ko(),{splash:_,createPrompt:p,createAlert:E,removeAlert:v,setSplash:V}=Ko(),{editor:F,fileList:U,selectedFileId:S,openFile:G,modifyFile:ct,addAsset:ht,setModified:Rt}=Le(),[J,T]=vt(),[r,u]=vt(!1),[a,c]=vt(!1),[w,b]=vt(!1),[D,H]=vt(!1);e={EVENT_WHENPROGRAMSTART:N("blocks.event.programStart","when program start"),CONTROL_STOP_OTHER:N("blocks.control.stopOther","other scripts"),PROCEDURES_ADD_LABEL:N("blocks.myblock.addLabel"," label text"),PROCEDURES_ADD_BOOLEAN:N("blocks.myblock.addBoolean","boolean"),PROCEDURES_ADD_STRING_NUMBER:N("blocks.myblock.addNumbetText","number or text"),...e||[]},Xo(()=>{X.prompt=(A,L,M,k,ot)=>{let dt={callback:M,message:A,defaultValue:L};dt.title=k?k:X.Msg.VARIABLE_MODAL_TITLE,dt.varType=typeof ot==="string"?ot:X.SCALAR_VARIABLE_TYPE,dt.showVariableOptions=i&&ot!==X.BROADCAST_MESSAGE_VARIABLE_TYPE&&dt.title!==X.Msg.RENAME_VARIABLE_MODAL_TITLE&&dt.title!==X.Msg.RENAME_LIST_MODAL_TITLE,dt.showCloudOption=ot===X.SCALAR_VARIABLE_TYPE&&this.props.canUseCloud,u(dt)},X.FlyoutExtensionCategoryHeader.getExtensionState=(A)=>{if(!it.has(A))return;let L=it.get(A),{statusButton:M}=L;if(!M)return X.StatusButtonState.NOT_READY;if(M.storage){if(M.storage.every((k)=>localStorage.getItem(k.id)))return X.StatusButtonState.READY;return X.StatusButtonState.NOT_READY}if(M.onUpdate?.())return X.StatusButtonState.READY;return X.StatusButtonState.NOT_READY};let R=()=>X.refreshStatusButtons(J);X.statusButtonCallback=(A)=>{if(!it.has(A))return;let L=it.get(A),{statusButton:M}=L;if(!M)return;if(M.storage){p({title:L.name,label:M.title,inputMode:M.storage.map((k)=>({name:k.id,placeholder:k.text,defaultValue:localStorage.getItem(k.id)})),body:M.description,onSubmit:(k)=>{Object.entries(k).forEach(([ot,dt])=>localStorage.setItem(ot,dt)),R()}});return}M.onClick?.(R)},X.Procedures.externalProcedureDefCallback=(A,L)=>{c({mutator:A,defCallback:L})}},[J]);let Q;if(J)Q=J.getAllVariables().filter((R)=>{if(R.isLocal)return!1;if(R.type===X.BROADCAST_MESSAGE_VARIABLE_TYPE){if(R.name===X.Msg.DEFAULT_BROADCAST_MESSAGE_NAME)return!1;let A=R.id_.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),L=new RegExp(`<field name="BROADCAST_OPTION" id="${A}"[^>]+>[^<]+</field>`,"g");for(let M of U)if(L.test(M.xml))return!0;return!1}return!0});let Z=t||Zo(),q=S===U[0].id,j=(R)=>R.bind(null,{context:Le(),createPrompt:p,createAlert:E,removeAlert:v});it.forEach((R)=>{Z+=Bt(o,R,q,g,j)});let $=(R)=>{let A=`
`;if(!s)A=o[0]?.workspaceToCode(R);let L=Array.from(new Set(Object.values(R.blockDB_).filter((M)=>it.has(M.category_)).map((M)=>M.category_)));return{content:A,extensions:L}},x=(R,A)=>{let{content:L,extensions:M}=$(A);if(ct({xml:R,content:L,extensions:M}),l)l(R,A)},W=(R,A)=>{r.callback(R,[],A),u(!1)},f=(R)=>{if(R&&J&&a)a.defCallback(R),J.refreshToolboxSelection_(),J.toolbox_.scrollToCategoryById("myBlocks");c(!1)},B=()=>{u(!1),c(!1)},tt=()=>b(!0),et=()=>b(!1),Dt=async(R)=>{if(!it.has(R)){E("importing",{id:R});let{default:A}=await import(`@blockcode/extension-${R}/blocks`);if(A.id=R,A.files)for(let L of A.files){let M=`extensions/${R.replace(/[^a-z\d]/gi,"_")}/${L.name}`,k=await fetch(L.uri).then((ot)=>ot.text());try{ht({...L,id:M,content:k})}catch(ot){}}if(C(A.translations),O)O({...A,blocks:A.blocks.filter(Se)});it.set(A.id,A),v(R)}setTimeout(()=>{J.toolbox_.setSelectedCategoryById(R)},50)};if(_){if(_===!0&&D===!1)it.clear(),H(Ho(F.extensions,C,ht,O).then(()=>{setTimeout(()=>H(!0),50)}));if(J&&D===!0){Q=[];let R=_;if(U.length===1||R===S)V(!1),H(!1),setTimeout(()=>Rt(!1),50);else{let A=U.findIndex((k)=>k.id===S)||0,L=U[A],M=U.at(A-1).id;setTimeout(()=>{if(_===!0)V(S),G(M);else if(L.content)G(M)})}}}let Ot=!0;if(F.extensions)Ot=F.extensions.every((R)=>it.has(R));return Nt(Bo,{children:zo("div",{className:It.editorWrapper,children:[Nt(Go,{toolbox:Z,messages:e,extensionsLoaded:Ot,globalVariables:Q,onWorkspaceCreated:T,onChange:x}),h?null:Nt("div",{className:Yo("scratchCategoryMenu",It.extensionButton),children:Nt("button",{className:It.addButton,title:N("blocks.extensions.addExtension","Add Extension"),onClick:tt,children:Nt("img",{src:De,title:"Add Extension"})})}),r&&Nt(zt,{title:r.title,label:r.message,defaultValue:r.defaultValue,enableLocalVariable:n,showListMessage:r.varType===X.LIST_VARIABLE_TYPE,showVariableOptions:r.showVariableOptions,showCloudOption:r.showCloudOption,onClose:B,onSubmit:W}),a&&Nt(Jt,{mutator:a.mutator,onClose:B,onSubmit:f}),w&&Nt(Qt,{onFilter:m,onSelect:Dt,onClose:et})]})})}import{useEditor as Jo}from"@blockcode/core";st(".MfXpyq_code-review{background:#fff;width:100%;height:100%;font-size:1rem;overflow:auto}.MfXpyq_code-review pre{margin:calc(var(--space)/2);counter-reset:line}.MfXpyq_code-review pre span{user-select:text;line-height:1.25rem;display:block}.MfXpyq_code-review pre span:before{counter-increment:line;content:counter(line);text-align:right;color:var(--text-primary-transparent);border-right:1px solid #ddd;width:40px;margin-right:.5em;padding:0 .5em;display:inline-block}");var Ie={codeReview:"MfXpyq_code-review"};import{jsx as qt}from"preact/jsx-runtime";function jt(){let{fileList:t,selectedFileId:e}=Jo(),o=t.find((n)=>n.id===e),i=[];if(o?.content)i=o.content.split(`
`);return qt("div",{className:Ie.codeReview,children:qt("pre",{children:i.map((n)=>qt("span",{children:n}))})})}var Fe="./assets/icon-blocks-vgmb334q.svg";var Pe="./assets/icon-review-th668gym.svg";var ye={"blocks.menu.file":"File","blocks.menu.file.newProject":"New","blocks.menu.file.openProject":"Open","blocks.menu.file.saveProject":"Save","blocks.menu.file.uploadProject":"Load from your computer","blocks.menu.file.downloadProject":"Save to your computer","blocks.menu.file.saveAlert":"Saved.","blocks.menu.edit":"Edit","blocks.menu.edit.undo":"Undo","blocks.menu.edit.redo":"Redo","blocks.menu.device":"Device","blocks.menu.device.name":"device","blocks.menu.device.connect":"Connect to your {name}","blocks.menu.device.disconnect":"Disconnect this {name}","blocks.menu.device.download":"Download program","blocks.menu.device.turnOnAutoDownload":"Turn on Auto Download","blocks.menu.device.turnOffAutoDownload":"Turn off Auto Download","blocks.alert.downloading":"Downloading...{progress}%","blocks.alert.downloadCompleted":"Download completed.","blocks.alert.connectionCancel":"Connection cancel.","blocks.alert.connectionError":"Connection error.","blocks.alert.flashOutSpace":"The flash is running out of space.","blocks.codeTab":"Code","blocks.reviewTab":"Code Review","blocks.monitorPane.title":"Monitor","blocks.downloadToDevice":"Download","blocks.extensions.addExtension":"Add Extension","blocks.extensions.empty":"No extension!","blocks.prompt.ok":"OK","blocks.prompt.cancel":"Cancel","blocks.dataPrompt.forAllTargets":"For all targets","blocks.dataPrompt.forThisTarget":"For this target only","blocks.dataPrompt.availableToAllTargets":"This variable will be available to all targets.","blocks.dataPrompt.listAvailableToAllTargets":"This list will be available to all targets.","blocks.myBlockPrompt.title":"Make a Block","blocks.myBlockPrompt.addAnInputNumberText":"Add an input","blocks.myBlockPrompt.numberTextType":"number or text","blocks.myBlockPrompt.addAnInputBoolean":"Add an input","blocks.myBlockPrompt.booleanType":"boolean","blocks.myBlockPrompt.addALabel":"Add a label","blocks.myBlockPrompt.flash":"Run without screen refresh","blocks.myBlockPrompt.command":"Command","blocks.myBlockPrompt.reporterNumberText":"Return number or text","blocks.myBlockPrompt.reporterBoolean":"Return boolean","blocks.event.programStart":"when program start","blocks.control.stopOther":"other scripts","blocks.myblock.addLabel":" label text","blocks.myblock.addBoolean":"boolean","blocks.myblock.addNumbetText":"number or text"};var $e={"blocks.menu.file":"","blocks.menu.file.newProject":"","blocks.menu.file.openProject":"","blocks.menu.file.saveProject":"","blocks.menu.file.uploadProject":"","blocks.menu.file.downloadProject":"","blocks.menu.file.saveAlert":"","blocks.menu.edit":"","blocks.menu.edit.undo":"","blocks.menu.edit.redo":"","blocks.menu.device":"","blocks.menu.device.name":"","blocks.menu.device.connect":"{name}","blocks.menu.device.disconnect":"{name}","blocks.menu.device.download":"","blocks.menu.device.turnOnAutoDownload":"","blocks.menu.device.turnOffAutoDownload":"","blocks.alert.downloading":"{progress}%","blocks.alert.downloadCompleted":"","blocks.alert.connectionCancel":"","blocks.alert.connectionError":"","blocks.alert.flashOutSpace":"","blocks.codeTab":"","blocks.reviewTab":"","blocks.monitorPane.title":"","blocks.downloadToDevice":"","blocks.extensions.addExtension":"","blocks.extensions.empty":"","blocks.prompt.ok":"","blocks.prompt.cancel":"","blocks.dataPrompt.forAllTargets":"","blocks.dataPrompt.forThisTarget":"","blocks.dataPrompt.availableToAllTargets":"","blocks.dataPrompt.listAvailableToAllTargets":"","blocks.myBlockPrompt.title":"","blocks.myBlockPrompt.addAnInputNumberText":"","blocks.myBlockPrompt.numberTextType":"","blocks.myBlockPrompt.addAnInputBoolean":"","blocks.myBlockPrompt.booleanType":"","blocks.myBlockPrompt.addALabel":"","blocks.myBlockPrompt.flash":"","blocks.myBlockPrompt.command":"","blocks.myBlockPrompt.reporterNumberText":"","blocks.myBlockPrompt.reporterBoolean":"","blocks.event.programStart":"","blocks.control.stopOther":"","blocks.myblock.addLabel":"","blocks.myblock.addBoolean":"","blocks.myblock.addNumbetText":""};var Ve={en:ye,"zh-Hans":$e};import{jsx as Pt}from"preact/jsx-runtime";var jo={icon:Fe,label:Pt(xt,{id:"blocks.codeTab",defaultMessage:"Code"}),Content:Ft},fn={icon:Pe,label:Pt(xt,{id:"blocks.reviewTab",defaultMessage:"Code Review"}),Content:jt},Rn={label:Pt(xt,{id:"blocks.monitorPane.title",defaultMessage:"Monitor"}),Content:null},xo=(t,e,o)=>{return[].concat(e,o,ce)};function t1({addLocaleData:t,openProject:e,useDefaultProject:o}){t(Ve);let i=()=>{e(Object.assign(me))};if(o)i();return{mainMenu:Yt({createProject:i,openProject:e,beforeDownload:xo}),tabs:[{...jo,Content:()=>Pt(Ft,{generators:[Ee]})}].concat([]),sidebars:[],pane:!1,tutorials:!1,canEditProjectName:!0}}export{fn as reviewTab,Rn as monitorPane,Yt as makeMainMenu,Ve as locales,t1 as default,jo as codeTab,At as PythonGenerator};
